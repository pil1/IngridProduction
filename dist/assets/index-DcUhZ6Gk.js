var Kd=Object.defineProperty;var Yd=(n,a,t)=>a in n?Kd(n,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[a]=t;var lr=(n,a,t)=>Yd(n,typeof a!="symbol"?a+"":a,t);import{j as e,V as Uo,R as $o,A as Ho,C as Vo,T as Wo,D as Ko,P as Gd,a as Yo,b as Zd,S as Qd,O as Go,c as Xd,d as Zo,e as Qo,f as Xo,g as Jo,h as el,i as Jd,k as Ea,l as tl,m as ka,n as nl,o as Ca,p as Aa,q as rl,r as al,s as il,t as sl,I as eu,u as ol,v as tu,w as ll,x as cl,y as nu,z as dl,B as ru,L as ul,E as ml,F as au,G as iu,H as pl,J as su,K as ou,M as fl,N as hl,Q as gl,U as lu,W as Cr,X as vl,Y as xl,Z as er,_ as Vn,$ as yl,a0 as bl,a1 as _l,a2 as jl,a3 as wl,a4 as Nl,a5 as Sl,a6 as cu,a7 as El,a8 as kl,a9 as Cl,aa as Al,ab as Pl,ac as Ol,ad as Dl,ae as du,af as uu,ag as mu,ah as Tl,ai as pu,aj as fu,ak as tr,al as hu,am as gu,an as Ll,ao as vu,ap as Rt,aq as xu,ar as yu,as as bu}from"./radix-vendor-DbKGBgYu.js";import{h as Rl,a as T,R as W,c as _u,L as Dt,u as kn,e as Bi,i as ju,j as Ui,r as wu,d as Ml,k as $i,l as Nu,O as Cs,m as Su,n as Eu}from"./react-vendor-CqYlms9V.js";import{t as ku,c as Cu,a as Kr,X as Yr,L as fe,B as Pa,C as Kt,S as rn,T as qt,b as Hi,d as Bn,e as Oa,P as br,f as pn,U as Vi,g as qn,h as Xn,R as Au,i as Ft,j as Tt,k as Da,l as xa,F as Ta,m as Fl,n as Il,o as Pu,p as at,E as mn,q as ql,s as cn,r as Wi,u as As,v as Ou,w as Sn,x as Br,y as Ki,z as zl,A as nn,D as on,G as Xa,H as On,I as Du,J as wi,K as Tu,M as Ni,N as Lu,O as Ru,Q as Mu,V as Fu,W as Ja,Y as Ps,Z as Iu,_ as Bl,$ as Ul,a0 as Yi,a1 as Gi,a2 as qu,a3 as zu,a4 as $l,a5 as xt,a6 as Zi,a7 as ya,a8 as Hl,a9 as Bu,aa as Os,ab as wn,ac as vr,ad as Uu,ae as $u,af as Vl,ag as Wl,ah as Si,ai as ei,aj as Hu,ak as Vu,al as Kl,am as La,an as ua,ao as Yl,ap as Wu,aq as Qi,ar as Gr,as as Xi,at as Ku,au as Gl,av as Ra,aw as Yu,ax as Zl,ay as Ei,az as Ql,aA as Xl,aB as Jl,aC as Gu,aD as Zu,aE as Qu,aF as Ds,aG as Ts,aH as Xu,aI as Ju,aJ as em,aK as tm,aL as Ls,aM as nm,aN as rm,aO as am}from"./utils-vendor-D2oH5-QA.js";import{c as im}from"./supabase-vendor-i88PsvXN.js";import{u as Ye,a as je,b as Oe,Q as sm,c as om}from"./query-vendor-f5mZDy0e.js";import{o as lm,r as cm,a as dm,b as tt,e as Ma,p as gt,c as St,s as J,n as yt,u as ct,d as Zr,C as Jt,f as nr,l as Fa,g as Ji,h as um,Z as Xt}from"./form-vendor-DyjNBw7b.js";import{P as st,r as mm,R as ec,L as pm,C as tc,X as nc,Y as rc,T as ac,a as fm,B as hm,b as gm}from"./charts-vendor-Ck1ORfSJ.js";import{_ as vm,a as xm}from"./pdf-vendor-BDGsuRSB.js";import{u as ym,a as Rs,D as bm,c as _m,S as jm,v as wm,b as Nm,s as Sm,K as Em,P as km,d as Cm,C as Am}from"./dnd-vendor-n_ZDzX1e.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function t(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(i){if(i.ep)return;i.ep=!0;const l=t(i);fetch(i.href,l)}})();var ra={},Ms;function Pm(){if(Ms)return ra;Ms=1;var n=Rl();return ra.createRoot=n.createRoot,ra.hydrateRoot=n.hydrateRoot,ra}var Om=Pm();const Dm=1,Tm=1e6;let ti=0;function Lm(){return ti=(ti+1)%Number.MAX_SAFE_INTEGER,ti.toString()}const ni=new Map,Fs=n=>{if(ni.has(n))return;const a=setTimeout(()=>{ni.delete(n),zr({type:"REMOVE_TOAST",toastId:n})},Tm);ni.set(n,a)},Rm=(n,a)=>{switch(a.type){case"ADD_TOAST":return{...n,toasts:[a.toast,...n.toasts].slice(0,Dm)};case"UPDATE_TOAST":return{...n,toasts:n.toasts.map(t=>t.id===a.toast.id?{...t,...a.toast}:t)};case"DISMISS_TOAST":{const{toastId:t}=a;return t?Fs(t):n.toasts.forEach(r=>{Fs(r.id)}),{...n,toasts:n.toasts.map(r=>r.id===t||t===void 0?{...r,open:!1}:r)}}case"REMOVE_TOAST":return a.toastId===void 0?{...n,toasts:[]}:{...n,toasts:n.toasts.filter(t=>t.id!==a.toastId)}}},ma=[];let pa={toasts:[]};function zr(n){pa=Rm(pa,n),ma.forEach(a=>{a(pa)})}function Mm({...n}){const a=Lm(),t=i=>zr({type:"UPDATE_TOAST",toast:{...i,id:a}}),r=()=>zr({type:"DISMISS_TOAST",toastId:a});return zr({type:"ADD_TOAST",toast:{...n,id:a,open:!0,onOpenChange:i=>{i||r()}}}),{id:a,dismiss:r,update:t}}function Ke(){const[n,a]=T.useState(pa);return T.useEffect(()=>(ma.push(a),()=>{const t=ma.indexOf(a);t>-1&&ma.splice(t,1)}),[n]),{...n,toast:Mm,dismiss:t=>zr({type:"DISMISS_TOAST",toastId:t})}}function pe(...n){return ku(Cu(n))}function Dn(n,a="USD"){const t=n??0;try{return new Intl.NumberFormat("en-US",{style:"currency",currency:a,minimumFractionDigits:2,maximumFractionDigits:2}).format(t)}catch{return`${a} ${t.toFixed(2)}`}}async function Fm(n="USD"){try{return new Intl.NumberFormat("en-US",{style:"currency",currency:n,minimumFractionDigits:0,maximumFractionDigits:0}).format(0).replace(/0/g,"").trim()}catch(a){return console.error("Error getting currency symbol:",a),n}}function Ia(n,a){return typeof n!="string"||n.length<=a?n:n.substring(0,a-3)+"..."}const Im=Gd,ic=T.forwardRef(({className:n,...a},t)=>e.jsx(Uo,{ref:t,className:pe("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",n),...a}));ic.displayName=Uo.displayName;const qm=Kr("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),sc=T.forwardRef(({className:n,variant:a,...t},r)=>e.jsx($o,{ref:r,className:pe(qm({variant:a}),n),...t}));sc.displayName=$o.displayName;const zm=T.forwardRef(({className:n,...a},t)=>e.jsx(Ho,{ref:t,className:pe("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",n),...a}));zm.displayName=Ho.displayName;const oc=T.forwardRef(({className:n,...a},t)=>e.jsx(Vo,{ref:t,className:pe("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",n),"toast-close":"",...a,children:e.jsx(Yr,{className:"h-4 w-4"})}));oc.displayName=Vo.displayName;const lc=T.forwardRef(({className:n,...a},t)=>e.jsx(Wo,{ref:t,className:pe("text-sm font-semibold",n),...a}));lc.displayName=Wo.displayName;const cc=T.forwardRef(({className:n,...a},t)=>e.jsx(Ko,{ref:t,className:pe("text-sm opacity-90",n),...a}));cc.displayName=Ko.displayName;function Bm(){const{toasts:n}=Ke();return e.jsxs(Im,{children:[n.map(function({id:a,title:t,description:r,action:i,...l}){return e.jsxs(sc,{...l,children:[e.jsxs("div",{className:"grid gap-1",children:[t&&e.jsx(lc,{children:t}),r&&e.jsx(cc,{children:r})]}),i,e.jsx(oc,{})]},a)}),e.jsx(ic,{})]})}var Is=["light","dark"],Um="(prefers-color-scheme: dark)",$m=T.createContext(void 0),Hm={setTheme:n=>{},themes:[]},Vm=()=>{var n;return(n=T.useContext($m))!=null?n:Hm};T.memo(({forcedTheme:n,storageKey:a,attribute:t,enableSystem:r,enableColorScheme:i,defaultTheme:l,value:c,attrs:m,nonce:u})=>{let h=l==="system",p=t==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${m.map(g=>`'${g}'`).join(",")})`};`:`var d=document.documentElement,n='${t}',s='setAttribute';`,d=i?Is.includes(l)&&l?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${l}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",o=(g,v=!1,x=!0)=>{let y=c?c[g]:g,f=v?g+"|| ''":`'${y}'`,_="";return i&&x&&!v&&Is.includes(g)&&(_+=`d.style.colorScheme = '${g}';`),t==="class"?v||y?_+=`c.add(${f})`:_+="null":y&&(_+=`d[s](n,${f})`),_},s=n?`!function(){${p}${o(n)}}()`:r?`!function(){try{${p}var e=localStorage.getItem('${a}');if('system'===e||(!e&&${h})){var t='${Um}',m=window.matchMedia(t);if(m.media!==t||m.matches){${o("dark")}}else{${o("light")}}}else if(e){${c?`var x=${JSON.stringify(c)};`:""}${o(c?"x[e]":"e",!0)}}${h?"":"else{"+o(l,!1,!1)+"}"}${d}}catch(e){}}()`:`!function(){try{${p}var e=localStorage.getItem('${a}');if(e){${c?`var x=${JSON.stringify(c)};`:""}${o(c?"x[e]":"e",!0)}}else{${o(l,!1,!1)};}${d}}catch(t){}}();`;return T.createElement("script",{nonce:u,dangerouslySetInnerHTML:{__html:s}})});var Wm=n=>{switch(n){case"success":return Gm;case"info":return Qm;case"warning":return Zm;case"error":return Xm;default:return null}},Km=Array(12).fill(0),Ym=({visible:n,className:a})=>W.createElement("div",{className:["sonner-loading-wrapper",a].filter(Boolean).join(" "),"data-visible":n},W.createElement("div",{className:"sonner-spinner"},Km.map((t,r)=>W.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${r}`})))),Gm=W.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},W.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),Zm=W.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},W.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),Qm=W.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},W.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),Xm=W.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},W.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),Jm=W.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},W.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),W.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),ep=()=>{let[n,a]=W.useState(document.hidden);return W.useEffect(()=>{let t=()=>{a(document.hidden)};return document.addEventListener("visibilitychange",t),()=>window.removeEventListener("visibilitychange",t)},[]),n},ki=1,tp=class{constructor(){this.subscribe=n=>(this.subscribers.push(n),()=>{let a=this.subscribers.indexOf(n);this.subscribers.splice(a,1)}),this.publish=n=>{this.subscribers.forEach(a=>a(n))},this.addToast=n=>{this.publish(n),this.toasts=[...this.toasts,n]},this.create=n=>{var a;let{message:t,...r}=n,i=typeof(n==null?void 0:n.id)=="number"||((a=n.id)==null?void 0:a.length)>0?n.id:ki++,l=this.toasts.find(m=>m.id===i),c=n.dismissible===void 0?!0:n.dismissible;return this.dismissedToasts.has(i)&&this.dismissedToasts.delete(i),l?this.toasts=this.toasts.map(m=>m.id===i?(this.publish({...m,...n,id:i,title:t}),{...m,...n,id:i,dismissible:c,title:t}):m):this.addToast({title:t,...r,dismissible:c,id:i}),i},this.dismiss=n=>(this.dismissedToasts.add(n),n||this.toasts.forEach(a=>{this.subscribers.forEach(t=>t({id:a.id,dismiss:!0}))}),this.subscribers.forEach(a=>a({id:n,dismiss:!0})),n),this.message=(n,a)=>this.create({...a,message:n}),this.error=(n,a)=>this.create({...a,message:n,type:"error"}),this.success=(n,a)=>this.create({...a,type:"success",message:n}),this.info=(n,a)=>this.create({...a,type:"info",message:n}),this.warning=(n,a)=>this.create({...a,type:"warning",message:n}),this.loading=(n,a)=>this.create({...a,type:"loading",message:n}),this.promise=(n,a)=>{if(!a)return;let t;a.loading!==void 0&&(t=this.create({...a,promise:n,type:"loading",message:a.loading,description:typeof a.description!="function"?a.description:void 0}));let r=n instanceof Promise?n:n(),i=t!==void 0,l,c=r.then(async u=>{if(l=["resolve",u],W.isValidElement(u))i=!1,this.create({id:t,type:"default",message:u});else if(rp(u)&&!u.ok){i=!1;let h=typeof a.error=="function"?await a.error(`HTTP error! status: ${u.status}`):a.error,p=typeof a.description=="function"?await a.description(`HTTP error! status: ${u.status}`):a.description;this.create({id:t,type:"error",message:h,description:p})}else if(a.success!==void 0){i=!1;let h=typeof a.success=="function"?await a.success(u):a.success,p=typeof a.description=="function"?await a.description(u):a.description;this.create({id:t,type:"success",message:h,description:p})}}).catch(async u=>{if(l=["reject",u],a.error!==void 0){i=!1;let h=typeof a.error=="function"?await a.error(u):a.error,p=typeof a.description=="function"?await a.description(u):a.description;this.create({id:t,type:"error",message:h,description:p})}}).finally(()=>{var u;i&&(this.dismiss(t),t=void 0),(u=a.finally)==null||u.call(a)}),m=()=>new Promise((u,h)=>c.then(()=>l[0]==="reject"?h(l[1]):u(l[1])).catch(h));return typeof t!="string"&&typeof t!="number"?{unwrap:m}:Object.assign(t,{unwrap:m})},this.custom=(n,a)=>{let t=(a==null?void 0:a.id)||ki++;return this.create({jsx:n(t),id:t,...a}),t},this.getActiveToasts=()=>this.toasts.filter(n=>!this.dismissedToasts.has(n.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},en=new tp,np=(n,a)=>{let t=(a==null?void 0:a.id)||ki++;return en.addToast({title:n,...a,id:t}),t},rp=n=>n&&typeof n=="object"&&"ok"in n&&typeof n.ok=="boolean"&&"status"in n&&typeof n.status=="number",ap=np,ip=()=>en.toasts,sp=()=>en.getActiveToasts(),fa=Object.assign(ap,{success:en.success,info:en.info,warning:en.warning,error:en.error,custom:en.custom,message:en.message,promise:en.promise,dismiss:en.dismiss,loading:en.loading},{getHistory:ip,getToasts:sp});function op(n,{insertAt:a}={}){if(typeof document>"u")return;let t=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",a==="top"&&t.firstChild?t.insertBefore(r,t.firstChild):t.appendChild(r),r.styleSheet?r.styleSheet.cssText=n:r.appendChild(document.createTextNode(n))}op(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function aa(n){return n.label!==void 0}var lp=3,cp="32px",dp="16px",qs=4e3,up=356,mp=14,pp=20,fp=200;function gn(...n){return n.filter(Boolean).join(" ")}function hp(n){let[a,t]=n.split("-"),r=[];return a&&r.push(a),t&&r.push(t),r}var gp=n=>{var a,t,r,i,l,c,m,u,h,p,d;let{invert:o,toast:s,unstyled:g,interacting:v,setHeights:x,visibleToasts:y,heights:f,index:_,toasts:b,expanded:E,removeToast:N,defaultRichColors:j,closeButton:C,style:D,cancelButtonStyle:k,actionButtonStyle:w,className:S="",descriptionClassName:P="",duration:O,position:L,gap:$,loadingIcon:B,expandByDefault:Y,classNames:U,icons:q,closeButtonAriaLabel:R="Close toast",pauseWhenPageIsHidden:F}=n,[M,z]=W.useState(null),[H,I]=W.useState(null),[A,V]=W.useState(!1),[K,Q]=W.useState(!1),[de,xe]=W.useState(!1),[Z,re]=W.useState(!1),[ye,Se]=W.useState(!1),[De,te]=W.useState(0),[se,ge]=W.useState(0),ce=W.useRef(s.duration||O||qs),le=W.useRef(null),Ne=W.useRef(null),ae=_===0,ue=_+1<=y,_e=s.type,ie=s.dismissible!==!1,he=s.className||"",We=s.descriptionClassName||"",Fe=W.useMemo(()=>f.findIndex(Be=>Be.toastId===s.id)||0,[f,s.id]),$e=W.useMemo(()=>{var Be;return(Be=s.closeButton)!=null?Be:C},[s.closeButton,C]),me=W.useMemo(()=>s.duration||O||qs,[s.duration,O]),Pe=W.useRef(0),Te=W.useRef(0),mt=W.useRef(0),oe=W.useRef(null),[Le,nt]=L.split("-"),wt=W.useMemo(()=>f.reduce((Be,Ze,it)=>it>=Fe?Be:Be+Ze.height,0),[f,Fe]),_n=ep(),Dr=s.invert||o,or=_e==="loading";Te.current=W.useMemo(()=>Fe*$+wt,[Fe,wt]),W.useEffect(()=>{ce.current=me},[me]),W.useEffect(()=>{V(!0)},[]),W.useEffect(()=>{let Be=Ne.current;if(Be){let Ze=Be.getBoundingClientRect().height;return ge(Ze),x(it=>[{toastId:s.id,height:Ze,position:s.position},...it]),()=>x(it=>it.filter(Gt=>Gt.toastId!==s.id))}},[x,s.id]),W.useLayoutEffect(()=>{if(!A)return;let Be=Ne.current,Ze=Be.style.height;Be.style.height="auto";let it=Be.getBoundingClientRect().height;Be.style.height=Ze,ge(it),x(Gt=>Gt.find(Zt=>Zt.toastId===s.id)?Gt.map(Zt=>Zt.toastId===s.id?{...Zt,height:it}:Zt):[{toastId:s.id,height:it,position:s.position},...Gt])},[A,s.title,s.description,x,s.id]);let fn=W.useCallback(()=>{Q(!0),te(Te.current),x(Be=>Be.filter(Ze=>Ze.toastId!==s.id)),setTimeout(()=>{N(s)},fp)},[s,N,x,Te]);W.useEffect(()=>{if(s.promise&&_e==="loading"||s.duration===1/0||s.type==="loading")return;let Be;return E||v||F&&_n?(()=>{if(mt.current<Pe.current){let Ze=new Date().getTime()-Pe.current;ce.current=ce.current-Ze}mt.current=new Date().getTime()})():ce.current!==1/0&&(Pe.current=new Date().getTime(),Be=setTimeout(()=>{var Ze;(Ze=s.onAutoClose)==null||Ze.call(s,s),fn()},ce.current)),()=>clearTimeout(Be)},[E,v,s,_e,F,_n,fn]),W.useEffect(()=>{s.delete&&fn()},[fn,s.delete]);function na(){var Be,Ze,it;return q!=null&&q.loading?W.createElement("div",{className:gn(U==null?void 0:U.loader,(Be=s==null?void 0:s.classNames)==null?void 0:Be.loader,"sonner-loader"),"data-visible":_e==="loading"},q.loading):B?W.createElement("div",{className:gn(U==null?void 0:U.loader,(Ze=s==null?void 0:s.classNames)==null?void 0:Ze.loader,"sonner-loader"),"data-visible":_e==="loading"},B):W.createElement(Ym,{className:gn(U==null?void 0:U.loader,(it=s==null?void 0:s.classNames)==null?void 0:it.loader),visible:_e==="loading"})}return W.createElement("li",{tabIndex:0,ref:Ne,className:gn(S,he,U==null?void 0:U.toast,(a=s==null?void 0:s.classNames)==null?void 0:a.toast,U==null?void 0:U.default,U==null?void 0:U[_e],(t=s==null?void 0:s.classNames)==null?void 0:t[_e]),"data-sonner-toast":"","data-rich-colors":(r=s.richColors)!=null?r:j,"data-styled":!(s.jsx||s.unstyled||g),"data-mounted":A,"data-promise":!!s.promise,"data-swiped":ye,"data-removed":K,"data-visible":ue,"data-y-position":Le,"data-x-position":nt,"data-index":_,"data-front":ae,"data-swiping":de,"data-dismissible":ie,"data-type":_e,"data-invert":Dr,"data-swipe-out":Z,"data-swipe-direction":H,"data-expanded":!!(E||Y&&A),style:{"--index":_,"--toasts-before":_,"--z-index":b.length-_,"--offset":`${K?De:Te.current}px`,"--initial-height":Y?"auto":`${se}px`,...D,...s.style},onDragEnd:()=>{xe(!1),z(null),oe.current=null},onPointerDown:Be=>{or||!ie||(le.current=new Date,te(Te.current),Be.target.setPointerCapture(Be.pointerId),Be.target.tagName!=="BUTTON"&&(xe(!0),oe.current={x:Be.clientX,y:Be.clientY}))},onPointerUp:()=>{var Be,Ze,it,Gt;if(Z||!ie)return;oe.current=null;let Zt=Number(((Be=Ne.current)==null?void 0:Be.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),hn=Number(((Ze=Ne.current)==null?void 0:Ze.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),pt=new Date().getTime()-((it=le.current)==null?void 0:it.getTime()),kt=M==="x"?Zt:hn,un=Math.abs(kt)/pt;if(Math.abs(kt)>=pp||un>.11){te(Te.current),(Gt=s.onDismiss)==null||Gt.call(s,s),I(M==="x"?Zt>0?"right":"left":hn>0?"down":"up"),fn(),re(!0),Se(!1);return}xe(!1),z(null)},onPointerMove:Be=>{var Ze,it,Gt,Zt;if(!oe.current||!ie||((Ze=window.getSelection())==null?void 0:Ze.toString().length)>0)return;let hn=Be.clientY-oe.current.y,pt=Be.clientX-oe.current.x,kt=(it=n.swipeDirections)!=null?it:hp(L);!M&&(Math.abs(pt)>1||Math.abs(hn)>1)&&z(Math.abs(pt)>Math.abs(hn)?"x":"y");let un={x:0,y:0};M==="y"?(kt.includes("top")||kt.includes("bottom"))&&(kt.includes("top")&&hn<0||kt.includes("bottom")&&hn>0)&&(un.y=hn):M==="x"&&(kt.includes("left")||kt.includes("right"))&&(kt.includes("left")&&pt<0||kt.includes("right")&&pt>0)&&(un.x=pt),(Math.abs(un.x)>0||Math.abs(un.y)>0)&&Se(!0),(Gt=Ne.current)==null||Gt.style.setProperty("--swipe-amount-x",`${un.x}px`),(Zt=Ne.current)==null||Zt.style.setProperty("--swipe-amount-y",`${un.y}px`)}},$e&&!s.jsx?W.createElement("button",{"aria-label":R,"data-disabled":or,"data-close-button":!0,onClick:or||!ie?()=>{}:()=>{var Be;fn(),(Be=s.onDismiss)==null||Be.call(s,s)},className:gn(U==null?void 0:U.closeButton,(i=s==null?void 0:s.classNames)==null?void 0:i.closeButton)},(l=q==null?void 0:q.close)!=null?l:Jm):null,s.jsx||T.isValidElement(s.title)?s.jsx?s.jsx:typeof s.title=="function"?s.title():s.title:W.createElement(W.Fragment,null,_e||s.icon||s.promise?W.createElement("div",{"data-icon":"",className:gn(U==null?void 0:U.icon,(c=s==null?void 0:s.classNames)==null?void 0:c.icon)},s.promise||s.type==="loading"&&!s.icon?s.icon||na():null,s.type!=="loading"?s.icon||(q==null?void 0:q[_e])||Wm(_e):null):null,W.createElement("div",{"data-content":"",className:gn(U==null?void 0:U.content,(m=s==null?void 0:s.classNames)==null?void 0:m.content)},W.createElement("div",{"data-title":"",className:gn(U==null?void 0:U.title,(u=s==null?void 0:s.classNames)==null?void 0:u.title)},typeof s.title=="function"?s.title():s.title),s.description?W.createElement("div",{"data-description":"",className:gn(P,We,U==null?void 0:U.description,(h=s==null?void 0:s.classNames)==null?void 0:h.description)},typeof s.description=="function"?s.description():s.description):null),T.isValidElement(s.cancel)?s.cancel:s.cancel&&aa(s.cancel)?W.createElement("button",{"data-button":!0,"data-cancel":!0,style:s.cancelButtonStyle||k,onClick:Be=>{var Ze,it;aa(s.cancel)&&ie&&((it=(Ze=s.cancel).onClick)==null||it.call(Ze,Be),fn())},className:gn(U==null?void 0:U.cancelButton,(p=s==null?void 0:s.classNames)==null?void 0:p.cancelButton)},s.cancel.label):null,T.isValidElement(s.action)?s.action:s.action&&aa(s.action)?W.createElement("button",{"data-button":!0,"data-action":!0,style:s.actionButtonStyle||w,onClick:Be=>{var Ze,it;aa(s.action)&&((it=(Ze=s.action).onClick)==null||it.call(Ze,Be),!Be.defaultPrevented&&fn())},className:gn(U==null?void 0:U.actionButton,(d=s==null?void 0:s.classNames)==null?void 0:d.actionButton)},s.action.label):null))};function zs(){if(typeof window>"u"||typeof document>"u")return"ltr";let n=document.documentElement.getAttribute("dir");return n==="auto"||!n?window.getComputedStyle(document.documentElement).direction:n}function vp(n,a){let t={};return[n,a].forEach((r,i)=>{let l=i===1,c=l?"--mobile-offset":"--offset",m=l?dp:cp;function u(h){["top","right","bottom","left"].forEach(p=>{t[`${c}-${p}`]=typeof h=="number"?`${h}px`:h})}typeof r=="number"||typeof r=="string"?u(r):typeof r=="object"?["top","right","bottom","left"].forEach(h=>{r[h]===void 0?t[`${c}-${h}`]=m:t[`${c}-${h}`]=typeof r[h]=="number"?`${r[h]}px`:r[h]}):u(m)}),t}var xp=T.forwardRef(function(n,a){let{invert:t,position:r="bottom-right",hotkey:i=["altKey","KeyT"],expand:l,closeButton:c,className:m,offset:u,mobileOffset:h,theme:p="light",richColors:d,duration:o,style:s,visibleToasts:g=lp,toastOptions:v,dir:x=zs(),gap:y=mp,loadingIcon:f,icons:_,containerAriaLabel:b="Notifications",pauseWhenPageIsHidden:E}=n,[N,j]=W.useState([]),C=W.useMemo(()=>Array.from(new Set([r].concat(N.filter(F=>F.position).map(F=>F.position)))),[N,r]),[D,k]=W.useState([]),[w,S]=W.useState(!1),[P,O]=W.useState(!1),[L,$]=W.useState(p!=="system"?p:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),B=W.useRef(null),Y=i.join("+").replace(/Key/g,"").replace(/Digit/g,""),U=W.useRef(null),q=W.useRef(!1),R=W.useCallback(F=>{j(M=>{var z;return(z=M.find(H=>H.id===F.id))!=null&&z.delete||en.dismiss(F.id),M.filter(({id:H})=>H!==F.id)})},[]);return W.useEffect(()=>en.subscribe(F=>{if(F.dismiss){j(M=>M.map(z=>z.id===F.id?{...z,delete:!0}:z));return}setTimeout(()=>{_u.flushSync(()=>{j(M=>{let z=M.findIndex(H=>H.id===F.id);return z!==-1?[...M.slice(0,z),{...M[z],...F},...M.slice(z+1)]:[F,...M]})})})}),[]),W.useEffect(()=>{if(p!=="system"){$(p);return}if(p==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?$("dark"):$("light")),typeof window>"u")return;let F=window.matchMedia("(prefers-color-scheme: dark)");try{F.addEventListener("change",({matches:M})=>{$(M?"dark":"light")})}catch{F.addListener(({matches:z})=>{try{$(z?"dark":"light")}catch(H){console.error(H)}})}},[p]),W.useEffect(()=>{N.length<=1&&S(!1)},[N]),W.useEffect(()=>{let F=M=>{var z,H;i.every(I=>M[I]||M.code===I)&&(S(!0),(z=B.current)==null||z.focus()),M.code==="Escape"&&(document.activeElement===B.current||(H=B.current)!=null&&H.contains(document.activeElement))&&S(!1)};return document.addEventListener("keydown",F),()=>document.removeEventListener("keydown",F)},[i]),W.useEffect(()=>{if(B.current)return()=>{U.current&&(U.current.focus({preventScroll:!0}),U.current=null,q.current=!1)}},[B.current]),W.createElement("section",{ref:a,"aria-label":`${b} ${Y}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},C.map((F,M)=>{var z;let[H,I]=F.split("-");return N.length?W.createElement("ol",{key:F,dir:x==="auto"?zs():x,tabIndex:-1,ref:B,className:m,"data-sonner-toaster":!0,"data-theme":L,"data-y-position":H,"data-lifted":w&&N.length>1&&!l,"data-x-position":I,style:{"--front-toast-height":`${((z=D[0])==null?void 0:z.height)||0}px`,"--width":`${up}px`,"--gap":`${y}px`,...s,...vp(u,h)},onBlur:A=>{q.current&&!A.currentTarget.contains(A.relatedTarget)&&(q.current=!1,U.current&&(U.current.focus({preventScroll:!0}),U.current=null))},onFocus:A=>{A.target instanceof HTMLElement&&A.target.dataset.dismissible==="false"||q.current||(q.current=!0,U.current=A.relatedTarget)},onMouseEnter:()=>S(!0),onMouseMove:()=>S(!0),onMouseLeave:()=>{P||S(!1)},onDragEnd:()=>S(!1),onPointerDown:A=>{A.target instanceof HTMLElement&&A.target.dataset.dismissible==="false"||O(!0)},onPointerUp:()=>O(!1)},N.filter(A=>!A.position&&M===0||A.position===F).map((A,V)=>{var K,Q;return W.createElement(gp,{key:A.id,icons:_,index:V,toast:A,defaultRichColors:d,duration:(K=v==null?void 0:v.duration)!=null?K:o,className:v==null?void 0:v.className,descriptionClassName:v==null?void 0:v.descriptionClassName,invert:t,visibleToasts:g,closeButton:(Q=v==null?void 0:v.closeButton)!=null?Q:c,interacting:P,position:F,style:v==null?void 0:v.style,unstyled:v==null?void 0:v.unstyled,classNames:v==null?void 0:v.classNames,cancelButtonStyle:v==null?void 0:v.cancelButtonStyle,actionButtonStyle:v==null?void 0:v.actionButtonStyle,removeToast:R,toasts:N.filter(de=>de.position==A.position),heights:D.filter(de=>de.position==A.position),setHeights:k,expandByDefault:l,gap:y,loadingIcon:f,expanded:w,pauseWhenPageIsHidden:E,swipeDirections:n.swipeDirections})})):null}))});const yp=({...n})=>{const{theme:a="system"}=Vm();return e.jsx(xp,{theme:a,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...n})},bp=Zd,_p=T.forwardRef(({className:n,sideOffset:a=4,...t},r)=>e.jsx(Yo,{ref:r,sideOffset:a,className:pe("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n),...t}));_p.displayName=Yo.displayName;const jp="https://teyivlpjxmpitqaqmucx.supabase.co",wp="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRleWl2bHBqeG1waXRxYXFtdWN4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTczNDMwNzcsImV4cCI6MjA3MjkxOTA3N30.FzB7NpfU7etqf3Xbl8of_qxW2MsqJckQybirm6G-cZk",X=im(jp,wp);window.supabase=X;const dc=T.createContext(void 0),Np=({children:n})=>{const a=Ye(),[t,r]=T.useState(null),[i,l]=T.useState(null),[c,m]=T.useState(null),[u,h]=T.useState(!0),p=T.useRef(null),{data:d,isLoading:o}=je({queryKey:["profiles",i==null?void 0:i.id],queryFn:async()=>{if(!(i!=null&&i.id))return null;const{data:g,error:v}=await X.from("profiles").select("*").eq("user_id",i.id).single();if(v&&v.code!=="PGRST116")throw console.error("Error fetching profile with react-query:",v),v;return g},enabled:!!(i!=null&&i.id),staleTime:1e3*60*5,refetchOnWindowFocus:!0});T.useEffect(()=>{const g=async(x,y)=>{var f;h(!0),r(y),l((y==null?void 0:y.user)||null),p.current&&(clearTimeout(p.current),p.current=null),(f=y==null?void 0:y.user)!=null&&f.id?((x==="SIGNED_IN"||x==="USER_UPDATED"||x==="INITIAL_SESSION")&&a.invalidateQueries({queryKey:["profiles",y.user.id]}),(x==="SIGNED_IN"||x==="USER_UPDATED")&&(p.current=setTimeout(async()=>{const{data:_,error:b}=await X.auth.refreshSession();b?console.error("Error refreshing session:",b):_.session&&r(_.session),p.current=null},500))):a.removeQueries({queryKey:["profiles"]}),h(!1)},{data:{subscription:v}}=X.auth.onAuthStateChange((x,y)=>{g(x,y)});return X.auth.getSession().then(({data:{session:x}})=>{g("INITIAL_SESSION",x)}).catch(x=>{console.error("Error fetching initial session:",x),r(null),l(null),h(!1)}),()=>{p.current&&clearTimeout(p.current),v.unsubscribe()}},[a]);const s=u||o;return e.jsx(dc.Provider,{value:{session:t,user:i,profile:c||d||null,impersonatedProfile:c,setImpersonatedProfile:m,isLoading:s},children:n})},Ie=()=>{const n=T.useContext(dc);if(n===void 0)throw new Error("useSession must be used within a SessionContextProvider");return n},Sp=()=>{const{isLoading:n}=Ie();return n?e.jsxs("div",{className:"flex flex-1 items-center justify-center",children:[e.jsx(fe,{className:"h-8 w-8 animate-spin"}),e.jsx("p",{className:"ml-2",children:"Loading dashboard..."})]}):e.jsx("div",{className:"flex flex-1 items-center justify-center rounded-lg border border-dashed shadow-sm p-4",children:e.jsxs("div",{className:"flex flex-col items-center gap-1 text-center",children:[e.jsx("h3",{className:"text-2xl font-bold tracking-tight",children:"Welcome to INFOtrac!"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Select a module from the sidebar to get started."})]})})},Ur=Kr("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-brand-accent text-brand-accent-foreground hover:bg-brand-accent/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),ee=T.forwardRef(({className:n,variant:a,size:t,asChild:r=!1,...i},l)=>{const c=r?Qd:"button";return e.jsx(c,{className:pe(Ur({variant:a,size:t,className:n})),ref:l,...i})});ee.displayName="Button";const Ep=()=>e.jsx("div",{className:"flex flex-1 items-center justify-center rounded-lg border border-dashed shadow-sm p-4",children:e.jsxs("div",{className:"flex flex-col items-center gap-1 text-center",children:[e.jsx("h3",{className:"text-2xl font-bold tracking-tight",children:"404 - Page Not Found"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"The page you are looking for does not exist."}),e.jsx(Dt,{to:"/",children:e.jsx(ee,{children:"Go to Dashboard"})})]})});var Bs,rt="colors",Mt="sizes",Ce="space",kp={gap:Ce,gridGap:Ce,columnGap:Ce,gridColumnGap:Ce,rowGap:Ce,gridRowGap:Ce,inset:Ce,insetBlock:Ce,insetBlockEnd:Ce,insetBlockStart:Ce,insetInline:Ce,insetInlineEnd:Ce,insetInlineStart:Ce,margin:Ce,marginTop:Ce,marginRight:Ce,marginBottom:Ce,marginLeft:Ce,marginBlock:Ce,marginBlockEnd:Ce,marginBlockStart:Ce,marginInline:Ce,marginInlineEnd:Ce,marginInlineStart:Ce,padding:Ce,paddingTop:Ce,paddingRight:Ce,paddingBottom:Ce,paddingLeft:Ce,paddingBlock:Ce,paddingBlockEnd:Ce,paddingBlockStart:Ce,paddingInline:Ce,paddingInlineEnd:Ce,paddingInlineStart:Ce,top:Ce,right:Ce,bottom:Ce,left:Ce,scrollMargin:Ce,scrollMarginTop:Ce,scrollMarginRight:Ce,scrollMarginBottom:Ce,scrollMarginLeft:Ce,scrollMarginX:Ce,scrollMarginY:Ce,scrollMarginBlock:Ce,scrollMarginBlockEnd:Ce,scrollMarginBlockStart:Ce,scrollMarginInline:Ce,scrollMarginInlineEnd:Ce,scrollMarginInlineStart:Ce,scrollPadding:Ce,scrollPaddingTop:Ce,scrollPaddingRight:Ce,scrollPaddingBottom:Ce,scrollPaddingLeft:Ce,scrollPaddingX:Ce,scrollPaddingY:Ce,scrollPaddingBlock:Ce,scrollPaddingBlockEnd:Ce,scrollPaddingBlockStart:Ce,scrollPaddingInline:Ce,scrollPaddingInlineEnd:Ce,scrollPaddingInlineStart:Ce,fontSize:"fontSizes",background:rt,backgroundColor:rt,backgroundImage:rt,borderImage:rt,border:rt,borderBlock:rt,borderBlockEnd:rt,borderBlockStart:rt,borderBottom:rt,borderBottomColor:rt,borderColor:rt,borderInline:rt,borderInlineEnd:rt,borderInlineStart:rt,borderLeft:rt,borderLeftColor:rt,borderRight:rt,borderRightColor:rt,borderTop:rt,borderTopColor:rt,caretColor:rt,color:rt,columnRuleColor:rt,fill:rt,outline:rt,outlineColor:rt,stroke:rt,textDecorationColor:rt,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:Mt,minBlockSize:Mt,maxBlockSize:Mt,inlineSize:Mt,minInlineSize:Mt,maxInlineSize:Mt,width:Mt,minWidth:Mt,maxWidth:Mt,height:Mt,minHeight:Mt,maxHeight:Mt,flexBasis:Mt,gridTemplateColumns:Mt,gridTemplateRows:Mt,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},Cp=(n,a)=>typeof a=="function"?{"()":Function.prototype.toString.call(a)}:a,Qr=()=>{const n=Object.create(null);return(a,t,...r)=>{const i=(l=>JSON.stringify(l,Cp))(a);return i in n?n[i]:n[i]=t(a,...r)}},ha=Symbol.for("sxs.internal"),es=(n,a)=>Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)),Us=n=>{for(const a in n)return!0;return!1},{hasOwnProperty:Ap}=Object.prototype,Ci=n=>n.includes("-")?n:n.replace(/[A-Z]/g,a=>"-"+a.toLowerCase()),Pp=/\s+(?![^()]*\))/,cr=n=>a=>n(...typeof a=="string"?String(a).split(Pp):[a]),$s={appearance:n=>({WebkitAppearance:n,appearance:n}),backfaceVisibility:n=>({WebkitBackfaceVisibility:n,backfaceVisibility:n}),backdropFilter:n=>({WebkitBackdropFilter:n,backdropFilter:n}),backgroundClip:n=>({WebkitBackgroundClip:n,backgroundClip:n}),boxDecorationBreak:n=>({WebkitBoxDecorationBreak:n,boxDecorationBreak:n}),clipPath:n=>({WebkitClipPath:n,clipPath:n}),content:n=>({content:n.includes('"')||n.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(n)?n:`"${n}"`}),hyphens:n=>({WebkitHyphens:n,hyphens:n}),maskImage:n=>({WebkitMaskImage:n,maskImage:n}),maskSize:n=>({WebkitMaskSize:n,maskSize:n}),tabSize:n=>({MozTabSize:n,tabSize:n}),textSizeAdjust:n=>({WebkitTextSizeAdjust:n,textSizeAdjust:n}),userSelect:n=>({WebkitUserSelect:n,userSelect:n}),marginBlock:cr((n,a)=>({marginBlockStart:n,marginBlockEnd:a||n})),marginInline:cr((n,a)=>({marginInlineStart:n,marginInlineEnd:a||n})),maxSize:cr((n,a)=>({maxBlockSize:n,maxInlineSize:a||n})),minSize:cr((n,a)=>({minBlockSize:n,minInlineSize:a||n})),paddingBlock:cr((n,a)=>({paddingBlockStart:n,paddingBlockEnd:a||n})),paddingInline:cr((n,a)=>({paddingInlineStart:n,paddingInlineEnd:a||n}))},ri=/([\d.]+)([^]*)/,Op=(n,a)=>n.length?n.reduce((t,r)=>(t.push(...a.map(i=>i.includes("&")?i.replace(/&/g,/[ +>|~]/.test(r)&&/&.*&/.test(i)?`:is(${r})`:r):r+" "+i)),t),[]):a,Dp=(n,a)=>n in Tp&&typeof a=="string"?a.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,(t,r,i,l)=>r+(i==="stretch"?`-moz-available${l};${Ci(n)}:${r}-webkit-fill-available`:`-moz-fit-content${l};${Ci(n)}:${r}fit-content`)+l):String(a),Tp={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},Ln=n=>n?n+"-":"",uc=(n,a,t)=>n.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,(r,i,l,c,m)=>c=="$"==!!l?r:(i||c=="--"?"calc(":"")+"var(--"+(c==="$"?Ln(a)+(m.includes("$")?"":Ln(t))+m.replace(/\$/g,"-"):m)+")"+(i||c=="--"?"*"+(i||"")+(l||"1")+")":"")),Lp=/\s*,\s*(?![^()]*\))/,Rp=Object.prototype.toString,hr=(n,a,t,r,i)=>{let l,c,m;const u=(h,p,d)=>{let o,s;const g=v=>{for(o in v){const f=o.charCodeAt(0)===64,_=f&&Array.isArray(v[o])?v[o]:[v[o]];for(s of _){const b=/[A-Z]/.test(y=o)?y:y.replace(/-[^]/g,N=>N[1].toUpperCase()),E=typeof s=="object"&&s&&s.toString===Rp&&(!r.utils[b]||!p.length);if(b in r.utils&&!E){const N=r.utils[b];if(N!==c){c=N,g(N(s)),c=null;continue}}else if(b in $s){const N=$s[b];if(N!==m){m=N,g(N(s)),m=null;continue}}if(f&&(x=o.slice(1)in r.media?"@media "+r.media[o.slice(1)]:o,o=x.replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,(N,j,C,D,k,w)=>{const S=ri.test(j),P=.0625*(S?-1:1),[O,L]=S?[D,j]:[j,D];return"("+(C[0]==="="?"":C[0]===">"===S?"max-":"min-")+O+":"+(C[0]!=="="&&C.length===1?L.replace(ri,($,B,Y)=>Number(B)+P*(C===">"?1:-1)+Y):L)+(k?") and ("+(k[0]===">"?"min-":"max-")+O+":"+(k.length===1?w.replace(ri,($,B,Y)=>Number(B)+P*(k===">"?-1:1)+Y):w):"")+")"})),E){const N=f?d.concat(o):[...d],j=f?[...p]:Op(p,o.split(Lp));l!==void 0&&i(Hs(...l)),l=void 0,u(s,j,N)}else l===void 0&&(l=[[],p,d]),o=f||o.charCodeAt(0)!==36?o:`--${Ln(r.prefix)}${o.slice(1).replace(/\$/g,"-")}`,s=E?s:typeof s=="number"?s&&b in Mp?String(s)+"px":String(s):uc(Dp(b,s??""),r.prefix,r.themeMap[b]),l[0].push(`${f?`${o} `:`${Ci(o)}:`}${s}`)}}var x,y};g(h),l!==void 0&&i(Hs(...l)),l=void 0};u(n,a,t)},Hs=(n,a,t)=>`${t.map(r=>`${r}{`).join("")}${a.length?`${a.join(",")}{`:""}${n.join(";")}${a.length?"}":""}${Array(t.length?t.length+1:0).join("}")}`,Mp={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},Vs=n=>String.fromCharCode(n+(n>25?39:97)),Gn=n=>(a=>{let t,r="";for(t=Math.abs(a);t>52;t=t/52|0)r=Vs(t%52)+r;return Vs(t%52)+r})(((a,t)=>{let r=t.length;for(;r;)a=33*a^t.charCodeAt(--r);return a})(5381,JSON.stringify(n))>>>0),Fr=["themed","global","styled","onevar","resonevar","allvar","inline"],Fp=n=>{if(n.href&&!n.href.startsWith(location.origin))return!1;try{return!!n.cssRules}catch{return!1}},Ip=n=>{let a;const t=()=>{const{cssRules:i}=a.sheet;return[].map.call(i,(l,c)=>{const{cssText:m}=l;let u="";if(m.startsWith("--sxs"))return"";if(i[c-1]&&(u=i[c-1].cssText).startsWith("--sxs")){if(!l.cssRules.length)return"";for(const h in a.rules)if(a.rules[h].group===l)return`--sxs{--sxs:${[...a.rules[h].cache].join(" ")}}${m}`;return l.cssRules.length?`${u}${m}`:""}return m}).join("")},r=()=>{if(a){const{rules:m,sheet:u}=a;if(!u.deleteRule){for(;Object(Object(u.cssRules)[0]).type===3;)u.cssRules.splice(0,1);u.cssRules=[]}for(const h in m)delete m[h]}const i=Object(n).styleSheets||[];for(const m of i)if(Fp(m)){for(let u=0,h=m.cssRules;h[u];++u){const p=Object(h[u]);if(p.type!==1)continue;const d=Object(h[u+1]);if(d.type!==4)continue;++u;const{cssText:o}=p;if(!o.startsWith("--sxs"))continue;const s=o.slice(14,-3).trim().split(/\s+/),g=Fr[s[0]];g&&(a||(a={sheet:m,reset:r,rules:{},toString:t}),a.rules[g]={group:d,index:u,cache:new Set(s)})}if(a)break}if(!a){const m=(u,h)=>({type:h,cssRules:[],insertRule(p,d){this.cssRules.splice(d,0,m(p,{import:3,undefined:1}[(p.toLowerCase().match(/^@([a-z]+)/)||[])[1]]||4))},get cssText(){return u==="@media{}"?`@media{${[].map.call(this.cssRules,p=>p.cssText).join("")}}`:u}});a={sheet:n?(n.head||n).appendChild(document.createElement("style")).sheet:m("","text/css"),rules:{},reset:r,toString:t}}const{sheet:l,rules:c}=a;for(let m=Fr.length-1;m>=0;--m){const u=Fr[m];if(!c[u]){const h=Fr[m+1],p=c[h]?c[h].index:l.cssRules.length;l.insertRule("@media{}",p),l.insertRule(`--sxs{--sxs:${m}}`,p),c[u]={group:l.cssRules[p+1],index:p,cache:new Set([m])}}qp(c[u])}};return r(),a},qp=n=>{const a=n.group;let t=a.cssRules.length;n.apply=r=>{try{a.insertRule(r,t),++t}catch{}}},Tr=Symbol(),zp=Qr(),Bp=(n,a)=>zp(n,()=>(...t)=>{let r={type:null,composers:new Set};for(const i of t)if(i!=null)if(i[ha]){r.type==null&&(r.type=i[ha].type);for(const l of i[ha].composers)r.composers.add(l)}else i.constructor!==Object||i.$$typeof?r.type==null&&(r.type=i):r.composers.add(Up(i,n));return r.type==null&&(r.type="span"),r.composers.size||r.composers.add(["PJLV",{},[],[],{},[]]),$p(n,r,a)}),Up=({variants:n,compoundVariants:a,defaultVariants:t,...r},i)=>{const l=`${Ln(i.prefix)}c-${Gn(r)}`,c=[],m=[],u=Object.create(null),h=[];for(const o in t)u[o]=String(t[o]);if(typeof n=="object"&&n)for(const o in n){p=u,d=o,Ap.call(p,d)||(u[o]="undefined");const s=n[o];for(const g in s){const v={[o]:String(g)};String(g)==="undefined"&&h.push(o);const x=s[g],y=[v,x,!Us(x)];c.push(y)}}var p,d;if(typeof a=="object"&&a)for(const o of a){let{css:s,...g}=o;s=typeof s=="object"&&s||{};for(const x in g)g[x]=String(g[x]);const v=[g,s,!Us(s)];m.push(v)}return[l,r,c,m,u,h]},$p=(n,a,t)=>{const[r,i,l,c]=Hp(a.composers),m=typeof a.type=="function"||a.type.$$typeof?(d=>{function o(){for(let s=0;s<o[Tr].length;s++){const[g,v]=o[Tr][s];d.rules[g].apply(v)}return o[Tr]=[],null}return o[Tr]=[],o.rules={},Fr.forEach(s=>o.rules[s]={apply:g=>o[Tr].push([s,g])}),o})(t):null,u=(m||t).rules,h=`.${r}${i.length>1?`:where(.${i.slice(1).join(".")})`:""}`,p=d=>{d=typeof d=="object"&&d||Vp;const{css:o,...s}=d,g={};for(const y in l)if(delete s[y],y in d){let f=d[y];typeof f=="object"&&f?g[y]={"@initial":l[y],...f}:(f=String(f),g[y]=f!=="undefined"||c.has(y)?f:l[y])}else g[y]=l[y];const v=new Set([...i]);for(const[y,f,_,b]of a.composers){t.rules.styled.cache.has(y)||(t.rules.styled.cache.add(y),hr(f,[`.${y}`],[],n,j=>{u.styled.apply(j)}));const E=Ws(_,g,n.media),N=Ws(b,g,n.media,!0);for(const j of E)if(j!==void 0)for(const[C,D,k]of j){const w=`${y}-${Gn(D)}-${C}`;v.add(w);const S=(k?t.rules.resonevar:t.rules.onevar).cache,P=k?u.resonevar:u.onevar;S.has(w)||(S.add(w),hr(D,[`.${w}`],[],n,O=>{P.apply(O)}))}for(const j of N)if(j!==void 0)for(const[C,D]of j){const k=`${y}-${Gn(D)}-${C}`;v.add(k),t.rules.allvar.cache.has(k)||(t.rules.allvar.cache.add(k),hr(D,[`.${k}`],[],n,w=>{u.allvar.apply(w)}))}}if(typeof o=="object"&&o){const y=`${r}-i${Gn(o)}-css`;v.add(y),t.rules.inline.cache.has(y)||(t.rules.inline.cache.add(y),hr(o,[`.${y}`],[],n,f=>{u.inline.apply(f)}))}for(const y of String(d.className||"").trim().split(/\s+/))y&&v.add(y);const x=s.className=[...v].join(" ");return{type:a.type,className:x,selector:h,props:s,toString:()=>x,deferredInjector:m}};return es(p,{className:r,selector:h,[ha]:a,toString:()=>(t.rules.styled.cache.has(r)||p(),r)})},Hp=n=>{let a="";const t=[],r={},i=[];for(const[l,,,,c,m]of n){a===""&&(a=l),t.push(l),i.push(...m);for(const u in c){const h=c[u];(r[u]===void 0||h!=="undefined"||m.includes(h))&&(r[u]=h)}}return[a,t,r,new Set(i)]},Ws=(n,a,t,r)=>{const i=[];e:for(let[l,c,m]of n){if(m)continue;let u,h=0,p=!1;for(u in l){const d=l[u];let o=a[u];if(o!==d){if(typeof o!="object"||!o)continue e;{let s,g,v=0;for(const x in o){if(d===String(o[x])){if(x!=="@initial"){const y=x.slice(1);(g=g||[]).push(y in t?t[y]:x.replace(/^@media ?/,"")),p=!0}h+=v,s=!0}++v}if(g&&g.length&&(c={["@media "+g.join(", ")]:c}),!s)continue e}}}(i[h]=i[h]||[]).push([r?"cv":`${u}-${l[u]}`,c,p])}return i},Vp={},Wp=Qr(),Kp=(n,a)=>Wp(n,()=>(...t)=>{const r=()=>{for(let i of t){i=typeof i=="object"&&i||{};let l=Gn(i);if(!a.rules.global.cache.has(l)){if(a.rules.global.cache.add(l),"@import"in i){let c=[].indexOf.call(a.sheet.cssRules,a.rules.themed.group)-1;for(let m of[].concat(i["@import"]))m=m.includes('"')||m.includes("'")?m:`"${m}"`,a.sheet.insertRule(`@import ${m};`,c++);delete i["@import"]}hr(i,[],[],n,c=>{a.rules.global.apply(c)})}}return""};return es(r,{toString:r})}),Yp=Qr(),Gp=(n,a)=>Yp(n,()=>t=>{const r=`${Ln(n.prefix)}k-${Gn(t)}`,i=()=>{if(!a.rules.global.cache.has(r)){a.rules.global.cache.add(r);const l=[];hr(t,[],[],n,m=>l.push(m));const c=`@keyframes ${r}{${l.join("")}}`;a.rules.global.apply(c)}return r};return es(i,{get name(){return i()},toString:i})}),Zp=class{constructor(a,t,r,i){this.token=a==null?"":String(a),this.value=t==null?"":String(t),this.scale=r==null?"":String(r),this.prefix=i==null?"":String(i)}get computedValue(){return"var("+this.variable+")"}get variable(){return"--"+Ln(this.prefix)+Ln(this.scale)+this.token}toString(){return this.computedValue}},Qp=Qr(),Xp=(n,a)=>Qp(n,()=>(t,r)=>{r=typeof t=="object"&&t||Object(r);const i=`.${t=(t=typeof t=="string"?t:"")||`${Ln(n.prefix)}t-${Gn(r)}`}`,l={},c=[];for(const u in r){l[u]={};for(const h in r[u]){const p=`--${Ln(n.prefix)}${u}-${h}`,d=uc(String(r[u][h]),n.prefix,u);l[u][h]=new Zp(h,d,u,n.prefix),c.push(`${p}:${d}`)}}const m=()=>{if(c.length&&!a.rules.themed.cache.has(t)){a.rules.themed.cache.add(t);const u=`${r===n.theme?":root,":""}.${t}{${c.join(";")}}`;a.rules.themed.apply(u)}return t};return{...l,get className(){return m()},selector:i,toString:m}}),Jp=Qr(),mc=n=>{let a=!1;const t=Jp(n,r=>{a=!0;const i="prefix"in(r=typeof r=="object"&&r||{})?String(r.prefix):"",l=typeof r.media=="object"&&r.media||{},c=typeof r.root=="object"?r.root||null:globalThis.document||null,m=typeof r.theme=="object"&&r.theme||{},u={prefix:i,media:l,theme:m,themeMap:typeof r.themeMap=="object"&&r.themeMap||{...kp},utils:typeof r.utils=="object"&&r.utils||{}},h=Ip(c),p={css:Bp(u,h),globalCss:Kp(u,h),keyframes:Gp(u,h),createTheme:Xp(u,h),reset(){h.reset(),p.theme.toString()},theme:{},sheet:h,config:u,prefix:i,getCssText:h.toString,toString:h.toString};return String(p.theme=p.createTheme(m)),p});return a||t.reset(),t},pc=()=>Bs||(Bs=mc()),ef=(...n)=>pc().createTheme(...n),Rn=(...n)=>pc().css(...n),fc={default:{colors:{brand:"hsl(153 60.0% 53.0%)",brandAccent:"hsl(154 54.8% 45.1%)",brandButtonText:"white",defaultButtonBackground:"white",defaultButtonBackgroundHover:"#eaeaea",defaultButtonBorder:"lightgray",defaultButtonText:"gray",dividerBackground:"#eaeaea",inputBackground:"transparent",inputBorder:"lightgray",inputBorderHover:"gray",inputBorderFocus:"gray",inputText:"black",inputLabelText:"gray",inputPlaceholder:"darkgray",messageText:"#2b805a",messageBackground:"#e7fcf1",messageBorder:"#d0f3e1",messageTextDanger:"#ff6369",messageBackgroundDanger:"#fff8f8",messageBorderDanger:"#822025",anchorTextColor:"gray",anchorTextHoverColor:"darkgray"},space:{spaceSmall:"4px",spaceMedium:"8px",spaceLarge:"16px",labelBottomMargin:"8px",anchorBottomMargin:"4px",emailInputSpacing:"4px",socialAuthSpacing:"4px",buttonPadding:"10px 15px",inputPadding:"10px 15px"},fontSizes:{baseBodySize:"13px",baseInputSize:"14px",baseLabelSize:"14px",baseButtonSize:"14px"},fonts:{bodyFontFamily:"ui-sans-serif, sans-serif",buttonFontFamily:"ui-sans-serif, sans-serif",inputFontFamily:"ui-sans-serif, sans-serif",labelFontFamily:"ui-sans-serif, sans-serif"},borderWidths:{buttonBorderWidth:"1px",inputBorderWidth:"1px"},radii:{borderRadiusButton:"4px",buttonBorderRadius:"4px",inputBorderRadius:"4px"}},dark:{colors:{brandButtonText:"white",defaultButtonBackground:"#2e2e2e",defaultButtonBackgroundHover:"#3e3e3e",defaultButtonBorder:"#3e3e3e",defaultButtonText:"white",dividerBackground:"#2e2e2e",inputBackground:"#1e1e1e",inputBorder:"#3e3e3e",inputBorderHover:"gray",inputBorderFocus:"gray",inputText:"white",inputPlaceholder:"darkgray",messageText:"#85e0b7",messageBackground:"#072719",messageBorder:"#2b805a",messageBackgroundDanger:"#1f1315"}}},Nt={SIGN_IN:"sign_in",SIGN_UP:"sign_up",FORGOTTEN_PASSWORD:"forgotten_password",MAGIC_LINK:"magic_link",UPDATE_PASSWORD:"update_password",VERIFY_OTP:"verify_otp"},tf="supabase-auth-ui",nf={ROOT:"root",SIGN_IN:Nt.SIGN_IN,SIGN_UP:Nt.SIGN_UP,FORGOTTEN_PASSWORD:Nt.FORGOTTEN_PASSWORD,MAGIC_LINK:Nt.MAGIC_LINK,UPDATE_PASSWORD:Nt.UPDATE_PASSWORD,anchor:"ui-anchor",button:"ui-button",container:"ui-container",divider:"ui-divider",input:"ui-input",label:"ui-label",loader:"ui-loader",message:"ui-message"};function rr(n,a,t){var r,i;const l=[],c=nf[n];return l.push(t!=null&&t.prependedClassName?(t==null?void 0:t.prependedClassName)+"_"+c:tf+"_"+c),(r=t==null?void 0:t.className)!=null&&r[n]&&l.push((i=t==null?void 0:t.className)==null?void 0:i[n]),((t==null?void 0:t.extend)===void 0||(t==null?void 0:t.extend)===!0)&&l.push(a),l}function Ai(n,a){let t;if(n&&a&&typeof n=="object"&&typeof a=="object"){if(Array.isArray(a))for(t=0;t<a.length;t++)n[t]=Ai(n[t],a[t]);else for(t in a)n[t]=Ai(n[t],a[t]);return n}return a}function ai(n,...a){let t=a.length;for(let r=0;r<t;r++)n=Ai(n,a[r]);return n}function rf(n,a){return n.replace(/{{(\w+)}}/g,(t,r)=>a.hasOwnProperty(r)?a[r]:t)}var af={sign_up:{email_label:"Email address",password_label:"Create a Password",email_input_placeholder:"Your email address",password_input_placeholder:"Your password",button_label:"Sign up",loading_button_label:"Signing up ...",social_provider_text:"Sign in with {{provider}}",link_text:"Don't have an account? Sign up",confirmation_text:"Check your email for the confirmation link"},sign_in:{email_label:"Email address",password_label:"Your Password",email_input_placeholder:"Your email address",password_input_placeholder:"Your password",button_label:"Sign in",loading_button_label:"Signing in ...",social_provider_text:"Sign in with {{provider}}",link_text:"Already have an account? Sign in"},magic_link:{email_input_label:"Email address",email_input_placeholder:"Your email address",button_label:"Send Magic Link",loading_button_label:"Sending Magic Link ...",link_text:"Send a magic link email",confirmation_text:"Check your email for the magic link"},forgotten_password:{email_label:"Email address",password_label:"Your Password",email_input_placeholder:"Your email address",button_label:"Send reset password instructions",loading_button_label:"Sending reset instructions ...",link_text:"Forgot your password?",confirmation_text:"Check your email for the password reset link"},update_password:{password_label:"New password",password_input_placeholder:"Your new password",button_label:"Update password",loading_button_label:"Updating password ...",confirmation_text:"Your password has been updated"},verify_otp:{email_input_label:"Email address",email_input_placeholder:"Your email address",phone_input_label:"Phone number",phone_input_placeholder:"Your phone number",token_input_label:"Token",token_input_placeholder:"Your Otp token",button_label:"Verify token",loading_button_label:"Signing in ..."}};const sf=Rn({fontFamily:"$bodyFontFamily",fontSize:"$baseBodySize",marginBottom:"$anchorBottomMargin",color:"$anchorTextColor",display:"block",textAlign:"center",textDecoration:"underline","&:hover":{color:"$anchorTextHoverColor"}}),Wn=({children:n,appearance:a,...t})=>{var r;const i=rr("anchor",sf(),a);return W.createElement("a",{...t,style:(r=a==null?void 0:a.style)==null?void 0:r.anchor,className:i.join(" ")},n)},of=Rn({fontFamily:"$buttonFontFamily",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",borderRadius:"$borderRadiusButton",fontSize:"$baseButtonSize",padding:"$buttonPadding",cursor:"pointer",borderWidth:"$buttonBorderWidth",borderStyle:"solid",width:"100%",transitionProperty:"background-color",transitionTimingFunction:"cubic-bezier(0.4, 0, 0.2, 1)",transitionDuration:"100ms","&:disabled":{opacity:.7,cursor:"unset"},variants:{color:{default:{backgroundColor:"$defaultButtonBackground",color:"$defaultButtonText",borderColor:"$defaultButtonBorder","&:hover:not(:disabled)":{backgroundColor:"$defaultButtonBackgroundHover"}},primary:{backgroundColor:"$brand",color:"$brandButtonText",borderColor:"$brandAccent","&:hover:not(:disabled)":{backgroundColor:"$brandAccent"}}}}}),Ar=({children:n,color:a="default",appearance:t,icon:r,loading:i=!1,...l})=>{var c;const m=rr("button",of({color:a}),t);return W.createElement("button",{...l,style:(c=t==null?void 0:t.style)==null?void 0:c.button,className:m.join(" "),disabled:i},r,n)},lf=Rn({display:"flex",gap:"4px",variants:{direction:{horizontal:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(48px, 1fr))"},vertical:{flexDirection:"column",margin:"8px 0"}},gap:{small:{gap:"4px"},medium:{gap:"8px"},large:{gap:"16px"}}}}),Nn=({children:n,appearance:a,...t})=>{var r;const i=rr("container",lf({direction:t.direction,gap:t.gap}),a);return W.createElement("div",{...t,style:(r=a==null?void 0:a.style)==null?void 0:r.container,className:i.join(" ")},n)},cf=Rn({background:"$dividerBackground",display:"block",margin:"16px 0",height:"1px",width:"100%"}),df=({children:n,appearance:a,...t})=>{var r;const i=rr("divider",cf(),a);return W.createElement("div",{...t,style:(r=a==null?void 0:a.style)==null?void 0:r.divider,className:i.join(" ")})},uf=Rn({fontFamily:"$inputFontFamily",background:"$inputBackground",borderRadius:"$inputBorderRadius",padding:"$inputPadding",cursor:"text",borderWidth:"$inputBorderWidth",borderColor:"$inputBorder",borderStyle:"solid",fontSize:"$baseInputSize",width:"100%",color:"$inputText",boxSizing:"border-box","&:hover":{borderColor:"$inputBorderHover",outline:"none"},"&:focus":{borderColor:"$inputBorderFocus",outline:"none"},"&::placeholder":{color:"$inputPlaceholder",letterSpacing:"initial"},transitionProperty:"background-color, border",transitionTimingFunction:"cubic-bezier(0.4, 0, 0.2, 1)",transitionDuration:"100ms",variants:{type:{default:{letterSpacing:"0px"},password:{letterSpacing:"0px"}}}}),Fn=({children:n,appearance:a,...t})=>{var r;const i=rr("input",uf({type:t.type==="password"?"password":"default"}),a);return W.createElement("input",{...t,style:(r=a==null?void 0:a.style)==null?void 0:r.input,className:i.join(" ")},n)},mf=Rn({fontFamily:"$labelFontFamily",fontSize:"$baseLabelSize",marginBottom:"$labelBottomMargin",color:"$inputLabelText",display:"block"}),In=({children:n,appearance:a,...t})=>{var r;const i=rr("label",mf(),a);return W.createElement("label",{...t,style:(r=a==null?void 0:a.style)==null?void 0:r.label,className:i.join(" ")},n)},pf=Rn({fontFamily:"$bodyFontFamily",fontSize:"$baseInputSize",marginBottom:"$labelBottomMargin",display:"block",textAlign:"center",borderRadius:"0.375rem",padding:"1.5rem 1rem",lineHeight:"1rem",color:"$messageText",backgroundColor:"$messageBackground",border:"1px solid $messageBorder",variants:{color:{danger:{color:"$messageTextDanger",backgroundColor:"$messageBackgroundDanger",border:"1px solid $messageBorderDanger"}}}}),En=({children:n,appearance:a,...t})=>{var r;const i=rr("message",pf({color:t.color}),a);return W.createElement("span",{...t,style:(r=a==null?void 0:a.style)==null?void 0:r.message,className:i.join(" ")},n)};function hc({setAuthView:n=()=>{},supabaseClient:a,redirectTo:t,i18n:r,appearance:i,showLinks:l=!1}){var c;const[m,u]=T.useState(""),[h,p]=T.useState(""),[d,o]=T.useState(""),[s,g]=T.useState(!1),v=async y=>{var f,_;if(y.preventDefault(),p(""),o(""),g(!0),m.length===0){p((f=r==null?void 0:r.magic_link)==null?void 0:f.empty_email_address),g(!1);return}const{error:b}=await a.auth.signInWithOtp({email:m,options:{emailRedirectTo:t}});b?p(b.message):o((_=r==null?void 0:r.magic_link)==null?void 0:_.confirmation_text),g(!1)},x=r==null?void 0:r.magic_link;return W.createElement("form",{id:"auth-magic-link",onSubmit:v},W.createElement(Nn,{gap:"large",direction:"vertical",appearance:i},W.createElement("div",null,W.createElement(In,{htmlFor:"email",appearance:i},x==null?void 0:x.email_input_label),W.createElement(Fn,{id:"email",name:"email",type:"email",autoFocus:!0,placeholder:x==null?void 0:x.email_input_placeholder,onChange:y=>{p&&p(""),u(y.target.value)},appearance:i})),W.createElement(Ar,{color:"primary",type:"submit",loading:s,appearance:i},s?x==null?void 0:x.loading_button_label:x==null?void 0:x.button_label),l&&W.createElement(Wn,{href:"#auth-sign-in",onClick:y=>{y.preventDefault(),n(Nt.SIGN_IN)},appearance:i},(c=r==null?void 0:r.sign_in)==null?void 0:c.link_text),d&&W.createElement(En,{appearance:i},d),h&&W.createElement(En,{color:"danger",appearance:i},h)))}const Lt=Rn({width:"21px",height:"21px"}),ff=({provider:n})=>n=="google"?hf():n=="facebook"?gf():n=="twitter"?vf():n=="apple"?xf():n=="github"?yf():n=="gitlab"?bf():n=="bitbucket"?_f():n=="discord"?jf():n=="azure"?wf():n=="keycloak"?Nf():n=="linkedin"?Sf():n=="notion"?Ef():n=="slack"?kf():n=="spotify"?Cf():n=="twitch"?Af():n=="workos"?Pf():n=="kakao"?Of():null,hf=()=>W.createElement("svg",{className:Lt(),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",width:"21px",height:"21px"},W.createElement("path",{fill:"#FFC107",d:"M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"}),W.createElement("path",{fill:"#FF3D00",d:"M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"}),W.createElement("path",{fill:"#4CAF50",d:"M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"}),W.createElement("path",{fill:"#1976D2",d:"M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571c0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z"})),gf=()=>W.createElement("svg",{className:Lt(),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",width:"21px",height:"21px"},W.createElement("path",{fill:"#039be5",d:"M24 5A19 19 0 1 0 24 43A19 19 0 1 0 24 5Z"}),W.createElement("path",{fill:"#fff",d:"M26.572,29.036h4.917l0.772-4.995h-5.69v-2.73c0-2.075,0.678-3.915,2.619-3.915h3.119v-4.359c-0.548-0.074-1.707-0.236-3.897-0.236c-4.573,0-7.254,2.415-7.254,7.917v3.323h-4.701v4.995h4.701v13.729C22.089,42.905,23.032,43,24,43c0.875,0,1.729-0.08,2.572-0.194V29.036z"})),vf=()=>W.createElement("svg",{className:Lt(),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",width:"21px",height:"21px"},W.createElement("path",{fill:"#03A9F4",d:"M42,12.429c-1.323,0.586-2.746,0.977-4.247,1.162c1.526-0.906,2.7-2.351,3.251-4.058c-1.428,0.837-3.01,1.452-4.693,1.776C34.967,9.884,33.05,9,30.926,9c-4.08,0-7.387,3.278-7.387,7.32c0,0.572,0.067,1.129,0.193,1.67c-6.138-0.308-11.582-3.226-15.224-7.654c-0.64,1.082-1,2.349-1,3.686c0,2.541,1.301,4.778,3.285,6.096c-1.211-0.037-2.351-0.374-3.349-0.914c0,0.022,0,0.055,0,0.086c0,3.551,2.547,6.508,5.923,7.181c-0.617,0.169-1.269,0.263-1.941,0.263c-0.477,0-0.942-0.054-1.392-0.135c0.94,2.902,3.667,5.023,6.898,5.086c-2.528,1.96-5.712,3.134-9.174,3.134c-0.598,0-1.183-0.034-1.761-0.104C9.268,36.786,13.152,38,17.321,38c13.585,0,21.017-11.156,21.017-20.834c0-0.317-0.01-0.633-0.025-0.945C39.763,15.197,41.013,13.905,42,12.429"})),xf=()=>W.createElement("svg",{className:Lt(),fill:"gray",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"21px",height:"21px"}," ",W.createElement("path",{d:"M 15.904297 1.078125 C 15.843359 1.06875 15.774219 1.0746094 15.699219 1.0996094 C 14.699219 1.2996094 13.600391 1.8996094 12.900391 2.5996094 C 12.300391 3.1996094 11.800781 4.1996094 11.800781 5.0996094 C 11.800781 5.2996094 11.999219 5.5 12.199219 5.5 C 13.299219 5.4 14.399609 4.7996094 15.099609 4.0996094 C 15.699609 3.2996094 16.199219 2.4 16.199219 1.5 C 16.199219 1.275 16.087109 1.10625 15.904297 1.078125 z M 16.199219 5.4003906 C 14.399219 5.4003906 13.600391 6.5 12.400391 6.5 C 11.100391 6.5 9.9003906 5.5 8.4003906 5.5 C 6.3003906 5.5 3.0996094 7.4996094 3.0996094 12.099609 C 2.9996094 16.299609 6.8 21 9 21 C 10.3 21 10.600391 20.199219 12.400391 20.199219 C 14.200391 20.199219 14.600391 21 15.900391 21 C 17.400391 21 18.500391 19.399609 19.400391 18.099609 C 19.800391 17.399609 20.100391 17.000391 20.400391 16.400391 C 20.600391 16.000391 20.4 15.600391 20 15.400391 C 17.4 14.100391 16.900781 9.9003906 19.800781 8.4003906 C 20.300781 8.1003906 20.4 7.4992188 20 7.1992188 C 18.9 6.1992187 17.299219 5.4003906 16.199219 5.4003906 z"})),yf=()=>W.createElement("svg",{className:Lt(),fill:"gray",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 30 30",width:"21px",height:"21px"}," ",W.createElement("path",{d:"M15,3C8.373,3,3,8.373,3,15c0,5.623,3.872,10.328,9.092,11.63C12.036,26.468,12,26.28,12,26.047v-2.051 c-0.487,0-1.303,0-1.508,0c-0.821,0-1.551-0.353-1.905-1.009c-0.393-0.729-0.461-1.844-1.435-2.526 c-0.289-0.227-0.069-0.486,0.264-0.451c0.615,0.174,1.125,0.596,1.605,1.222c0.478,0.627,0.703,0.769,1.596,0.769 c0.433,0,1.081-0.025,1.691-0.121c0.328-0.833,0.895-1.6,1.588-1.962c-3.996-0.411-5.903-2.399-5.903-5.098 c0-1.162,0.495-2.286,1.336-3.233C9.053,10.647,8.706,8.73,9.435,8c1.798,0,2.885,1.166,3.146,1.481C13.477,9.174,14.461,9,15.495,9 c1.036,0,2.024,0.174,2.922,0.483C18.675,9.17,19.763,8,21.565,8c0.732,0.731,0.381,2.656,0.102,3.594 c0.836,0.945,1.328,2.066,1.328,3.226c0,2.697-1.904,4.684-5.894,5.097C18.199,20.49,19,22.1,19,23.313v2.734 c0,0.104-0.023,0.179-0.035,0.268C23.641,24.676,27,20.236,27,15C27,8.373,21.627,3,15,3z"})),bf=()=>W.createElement("svg",{className:Lt(),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",width:"21px",height:"21px"},W.createElement("path",{fill:"#e53935",d:"M24 43L16 20 32 20z"}),W.createElement("path",{fill:"#ff7043",d:"M24 43L42 20 32 20z"}),W.createElement("path",{fill:"#e53935",d:"M37 5L42 20 32 20z"}),W.createElement("path",{fill:"#ffa726",d:"M24 43L42 20 45 28z"}),W.createElement("path",{fill:"#ff7043",d:"M24 43L6 20 16 20z"}),W.createElement("path",{fill:"#e53935",d:"M11 5L6 20 16 20z"}),W.createElement("path",{fill:"#ffa726",d:"M24 43L6 20 3 28z"})),_f=()=>W.createElement("svg",{className:Lt(),xmlns:"http://www.w3.org/2000/svg",width:"512",height:"512",viewBox:"0 0 62.42 62.42"},W.createElement("defs",null,W.createElement("linearGradient",{id:"New_Gradient_Swatch_1",x1:"64.01",y1:"30.27",x2:"32.99",y2:"54.48",gradientUnits:"userSpaceOnUse"},W.createElement("stop",{offset:"0.18",stopColor:"#0052cc"}),W.createElement("stop",{offset:"1",stopColor:"#2684ff"}))),W.createElement("title",null,"Bitbucket-blue"),W.createElement("g",{id:"Layer_2","data-name":"Layer 2"},W.createElement("g",{id:"Blue",transform:"translate(0 -3.13)"},W.createElement("path",{d:"M2,6.26A2,2,0,0,0,0,8.58L8.49,60.12a2.72,2.72,0,0,0,2.66,2.27H51.88a2,2,0,0,0,2-1.68L62.37,8.59a2,2,0,0,0-2-2.32ZM37.75,43.51h-13L21.23,25.12H40.9Z",fill:"#2684ff"}),W.createElement("path",{d:"M59.67,25.12H40.9L37.75,43.51h-13L9.4,61.73a2.71,2.71,0,0,0,1.75.66H51.89a2,2,0,0,0,2-1.68Z",fill:"url(#New_Gradient_Swatch_1)"})))),jf=()=>W.createElement("svg",{className:Lt(),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",width:"21px",height:"21px"},W.createElement("path",{fill:"#536dfe",d:"M39.248,10.177c-2.804-1.287-5.812-2.235-8.956-2.778c-0.057-0.01-0.114,0.016-0.144,0.068	c-0.387,0.688-0.815,1.585-1.115,2.291c-3.382-0.506-6.747-0.506-10.059,0c-0.3-0.721-0.744-1.603-1.133-2.291	c-0.03-0.051-0.087-0.077-0.144-0.068c-3.143,0.541-6.15,1.489-8.956,2.778c-0.024,0.01-0.045,0.028-0.059,0.051	c-5.704,8.522-7.267,16.835-6.5,25.044c0.003,0.04,0.026,0.079,0.057,0.103c3.763,2.764,7.409,4.442,10.987,5.554	c0.057,0.017,0.118-0.003,0.154-0.051c0.846-1.156,1.601-2.374,2.248-3.656c0.038-0.075,0.002-0.164-0.076-0.194	c-1.197-0.454-2.336-1.007-3.432-1.636c-0.087-0.051-0.094-0.175-0.014-0.234c0.231-0.173,0.461-0.353,0.682-0.534	c0.04-0.033,0.095-0.04,0.142-0.019c7.201,3.288,14.997,3.288,22.113,0c0.047-0.023,0.102-0.016,0.144,0.017	c0.22,0.182,0.451,0.363,0.683,0.536c0.08,0.059,0.075,0.183-0.012,0.234c-1.096,0.641-2.236,1.182-3.434,1.634	c-0.078,0.03-0.113,0.12-0.075,0.196c0.661,1.28,1.415,2.498,2.246,3.654c0.035,0.049,0.097,0.07,0.154,0.052	c3.595-1.112,7.241-2.79,11.004-5.554c0.033-0.024,0.054-0.061,0.057-0.101c0.917-9.491-1.537-17.735-6.505-25.044	C39.293,10.205,39.272,10.187,39.248,10.177z M16.703,30.273c-2.168,0-3.954-1.99-3.954-4.435s1.752-4.435,3.954-4.435	c2.22,0,3.989,2.008,3.954,4.435C20.658,28.282,18.906,30.273,16.703,30.273z M31.324,30.273c-2.168,0-3.954-1.99-3.954-4.435	s1.752-4.435,3.954-4.435c2.22,0,3.989,2.008,3.954,4.435C35.278,28.282,33.544,30.273,31.324,30.273z"})),wf=()=>W.createElement("svg",{className:Lt(),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",width:"21px",height:"21px"},W.createElement("linearGradient",{id:"k8yl7~hDat~FaoWq8WjN6a",x1:"-1254.397",x2:"-1261.911",y1:"877.268",y2:"899.466",gradientTransform:"translate(1981.75 -1362.063) scale(1.5625)",gradientUnits:"userSpaceOnUse"},W.createElement("stop",{offset:"0",stopColor:"#114a8b"}),W.createElement("stop",{offset:"1",stopColor:"#0669bc"})),W.createElement("path",{fill:"url(#k8yl7~hDat~FaoWq8WjN6a)",d:"M17.634,6h11.305L17.203,40.773c-0.247,0.733-0.934,1.226-1.708,1.226H6.697 c-0.994,0-1.8-0.806-1.8-1.8c0-0.196,0.032-0.39,0.094-0.576L15.926,7.227C16.173,6.494,16.86,6,17.634,6L17.634,6z"}),W.createElement("path",{fill:"#0078d4",d:"M34.062,29.324H16.135c-0.458-0.001-0.83,0.371-0.831,0.829c0,0.231,0.095,0.451,0.264,0.608 l11.52,10.752C27.423,41.826,27.865,42,28.324,42h10.151L34.062,29.324z"}),W.createElement("linearGradient",{id:"k8yl7~hDat~FaoWq8WjN6b",x1:"-1252.05",x2:"-1253.788",y1:"887.612",y2:"888.2",gradientTransform:"translate(1981.75 -1362.063) scale(1.5625)",gradientUnits:"userSpaceOnUse"},W.createElement("stop",{offset:"0",stopOpacity:".3"}),W.createElement("stop",{offset:".071",stopOpacity:".2"}),W.createElement("stop",{offset:".321",stopOpacity:".1"}),W.createElement("stop",{offset:".623",stopOpacity:".05"}),W.createElement("stop",{offset:"1",stopOpacity:"0"})),W.createElement("path",{fill:"url(#k8yl7~hDat~FaoWq8WjN6b)",d:"M17.634,6c-0.783-0.003-1.476,0.504-1.712,1.25L5.005,39.595 c-0.335,0.934,0.151,1.964,1.085,2.299C6.286,41.964,6.493,42,6.702,42h9.026c0.684-0.122,1.25-0.603,1.481-1.259l2.177-6.416 l7.776,7.253c0.326,0.27,0.735,0.419,1.158,0.422h10.114l-4.436-12.676l-12.931,0.003L28.98,6H17.634z"}),W.createElement("linearGradient",{id:"k8yl7~hDat~FaoWq8WjN6c",x1:"-1252.952",x2:"-1244.704",y1:"876.6",y2:"898.575",gradientTransform:"translate(1981.75 -1362.063) scale(1.5625)",gradientUnits:"userSpaceOnUse"},W.createElement("stop",{offset:"0",stopColor:"#3ccbf4"}),W.createElement("stop",{offset:"1",stopColor:"#2892df"})),W.createElement("path",{fill:"url(#k8yl7~hDat~FaoWq8WjN6c)",d:"M32.074,7.225C31.827,6.493,31.141,6,30.368,6h-12.6c0.772,0,1.459,0.493,1.705,1.224 l10.935,32.399c0.318,0.942-0.188,1.963-1.13,2.281C29.093,41.968,28.899,42,28.703,42h12.6c0.994,0,1.8-0.806,1.8-1.801 c0-0.196-0.032-0.39-0.095-0.575L32.074,7.225z"})),Nf=()=>W.createElement("svg",{className:Lt(),width:"512",height:"512",viewBox:"0 0 512 512",fill:"none",xmlns:"http://www.w3.org/2000/svg"},W.createElement("path",{d:"M472.136 163.959H408.584C407.401 163.959 406.218 163.327 405.666 162.3L354.651 73.6591C354.02 72.632 352.916 72 351.654 72H143.492C142.309 72 141.126 72.632 140.574 73.6591L87.5084 165.618L36.414 254.259C35.862 255.286 35.862 256.55 36.414 257.656L87.5084 346.297L140.495 438.335C141.047 439.362 142.23 440.073 143.413 439.994H351.654C352.837 439.994 354.02 439.362 354.651 438.335L405.745 349.694C406.297 348.667 407.48 347.956 408.663 348.035H472.215C474.344 348.035 476 346.297 476 344.243V167.83C475.921 165.697 474.186 163.959 472.136 163.959ZM228.728 349.694L212.721 377.345C212.485 377.74 212.091 378.135 211.696 378.372C211.223 378.609 210.75 378.767 210.198 378.767H178.422C177.318 378.767 176.293 378.214 175.82 377.187L128.431 294.787L123.779 286.65L106.748 257.498C106.511 257.103 106.353 256.629 106.432 256.076C106.432 255.602 106.59 255.049 106.827 254.654L123.937 224.949L175.899 134.886C176.451 133.938 177.476 133.306 178.501 133.306H210.198C210.75 133.306 211.302 133.464 211.854 133.701C212.248 133.938 212.643 134.254 212.879 134.728L228.886 162.537C229.359 163.485 229.28 164.67 228.728 165.539L177.397 254.654C177.16 255.049 177.081 255.523 177.081 255.918C177.081 256.392 177.239 256.787 177.397 257.182L228.728 346.218C229.438 347.403 229.359 348.667 228.728 349.694V349.694ZM388.083 257.498L371.051 286.65L366.399 294.787L319.011 377.187C318.459 378.135 317.512 378.767 316.409 378.767H284.632C284.08 378.767 283.607 378.609 283.134 378.372C282.74 378.135 282.346 377.819 282.109 377.345L266.103 349.694C265.393 348.667 265.393 347.403 266.024 346.376L317.355 257.34C317.591 256.945 317.67 256.471 317.67 256.076C317.67 255.602 317.513 255.207 317.355 254.812L266.024 165.697C265.472 164.749 265.393 163.643 265.866 162.695L281.873 134.886C282.109 134.491 282.503 134.096 282.898 133.859C283.371 133.543 283.923 133.464 284.553 133.464H316.409C317.512 133.464 318.538 134.017 319.011 135.044L370.972 225.107L388.083 254.812C388.319 255.286 388.477 255.76 388.477 256.234C388.477 256.55 388.319 257.024 388.083 257.498V257.498Z",fill:"#008AAA"})),Sf=()=>W.createElement("svg",{className:Lt(),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",width:"21px",height:"21px"},W.createElement("path",{fill:"#0288D1",d:"M42,37c0,2.762-2.238,5-5,5H11c-2.761,0-5-2.238-5-5V11c0-2.762,2.239-5,5-5h26c2.762,0,5,2.238,5,5V37z"}),W.createElement("path",{fill:"#FFF",d:"M12 19H17V36H12zM14.485 17h-.028C12.965 17 12 15.888 12 14.499 12 13.08 12.995 12 14.514 12c1.521 0 2.458 1.08 2.486 2.499C17 15.887 16.035 17 14.485 17zM36 36h-5v-9.099c0-2.198-1.225-3.698-3.192-3.698-1.501 0-2.313 1.012-2.707 1.99C24.957 25.543 25 26.511 25 27v9h-5V19h5v2.616C25.721 20.5 26.85 19 29.738 19c3.578 0 6.261 2.25 6.261 7.274L36 36 36 36z"})),Ef=()=>W.createElement("svg",{className:Lt(),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",width:"21px",height:"21px",fillRule:"evenodd",clipRule:"evenodd"},W.createElement("path",{fill:"#fff",fillRule:"evenodd",d:"M11.553,11.099c1.232,1.001,1.694,0.925,4.008,0.77 l21.812-1.31c0.463,0,0.078-0.461-0.076-0.538l-3.622-2.619c-0.694-0.539-1.619-1.156-3.391-1.002l-21.12,1.54 c-0.77,0.076-0.924,0.461-0.617,0.77L11.553,11.099z",clipRule:"evenodd"}),W.createElement("path",{fill:"#fff",fillRule:"evenodd",d:"M12.862,16.182v22.95c0,1.233,0.616,1.695,2.004,1.619 l23.971-1.387c1.388-0.076,1.543-0.925,1.543-1.927V14.641c0-1-0.385-1.54-1.234-1.463l-25.05,1.463 C13.171,14.718,12.862,15.181,12.862,16.182L12.862,16.182z",clipRule:"evenodd"}),W.createElement("path",{fill:"#424242",fillRule:"evenodd",d:"M11.553,11.099c1.232,1.001,1.694,0.925,4.008,0.77 l21.812-1.31c0.463,0,0.078-0.461-0.076-0.538l-3.622-2.619c-0.694-0.539-1.619-1.156-3.391-1.002l-21.12,1.54 c-0.77,0.076-0.924,0.461-0.617,0.77L11.553,11.099z M12.862,16.182v22.95c0,1.233,0.616,1.695,2.004,1.619l23.971-1.387 c1.388-0.076,1.543-0.925,1.543-1.927V14.641c0-1-0.385-1.54-1.234-1.463l-25.05,1.463C13.171,14.718,12.862,15.181,12.862,16.182 L12.862,16.182z M36.526,17.413c0.154,0.694,0,1.387-0.695,1.465l-1.155,0.23v16.943c-1.003,0.539-1.928,0.847-2.698,0.847 c-1.234,0-1.543-0.385-2.467-1.54l-7.555-11.86v11.475l2.391,0.539c0,0,0,1.386-1.929,1.386l-5.317,0.308 c-0.154-0.308,0-1.078,0.539-1.232l1.388-0.385V20.418l-1.927-0.154c-0.155-0.694,0.23-1.694,1.31-1.772l5.704-0.385l7.862,12.015 V19.493l-2.005-0.23c-0.154-0.848,0.462-1.464,1.233-1.54L36.526,17.413z M7.389,5.862l21.968-1.618 c2.698-0.231,3.392-0.076,5.087,1.155l7.013,4.929C42.614,11.176,43,11.407,43,12.33v27.032c0,1.694-0.617,2.696-2.775,2.849 l-25.512,1.541c-1.62,0.077-2.391-0.154-3.239-1.232l-5.164-6.7C5.385,34.587,5,33.664,5,32.585V8.556 C5,7.171,5.617,6.015,7.389,5.862z",clipRule:"evenodd"})),kf=()=>W.createElement("svg",{className:Lt(),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",width:"21px",height:"21px"},W.createElement("path",{fill:"#33d375",d:"M33,8c0-2.209-1.791-4-4-4s-4,1.791-4,4c0,1.254,0,9.741,0,11c0,2.209,1.791,4,4,4s4-1.791,4-4	C33,17.741,33,9.254,33,8z"}),W.createElement("path",{fill:"#33d375",d:"M43,19c0,2.209-1.791,4-4,4c-1.195,0-4,0-4,0s0-2.986,0-4c0-2.209,1.791-4,4-4S43,16.791,43,19z"}),W.createElement("path",{fill:"#40c4ff",d:"M8,14c-2.209,0-4,1.791-4,4s1.791,4,4,4c1.254,0,9.741,0,11,0c2.209,0,4-1.791,4-4s-1.791-4-4-4	C17.741,14,9.254,14,8,14z"}),W.createElement("path",{fill:"#40c4ff",d:"M19,4c2.209,0,4,1.791,4,4c0,1.195,0,4,0,4s-2.986,0-4,0c-2.209,0-4-1.791-4-4S16.791,4,19,4z"}),W.createElement("path",{fill:"#e91e63",d:"M14,39.006C14,41.212,15.791,43,18,43s4-1.788,4-3.994c0-1.252,0-9.727,0-10.984	c0-2.206-1.791-3.994-4-3.994s-4,1.788-4,3.994C14,29.279,14,37.754,14,39.006z"}),W.createElement("path",{fill:"#e91e63",d:"M4,28.022c0-2.206,1.791-3.994,4-3.994c1.195,0,4,0,4,0s0,2.981,0,3.994c0,2.206-1.791,3.994-4,3.994	S4,30.228,4,28.022z"}),W.createElement("path",{fill:"#ffc107",d:"M39,33c2.209,0,4-1.791,4-4s-1.791-4-4-4c-1.254,0-9.741,0-11,0c-2.209,0-4,1.791-4,4s1.791,4,4,4	C29.258,33,37.746,33,39,33z"}),W.createElement("path",{fill:"#ffc107",d:"M28,43c-2.209,0-4-1.791-4-4c0-1.195,0-4,0-4s2.986,0,4,0c2.209,0,4,1.791,4,4S30.209,43,28,43z"})),Cf=()=>W.createElement("svg",{className:Lt(),width:"512",height:"512",viewBox:"0 0 512 512",fill:"none",xmlns:"http://www.w3.org/2000/svg"},W.createElement("path",{d:"M255.498 31.0034C131.513 31.0034 31 131.515 31 255.502C31 379.492 131.513 480 255.498 480C379.497 480 480 379.495 480 255.502C480 131.522 379.497 31.0135 255.495 31.0135L255.498 31V31.0034ZM358.453 354.798C354.432 361.391 345.801 363.486 339.204 359.435C286.496 327.237 220.139 319.947 141.993 337.801C134.463 339.516 126.957 334.798 125.24 327.264C123.516 319.731 128.217 312.225 135.767 310.511C221.284 290.972 294.639 299.384 353.816 335.549C360.413 339.596 362.504 348.2 358.453 354.798ZM385.932 293.67C380.864 301.903 370.088 304.503 361.858 299.438C301.512 262.345 209.528 251.602 138.151 273.272C128.893 276.067 119.118 270.851 116.309 261.61C113.521 252.353 118.74 242.597 127.981 239.782C209.512 215.044 310.87 227.026 380.17 269.612C388.4 274.68 391 285.456 385.935 293.676V293.673L385.932 293.67ZM388.293 230.016C315.935 187.039 196.56 183.089 127.479 204.055C116.387 207.42 104.654 201.159 101.293 190.063C97.9326 178.964 104.189 167.241 115.289 163.87C194.59 139.796 326.418 144.446 409.723 193.902C419.722 199.826 422.995 212.71 417.068 222.675C411.168 232.653 398.247 235.943 388.303 230.016H388.293V230.016Z",fill:"#1ED760"})),Af=()=>W.createElement("svg",{className:Lt(),width:"512",height:"512",viewBox:"0 0 512 512",fill:"none",xmlns:"http://www.w3.org/2000/svg"},W.createElement("path",{d:"M416 240L352 304H288L232 360V304H160V64H416V240Z",fill:"white"}),W.createElement("path",{d:"M144 32L64 112V400H160V480L240 400H304L448 256V32H144ZM416 240L352 304H288L232 360V304H160V64H416V240Z",fill:"#9146FF"}),W.createElement("path",{d:"M368 120H336V216H368V120Z",fill:"#9146FF"}),W.createElement("path",{d:"M280 120H248V216H280V120Z",fill:"#9146FF"})),Pf=()=>W.createElement("svg",{className:Lt(),width:"512",height:"512",viewBox:"0 0 512 512",fill:"none",xmlns:"http://www.w3.org/2000/svg"},W.createElement("path",{d:"M33 256.043C33 264.556 35.3159 273.069 39.4845 280.202L117.993 415.493C126.098 429.298 138.373 440.572 153.657 445.634C183.764 455.528 214.797 442.873 229.618 417.333L248.609 384.661L173.806 256.043L252.777 119.831L271.768 87.1591C277.557 77.2654 284.968 69.4424 294 63H285.894H172.185C150.878 63 131.193 74.2742 120.54 92.6812L39.7161 231.884C35.3159 239.016 33 247.53 33 256.043Z",fill:"#6363F1"}),W.createElement("path",{d:"M480 256.058C480 247.539 477.684 239.021 473.516 231.883L393.849 94.6596C379.028 69.3331 347.995 56.4396 317.888 66.34C302.603 71.4053 290.329 82.6871 282.224 96.5015L264.391 127.354L339.194 256.058L260.223 392.131L241.232 424.825C235.443 434.495 228.032 442.553 219 449H227.106H340.815C362.122 449 381.807 437.718 392.46 419.299L473.284 280.003C477.684 272.866 480 264.577 480 256.058Z",fill:"#6363F1"})),Of=()=>W.createElement("svg",{className:Lt(),xmlns:"http://www.w3.org/2000/svg",width:"2500",height:"2500",viewBox:"0 0 256 256"},W.createElement("path",{fill:"#FFE812",d:"M256 236c0 11.046-8.954 20-20 20H20c-11.046 0-20-8.954-20-20V20C0 8.954 8.954 0 20 0h216c11.046 0 20 8.954 20 20v216z"}),W.createElement("path",{d:"M128 36C70.562 36 24 72.713 24 118c0 29.279 19.466 54.97 48.748 69.477-1.593 5.494-10.237 35.344-10.581 37.689 0 0-.207 1.762.934 2.434s2.483.15 2.483.15c3.272-.457 37.943-24.811 43.944-29.04 5.995.849 12.168 1.29 18.472 1.29 57.438 0 104-36.712 104-82 0-45.287-46.562-82-104-82z"}),W.createElement("path",{fill:"#FFE812",d:"M70.5 146.625c-3.309 0-6-2.57-6-5.73V105.25h-9.362c-3.247 0-5.888-2.636-5.888-5.875s2.642-5.875 5.888-5.875h30.724c3.247 0 5.888 2.636 5.888 5.875s-2.642 5.875-5.888 5.875H76.5v35.645c0 3.16-2.691 5.73-6 5.73zM123.112 146.547c-2.502 0-4.416-1.016-4.993-2.65l-2.971-7.778-18.296-.001-2.973 7.783c-.575 1.631-2.488 2.646-4.99 2.646a9.155 9.155 0 0 1-3.814-.828c-1.654-.763-3.244-2.861-1.422-8.52l14.352-37.776c1.011-2.873 4.082-5.833 7.99-5.922 3.919.088 6.99 3.049 8.003 5.928l14.346 37.759c1.826 5.672.236 7.771-1.418 8.532a9.176 9.176 0 0 1-3.814.827c-.001 0 0 0 0 0zm-11.119-21.056L106 108.466l-5.993 17.025h11.986zM138 145.75c-3.171 0-5.75-2.468-5.75-5.5V99.5c0-3.309 2.748-6 6.125-6s6.125 2.691 6.125 6v35.25h12.75c3.171 0 5.75 2.468 5.75 5.5s-2.579 5.5-5.75 5.5H138zM171.334 146.547c-3.309 0-6-2.691-6-6V99.5c0-3.309 2.691-6 6-6s6 2.691 6 6v12.896l16.74-16.74c.861-.861 2.044-1.335 3.328-1.335 1.498 0 3.002.646 4.129 1.772 1.051 1.05 1.678 2.401 1.764 3.804.087 1.415-.384 2.712-1.324 3.653l-13.673 13.671 14.769 19.566a5.951 5.951 0 0 1 1.152 4.445 5.956 5.956 0 0 1-2.328 3.957 5.94 5.94 0 0 1-3.609 1.211 5.953 5.953 0 0 1-4.793-2.385l-14.071-18.644-2.082 2.082v13.091a6.01 6.01 0 0 1-6.002 6.003z"}));function Df({supabaseClient:n,socialLayout:a="vertical",providers:t=["github","google","azure"],providerScopes:r,queryParams:i,redirectTo:l,onlyThirdPartyProviders:c=!0,view:m="sign_in",i18n:u,appearance:h}){const[p,d]=T.useState(!1),[o,s]=T.useState(""),g=a==="vertical",v=m==="magic_link"?"sign_in":m,x=async f=>{d(!0);const{error:_}=await n.auth.signInWithOAuth({provider:f,options:{redirectTo:l,scopes:r==null?void 0:r[f],queryParams:i}});_&&s(_.message),d(!1)};function y(f){const _=f.toLowerCase();return f.charAt(0).toUpperCase()+_.slice(1)}return W.createElement(W.Fragment,null,t&&t.length>0&&W.createElement(W.Fragment,null,W.createElement(Nn,{gap:"large",direction:"vertical",appearance:h},W.createElement(Nn,{direction:g?"vertical":"horizontal",gap:g?"small":"medium",appearance:h},t.map(f=>{var _;return W.createElement(Ar,{key:f,color:"default",loading:p,onClick:()=>x(f),appearance:h},W.createElement(ff,{provider:f}),g&&rf((_=u==null?void 0:u[v])==null?void 0:_.social_provider_text,{provider:y(f)}))}))),!c&&W.createElement(df,{appearance:h})))}function Ks({authView:n="sign_in",defaultEmail:a="",defaultPassword:t="",setAuthView:r=()=>{},setDefaultEmail:i=g=>{},setDefaultPassword:l=g=>{},supabaseClient:c,showLinks:m=!1,redirectTo:u,additionalData:h,magicLink:p,i18n:d,appearance:o,children:s}){var g,v,x,y;const f=T.useRef(!0),[_,b]=T.useState(a),[E,N]=T.useState(t),[j,C]=T.useState(""),[D,k]=T.useState(!1),[w,S]=T.useState("");T.useEffect(()=>(f.current=!0,b(a),N(t),()=>{f.current=!1}),[n]);const P=async $=>{var B;switch($.preventDefault(),C(""),k(!0),n){case"sign_in":const{error:Y}=await c.auth.signInWithPassword({email:_,password:E});Y&&C(Y.message);break;case"sign_up":let U={emailRedirectTo:u};h&&(U.data=h);const{data:{user:q,session:R},error:F}=await c.auth.signUp({email:_,password:E,options:U});F?C(F.message):q&&!R&&S((B=d==null?void 0:d.sign_up)==null?void 0:B.confirmation_text);break}f.current&&k(!1)},O=$=>{i(_),l(E),r($)},L=d==null?void 0:d[n];return W.createElement("form",{id:n==="sign_in"?"auth-sign-in":"auth-sign-up",onSubmit:P,autoComplete:"on",style:{width:"100%"}},W.createElement(Nn,{direction:"vertical",gap:"large",appearance:o},W.createElement(Nn,{direction:"vertical",gap:"large",appearance:o},W.createElement("div",null,W.createElement(In,{htmlFor:"email",appearance:o},L==null?void 0:L.email_label),W.createElement(Fn,{id:"email",type:"email",name:"email",placeholder:L==null?void 0:L.email_input_placeholder,defaultValue:_,onChange:$=>b($.target.value),autoComplete:"email",appearance:o})),W.createElement("div",null,W.createElement(In,{htmlFor:"password",appearance:o},L==null?void 0:L.password_label),W.createElement(Fn,{id:"password",type:"password",name:"password",placeholder:L==null?void 0:L.password_input_placeholder,defaultValue:E,onChange:$=>N($.target.value),autoComplete:n==="sign_in"?"current-password":"new-password",appearance:o})),s),W.createElement(Ar,{type:"submit",color:"primary",loading:D,appearance:o},D?L==null?void 0:L.loading_button_label:L==null?void 0:L.button_label),m&&W.createElement(Nn,{direction:"vertical",gap:"small",appearance:o},n===Nt.SIGN_IN&&p&&W.createElement(Wn,{href:"#auth-magic-link",onClick:$=>{$.preventDefault(),r(Nt.MAGIC_LINK)},appearance:o},(g=d==null?void 0:d.magic_link)==null?void 0:g.link_text),n===Nt.SIGN_IN&&W.createElement(Wn,{href:"#auth-forgot-password",onClick:$=>{$.preventDefault(),r(Nt.FORGOTTEN_PASSWORD)},appearance:o},(v=d==null?void 0:d.forgotten_password)==null?void 0:v.link_text),n===Nt.SIGN_IN?W.createElement(Wn,{href:"#auth-sign-up",onClick:$=>{$.preventDefault(),O(Nt.SIGN_UP)},appearance:o},(x=d==null?void 0:d.sign_up)==null?void 0:x.link_text):W.createElement(Wn,{href:"#auth-sign-in",onClick:$=>{$.preventDefault(),O(Nt.SIGN_IN)},appearance:o},(y=d==null?void 0:d.sign_in)==null?void 0:y.link_text))),w&&W.createElement(En,{appearance:o},w),j&&W.createElement(En,{color:"danger",appearance:o},j))}function gc({setAuthView:n=()=>{},supabaseClient:a,redirectTo:t,i18n:r,appearance:i,showLinks:l=!1}){var c;const[m,u]=T.useState(""),[h,p]=T.useState(""),[d,o]=T.useState(""),[s,g]=T.useState(!1),v=async y=>{var f;y.preventDefault(),p(""),o(""),g(!0);const{error:_}=await a.auth.resetPasswordForEmail(m,{redirectTo:t});_?p(_.message):o((f=r==null?void 0:r.forgotten_password)==null?void 0:f.confirmation_text),g(!1)},x=r==null?void 0:r.forgotten_password;return W.createElement("form",{id:"auth-forgot-password",onSubmit:v},W.createElement(Nn,{direction:"vertical",gap:"large",appearance:i},W.createElement(Nn,{gap:"large",direction:"vertical",appearance:i},W.createElement("div",null,W.createElement(In,{htmlFor:"email",appearance:i},x==null?void 0:x.email_label),W.createElement(Fn,{id:"email",name:"email",type:"email",autoFocus:!0,placeholder:x==null?void 0:x.email_input_placeholder,onChange:y=>u(y.target.value),appearance:i})),W.createElement(Ar,{type:"submit",color:"primary",loading:s,appearance:i},s?x==null?void 0:x.loading_button_label:x==null?void 0:x.button_label),l&&W.createElement(Wn,{href:"#auth-sign-in",onClick:y=>{y.preventDefault(),n(Nt.SIGN_IN)},appearance:i},(c=r==null?void 0:r.sign_in)==null?void 0:c.link_text),d&&W.createElement(En,{appearance:i},d),h&&W.createElement(En,{color:"danger",appearance:i},h))))}function vc({supabaseClient:n,i18n:a,appearance:t}){const[r,i]=T.useState(""),[l,c]=T.useState(""),[m,u]=T.useState(""),[h,p]=T.useState(!1),d=async s=>{var g;s.preventDefault(),c(""),u(""),p(!0);const{error:v}=await n.auth.updateUser({password:r});v?c(v.message):u((g=a==null?void 0:a.update_password)==null?void 0:g.confirmation_text),p(!1)},o=a==null?void 0:a.update_password;return W.createElement("form",{id:"auth-update-password",onSubmit:d},W.createElement(Nn,{gap:"large",direction:"vertical",appearance:t},W.createElement("div",null,W.createElement(In,{htmlFor:"password",appearance:t},o==null?void 0:o.password_label),W.createElement(Fn,{id:"password",name:"password",placeholder:o==null?void 0:o.password_input_placeholder,type:"password",autoFocus:!0,onChange:s=>i(s.target.value),appearance:t})),W.createElement(Ar,{type:"submit",color:"primary",loading:h,appearance:t},h?o==null?void 0:o.loading_button_label:o==null?void 0:o.button_label),m&&W.createElement(En,{appearance:t},m),l&&W.createElement(En,{color:"danger",appearance:t},l)))}function Tf({setAuthView:n=()=>{},supabaseClient:a,otpType:t="email",i18n:r,appearance:i,showLinks:l=!1}){var c;const[m,u]=T.useState(""),[h,p]=T.useState(""),[d,o]=T.useState(""),[s,g]=T.useState(""),[v,x]=T.useState(""),[y,f]=T.useState(!1),_=async E=>{E.preventDefault(),g(""),x(""),f(!0);let N={email:m,token:d,type:t};["sms","phone_change"].includes(t)&&(N={phone:h,token:d,type:t});const{error:j}=await a.auth.verifyOtp(N);j&&g(j.message),f(!1)},b=r==null?void 0:r.verify_otp;return W.createElement("form",{id:"auth-magic-link",onSubmit:_},W.createElement(Nn,{gap:"large",direction:"vertical",appearance:i},["sms","phone_change"].includes(t)?W.createElement("div",null,W.createElement(In,{htmlFor:"phone",appearance:i},b==null?void 0:b.phone_input_label),W.createElement(Fn,{id:"phone",name:"phone",type:"text",autoFocus:!0,placeholder:b==null?void 0:b.phone_input_placeholder,onChange:E=>p(E.target.value),appearance:i})):W.createElement("div",null,W.createElement(In,{htmlFor:"email",appearance:i},b==null?void 0:b.email_input_label),W.createElement(Fn,{id:"email",name:"email",type:"email",autoFocus:!0,placeholder:b==null?void 0:b.email_input_placeholder,onChange:E=>u(E.target.value),appearance:i})),W.createElement("div",null,W.createElement(In,{htmlFor:"token",appearance:i},b==null?void 0:b.token_input_label),W.createElement(Fn,{id:"token",name:"token",type:"text",placeholder:b==null?void 0:b.token_input_placeholder,onChange:E=>o(E.target.value),appearance:i})),W.createElement(Ar,{color:"primary",type:"submit",loading:y,appearance:i},y?b==null?void 0:b.loading_button_label:b==null?void 0:b.button_label),l&&W.createElement(Wn,{href:"#auth-sign-in",onClick:E=>{E.preventDefault(),n(Nt.SIGN_IN)},appearance:i},(c=r==null?void 0:r.sign_in)==null?void 0:c.link_text),v&&W.createElement(En,{appearance:i},v),s&&W.createElement(En,{color:"danger",appearance:i},s)))}const xc=T.createContext({user:null,session:null}),Lf=n=>{const{supabaseClient:a}=n,[t,r]=T.useState(null),[i,l]=T.useState((t==null?void 0:t.user)??null);T.useEffect(()=>{(async()=>{var u;const{data:h}=await a.auth.getSession();r(h.session),l(((u=h.session)==null?void 0:u.user)??null)})();const{data:m}=a.auth.onAuthStateChange(async(u,h)=>{r(h),l((h==null?void 0:h.user)??null)});return()=>{m==null||m.subscription.unsubscribe()}},[]);const c={session:t,user:i};return W.createElement(xc.Provider,{value:c,...n})},Rf=()=>{const n=T.useContext(xc);if(n===void 0)throw new Error("useUser must be used within a UserContextProvider.");return n};function ar({supabaseClient:n,socialLayout:a="vertical",providers:t,providerScopes:r,queryParams:i,view:l="sign_in",redirectTo:c,onlyThirdPartyProviders:m=!1,magicLink:u=!1,showLinks:h=!0,appearance:p,theme:d="default",localization:o={variables:{}},otpType:s="email",additionalData:g,children:v}){const x=ai(af,o.variables??{}),[y,f]=T.useState(l),[_,b]=T.useState(""),[E,N]=T.useState(""),j=y==="sign_in"||y==="sign_up"||y==="magic_link";T.useEffect(()=>{var k,w;mc({theme:ai(((k=p==null?void 0:p.theme)==null?void 0:k.default)??{},((w=p==null?void 0:p.variables)==null?void 0:w.default)??{})})},[p]);const C=({children:k})=>{var w;return W.createElement("div",{className:d!=="default"?ef(ai(p==null?void 0:p.theme[d],((w=p==null?void 0:p.variables)==null?void 0:w[d])??{})):""},j&&W.createElement(Df,{appearance:p,supabaseClient:n,providers:t,providerScopes:r,queryParams:i,socialLayout:a,redirectTo:c,onlyThirdPartyProviders:m,i18n:x,view:y}),!m&&k)};T.useEffect(()=>{const{data:k}=n.auth.onAuthStateChange(w=>{w==="PASSWORD_RECOVERY"?f("update_password"):w==="USER_UPDATED"&&f("sign_in")});return f(l),()=>k.subscription.unsubscribe()},[l]);const D={supabaseClient:n,setAuthView:f,defaultEmail:_,defaultPassword:E,setDefaultEmail:b,setDefaultPassword:N,redirectTo:c,magicLink:u,showLinks:h,i18n:x,appearance:p};switch(y){case Nt.SIGN_IN:return W.createElement(C,null,W.createElement(Ks,{...D,authView:"sign_in"}));case Nt.SIGN_UP:return W.createElement(C,null,W.createElement(Ks,{appearance:p,supabaseClient:n,authView:"sign_up",setAuthView:f,defaultEmail:_,defaultPassword:E,setDefaultEmail:b,setDefaultPassword:N,redirectTo:c,magicLink:u,showLinks:h,i18n:x,additionalData:g,children:v}));case Nt.FORGOTTEN_PASSWORD:return W.createElement(C,null,W.createElement(gc,{appearance:p,supabaseClient:n,setAuthView:f,redirectTo:c,showLinks:h,i18n:x}));case Nt.MAGIC_LINK:return W.createElement(C,null,W.createElement(hc,{appearance:p,supabaseClient:n,setAuthView:f,redirectTo:c,showLinks:h,i18n:x}));case Nt.UPDATE_PASSWORD:return W.createElement(vc,{appearance:p,supabaseClient:n,i18n:x});case Nt.VERIFY_OTP:return W.createElement(Tf,{appearance:p,supabaseClient:n,otpType:s,i18n:x});default:return null}}ar.ForgottenPassword=gc;ar.UpdatePassword=vc;ar.MagicLink=hc;ar.UserContextProvider=Lf;ar.useUser=Rf;Rn({borderRadius:"12px",boxShadow:"rgba(100, 100, 111, 0.2) 0px 7px 29px 0px",width:"360px",padding:"28px 32px"});const Mf=()=>{const{session:n,isLoading:a}=Ie(),t=kn();return T.useEffect(()=>{const{data:{subscription:r}}=X.auth.onAuthStateChange((i,l)=>{i==="SIGNED_IN"&&l&&t("/",{replace:!0})});return()=>r.unsubscribe()},[t]),n&&!a?e.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gray-100 dark:bg-gray-900 p-4",children:e.jsxs("div",{className:"w-full max-w-md bg-white dark:bg-gray-800 p-8 rounded-lg shadow-md relative",children:[e.jsx(fe,{className:"h-10 w-10 animate-spin text-brand-accent"}),e.jsx("h2",{className:"text-2xl font-bold text-center mb-6 text-gray-900 dark:text-white",children:"Redirecting..."})]})}):e.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gray-100 dark:bg-gray-900 p-4",children:e.jsxs("div",{className:"w-full max-w-md bg-white dark:bg-gray-800 p-8 rounded-lg shadow-md relative",children:[a&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/80 dark:bg-gray-800/80 z-10 rounded-lg",children:e.jsx(fe,{className:"h-10 w-10 animate-spin text-brand-accent"})}),e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx("img",{src:"/infotrac-logo.png",alt:"INFOtrac Logo",className:"h-16 w-auto object-contain"})}),e.jsx("h2",{className:"text-2xl font-bold text-center mb-6 text-gray-900 dark:text-white",children:"Welcome to INFOtrac"}),e.jsx(ar,{supabaseClient:X,providers:[],appearance:{theme:fc,variables:{default:{colors:{brand:"hsl(var(--brand-accent))",brandAccent:"hsl(var(--brand-accent-foreground))"}}}},theme:"light",view:"sign_in"})]})})},Ct=T.forwardRef(({className:n,...a},t)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:t,className:pe("w-full caption-bottom text-sm",n),...a})}));Ct.displayName="Table";const At=T.forwardRef(({className:n,...a},t)=>e.jsx("thead",{ref:t,className:pe("[&_tr]:border-b",n),...a}));At.displayName="TableHeader";const Pt=T.forwardRef(({className:n,...a},t)=>e.jsx("tbody",{ref:t,className:pe("[&_tr:last-child]:border-0",n),...a}));Pt.displayName="TableBody";const Ff=T.forwardRef(({className:n,...a},t)=>e.jsx("tfoot",{ref:t,className:pe("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",n),...a}));Ff.displayName="TableFooter";const Me=T.forwardRef(({className:n,...a},t)=>e.jsx("tr",{ref:t,className:pe("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",n),...a}));Me.displayName="TableRow";const be=T.forwardRef(({className:n,...a},t)=>e.jsx("th",{ref:t,className:pe("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",n),...a}));be.displayName="TableHead";const ve=T.forwardRef(({className:n,...a},t)=>e.jsx("td",{ref:t,className:pe("p-4 align-middle [&:has([role=checkbox])]:pr-0",n),...a}));ve.displayName="TableCell";const If=T.forwardRef(({className:n,...a},t)=>e.jsx("caption",{ref:t,className:pe("mt-4 text-sm text-muted-foreground",n),...a}));If.displayName="TableCaption";const ne=T.forwardRef(({className:n,type:a,...t},r)=>e.jsx("input",{type:a,className:pe("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",n),ref:r,...t}));ne.displayName="Input";const an=Jd,qf=Xd,yc=T.forwardRef(({className:n,...a},t)=>e.jsx(Go,{className:pe("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",n),...a,ref:t}));yc.displayName=Go.displayName;const zt=T.forwardRef(({className:n,...a},t)=>e.jsxs(qf,{children:[e.jsx(yc,{}),e.jsx(Zo,{ref:t,className:pe("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",n),...a})]}));zt.displayName=Zo.displayName;const Bt=({className:n,...a})=>e.jsx("div",{className:pe("flex flex-col space-y-2 text-center sm:text-left",n),...a});Bt.displayName="AlertDialogHeader";const Ut=({className:n,...a})=>e.jsx("div",{className:pe("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",n),...a});Ut.displayName="AlertDialogFooter";const $t=T.forwardRef(({className:n,...a},t)=>e.jsx(Qo,{ref:t,className:pe("text-lg font-semibold",n),...a}));$t.displayName=Qo.displayName;const Ht=T.forwardRef(({className:n,...a},t)=>e.jsx(Xo,{ref:t,className:pe("text-sm text-muted-foreground",n),...a}));Ht.displayName=Xo.displayName;const Vt=T.forwardRef(({className:n,...a},t)=>e.jsx(Jo,{ref:t,className:pe(Ur(),n),...a}));Vt.displayName=Jo.displayName;const Wt=T.forwardRef(({className:n,...a},t)=>e.jsx(el,{ref:t,className:pe(Ur({variant:"outline"}),"mt-2 sm:mt-0",n),...a}));Wt.displayName=el.displayName;const we=T.forwardRef(({className:n,...a},t)=>e.jsx("div",{ref:t,className:pe("rounded-lg border bg-card text-card-foreground shadow-sm",n),...a}));we.displayName="Card";const Ae=T.forwardRef(({className:n,...a},t)=>e.jsx("div",{ref:t,className:pe("flex flex-col space-y-1.5 p-6",n),...a}));Ae.displayName="CardHeader";const Ee=T.forwardRef(({className:n,...a},t)=>e.jsx("h3",{ref:t,className:pe("text-2xl font-semibold leading-none tracking-tight",n),...a}));Ee.displayName="CardTitle";const Re=T.forwardRef(({className:n,...a},t)=>e.jsx("p",{ref:t,className:pe("text-sm text-muted-foreground",n),...a}));Re.displayName="CardDescription";const ke=T.forwardRef(({className:n,...a},t)=>e.jsx("div",{ref:t,className:pe("p-6 pt-0",n),...a}));ke.displayName="CardContent";const qa=T.forwardRef(({className:n,...a},t)=>e.jsx("div",{ref:t,className:pe("flex items-center p-6 pt-0",n),...a}));qa.displayName="CardFooter";const zf=()=>{const n=Ye(),{toast:a}=Ke(),{profile:t,isLoading:r}=Ie(),l=(t==null?void 0:t.role)==="super-admin",[c,m]=T.useState(""),[u,h]=T.useState(!1),[p,d]=T.useState(null),{data:o,isLoading:s,isError:g}=je({queryKey:["companies",c],queryFn:async()=>{let _=X.from("companies").select("*").order("name");c&&(_=_.or(`name.ilike.%${c}%,domain.ilike.%${c}%`));const{data:b,error:E}=await _;if(E)throw E;return b},enabled:l}),v=Oe({mutationFn:async _=>{const{data:b,error:E}=await X.functions.invoke("delete-company-and-users",{body:{company_id:_}});if(E)throw E;return b},onSuccess:_=>{n.invalidateQueries({queryKey:["companies"]}),n.invalidateQueries({queryKey:["users"]}),a({title:"Company Deleted",description:_.message||"The company and associated users have been successfully deleted."}),h(!1),d(null)},onError:_=>{a({title:"Error deleting company",description:_.message||"An unexpected error occurred.",variant:"destructive"})}}),x=_=>{m(_.target.value)},y=_=>{d(_),h(!0)},f=()=>{p&&v.mutate(p.id)};return!l||r||s?e.jsxs("div",{className:"flex flex-1 items-center justify-center",children:[e.jsx(fe,{className:"h-8 w-8 animate-spin"}),e.jsx("p",{className:"ml-2",children:"Loading companies..."})]}):g?e.jsx("div",{className:"flex flex-1 items-center justify-center text-destructive",children:e.jsx("p",{children:"Error loading companies. Please try again."})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-4",children:e.jsx(ne,{placeholder:"Search companies...",value:c,onChange:x,className:"max-w-sm"})}),e.jsxs(we,{children:[e.jsxs(Ae,{className:"flex flex-row items-start justify-between space-y-0 pb-2",children:[e.jsxs("div",{children:[e.jsxs(Ee,{className:"flex items-center gap-2",children:[e.jsx(Pa,{className:"h-5 w-5"})," Companies"]}),e.jsx(Re,{children:"A list of all registered companies on the platform."})]}),l&&e.jsx(Dt,{to:"/company-setup",children:e.jsxs(ee,{children:[e.jsx(Kt,{className:"mr-2 h-4 w-4"})," Add New Company"]})})]}),e.jsx(ke,{children:e.jsxs(Ct,{children:[e.jsx(At,{children:e.jsxs(Me,{children:[e.jsx(be,{children:"Name"}),e.jsx(be,{children:"Domain"}),e.jsx(be,{children:"Default Currency"}),e.jsx(be,{className:"text-right",children:"Actions"})]})}),e.jsx(Pt,{children:(o==null?void 0:o.length)===0?e.jsx(Me,{children:e.jsx(ve,{colSpan:4,className:"text-center text-muted-foreground",children:"No companies found."})}):o==null?void 0:o.map(_=>e.jsxs(Me,{children:[e.jsx(ve,{className:"font-medium",children:_.name}),e.jsx(ve,{children:_.domain||"N/A"}),e.jsx(ve,{children:_.default_currency}),e.jsxs(ve,{className:"text-right space-x-2",children:[e.jsx(Dt,{to:`/company-settings?companyId=${_.id}`,children:e.jsxs(ee,{variant:"outline",size:"icon",children:[e.jsx(rn,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Edit"})]})}),e.jsxs(ee,{variant:"destructive",size:"icon",onClick:()=>y(_),disabled:v.isPending,children:[v.isPending&&(p==null?void 0:p.id)===_.id?e.jsx(fe,{className:"h-4 w-4 animate-spin"}):e.jsx(qt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Delete"})]})]})]},_.id))})]})})]}),e.jsx(an,{open:u,onOpenChange:h,children:e.jsxs(zt,{children:[e.jsxs(Bt,{children:[e.jsx($t,{children:"Are you absolutely sure?"}),e.jsxs(Ht,{children:['This action cannot be undone. This will permanently delete the company "',p==null?void 0:p.name,'" AND all associated user accounts and their data.']})]}),e.jsxs(Ut,{children:[e.jsx(Wt,{disabled:v.isPending,children:"Cancel"}),e.jsxs(Vt,{onClick:f,disabled:v.isPending,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:[v.isPending?e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Delete"]})]})]})})]})},vt=rl,ir=al,Bf=tl,bc=T.forwardRef(({className:n,...a},t)=>e.jsx(Ea,{ref:t,className:pe("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",n),...a}));bc.displayName=Ea.displayName;const ut=T.forwardRef(({className:n,children:a,...t},r)=>e.jsxs(Bf,{children:[e.jsx(bc,{}),e.jsxs(ka,{ref:r,className:pe("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",n),...t,children:[a,e.jsxs(nl,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(Yr,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));ut.displayName=ka.displayName;const _t=({className:n,...a})=>e.jsx("div",{className:pe("flex flex-col space-y-1.5 text-center sm:text-left",n),...a});_t.displayName="DialogHeader";const sr=({className:n,...a})=>e.jsx("div",{className:pe("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",n),...a});sr.displayName="DialogFooter";const jt=T.forwardRef(({className:n,...a},t)=>e.jsx(Ca,{ref:t,className:pe("text-lg font-semibold leading-none tracking-tight",n),...a}));jt.displayName=Ca.displayName;const Et=T.forwardRef(({className:n,...a},t)=>e.jsx(Aa,{ref:t,className:pe("text-sm text-muted-foreground",n),...a}));Et.displayName=Aa.displayName;const Uf=Kr("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),G=T.forwardRef(({className:n,...a},t)=>e.jsx(il,{ref:t,className:pe(Uf(),n),...a}));G.displayName=il.displayName;const Ot=T.forwardRef(({className:n,...a},t)=>e.jsx("textarea",{className:pe("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n),ref:t,...a}));Ot.displayName="Textarea";const bt=T.forwardRef(({className:n,...a},t)=>e.jsx(sl,{ref:t,className:pe("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",n),...a,children:e.jsx(eu,{className:pe("flex items-center justify-center text-current"),children:e.jsx(Hi,{className:"h-4 w-4"})})}));bt.displayName=sl.displayName;var $f=function(n,a){for(var t={};n.length;){var r=n[0],i=r.code,l=r.message,c=r.path.join(".");if(!t[c])if("unionErrors"in r){var m=r.unionErrors[0].errors[0];t[c]={message:m.message,type:m.code}}else t[c]={message:l,type:i};if("unionErrors"in r&&r.unionErrors.forEach(function(p){return p.errors.forEach(function(d){return n.push(d)})}),a){var u=t[c].types,h=u&&u[r.code];t[c]=dm(c,a,t,i,h?[].concat(h,r.message):r.message)}n.shift()}return t},dt=function(n,a,t){return t===void 0&&(t={}),function(r,i,l){try{return Promise.resolve(function(c,m){try{var u=Promise.resolve(n[t.mode==="sync"?"parse":"parseAsync"](r,a)).then(function(h){return l.shouldUseNativeValidation&&lm({},l),{errors:{},values:t.raw?r:h}})}catch(h){return m(h)}return u&&u.then?u.then(void 0,m):u}(0,function(c){if(function(m){return Array.isArray(m==null?void 0:m.errors)}(c))return{values:{},errors:cm($f(c.errors,!l.shouldUseNativeValidation&&l.criteriaMode==="all"),l)};throw c}))}catch(c){return Promise.reject(c)}}};const Je=su,et=ou,Qe=T.forwardRef(({className:n,children:a,...t},r)=>e.jsxs(ol,{ref:r,className:pe("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",n),...t,children:[a,e.jsx(tu,{asChild:!0,children:e.jsx(Bn,{className:"h-4 w-4 opacity-50"})})]}));Qe.displayName=ol.displayName;const _c=T.forwardRef(({className:n,...a},t)=>e.jsx(ll,{ref:t,className:pe("flex cursor-default items-center justify-center py-1",n),...a,children:e.jsx(Oa,{className:"h-4 w-4"})}));_c.displayName=ll.displayName;const jc=T.forwardRef(({className:n,...a},t)=>e.jsx(cl,{ref:t,className:pe("flex cursor-default items-center justify-center py-1",n),...a,children:e.jsx(Bn,{className:"h-4 w-4"})}));jc.displayName=cl.displayName;const Xe=T.forwardRef(({className:n,children:a,position:t="popper",...r},i)=>e.jsx(nu,{children:e.jsxs(dl,{ref:i,className:pe("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",n),position:t,...r,children:[e.jsx(_c,{}),e.jsx(ru,{className:pe("p-1",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a}),e.jsx(jc,{})]})}));Xe.displayName=dl.displayName;const Hf=T.forwardRef(({className:n,...a},t)=>e.jsx(ul,{ref:t,className:pe("py-1.5 pl-8 pr-2 text-sm font-semibold",n),...a}));Hf.displayName=ul.displayName;const Ue=T.forwardRef(({className:n,children:a,...t},r)=>e.jsxs(ml,{ref:r,className:pe("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(au,{children:e.jsx(Hi,{className:"h-4 w-4"})})}),e.jsx(iu,{children:a})]}));Ue.displayName=ml.displayName;const Vf=T.forwardRef(({className:n,...a},t)=>e.jsx(pl,{ref:t,className:pe("-mx-1 my-1 h-px bg-muted",n),...a}));Vf.displayName=pl.displayName;const zn=({value:n,onChange:a,disabled:t,currencyCode:r,...i})=>{const[l,c]=T.useState(""),[m,u]=T.useState(""),h=T.useRef(!1);T.useEffect(()=>{Fm(r).then(s=>{u(s)})},[r]),T.useEffect(()=>{t?(async()=>c(await Dn(n,r)))():h.current?c(n.toString()):(async()=>c(await Dn(n,r)))()},[n,r,t]);const p=T.useCallback(async()=>{h.current=!0,c(n.toString())},[n]),d=T.useCallback(async()=>{h.current=!1;const s=parseFloat(l);isNaN(s)?(a(0),c(await Dn(0,r))):(a(s),c(await Dn(s,r)))},[l,a,r]),o=T.useCallback(s=>{c(s.target.value)},[]);return e.jsxs("div",{className:"relative",children:[!t&&h.current&&e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground",children:m}),e.jsx(ne,{type:"text",value:l,onChange:o,onFocus:p,onBlur:d,disabled:t,className:!t&&h.current?"pl-8":"",...i})]})},Wf=tt({name:J().min(1,"Module name is required"),description:J().optional().nullable(),is_active:St().default(!0),default_monthly_price:gt(n=>n===""?0:Number(n),yt().min(0,"Monthly price must be non-negative").default(0)),default_per_user_price:gt(n=>n===""?0:Number(n),yt().min(0,"Per-user price must be non-negative").default(0)),module_type:Ma(["core","super","add-on"],{required_error:"Module type is required",invalid_type_error:"Invalid module type"}).default("add-on")}),Kf=()=>{const n=Ye(),{toast:a}=Ke(),{profile:t,isLoading:r}=Ie(),[i,l]=T.useState(!1),[c,m]=T.useState(null),u=(t==null?void 0:t.role)==="super-admin",{data:h,isLoading:p,isError:d}=je({queryKey:["modules"],queryFn:async()=>{console.log("SystemModulesPage: Fetching modules from Supabase...");const{data:_,error:b}=await X.from("modules").select("*").order("name",{ascending:!0});if(b)throw console.error("SystemModulesPage: Error in modules queryFn:",b),b;return console.log("SystemModulesPage: Modules fetched:",_),_}}),o=(h==null?void 0:h.find(_=>_.id===c))||null,s=ct({resolver:dt(Wf),defaultValues:{name:"",description:"",is_active:!0,default_monthly_price:0,default_per_user_price:0,module_type:"add-on"}});T.useEffect(()=>{i&&(console.log("Dialog opened/reset. Editing module:",o),s.reset(o?{name:o.name,description:o.description||"",is_active:o.is_active,default_monthly_price:o.default_monthly_price,default_per_user_price:o.default_per_user_price,module_type:o.module_type}:{name:"",description:"",is_active:!0,default_monthly_price:0,default_per_user_price:0,module_type:"add-on"}))},[i,o,s]);const g=Oe({mutationFn:async _=>{if(!u)throw new Error("Access Denied: Only Super Admins can manage system modules.");if(c){const{error:b}=await X.from("modules").update({..._,updated_at:new Date().toISOString()}).eq("id",c);if(b)throw b}else{const{error:b}=await X.from("modules").insert(_);if(b)throw b}return null},onSuccess:()=>{n.refetchQueries({queryKey:["modules"],exact:!0}),n.invalidateQueries({queryKey:["allSystemModulesForCompanySetup"]}),n.invalidateQueries({queryKey:["systemModules"]}),n.invalidateQueries({queryKey:["allSystemModulesForMenu"]}),a({title:"Module Saved",description:"System module has been successfully saved."}),l(!1),m(null)},onError:_=>{a({title:"Error saving module",description:_.message||"An unexpected error occurred.",variant:"destructive"})}}),v=_=>{console.log("DEBUG: onSubmit received values:",_),g.mutate(_)},x=()=>{m(null),l(!0)},y=_=>{m(_),l(!0)},f=g.isPending;return r||p?e.jsxs("div",{className:"flex flex-1 items-center justify-center",children:[e.jsx(fe,{className:"h-8 w-8 animate-spin"}),e.jsx("p",{className:"ml-2",children:"Loading modules..."})]}):u?d?e.jsx("div",{className:"flex flex-1 items-center justify-center text-destructive",children:e.jsx("p",{children:"Error loading data. Please try again."})}):e.jsx(e.Fragment,{children:e.jsxs(we,{children:[e.jsxs(Ae,{className:"flex flex-row items-start justify-between space-y-0 pb-2",children:[e.jsxs("div",{children:[e.jsxs(Ee,{className:"flex items-center gap-2",children:[e.jsx(br,{className:"h-5 w-5"})," All System Modules"]}),e.jsx(Re,{children:"Manage all available modules on the INFOtrac platform, including their type and default pricing."})]}),e.jsxs(vt,{open:i,onOpenChange:l,children:[e.jsx(ir,{asChild:!0,children:e.jsxs(ee,{onClick:x,children:[e.jsx(Kt,{className:"mr-2 h-4 w-4"})," Add New Module"]})}),e.jsxs(ut,{className:"sm:max-w-[600px]",children:[" ",e.jsxs(_t,{children:[e.jsx(jt,{children:o?"Edit Module":"Add New Module"}),e.jsx(Et,{children:o?"Update the details of this module.":"Define a new module for the INFOtrac platform and its default pricing."})]}),e.jsxs("form",{onSubmit:s.handleSubmit(v),className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"name",children:"Name"}),e.jsx(ne,{id:"name",...s.register("name"),disabled:f||!!c}),s.formState.errors.name&&e.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.name.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"description",children:"Description"}),e.jsx(Ot,{id:"description",...s.register("description"),disabled:f}),s.formState.errors.description&&e.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.description.message})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(bt,{id:"is_active",checked:s.watch("is_active"),onCheckedChange:_=>s.setValue("is_active",_),disabled:f}),e.jsx(G,{htmlFor:"is_active",children:"Active"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"module_type",children:"Module Type"}),e.jsxs(Je,{onValueChange:_=>s.setValue("module_type",_),value:s.watch("module_type"),disabled:f,children:[e.jsx(Qe,{id:"module_type",children:e.jsx(et,{placeholder:"Select module type"})}),e.jsxs(Xe,{children:[e.jsx(Ue,{value:"core",children:"Core Module"}),e.jsx(Ue,{value:"super",children:"Super Module"}),e.jsx(Ue,{value:"add-on",children:"Add-On Module"})]})]}),s.formState.errors.module_type&&e.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.module_type.message})]}),e.jsxs(we,{className:"mt-4",children:[e.jsxs(Ae,{children:[e.jsx(Ee,{className:"text-lg",children:"Default Pricing"}),e.jsx(Re,{children:"Set the base monthly and per-user prices for this module."})]}),e.jsxs(ke,{className:"grid gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{children:"Monthly Price"}),e.jsx(zn,{value:s.watch("default_monthly_price"),onChange:_=>s.setValue("default_monthly_price",_),disabled:f,currencyCode:"USD"}),s.formState.errors.default_monthly_price&&e.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.default_monthly_price.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{children:"Per-User Price"}),e.jsx(zn,{value:s.watch("default_per_user_price"),onChange:_=>s.setValue("default_per_user_price",_),disabled:f,currencyCode:"USD"}),s.formState.errors.default_per_user_price&&e.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.default_per_user_price.message})]})]})]}),e.jsxs(ee,{type:"submit",disabled:f,className:"mt-4",children:[f?e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(pn,{className:"mr-2 h-4 w-4"}),o?"Update Module":"Create Module"]})]})]},c||"new")]})]}),e.jsx(ke,{children:e.jsxs(Ct,{children:[e.jsx(At,{children:e.jsxs(Me,{children:[e.jsx(be,{children:"Name"}),e.jsx(be,{children:"Description"}),e.jsx(be,{children:"Type"}),e.jsx(be,{className:"text-center",children:"Active"}),e.jsx(be,{className:"text-right",children:"Actions"})]})}),e.jsx(Pt,{children:(h==null?void 0:h.length)===0?e.jsx(Me,{children:e.jsx(ve,{colSpan:5,className:"text-center text-muted-foreground",children:"No modules found."})}):h==null?void 0:h.map(_=>e.jsxs(Me,{children:[e.jsx(ve,{className:"font-medium",children:_.name}),e.jsx(ve,{children:_.description||"N/A"}),e.jsxs(ve,{children:[_.module_type.charAt(0).toUpperCase()+_.module_type.slice(1)," Module"]}),e.jsx(ve,{className:"text-center",children:_.is_active?"Yes":"No"}),e.jsx(ve,{className:"text-right space-x-2",children:e.jsxs(ee,{variant:"outline",size:"sm",onClick:()=>y(_.id),children:[e.jsx(rn,{className:"h-4 w-4 mr-1"})," Edit"]})})]},_.id))})]})})]})}):e.jsx("div",{className:"flex flex-1 items-center justify-center text-destructive",children:e.jsx("p",{children:"Access Denied: Only Super Admins can access this page."})})},dn=lu,sn=T.forwardRef(({className:n,...a},t)=>e.jsx(fl,{ref:t,className:pe("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",n),...a}));sn.displayName=fl.displayName;const ze=T.forwardRef(({className:n,...a},t)=>e.jsx(hl,{ref:t,className:pe("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",n),...a}));ze.displayName=hl.displayName;const Ve=T.forwardRef(({className:n,...a},t)=>e.jsx(gl,{ref:t,className:pe("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",n),...a}));Ve.displayName=gl.displayName;const Yf=tt({module_id:J(),is_enabled:St(),monthly_price:gt(n=>n===""?0:Number(n),yt().min(0,"Monthly price must be non-negative")),per_user_price:gt(n=>n===""?0:Number(n),yt().min(0,"Per-user price must be non-negative")),is_locked_by_system:St(),module_type:Ma(["core","super","add-on"])}),Gf=tt({modules:Zr(Yf)}),wc=({companyId:n})=>{const a=Ye(),{toast:t}=Ke(),{profile:r,isLoading:i}=Ie(),l=r==null?void 0:r.role,c=l==="super-admin",{data:m,isLoading:u}=je({queryKey:["systemModules"],queryFn:async()=>{const{data:k,error:w}=await X.from("modules").select("*, module_type").order("name",{ascending:!0});if(w)throw w;return k}}),{data:h,isLoading:p}=je({queryKey:["companyModuleSettings",n],queryFn:async()=>{if(!n)return[];const{data:k,error:w}=await X.from("company_modules").select("*, is_locked_by_system").eq("company_id",n);if(w)throw w;return k},enabled:!!n}),{data:d}=je({queryKey:["companyDefaultCurrency",n],queryFn:async()=>{if(!n)return{default_currency:"USD"};const{data:k,error:w}=await X.from("companies").select("default_currency").eq("id",n).single();if(w)throw w;return k},enabled:!!n}),o=(d==null?void 0:d.default_currency)||"USD",s=ct({resolver:dt(Gf),defaultValues:{modules:[]}});T.useEffect(()=>{if(m&&h){const k=m.map(w=>{const S=h.find(P=>P.module_id===w.id);return{module_id:w.id,is_enabled:(S==null?void 0:S.is_enabled)||!1,monthly_price:(S==null?void 0:S.monthly_price)??w.default_monthly_price??0,per_user_price:(S==null?void 0:S.per_user_price)??w.default_per_user_price??0,is_locked_by_system:(S==null?void 0:S.is_locked_by_system)??w.module_type==="core",module_type:w.module_type}});s.reset({modules:k})}},[m,h,s]);const g=Oe({mutationFn:async k=>{if(!n)throw new Error("Company ID not found.");if(l==="admin"&&n!==(r==null?void 0:r.company_id))throw new Error("Access Denied: You can only manage modules for your own company.");const{error:w}=await X.functions.invoke("assign-company-module",{body:{companyId:n,moduleId:k.module_id,isEnabled:k.is_enabled,monthly_price:k.monthly_price,per_user_price:k.per_user_price}});if(w)throw w;return null}}),v=async k=>{const w=k.modules.map(L=>g.mutateAsync(L)),S=await Promise.allSettled(w),P=S.filter(L=>L.status==="fulfilled").length,O=S.filter(L=>L.status==="rejected").length;P>0&&O===0?t({title:"Module Settings Saved",description:"All company module settings have been updated."}):P>0&&O>0?t({title:"Partial Update",description:`${P} modules updated, ${O} failed.`,variant:"destructive"}):t({title:"Error Saving Module Settings",description:"No module settings could be updated.",variant:"destructive"}),a.invalidateQueries({queryKey:["companyModuleSettings",n]}),a.invalidateQueries({queryKey:["companyModulesWithPrices",n]}),a.invalidateQueries({queryKey:["userMenuPreferences"]})},x=i||u||p,y=g.isPending,f=l&&(c||l==="admin"&&n===(r==null?void 0:r.company_id)),_=T.useMemo(()=>{const k=s.watch("modules");if(!k||!m)return[];const w=k.map(S=>{const P=m.find(O=>O.id===S.module_id);return{...S,systemModuleName:(P==null?void 0:P.name)||"",description:(P==null?void 0:P.description)||null,module_type:(P==null?void 0:P.module_type)||"add-on"}});return c?w:w.filter(S=>S.is_enabled)},[s.watch("modules"),c,m]),b=k=>_.filter(w=>w.module_type===k).sort((w,S)=>w.systemModuleName.localeCompare(S.systemModuleName)),E=b("core"),N=b("super"),j=b("add-on");if(x)return e.jsxs("div",{className:"flex flex-1 items-center justify-center",children:[e.jsx(fe,{className:"h-8 w-8 animate-spin"}),e.jsx("p",{className:"ml-2",children:"Loading company modules..."})]});if(!f)return e.jsx("div",{className:"flex flex-1 items-center justify-center text-destructive",children:e.jsx("p",{children:"Access Denied: You do not have permission to manage modules for this company."})});const C=(k,w)=>{const S=l==="admin"&&w==="core",P=!c;return e.jsxs(Ct,{children:[e.jsx(At,{children:e.jsxs(Me,{children:[e.jsx(be,{children:"Module"}),e.jsx(be,{children:"Description"}),!P&&e.jsx(be,{children:"Enabled"})," ",!S&&e.jsxs(be,{children:["Monthly Price (",o,")"]}),!S&&e.jsxs(be,{children:["Per-User Price (",o,")"]})]})}),e.jsx(Pt,{children:k.length===0?e.jsx(Me,{children:e.jsx(ve,{colSpan:(P?0:1)+1+1+(S?0:2),className:"text-center text-muted-foreground",children:"No modules found in this category."})}):k.map(O=>{var U,q,R,F,M,z,H,I;const L=m==null?void 0:m.find(A=>A.id===O.module_id);if(!L)return null;const $=O.is_locked_by_system,B=y||$||!c,Y=s.watch("modules").findIndex(A=>A.module_id===O.module_id);return Y===-1?null:e.jsxs(Me,{children:[e.jsx(ve,{className:"font-medium",children:L.name}),e.jsx(ve,{children:L.description||"N/A"}),!P&&e.jsx(ve,{children:e.jsx(bt,{checked:O.is_enabled,onCheckedChange:A=>s.setValue(`modules.${Y}.is_enabled`,A),disabled:B})}),!S&&e.jsxs(ve,{children:[e.jsx(zn,{value:O.monthly_price,onChange:A=>s.setValue(`modules.${Y}.monthly_price`,A),disabled:B||!c,currencyCode:o}),((q=(U=s.formState.errors.modules)==null?void 0:U[Y])==null?void 0:q.monthly_price)&&e.jsx("p",{className:"text-sm text-destructive",children:(F=(R=s.formState.errors.modules[Y])==null?void 0:R.monthly_price)==null?void 0:F.message})]}),!S&&e.jsxs(ve,{children:[e.jsx(zn,{value:O.per_user_price,onChange:A=>s.setValue(`modules.${Y}.per_user_price`,A),disabled:B||!c,currencyCode:o}),((z=(M=s.formState.errors.modules)==null?void 0:M[Y])==null?void 0:z.per_user_price)&&e.jsx("p",{className:"text-sm text-destructive",children:(I=(H=s.formState.errors.modules[Y])==null?void 0:H.per_user_price)==null?void 0:I.message})]})]},O.module_id)})})]})},D=c?3:2;return e.jsxs(we,{className:"mt-4",children:[e.jsxs(Ae,{children:[e.jsx(Ee,{children:"Company Modules"}),e.jsx(Re,{children:c?"Enable or disable modules for this company and set custom pricing. If custom pricing is not set, the system default price will be used.":"These are the modules currently enabled for your company. Contact a Super Admin to enable or disable additional modules."})]}),e.jsx(ke,{children:e.jsxs("form",{onSubmit:s.handleSubmit(v),className:"grid gap-6",children:[e.jsxs(dn,{defaultValue:"core",children:[e.jsxs(sn,{className:pe("grid w-full",`grid-cols-${D}`),children:[e.jsx(ze,{value:"core",children:"Core Modules"}),c&&e.jsx(ze,{value:"super",children:"Super Modules"}),e.jsx(ze,{value:"addon",children:"Add-On Modules"})]}),e.jsx(Ve,{value:"core",className:"mt-4",children:C(E,"core")}),c&&e.jsx(Ve,{value:"super",className:"mt-4",children:C(N,"super")}),e.jsx(Ve,{value:"addon",className:"mt-4",children:C(j,"addon")})]}),c&&e.jsxs(ee,{type:"submit",disabled:y,className:"mt-4",children:[y?e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(pn,{className:"mr-2 h-4 w-4"}),"Save Module Settings"]})]})})]})},Zf=()=>{const{profile:n,isLoading:a}=Ie(),t=n==null?void 0:n.company_id,r=n==null?void 0:n.role,i=a,l=r&&(r==="super-admin"||r==="admin"&&t===(n==null?void 0:n.company_id));return i?e.jsxs("div",{className:"flex flex-1 items-center justify-center",children:[e.jsx(fe,{className:"h-8 w-8 animate-spin"}),e.jsx("p",{className:"ml-2",children:"Loading modules overview..."})]}):l?t?e.jsxs(we,{children:[e.jsxs(Ae,{children:[e.jsxs(Ee,{className:"flex items-center gap-2",children:[e.jsx(br,{className:"h-5 w-5"})," Company Modules"]}),e.jsx(Re,{children:"Manage and configure the modules enabled for your company."})]}),e.jsx(ke,{children:e.jsx(wc,{companyId:t})})]}):e.jsx("div",{className:"flex flex-1 items-center justify-center text-destructive",children:e.jsx("p",{children:"Error: Company ID not found. Please ensure your profile is linked to a company."})}):e.jsx("div",{className:"flex flex-1 items-center justify-center text-destructive",children:e.jsx("p",{children:"Access Denied: You do not have permission to manage modules for this company."})})};var ts="Switch",[Qf,b_]=xl(ts),[Xf,Jf]=Qf(ts),Nc=T.forwardRef((n,a)=>{const{__scopeSwitch:t,name:r,checked:i,defaultChecked:l,required:c,disabled:m,value:u="on",onCheckedChange:h,form:p,...d}=n,[o,s]=T.useState(null),g=Cr(a,_=>s(_)),v=T.useRef(!1),x=o?p||!!o.closest("form"):!0,[y=!1,f]=vl({prop:i,defaultProp:l,onChange:h});return e.jsxs(Xf,{scope:t,checked:y,disabled:m,children:[e.jsx(er.button,{type:"button",role:"switch","aria-checked":y,"aria-required":c,"data-state":kc(y),"data-disabled":m?"":void 0,disabled:m,value:u,...d,ref:g,onClick:Vn(n.onClick,_=>{f(b=>!b),x&&(v.current=_.isPropagationStopped(),v.current||_.stopPropagation())})}),x&&e.jsx(eh,{control:o,bubbles:!v.current,name:r,value:u,checked:y,required:c,disabled:m,form:p,style:{transform:"translateX(-100%)"}})]})});Nc.displayName=ts;var Sc="SwitchThumb",Ec=T.forwardRef((n,a)=>{const{__scopeSwitch:t,...r}=n,i=Jf(Sc,t);return e.jsx(er.span,{"data-state":kc(i.checked),"data-disabled":i.disabled?"":void 0,...r,ref:a})});Ec.displayName=Sc;var eh=n=>{const{control:a,checked:t,bubbles:r=!0,...i}=n,l=T.useRef(null),c=yl(t),m=bl(a);return T.useEffect(()=>{const u=l.current,h=window.HTMLInputElement.prototype,d=Object.getOwnPropertyDescriptor(h,"checked").set;if(c!==t&&d){const o=new Event("click",{bubbles:r});d.call(u,t),u.dispatchEvent(o)}},[c,t,r]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:t,...i,tabIndex:-1,ref:l,style:{...n.style,...m,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function kc(n){return n?"checked":"unchecked"}var Cc=Nc,th=Ec;const za=T.forwardRef(({className:n,...a},t)=>e.jsx(Cc,{className:pe("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",n),...a,ref:t,children:e.jsx(th,{className:pe("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));za.displayName=Cc.displayName;const nh=tt({first_name:J().min(1,"First name is required").nullable(),last_name:J().min(1,"Last name is required").nullable(),email:J().email("Invalid email address").optional(),role:J().min(1,"Role is required"),company_id:J().optional().nullable(),status:J().min(1,"Status is required")}),rh=({isOpen:n,onOpenChange:a,editingUser:t})=>{const r=Ye(),{toast:i}=Ke(),{profile:l,user:c,isLoading:m}=Ie(),u=(l==null?void 0:l.role)==="super-admin",h=l==null?void 0:l.company_id,p=ct({resolver:dt(nh),defaultValues:{first_name:t.first_name,last_name:t.last_name,email:t.email,role:t.role,company_id:t.company_id,status:t.status}});T.useEffect(()=>{n&&t&&p.reset({first_name:t.first_name,last_name:t.last_name,email:t.email,role:t.role,company_id:t.company_id,status:t.status})},[n,t,p]);const{data:d,isLoading:o}=je({queryKey:["companies"],queryFn:async()=>{const{data:k,error:w}=await X.from("companies").select("id, name").order("name",{ascending:!0});if(w)throw w;return k},enabled:u}),{data:s,isLoading:g}=je({queryKey:["companyModulesForUserEdit",t.company_id],queryFn:async()=>{if(!t.company_id)return[];const{data:k,error:w}=await X.from("company_modules").select("id, company_id, module_id, is_enabled, is_locked_by_system").eq("company_id",t.company_id).eq("is_enabled",!0);if(w)throw w;return k},enabled:!!t.company_id}),{data:v,isLoading:x}=je({queryKey:["allModulesForUserEdit"],queryFn:async()=>{const{data:k,error:w}=await X.from("modules").select("id, name, description, roles");if(w)throw w;return k},enabled:!!t.company_id}),{data:y,isLoading:f}=je({queryKey:["userModules",t.user_id],queryFn:async()=>{if(!t.user_id)return[];const{data:k,error:w}=await X.from("user_modules").select("id, user_id, module_id, is_enabled").eq("user_id",t.user_id);if(w)throw w;return k},enabled:!!t.user_id}),_=Oe({mutationFn:async k=>{var L;if(!l||!c)throw new Error("Current user profile or session not loaded.");let w=k.company_id;if(l.role==="admin"){if(!h||k.company_id!==h)throw new Error("Admins can only manage users within their own company.");w=h}else if(l.role!=="super-admin")throw new Error("Insufficient permissions to update user.");const S=t.status,P=k.status,{error:O}=await X.from("profiles").update({first_name:k.first_name,last_name:k.last_name,full_name:(k.first_name||"")+" "+(k.last_name||""),role:k.role,company_id:w,status:P,updated_at:new Date().toISOString()}).eq("user_id",t.user_id);if(O)throw O;if(S!==P&&t.company_id){const $=((L=d==null?void 0:d.find(B=>B.id===t.company_id))==null?void 0:L.name)||"Your Company";await X.functions.invoke("send-email",{body:{template_name:"user_status_updated",recipient_email:l.email,template_variables:{admin_name:l.first_name||l.full_name||l.email,company_name:$,target_user_name:t.full_name||`${t.first_name} ${t.last_name}`,target_user_email:t.email,new_status:P.charAt(0).toUpperCase()+P.slice(1),performed_by_name:l.full_name||l.email,performed_by_email:l.email,users_link:`${window.location.origin}/users`,year:new Date().getFullYear()}}})}return null},onSuccess:()=>{r.invalidateQueries({queryKey:["users"]}),r.invalidateQueries({queryKey:["userModules",t.user_id]}),i({title:"User Updated",description:`Profile for ${t.full_name||t.email} has been updated.`}),a(!1)},onError:k=>{i({title:"Error updating user",description:k.message||"An unexpected error occurred.",variant:"destructive"})}}),b=Oe({mutationFn:async({moduleId:k,isEnabled:w})=>{var $,B;if(!t.user_id||!t.company_id||!l||!c)throw new Error("User or company ID missing for module update, or current user profile not loaded.");const{error:S}=await X.functions.invoke("upsert-user-module",{body:{target_user_id:t.user_id,target_user_role:t.role,module_id:k,company_id:t.company_id,is_enabled:w}});if(S)throw S;const P=(($=v==null?void 0:v.find(Y=>Y.id===k))==null?void 0:$.name)||"Unknown Module",O=((B=d==null?void 0:d.find(Y=>Y.id===t.company_id))==null?void 0:B.name)||"Your Company",L=w?"Enabled":"Disabled";await X.functions.invoke("send-email",{body:{template_name:"user_module_access_updated",recipient_email:l.email,template_variables:{admin_name:l.first_name||l.full_name||l.email,company_name:O,target_user_name:t.full_name||`${t.first_name} ${t.last_name}`,target_user_email:t.email,module_name:P,access_status:L,performed_by_name:l.full_name||l.email,performed_by_email:l.email,users_link:`${window.location.origin}/users`,year:new Date().getFullYear()}}})},onSuccess:()=>{r.invalidateQueries({queryKey:["userModules",t.user_id]}),r.invalidateQueries({queryKey:["userMenuPreferences",t.user_id]}),i({title:"User Module Updated",description:"User's module access has been updated."})},onError:k=>{i({title:"Error updating user module",description:k.message,variant:"destructive"})}}),E=k=>{_.mutate(k)},N=(k,w)=>{b.mutate({moduleId:k,isEnabled:w})},j=m||_.isPending||u&&o||g||x||f||b.isPending,C=v==null?void 0:v.filter(k=>{const w=s==null?void 0:s.some(P=>P.module_id===k.id&&P.is_enabled),S=!k.roles||k.roles.length===0||k.roles.includes(t.role);return w&&S}).map(k=>{const w=y==null?void 0:y.find(O=>O.module_id===k.id),S=s==null?void 0:s.find(O=>O.module_id===k.id);let P;return w?P=w.is_enabled:P=t.role==="admin"||t.role==="controller",{...k,is_enabled_for_user:P,is_locked:(S==null?void 0:S.is_locked_by_system)??!1}}),D=j||(l==null?void 0:l.user_id)===t.user_id;return e.jsxs(ut,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(_t,{children:[e.jsxs(jt,{children:["Edit User: ",t.full_name||t.email]}),e.jsx(Et,{children:"Update the profile details and module access for this user."})]}),e.jsxs(dn,{defaultValue:"profile",className:"grid gap-4 py-4",children:[e.jsxs(sn,{className:"grid w-full grid-cols-2",children:[e.jsx(ze,{value:"profile",children:"Profile"}),e.jsx(ze,{value:"modules",disabled:!t.company_id,children:"Module Access"})]}),e.jsx(Ve,{value:"profile",children:e.jsxs("form",{onSubmit:p.handleSubmit(E),className:"grid gap-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(G,{htmlFor:"first_name",className:"text-right",children:"First Name"}),e.jsx(ne,{id:"first_name",...p.register("first_name"),className:"col-span-3",disabled:j}),p.formState.errors.first_name&&e.jsx("p",{className:"col-span-4 text-right text-sm text-destructive",children:p.formState.errors.first_name.message})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(G,{htmlFor:"last_name",className:"text-right",children:"Last Name"}),e.jsx(ne,{id:"last_name",...p.register("last_name"),className:"col-span-3",disabled:j}),p.formState.errors.last_name&&e.jsx("p",{className:"col-span-4 text-right text-sm text-destructive",children:p.formState.errors.last_name.message})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(G,{htmlFor:"email",className:"text-right",children:"Email"}),e.jsx(ne,{id:"email",type:"email",value:t.email,className:"col-span-3",readOnly:!0,disabled:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(G,{htmlFor:"role",className:"text-right",children:"Role"}),e.jsxs(Je,{onValueChange:k=>p.setValue("role",k),value:p.watch("role"),disabled:j||(l==null?void 0:l.user_id)===t.user_id,children:[e.jsx(Qe,{className:"col-span-3",children:e.jsx(et,{placeholder:"Select a role"})}),e.jsxs(Xe,{children:[e.jsx(Ue,{value:"user",children:"User"}),e.jsx(Ue,{value:"admin",children:"Admin"}),e.jsx(Ue,{value:"controller",children:"Controller"}),u&&e.jsx(Ue,{value:"super-admin",children:"Super Admin"})]})]}),p.formState.errors.role&&e.jsx("p",{className:"col-span-4 text-right text-sm text-destructive",children:p.formState.errors.role.message})]}),u&&e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(G,{htmlFor:"company_id",className:"text-right",children:"Company"}),e.jsxs(Je,{onValueChange:k=>p.setValue("company_id",k),value:p.watch("company_id")||"",disabled:j,children:[e.jsx(Qe,{className:"col-span-3",children:e.jsx(et,{placeholder:"Select a company"})}),e.jsx(Xe,{children:d==null?void 0:d.map(k=>e.jsx(Ue,{value:k.id,children:k.name},k.id))})]}),p.formState.errors.company_id&&e.jsx("p",{className:"col-span-4 text-right text-sm text-destructive",children:p.formState.errors.company_id.message})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(G,{htmlFor:"status",className:"text-right",children:"Active"}),e.jsx(Jt,{name:"status",control:p.control,render:({field:k})=>e.jsx(za,{id:"status",checked:k.value==="active",onCheckedChange:w=>k.onChange(w?"active":"inactive"),className:"col-span-3",disabled:D})}),p.formState.errors.status&&e.jsx("p",{className:"col-span-4 text-right text-sm text-destructive",children:p.formState.errors.status.message})]}),e.jsxs(ee,{type:"submit",disabled:j,children:[j&&_.isPending?e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Save Changes"]})]})}),e.jsx(Ve,{value:"modules",children:t.company_id?e.jsx("div",{className:"grid gap-4",children:g||x||f?e.jsxs("div",{className:"flex justify-center items-center py-8",children:[e.jsx(fe,{className:"h-6 w-6 animate-spin mr-2"})," Loading modules..."]}):(C==null?void 0:C.length)===0?e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"No modules available for this user's role or company."}):C==null?void 0:C.map(k=>e.jsxs("div",{className:"flex items-center justify-between border-b pb-2 last:border-b-0 last:pb-0",children:[e.jsxs("div",{children:[e.jsx(G,{htmlFor:`module-${k.id}`,className:"font-medium",children:k.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:k.description})]}),e.jsx(bt,{id:`module-${k.id}`,checked:k.is_enabled_for_user,onCheckedChange:w=>N(k.id,w),disabled:j||b.isPending||!u&&k.is_locked})]},k.id))}):e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"This user is not assigned to a company. Assign a company to manage modules."})})]})]})},ah=tt({module_id:J(),name:J(),description:J().optional().nullable(),is_enabled:St(),is_locked_by_system:St(),module_type:Ma(["core","super","add-on"])}),ih=tt({email:J().email("Invalid email address"),password:J().min(6,"Password must be at least 6 characters long"),first_name:J().min(1,"First name is required"),last_name:J().min(1,"Last name is required"),role:J().min(1,"Role is required"),company_id:J().optional().nullable()}),sh=ih.extend({modules:Zr(ah)}),ii=n=>n?n.charAt(0).toUpperCase()+n.slice(1):"",oh=()=>{const n=Ye(),{toast:a}=Ke(),{profile:t,isLoading:r,user:i}=Ie(),[l,c]=T.useState(!1),[m,u]=T.useState(!1),[h,p]=T.useState(null),[d,o]=T.useState(null),[s,g]=T.useState(!1),[v,x]=T.useState(null),[y,f]=T.useState(!1),[_,b]=T.useState(null),[E,N]=T.useState("user-details"),[j,C]=T.useState(null),[D,k]=T.useState(null),w=(t==null?void 0:t.role)==="super-admin",S=(t==null?void 0:t.role)==="admin",P=t==null?void 0:t.company_id,{data:O,isLoading:L,isError:$}=je({queryKey:["users",P],queryFn:async()=>{let me=X.from("profiles").select("*");!w&&P&&(me=me.eq("company_id",P));const{data:Pe,error:Te}=await me;if(Te)throw Te;return Pe},enabled:!!t}),{data:B,isLoading:Y,isError:U}=je({queryKey:["companies"],queryFn:async()=>{const{data:me,error:Pe}=await X.from("companies").select("id, name");if(Pe)throw Pe;return me},enabled:w}),{data:q,isLoading:R,isError:F}=je({queryKey:["invitations",P],queryFn:async()=>{let me=X.from("invitations").select("id,email,role,invited_by,expires_at,accepted_at,company_id").is("accepted_at",null);!w&&P&&(me=me.eq("company_id",P));const{data:Pe,error:Te}=await me;if(Te)throw Te;return Pe.map(oe=>({id:oe.id,email:oe.email,role:oe.role,invited_by:oe.invited_by,expires_at:oe.expires_at,accepted_at:oe.accepted_at,company_id:oe.company_id}))},enabled:!!t}),{data:M,isLoading:z}=je({queryKey:["allSystemModulesForUserCreation",D],queryFn:async()=>{if(!D)return[];const{data:me,error:Pe}=await X.from("modules").select("id, name, description, is_active, module_type, roles");if(Pe)throw console.error("Error fetching system modules:",Pe),Pe;return me||[]},enabled:!!t&&!!D}),{data:H,isLoading:I}=je({queryKey:["companyEnabledModulesForUserCreation",P],queryFn:async()=>{if(!P)return[];const{data:me,error:Pe}=await X.from("company_modules").select("id, company_id, module_id, is_enabled, is_locked_by_system").eq("company_id",P).eq("is_enabled",!0);if(Pe)throw Pe;return me||[]},enabled:!!P&&!!t}),A=ct({resolver:dt(sh),defaultValues:{email:"",password:"",first_name:"",last_name:"",role:"user",company_id:w?void 0:P||void 0,modules:[]}});T.useEffect(()=>{if(M&&H&&D){const me=A.getValues("company_id")||P,Pe=M.filter(Te=>{const mt=!Te.roles||Te.roles.length===0||Te.roles.includes(D),oe=w||!me||(H||[]).some(Le=>Le.module_id===Te.id&&Le.is_enabled);return Te.is_active&&mt&&oe}).map(Te=>({module_id:Te.id,name:Te.name,description:Te.description,is_enabled:Te.module_type==="core",is_locked_by_system:Te.module_type==="core",module_type:Te.module_type}));A.setValue("modules",Pe)}},[M,H,D,A.watch("company_id"),w,P]),T.useEffect(()=>{l&&(N("user-details"),C(null),k(null),A.reset({email:"",password:"",first_name:"",last_name:"",role:"user",company_id:w?void 0:P||void 0,modules:[]}))},[l,A,w,P]);const V=Oe({mutationFn:async me=>{const Pe=w?me:{...me,company_id:P},{data:Te,error:mt}=await X.functions.invoke("create-user-by-admin",{body:{...Pe,modules:[]}});if(mt)throw mt;return Te},onSuccess:me=>{a({title:"User Created",description:"User account created. Now configure module access."}),C(me.userId),k(A.getValues("role")),N("module-access"),n.invalidateQueries({queryKey:["users"]})},onError:me=>{me.status===409&&me.message.includes("A user with this email already exists.")?a({title:"Error Creating User",description:"A user with this email address already exists. Please use a different email.",variant:"destructive"}):a({title:"Error creating user",description:me.message||"An unexpected error occurred.",variant:"destructive"})}}),K=Oe({mutationFn:async me=>{if(!j||!P)throw new Error("User ID or Company ID missing for module update.");const Pe={target_user_id:j,company_id:P,modules:me.map(oe=>({module_id:oe.module_id,is_enabled:oe.is_enabled}))},{data:Te,error:mt}=await X.functions.invoke("upsert-user-module",{body:Pe});if(mt)throw mt;return Te},onSuccess:()=>{n.invalidateQueries({queryKey:["users"]}),n.invalidateQueries({queryKey:["userModulesForMenu",j]}),a({title:"Module Access Saved",description:"User's module access has been configured."}),c(!1)},onError:me=>{a({title:"Error Saving Module Access",description:me.message||"An unexpected error occurred.",variant:"destructive"})}}),Q=Oe({mutationFn:async me=>{o(me);const{data:Pe,error:Te}=await X.functions.invoke("resend-invitation",{body:{invitation_id:me}});if(Te)throw Te;return Pe},onSuccess:me=>{n.invalidateQueries({queryKey:["invitations"]}),a({title:"Invitation Resent",description:me.message||"The invitation has been successfully resent."}),console.log("New Invitation Link:",me.invitationLink),o(null)},onError:me=>{a({title:"Error Resending Invitation",description:me.message||"An unexpected error occurred.",variant:"destructive"}),o(null)}}),de=Oe({mutationFn:async me=>{const{data:Pe,error:Te}=await X.functions.invoke("delete-invitation",{body:{invitation_id:me}});if(Te)throw Te;return Pe},onSuccess:me=>{n.invalidateQueries({queryKey:["invitations"]}),a({title:"Invitation Deleted",description:me.message||"The invitation has been successfully deleted."}),g(!1),x(null)},onError:me=>{a({title:"Error Deleting Invitation",description:me.message||"An unexpected error occurred.",variant:"destructive"})}}),xe=Oe({mutationFn:async me=>{if((i==null?void 0:i.id)===me)throw new Error("Cannot delete your own user account.");const{data:Pe,error:Te}=await X.functions.invoke("delete-user-by-admin",{body:{user_id:me}});if(Te)throw Te;return Pe},onSuccess:me=>{n.invalidateQueries({queryKey:["users"]}),a({title:"User Deleted",description:me.message||"The user account has been successfully deleted."}),f(!1),b(null)},onError:me=>{a({title:"Error Deleting User",description:me.message||"An unexpected error occurred.",variant:"destructive"})}}),Z=me=>{V.mutate(me)},re=me=>{K.mutate(me.modules)},ye=me=>{p(me),u(!0)},Se=me=>{Q.mutate(me)},De=me=>{x(me),g(!0)},te=()=>{v&&de.mutate(v.id)},se=me=>{b(me),f(!0)},ge=()=>{_&&xe.mutate(_.user_id)},ce=r||L||w&&Y||R||z||I,le=V.isPending,Ne=K.isPending,ae=A.watch("modules"),ue=D||A.watch("role"),_e=me=>ae.filter(Pe=>Pe.module_type===me).sort((Pe,Te)=>Pe.name.localeCompare(Te.name)),ie=_e("core"),he=_e("super"),We=_e("add-on"),Fe=me=>e.jsxs(Ct,{children:[e.jsx(At,{children:e.jsxs(Me,{children:[e.jsx(be,{children:"Module"}),e.jsx(be,{children:"Description"}),e.jsx(be,{children:"Enabled"})]})}),e.jsx(Pt,{children:me.length===0?e.jsx(Me,{children:e.jsx(ve,{colSpan:3,className:"text-center text-muted-foreground",children:"No modules available for this role or company."})}):me.map((Pe,Te)=>{const mt=Pe.is_locked_by_system,oe=Ne||mt,Le=A.watch("modules").findIndex(nt=>nt.module_id===Pe.module_id);return Le===-1?null:e.jsxs(Me,{children:[e.jsx(ve,{className:"font-medium",children:Pe.name}),e.jsx(ve,{children:Pe.description||"N/A"}),e.jsx(ve,{children:e.jsx(bt,{checked:A.watch(`modules.${Le}.is_enabled`),onCheckedChange:nt=>A.setValue(`modules.${Le}.is_enabled`,nt),disabled:oe})})]},Pe.module_id)})})]});if(ce)return e.jsxs("div",{className:"flex flex-1 items-center justify-center",children:[e.jsx(fe,{className:"h-8 w-8 animate-spin"}),e.jsx("p",{className:"ml-2",children:"Loading users and invitations..."})]});if($||w&&U||F)return e.jsx("div",{className:"flex flex-1 items-center justify-center text-destructive",children:e.jsx("p",{children:"Error loading data. Please try again."})});const $e=["admin","controller","super-admin"].includes(ue||"");return e.jsxs(e.Fragment,{children:[e.jsxs(we,{className:"mb-6",children:[e.jsxs(Ae,{className:"flex flex-row items-start justify-between space-y-0 pb-2",children:[e.jsxs("div",{children:[e.jsxs(Ee,{className:"flex items-center gap-2",children:[e.jsx(Vi,{className:"h-5 w-5"})," Current Users"]}),e.jsx(Re,{children:w?"All users across the platform.":"Users in your company."})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(vt,{open:l,onOpenChange:c,children:[e.jsx(ir,{asChild:!0,children:e.jsxs(ee,{children:[e.jsx(Kt,{className:"mr-2 h-4 w-4"})," Add New User"]})}),e.jsxs(ut,{className:"sm:max-w-[800px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(_t,{children:[e.jsx(jt,{children:"Add New User"}),e.jsx(Et,{children:"Create a new user account and configure their module access."})]}),e.jsxs(dn,{value:E,onValueChange:N,className:"grid gap-4 py-4",children:[e.jsxs(sn,{className:"grid w-full grid-cols-2",children:[e.jsx(ze,{value:"user-details",children:"User Details"}),e.jsx(ze,{value:"module-access",disabled:!j,children:"Module Access"})]}),e.jsxs("form",{onSubmit:A.handleSubmit(E==="user-details"?Z:re),className:"grid gap-4",children:[e.jsxs(Ve,{value:"user-details",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"first_name",children:"First Name"}),e.jsx(ne,{id:"first_name",...A.register("first_name"),disabled:le}),A.formState.errors.first_name&&e.jsx("p",{className:"text-sm text-destructive",children:A.formState.errors.first_name.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"last_name",children:"Last Name"}),e.jsx(ne,{id:"last_name",...A.register("last_name"),disabled:le}),A.formState.errors.last_name&&e.jsx("p",{className:"text-sm text-destructive",children:A.formState.errors.last_name.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"email",children:"Email"}),e.jsx(ne,{id:"email",type:"email",...A.register("email"),disabled:le}),A.formState.errors.email&&e.jsx("p",{className:"text-sm text-destructive",children:A.formState.errors.email.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"password",children:"Password"}),e.jsx(ne,{id:"password",type:"password",...A.register("password"),disabled:le}),A.formState.errors.password&&e.jsx("p",{className:"text-sm text-destructive",children:A.formState.errors.password.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"role",children:"Role"}),e.jsx(Jt,{name:"role",control:A.control,render:({field:me})=>e.jsxs(Je,{onValueChange:me.onChange,value:me.value,disabled:le,children:[e.jsx(Qe,{children:e.jsx(et,{placeholder:"Select a role"})}),e.jsxs(Xe,{children:[e.jsx(Ue,{value:"user",children:"User"}),e.jsx(Ue,{value:"admin",children:"Admin"}),e.jsx(Ue,{value:"controller",children:"Controller"}),w&&e.jsx(Ue,{value:"super-admin",children:"Super Admin"})]})]})}),A.formState.errors.role&&e.jsx("p",{className:"text-sm text-destructive",children:A.formState.errors.role.message})]}),w&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"company_id",children:"Company"}),e.jsx(Jt,{name:"company_id",control:A.control,render:({field:me})=>e.jsxs(Je,{onValueChange:me.onChange,value:me.value||"",disabled:le||Y,children:[e.jsx(Qe,{children:e.jsx(et,{placeholder:Y?"Loading companies...":"Select a company"})}),e.jsx(Xe,{children:B==null?void 0:B.map(Pe=>e.jsx(Ue,{value:Pe.id,children:Pe.name},Pe.id))})]})}),A.formState.errors.company_id&&e.jsx("p",{className:"col-span-4 text-right text-sm text-destructive",children:A.formState.errors.company_id.message})]})]}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx(ee,{type:"submit",disabled:le,children:le?e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsxs(e.Fragment,{children:["Next ",e.jsx(qn,{className:"ml-2 h-4 w-4"})]})})})]}),e.jsx(Ve,{value:"module-access",children:e.jsxs(we,{children:[e.jsxs(Ae,{children:[e.jsxs(Ee,{className:"text-lg flex items-center gap-2",children:[e.jsx(br,{className:"h-5 w-5"})," Module Access"]}),e.jsx(Re,{children:"Configure which modules this new user will have access to. Core modules are enabled by default."})]}),e.jsx(ke,{className:"grid gap-4",children:ue==="user"?e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"text-md font-semibold",children:"Add-On Modules"}),Fe(We)]}):e.jsxs(dn,{defaultValue:"core-modules",children:[e.jsxs(sn,{className:`grid w-full ${$e?"grid-cols-3":"grid-cols-2"}`,children:[e.jsx(ze,{value:"core-modules",children:"Core Modules"}),$e&&e.jsx(ze,{value:"super-modules",children:"Super Modules"}),e.jsx(ze,{value:"add-on-modules",children:"Add-On Modules"})]}),e.jsx(Ve,{value:"core-modules",className:"mt-4",children:Fe(ie)},`core-${ue}`),$e&&e.jsx(Ve,{value:"super-modules",className:"mt-4",children:Fe(he)},`super-${ue}`),e.jsx(Ve,{value:"add-on-modules",className:"mt-4",children:Fe(We)},`addon-${ue}`)]})}),e.jsxs("div",{className:"flex justify-between p-6 pt-0",children:[e.jsxs(ee,{type:"button",variant:"outline",onClick:()=>N("user-details"),disabled:Ne,children:[e.jsx(Xn,{className:"mr-2 h-4 w-4"})," Previous"]}),e.jsxs(ee,{type:"submit",disabled:Ne,children:[Ne?e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(pn,{className:"mr-2 h-4 w-4"}),"Save Module Access"]})]})]})},`module-access-tab-${ue}`)]})]})]})]})})]}),e.jsx(ke,{children:e.jsxs(Ct,{children:[e.jsx(At,{children:e.jsxs(Me,{children:[e.jsx(be,{children:"Name"}),e.jsx(be,{children:"Email"}),e.jsx(be,{children:"Role"}),e.jsx(be,{children:"Status"}),w&&e.jsx(be,{children:"Company"}),e.jsx(be,{className:"text-right",children:"Actions"})]})}),e.jsx(Pt,{children:O==null?void 0:O.map(me=>{var Pe;return e.jsxs(Me,{children:[e.jsx(ve,{className:"font-medium",children:me.full_name||"N/A"}),e.jsx(ve,{children:me.email}),e.jsx(ve,{children:ii(me.role)}),e.jsx(ve,{children:ii(me.status)}),w&&e.jsx(ve,{children:((Pe=B==null?void 0:B.find(Te=>Te.id===me.company_id))==null?void 0:Pe.name)||"N/A"}),e.jsxs(ve,{className:"text-right space-x-2",children:[e.jsxs(ee,{variant:"outline",size:"sm",onClick:()=>ye(me),children:[e.jsx(rn,{className:"h-4 w-4 mr-1"})," Edit"]}),(w||S&&me.role==="user")&&e.jsxs(ee,{variant:"destructive",size:"sm",onClick:()=>se(me),disabled:xe.isPending||(i==null?void 0:i.id)===me.user_id,children:[xe.isPending&&(_==null?void 0:_.user_id)===me.user_id?e.jsx(fe,{className:"h-4 w-4 animate-spin"}):e.jsx(qt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Delete User"})]})]})]},me.id)})})]})})]}),e.jsxs(we,{children:[e.jsxs(Ae,{children:[e.jsx(Ee,{children:"Pending Invitations"}),e.jsx(Re,{children:w?"All pending invitations across the platform.":"Pending invitations for your company."})]}),e.jsx(ke,{children:e.jsxs(Ct,{children:[e.jsx(At,{children:e.jsxs(Me,{children:[e.jsx(be,{children:"Email"}),e.jsx(be,{children:"Role"}),e.jsx(be,{children:"Expires"}),e.jsx(be,{className:"text-right",children:"Actions"})]})}),e.jsx(Pt,{children:q==null?void 0:q.map(me=>e.jsxs(Me,{children:[e.jsx(ve,{className:"font-medium",children:me.email}),e.jsx(ve,{children:ii(me.role)}),e.jsx(ve,{children:new Date(me.expires_at).toLocaleDateString()}),e.jsxs(ve,{className:"text-right space-x-2",children:[e.jsxs(ee,{variant:"outline",size:"sm",onClick:()=>Se(me.id),disabled:d===me.id||de.isPending,children:[d===me.id?e.jsx(fe,{className:"h-4 w-4 animate-spin"}):e.jsx(Au,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Resend Invite"})]}),e.jsxs(ee,{variant:"destructive",size:"sm",onClick:()=>De(me),disabled:d===me.id||de.isPending,children:[de.isPending&&(v==null?void 0:v.id)===me.id?e.jsx(fe,{className:"h-4 w-4 animate-spin"}):e.jsx(qt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Delete Invite"})]})]})]},me.id))})]})})]}),h&&e.jsx(vt,{open:m,onOpenChange:u,children:e.jsx(rh,{isOpen:m,onOpenChange:u,editingUser:h})}),e.jsx(an,{open:s,onOpenChange:g,children:e.jsxs(zt,{children:[e.jsxs(Bt,{children:[e.jsx($t,{children:"Are you absolutely sure?"}),e.jsxs(Ht,{children:['This action cannot be undone. This will permanently delete the invitation for "',v==null?void 0:v.email,'". The invited user will no longer be able to use this invitation link to set up their account.']})]}),e.jsxs(Ut,{children:[e.jsx(Wt,{disabled:de.isPending,children:"Cancel"}),e.jsxs(Vt,{onClick:te,disabled:de.isPending,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:[de.isPending?e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Delete Invitation"]})]})]})}),e.jsx(an,{open:y,onOpenChange:f,children:e.jsxs(zt,{children:[e.jsxs(Bt,{children:[e.jsx($t,{children:"Are you absolutely sure?"}),e.jsxs(Ht,{children:['This action cannot be undone. This will permanently delete the user "',(_==null?void 0:_.full_name)||(_==null?void 0:_.email),'" and all their associated data.',(i==null?void 0:i.id)===(_==null?void 0:_.user_id)&&e.jsx("p",{className:"text-red-500 font-semibold mt-2",children:"You cannot delete your own account."})]})]}),e.jsxs(Ut,{children:[e.jsx(Wt,{disabled:xe.isPending,children:"Cancel"}),e.jsxs(Vt,{onClick:ge,disabled:xe.isPending||(i==null?void 0:i.id)===(_==null?void 0:_.user_id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:[xe.isPending?e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Delete User"]})]})]})})]})},lh=tt({name:J().min(1,"Vendor name is required"),contact_person:J().optional().nullable(),email:J().email("Invalid email address").optional().nullable(),phone:J().optional().nullable(),address_line_1:J().optional().nullable(),address_line_2:J().optional().nullable(),city:J().optional().nullable(),state_province:J().optional().nullable(),postal_code:J().optional().nullable(),country:J().optional().nullable(),spire_id:J().optional().nullable(),is_active:St().default(!0),website:J().url("Invalid URL").or(Fa("")).optional().nullable(),tax_id:J().optional().nullable(),payment_terms:J().optional().nullable(),default_currency_code:J().min(1,"Default currency is required").default("USD"),notes:J().optional().nullable(),account_number:J().optional().nullable(),tax_exempt:St().default(!1),credit_limit:gt(n=>n===""?0:Number(n),yt().min(0,"Credit limit must be non-negative").default(0)),payment_method:J().optional().nullable(),shipping_address_line_1:J().optional().nullable(),shipping_address_line_2:J().optional().nullable(),shipping_city:J().optional().nullable(),shipping_state_province:J().optional().nullable(),shipping_postal_code:J().optional().nullable(),shipping_country:J().optional().nullable(),shipping_addresses_data:nr().optional().nullable()}),ch=({isOpen:n,onOpenChange:a,editingVendor:t,companyId:r,initialMode:i,prefillData:l})=>{const c=Ye(),{toast:m}=Ke(),{profile:u,isLoading:h}=Ie(),p=u==null?void 0:u.role,[d,o]=T.useState(i),s=ct({resolver:dt(lh),defaultValues:{name:"",contact_person:"",email:"",phone:"",address_line_1:"",address_line_2:"",city:"",state_province:"",postal_code:"",country:"",spire_id:"",is_active:!0,website:"",tax_id:"",payment_terms:"",default_currency_code:"USD",notes:"",account_number:"",tax_exempt:!1,credit_limit:0,payment_method:"",shipping_address_line_1:"",shipping_address_line_2:"",shipping_city:"",shipping_state_province:"",shipping_postal_code:"",shipping_country:"",shipping_addresses_data:null}}),{data:g,isLoading:v}=je({queryKey:["currencies"],queryFn:async()=>{const{data:b,error:E}=await X.from("currencies").select("id, code, name, symbol").eq("is_active",!0).order("code");if(E)throw E;return b}});T.useEffect(()=>{n&&(o(i),t?s.reset({name:t.name,contact_person:t.contact_person||"",email:t.email||"",phone:t.phone||"",address_line_1:t.address_line_1||"",address_line_2:t.address_line_2||"",city:t.city||"",state_province:t.state_province||"",postal_code:t.postal_code||"",country:t.country||"",spire_id:t.spire_id||"",is_active:t.is_active??!0,website:t.website||"",tax_id:t.tax_id||"",payment_terms:t.payment_terms||"",default_currency_code:t.default_currency_code||"USD",notes:t.notes||"",account_number:t.account_number||"",tax_exempt:t.tax_exempt??!1,credit_limit:t.credit_limit??0,payment_method:t.payment_method||"",shipping_address_line_1:t.shipping_address_line_1||"",shipping_address_line_2:t.shipping_address_line_2||"",shipping_city:t.shipping_city||"",shipping_state_province:t.state_province||"",shipping_postal_code:t.postal_code||"",shipping_country:t.country||"",shipping_addresses_data:t.shipping_addresses_data||null}):l?(s.reset({name:l.name||"",contact_person:l.contact_person||"",email:l.email||"",phone:l.phone||"",address_line_1:l.address_line_1||"",address_line_2:l.address_line_2||"",city:l.city||"",state_province:l.state_province||"",postal_code:l.postal_code||"",country:l.country||"",spire_id:l.spire_id||"",is_active:l.is_active??!0,website:l.website||"",tax_id:l.tax_id||"",payment_terms:l.payment_terms||"",default_currency_code:l.default_currency_code||"USD",notes:l.notes||"",account_number:l.account_number||"",tax_exempt:l.tax_exempt??!1,credit_limit:l.credit_limit??0,payment_method:l.payment_method||"",shipping_address_line_1:l.shipping_address_line_1||"",shipping_address_line_2:l.shipping_address_line_2||"",shipping_city:l.shipping_city||"",shipping_state_province:l.state_province||"",shipping_postal_code:l.postal_code||"",shipping_country:l.country||"",shipping_addresses_data:l.shipping_addresses_data||null}),o("add")):s.reset({name:"",contact_person:"",email:"",phone:"",address_line_1:"",address_line_2:"",city:"",state_province:"",postal_code:"",country:"",spire_id:"",is_active:!0,website:"",tax_id:"",payment_terms:"",default_currency_code:"USD",notes:"",account_number:"",tax_exempt:!1,credit_limit:0,payment_method:"",shipping_address_line_1:"",shipping_address_line_2:"",shipping_city:"",shipping_state_province:"",shipping_postal_code:"",shipping_country:"",shipping_addresses_data:null}))},[n,t,s,i,l]);const x=Oe({mutationFn:async b=>{if(!p||!["admin","controller","super-admin"].includes(p))throw new Error("Access Denied: You do not have permission to manage vendors.");if(p!=="super-admin"&&r!==(u==null?void 0:u.company_id))throw new Error("Access Denied: You can only manage vendors for your own company.");const E={...b,company_id:r,shipping_addresses_data:b.shipping_addresses_data||null};if(t){const{error:N}=await X.from("vendors").update({...E,updated_at:new Date().toISOString()}).eq("id",t.id);if(N)throw N}else{const{error:N}=await X.from("vendors").insert(E);if(N)throw N}return null},onSuccess:()=>{c.invalidateQueries({queryKey:["vendors"]}),m({title:"Vendor Saved",description:"Vendor details have been successfully saved."}),a(!1)},onError:b=>{m({title:"Error Saving Vendor",description:b.message||"An unexpected error occurred.",variant:"destructive"})}}),y=b=>{x.mutate(b)},f=h||x.isPending||v,_=d==="view";return e.jsxs(ut,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(_t,{children:[e.jsx(jt,{children:t?_?"View Vendor":"Edit Vendor":"Add New Vendor"}),e.jsx(Et,{children:t?_?"Details of this vendor.":"Update the details of this vendor.":"Add a new vendor to your company's records."})]}),e.jsxs("form",{onSubmit:s.handleSubmit(y),className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"name",children:"Vendor Name"}),e.jsx(ne,{id:"name",...s.register("name"),disabled:f||_}),s.formState.errors.name&&e.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.name.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"account_number",children:"Account Number (Optional)"}),e.jsx(ne,{id:"account_number",...s.register("account_number"),disabled:f||_})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"contact_person",children:"Contact Person (Optional)"}),e.jsx(ne,{id:"contact_person",...s.register("contact_person"),disabled:f||_})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"email",children:"Email (Optional)"}),e.jsx(ne,{id:"email",type:"email",...s.register("email"),disabled:f||_}),s.formState.errors.email&&e.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.email.message})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"phone",children:"Phone (Optional)"}),e.jsx(ne,{id:"phone",...s.register("phone"),disabled:f||_})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"website",children:"Website (Optional)"}),e.jsx(ne,{id:"website",type:"url",...s.register("website"),disabled:f||_}),s.formState.errors.website&&e.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.website.message})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"tax_id",children:"Tax ID (Optional)"}),e.jsx(ne,{id:"tax_id",...s.register("tax_id"),disabled:f||_})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-6",children:[e.jsx(bt,{id:"tax_exempt",checked:s.watch("tax_exempt"),onCheckedChange:b=>s.setValue("tax_exempt",b),disabled:f||_}),e.jsx(G,{htmlFor:"tax_exempt",children:"Tax Exempt"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"credit_limit",children:"Credit Limit"}),e.jsx(ne,{id:"credit_limit",type:"number",step:"0.01",...s.register("credit_limit",{valueAsNumber:!0}),disabled:f||_}),s.formState.errors.credit_limit&&e.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.credit_limit.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"payment_terms",children:"Payment Terms (Optional)"}),e.jsx(ne,{id:"payment_terms",...s.register("payment_terms"),disabled:f||_})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"payment_method",children:"Payment Method (Optional)"}),e.jsx(ne,{id:"payment_method",...s.register("payment_method"),disabled:f||_})]}),e.jsx("h4",{className:"text-md font-semibold mt-4",children:"Billing Address"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"address_line_1",children:"Address Line 1 (Optional)"}),e.jsx(ne,{id:"address_line_1",...s.register("address_line_1"),disabled:f||_})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"address_line_2",children:"Address Line 2 (Optional)"}),e.jsx(ne,{id:"address_line_2",...s.register("address_line_2"),disabled:f||_})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"city",children:"City (Optional)"}),e.jsx(ne,{id:"city",...s.register("city"),disabled:f||_})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"state_province",children:"State/Province (Optional)"}),e.jsx(ne,{id:"state_province",...s.register("state_province"),disabled:f||_})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"postal_code",children:"Zip/Postal Code (Optional)"}),e.jsx(ne,{id:"postal_code",...s.register("postal_code"),disabled:f||_})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"country",children:"Country (Optional)"}),e.jsx(ne,{id:"country",...s.register("country"),disabled:f||_})]})]}),e.jsx("h4",{className:"text-md font-semibold mt-4",children:"Shipping Address (Optional)"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"shipping_address_line_1",children:"Shipping Address Line 1"}),e.jsx(ne,{id:"shipping_address_line_1",...s.register("shipping_address_line_1"),disabled:f||_})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"shipping_address_line_2",children:"Shipping Address Line 2"}),e.jsx(ne,{id:"shipping_address_line_2",...s.register("shipping_address_line_2"),disabled:f||_})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"shipping_city",children:"Shipping City"}),e.jsx(ne,{id:"shipping_city",...s.register("shipping_city"),disabled:f||_})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"shipping_state_province",children:"Shipping State/Province"}),e.jsx(ne,{id:"shipping_state_province",...s.register("shipping_state_province"),disabled:f||_})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"shipping_postal_code",children:"Shipping Zip/Postal Code"}),e.jsx(ne,{id:"shipping_postal_code",...s.register("shipping_postal_code"),disabled:f||_})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"shipping_country",children:"Shipping Country"}),e.jsx(ne,{id:"shipping_country",...s.register("shipping_country"),disabled:f||_})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"default_currency_code",children:"Default Currency"}),e.jsxs(Je,{onValueChange:b=>s.setValue("default_currency_code",b),value:s.watch("default_currency_code"),disabled:f||_,children:[e.jsx(Qe,{id:"default_currency_code",children:e.jsx(et,{placeholder:"Select default currency"})}),e.jsx(Xe,{children:g==null?void 0:g.map(b=>e.jsxs(Ue,{value:b.code,children:[b.code," - ",b.name," (",b.symbol,")"]},b.code))})]}),s.formState.errors.default_currency_code&&e.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.default_currency_code.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"notes",children:"Notes (Optional)"}),e.jsx(Ot,{id:"notes",...s.register("notes"),disabled:f||_,rows:3})]}),e.jsx("h4",{className:"text-md font-semibold mt-4",children:"Spire Integration Details"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"spire_id",children:"Spire ID (vendorNo)"}),e.jsx(ne,{id:"spire_id",...s.register("spire_id"),disabled:f||_})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"shipping_addresses_data",children:"Spire Shipping Addresses (JSON Array - Advanced)"}),e.jsx(Ot,{id:"shipping_addresses_data",value:s.watch("shipping_addresses_data")?JSON.stringify(s.watch("shipping_addresses_data"),null,2):"",onChange:b=>{try{s.setValue("shipping_addresses_data",JSON.parse(b.target.value))}catch{}},disabled:f||_,rows:5,className:"font-mono text-sm"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Enter valid JSON array for Spire's `shippingAddresses`."})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsx(bt,{id:"is_active",checked:s.watch("is_active"),onCheckedChange:b=>s.setValue("is_active",b),disabled:f||_}),e.jsx(G,{htmlFor:"is_active",children:"Active Vendor"})]}),d!=="view"&&e.jsxs(ee,{type:"submit",disabled:f||!s.formState.isDirty,className:"mt-6",children:[f&&e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}),e.jsx(pn,{className:"mr-2 h-4 w-4"}),"Save Vendor"]})]}),e.jsxs(sr,{children:[_&&e.jsxs(ee,{onClick:()=>o("edit"),disabled:f,variant:"secondary",children:[e.jsx(rn,{className:"mr-2 h-4 w-4"})," Edit"]}),!_&&e.jsxs(ee,{variant:"outline",onClick:()=>{t?(o("view"),s.reset({name:t.name,contact_person:t.contact_person||"",email:t.email||"",phone:t.phone||"",address_line_1:t.address_line_1||"",address_line_2:t.address_line_2||"",city:t.city||"",state_province:t.state_province||"",postal_code:t.postal_code||"",country:t.country||"",spire_id:t.spire_id||"",is_active:t.is_active??!0,website:t.website||"",tax_id:t.tax_id||"",payment_terms:t.payment_terms||"",default_currency_code:t.default_currency_code||"USD",notes:t.notes||"",account_number:t.account_number||"",tax_exempt:t.tax_exempt??!1,credit_limit:t.credit_limit??0,payment_method:t.payment_method||"",shipping_address_line_1:t.shipping_address_line_1||"",shipping_address_line_2:t.shipping_address_line_2||"",shipping_city:t.shipping_city||"",shipping_state_province:t.state_province||"",shipping_postal_code:t.postal_code||"",shipping_country:t.country||"",shipping_addresses_data:t.shipping_addresses_data||null})):a(!1)},disabled:f,children:[e.jsx(Ft,{className:"mr-2 h-4 w-4"})," Cancel"]})]})]})};var dh="Separator",Ys="horizontal",uh=["horizontal","vertical"],Ac=T.forwardRef((n,a)=>{const{decorative:t,orientation:r=Ys,...i}=n,l=mh(r)?r:Ys,m=t?{role:"none"}:{"aria-orientation":l==="vertical"?l:void 0,role:"separator"};return e.jsx(er.div,{"data-orientation":l,...m,...i,ref:a})});Ac.displayName=dh;function mh(n){return uh.includes(n)}var Pc=Ac;const lt=T.forwardRef(({className:n,orientation:a="horizontal",decorative:t=!0,...r},i)=>e.jsx(Pc,{ref:i,decorative:t,orientation:a,className:pe("shrink-0 bg-border",a==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",n),...r}));lt.displayName=Pc.displayName;const Oc=({isOpen:n,onOpenChange:a,onAnalyzeSuccess:t,entityType:r})=>{const[i,l]=T.useState(""),[c,m]=T.useState(null),u=T.useRef(null),{toast:h}=Ke(),{profile:p,isLoading:d}=Ie(),o=p==null?void 0:p.role,s=Oe({mutationFn:async N=>{if(!o||!["admin","controller","super-admin"].includes(o))throw new Error("Access Denied: You do not have permission to use Smart Add.");const{data:j,error:C}=await X.functions.invoke("smart-add-analysis",{body:{user_input:N,entity_type:r}});if(C)throw C;return j.data},onSuccess:N=>{typeof N=="object"&&N!==null&&Object.keys(N).length>0?(t(N),h({title:"Analysis Complete",description:"AI has extracted details. Please review and save."}),a(!1),l(""),m(null)):h({title:"No Data Extracted",description:"AI could not find relevant information. Please try a different input or add manually.",variant:"destructive"})},onError:N=>{h({title:"Analysis Error",description:N.message||"An unexpected error occurred during AI analysis.",variant:"destructive"})}}),g=Oe({mutationFn:async({file:N,text:j})=>{if(!o||!["admin","controller","super-admin"].includes(o))throw new Error("Access Denied: You do not have permission to use Smart Add.");const C=new FileReader;return C.readAsDataURL(N),new Promise((D,k)=>{C.onloadend=async()=>{var S;const w=(S=C.result)==null?void 0:S.toString().split(",")[1];if(!w)return k(new Error("Failed to read file as Base64."));try{let P="";if(r==="vendor")P="analyze-vendor-invoice";else if(r==="customer")P="analyze-customer-contact";else return k(new Error("Invalid entity type for file analysis."));const{data:O,error:L}=await X.functions.invoke(P,{body:{fileBase64:w,mimeType:N.type,user_text_input:j}});if(L)return k(L);D(O.data)}catch(P){k(P)}},C.onerror=w=>k(w)})},onSuccess:N=>{typeof N=="object"&&N!==null&&Object.keys(N).length>0?(t(N),h({title:"File Analysis Complete",description:"AI has extracted details from the file. Please review and save."}),a(!1),l(""),m(null)):h({title:"No Data Extracted from File",description:"AI could not find relevant information in the file. Please try a different file or add manually.",variant:"destructive"})},onError:N=>{h({title:"File Analysis Error",description:N.message||"An unexpected error occurred during file analysis.",variant:"destructive"})}}),v=N=>{var C;const j=(C=N.target.files)==null?void 0:C[0];if(j){if(j.size>5*1024*1024){h({title:"File Too Large",description:"Please upload a file smaller than 5MB.",variant:"destructive"});return}m(j),l("")}},x=()=>{m(null),u.current&&(u.current.value="")},y=()=>{c&&i.trim()?g.mutate({file:c,text:i}):c?g.mutate({file:c,text:""}):i.trim()?s.mutate(i):h({title:"Input Required",description:"Please provide some text or upload a file to analyze.",variant:"destructive"})},f=d||s.isPending||g.isPending,_="Tip: try copy/pasting the email signature from the customer! Or upload a vCard or business card image. Paste details like 'Acme Corp, John Doe, info@acmecorp.com, 123 Main St, Anytown, USA, Phone: +1-555-123-4567'",b="e.g., 'Global Supplies Ltd., Jane Doe (Contact), jane@globalsupplies.com, 456 Industrial Ave, City, State, 12345, Phone: 555-987-6543, Website: https://globalsupplies.com, Payment Terms: Net 30'",E=r==="customer"?"image/*,application/vcard,.vcf":"image/*,application/pdf";return e.jsx(vt,{open:n,onOpenChange:a,children:e.jsxs(ut,{className:"sm:max-w-[600px]",children:[e.jsxs(_t,{children:[e.jsxs(jt,{className:"flex items-center gap-2",children:[e.jsx(Tt,{className:"h-5 w-5"})," Smart Add ",r==="customer"?"Customer":"Vendor"]}),e.jsx(Et,{children:"Paste text details or upload a file. AI will analyze and pre-fill the form."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(G,{htmlFor:"smart-add-input",className:"flex items-center gap-1",children:[e.jsx(Da,{className:"h-4 w-4 text-yellow-500"}),r==="customer"?"Customer Details (Text)":"Vendor Details (Text)"]}),e.jsx(Ot,{id:"smart-add-input",placeholder:r==="customer"?_:b,value:i,onChange:N=>{l(N.target.value)},rows:7,disabled:f})]}),e.jsx(lt,{orientation:"horizontal",className:"my-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(G,{htmlFor:"file-upload",className:"flex items-center gap-1",children:[e.jsx(xa,{className:"h-4 w-4 text-blue-500"}),r==="customer"?"Upload vCard or Business Card Image":"Upload Invoice (Image or PDF)"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(ee,{type:"button",variant:"outline",onClick:()=>{var N;return(N=u.current)==null?void 0:N.click()},disabled:f,className:"flex items-center gap-2",children:[e.jsx(xa,{className:"h-4 w-4"}),"Choose File"]}),e.jsx("input",{ref:u,type:"file",accept:E,onChange:v,className:"hidden",disabled:f}),c&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Ta,{className:"h-4 w-4"}),c.name,e.jsx(ee,{type:"button",variant:"ghost",size:"sm",onClick:x,className:"h-6 w-6 p-0",children:e.jsx(Yr,{className:"h-3 w-3"})})]})]})]})]}),e.jsxs(sr,{children:[e.jsx(ee,{variant:"outline",onClick:()=>a(!1),disabled:f,children:"Cancel"}),e.jsxs(ee,{onClick:y,disabled:f||!i.trim()&&!c,children:[f?e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Tt,{className:"mr-2 h-4 w-4"}),"Analyze & Pre-fill"]})]})]})})},ph=()=>{const n=Ye(),{toast:a}=Ke(),{profile:t,isLoading:r}=Ie(),[i,l]=T.useState(!1),[c,m]=T.useState(null),[u,h]=T.useState(!1),[p,d]=T.useState(null),[o,s]=T.useState(!1),[g,v]=T.useState(null),x=t==null?void 0:t.company_id,y=t==null?void 0:t.role,{data:f,isLoading:_,isError:b}=je({queryKey:["vendors",x],queryFn:async()=>{if(!x)return[];const{data:O,error:L}=await X.from("vendors").select("*").eq("company_id",x).order("name",{ascending:!0});if(L)throw L;return O},enabled:!!x&&!r}),E=Oe({mutationFn:async O=>{if(!x)throw new Error("Company ID not found.");const{error:L}=await X.from("vendors").delete().eq("id",O).eq("company_id",x);if(L)throw L;return null},onSuccess:()=>{n.invalidateQueries({queryKey:["vendors"]}),a({title:"Vendor Deleted",description:"Vendor record has been successfully deleted."}),h(!1),d(null)},onError:O=>{a({title:"Error deleting vendor",description:O.message||"An unexpected error occurred.",variant:"destructive"})}}),N=()=>{m(null),v(null),l(!0)},j=O=>{m(O),v(null),l(!0)},C=O=>{d(O),h(!0)},D=()=>{p&&E.mutate(p.id)},k=O=>{const L={...O,default_currency_code:O.default_currency_code??void 0,is_active:O.is_active??!0,tax_exempt:O.tax_exempt??!1,credit_limit:O.credit_limit??0,shipping_addresses_data:O.shipping_addresses_data===null?void 0:O.shipping_addresses_data};v(L),m(null),l(!0)},w=E.isPending,S=y&&["admin","controller","super-admin"].includes(y),P=T.useMemo(()=>f&&f.length>0,[f]);return r||_?e.jsxs("div",{className:"flex flex-1 items-center justify-center",children:[e.jsx(fe,{className:"h-8 w-8 animate-spin"}),e.jsx("p",{className:"ml-2",children:"Loading vendors..."})]}):S?x?b?e.jsx("div",{className:"flex flex-1 items-center justify-center text-destructive",children:e.jsx("p",{children:"Error loading vendors. Please try again."})}):e.jsxs(e.Fragment,{children:[e.jsxs(we,{children:[e.jsxs(Ae,{className:"flex flex-row items-start justify-between space-y-0 pb-2",children:[e.jsxs("div",{children:[e.jsxs(Ee,{className:"flex items-center gap-2",children:[e.jsx(Fl,{className:"h-5 w-5"})," Vendors"]}),e.jsx(Re,{children:"Manage your company's vendor relationships."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ee,{onClick:()=>s(!0),disabled:_||!S,children:[e.jsx(Tt,{className:"mr-2 h-4 w-4"})," Smart Add"]}),e.jsxs(ee,{onClick:N,disabled:_||!S,children:[e.jsx(Kt,{className:"mr-2 h-4 w-4"})," Add New Vendor"]})]})]}),e.jsx(ke,{children:_?e.jsxs("div",{className:"flex justify-center items-center py-4",children:[e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"})," Loading vendors..."]}):b?e.jsx("div",{className:"text-red-500",children:"Error loading vendors."}):P?e.jsx("div",{className:"space-y-2",children:f==null?void 0:f.map(O=>e.jsx(we,{className:"p-2 hover:bg-muted cursor-pointer",children:e.jsxs("div",{className:"flex justify-between items-center",onClick:()=>j(O),children:[e.jsx("div",{className:"font-semibold",children:O.name}),e.jsxs(ee,{variant:"destructive",size:"icon",onClick:L=>{L.stopPropagation(),C(O)},disabled:w,children:[w&&(p==null?void 0:p.id)===O.id?e.jsx(fe,{className:"h-4 w-4 animate-spin"}):e.jsx(qt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Delete"})]})]})},O.id))}):e.jsx("div",{children:"No vendors defined for your company."})})]}),e.jsx(vt,{open:i,onOpenChange:l,children:e.jsx(ch,{isOpen:i,onOpenChange:l,editingVendor:c,companyId:x||"",initialMode:c?"view":"add",prefillData:g})}),e.jsx(Oc,{isOpen:o,onOpenChange:s,onAnalyzeSuccess:k,entityType:"vendor"}),e.jsx(an,{open:u,onOpenChange:h,children:e.jsxs(zt,{children:[e.jsxs(Bt,{children:[e.jsx($t,{children:"Are you absolutely sure?"}),e.jsxs(Ht,{children:['This action cannot be undone. This will permanently delete the vendor "',p==null?void 0:p.name,'".']})]}),e.jsxs(Ut,{children:[e.jsx(Wt,{disabled:w,children:"Cancel"}),e.jsxs(Vt,{onClick:D,disabled:w,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:[w?e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Delete"]})]})]})})]}):e.jsx("div",{className:"flex flex-1 items-center justify-center text-destructive",children:e.jsx("p",{children:"Error: Company ID not found. Please ensure your profile is linked to a company."})}):e.jsx("div",{className:"flex flex-1 items-center justify-center text-destructive",children:e.jsx("p",{children:"Access Denied: Only Admins, Controllers, or Super Admins can manage vendors."})})},fh=tt({name:J().min(1,"Customer name is required"),contact_person:J().optional().nullable(),email:J().email("Invalid email address").optional().nullable(),phone:J().optional().nullable(),address_line_1:J().optional().nullable(),address_line_2:J().optional().nullable(),city:J().optional().nullable(),state_province:J().optional().nullable(),postal_code:J().optional().nullable(),country:J().optional().nullable(),spire_customer_id:J().optional().nullable(),is_active:St().default(!0),website:J().url("Invalid URL").or(Fa("")).optional().nullable(),tax_id:J().optional().nullable(),payment_terms:J().optional().nullable(),default_currency_code:J().min(1,"Default currency is required").default("USD"),notes:J().optional().nullable(),account_number:J().optional().nullable(),tax_exempt:St().default(!1),credit_limit:gt(n=>n===""?null:Number(n),yt().positive("Credit limit must be positive").nullable().optional()),payment_method:J().optional().nullable(),code:J().optional().nullable(),receivable_account:J().optional().nullable(),upload_flag:St().default(!0),discount_code:J().optional().nullable(),credit_type:gt(n=>n===""?null:Number(n),yt().int().nullable().optional()),on_hold:St().default(!1),reference_code:J().optional().nullable(),apply_finance_charges:St().default(!1),user_def_1:J().optional().nullable(),background_color_int:gt(n=>n===""?null:Number(n),yt().int().nullable().optional()),default_ship_to_code:J().optional().nullable(),foreground_color_int:gt(n=>n===""?null:Number(n),yt().int().nullable().optional()),user_def_2:J().optional().nullable(),udf_data:nr().optional().nullable(),statement_type:J().optional().nullable(),payment_provider_id_int:gt(n=>n===""?null:Number(n),yt().int().nullable().optional()),special_code:J().optional().nullable(),spire_status:J().optional().nullable(),shipping_address_line_1:J().optional().nullable(),shipping_address_line_2:J().optional().nullable(),shipping_city:J().optional().nullable(),shipping_state_province:J().optional().nullable(),shipping_postal_code:J().optional().nullable(),shipping_country:J().optional().nullable()}),hh=({isOpen:n,onOpenChange:a,editingCustomer:t,companyId:r,initialMode:i,prefillData:l})=>{const c=Ye(),{toast:m}=Ke(),{profile:u,isLoading:h}=Ie(),p=u==null?void 0:u.role,[d,o]=T.useState(i),s=ct({resolver:dt(fh),defaultValues:{name:"",contact_person:"",email:"",phone:"",address_line_1:"",address_line_2:"",city:"",state_province:"",postal_code:"",country:"",spire_customer_id:"",is_active:!0,website:"",tax_id:"",payment_terms:"",default_currency_code:"USD",notes:"",account_number:"",tax_exempt:!1,credit_limit:void 0,payment_method:"",code:"",receivable_account:"",upload_flag:!0,discount_code:"",credit_type:void 0,on_hold:!1,reference_code:"",apply_finance_charges:!1,user_def_1:"",background_color_int:void 0,default_ship_to_code:"",foreground_color_int:void 0,user_def_2:"",udf_data:{},statement_type:"",payment_provider_id_int:void 0,special_code:"",spire_status:"",shipping_address_line_1:"",shipping_address_line_2:"",shipping_city:"",shipping_state_province:"",shipping_postal_code:"",shipping_country:""}}),{data:g,isLoading:v}=je({queryKey:["currencies"],queryFn:async()=>{const{data:b,error:E}=await X.from("currencies").select("id, code, name, symbol").eq("is_active",!0).order("code");if(E)throw E;return b}});T.useEffect(()=>{n&&(o(i),t?s.reset({name:t.name,contact_person:t.contact_person||"",email:t.email||"",phone:t.phone||"",address_line_1:t.address_line_1||"",address_line_2:t.address_line_2||"",city:t.city||"",state_province:t.state_province||"",postal_code:t.postal_code||"",country:t.country||"",spire_customer_id:t.spire_customer_id||"",is_active:t.is_active??!0,website:t.website||"",tax_id:t.tax_id||"",payment_terms:t.payment_terms||"",default_currency_code:t.default_currency_code||"USD",notes:t.notes||"",account_number:t.account_number||"",tax_exempt:t.tax_exempt??!1,credit_limit:t.credit_limit||void 0,payment_method:t.payment_method||"",code:t.code||"",receivable_account:t.receivable_account||"",upload_flag:t.upload_flag??!0,discount_code:t.discount_code||"",credit_type:t.credit_type||void 0,on_hold:t.on_hold??!1,reference_code:t.reference_code||"",apply_finance_charges:t.apply_finance_charges??!1,user_def_1:t.user_def_1||"",background_color_int:t.background_color_int||void 0,default_ship_to_code:t.default_ship_to_code||"",foreground_color_int:t.foreground_color_int||void 0,user_def_2:t.user_def_2||"",udf_data:t.udf_data||{},statement_type:t.statement_type||"",payment_provider_id_int:t.payment_provider_id_int||void 0,special_code:t.special_code||"",spire_status:t.spire_status||"",shipping_address_line_1:t.shipping_address_line_1||"",shipping_address_line_2:t.shipping_address_line_2||"",shipping_city:t.shipping_city||"",shipping_state_province:t.state_province||"",shipping_postal_code:t.postal_code||"",shipping_country:t.country||""}):l?(s.reset({name:l.name||"",contact_person:l.contact_person||"",email:l.email||"",phone:l.phone||"",address_line_1:l.address_line_1||"",address_line_2:l.address_line_2||"",city:l.city||"",state_province:l.state_province||"",postal_code:l.postal_code||"",country:l.country||"",spire_customer_id:l.spire_customer_id||"",is_active:l.is_active??!0,website:l.website||"",tax_id:l.tax_id||"",payment_terms:l.payment_terms||"",default_currency_code:l.default_currency_code||"USD",notes:l.notes||"",account_number:l.account_number||"",tax_exempt:l.tax_exempt??!1,credit_limit:l.credit_limit||void 0,payment_method:l.payment_method||"",code:l.code||"",receivable_account:l.receivable_account||"",upload_flag:l.upload_flag??!0,discount_code:l.discount_code||"",credit_type:l.credit_type||void 0,on_hold:l.on_hold??!1,reference_code:l.reference_code||"",apply_finance_charges:l.apply_finance_charges??!1,user_def_1:l.user_def_1||"",background_color_int:l.background_color_int||void 0,default_ship_to_code:l.default_ship_to_code||"",foreground_color_int:l.foreground_color_int||void 0,user_def_2:l.user_def_2||"",udf_data:l.udf_data||{},statement_type:l.statement_type||"",payment_provider_id_int:l.payment_provider_id_int||void 0,special_code:l.special_code||"",spire_status:l.spire_status||"",shipping_address_line_1:l.shipping_address_line_1||"",shipping_address_line_2:l.shipping_address_line_2||"",shipping_city:l.shipping_city||"",shipping_state_province:l.state_province||"",shipping_postal_code:l.postal_code||"",shipping_country:l.country||""}),o("add")):s.reset({name:"",contact_person:"",email:"",phone:"",address_line_1:"",address_line_2:"",city:"",state_province:"",postal_code:"",country:"",spire_customer_id:"",is_active:!0,website:"",tax_id:"",payment_terms:"",default_currency_code:"USD",notes:"",account_number:"",tax_exempt:!1,credit_limit:void 0,payment_method:"",code:"",receivable_account:"",upload_flag:!0,discount_code:"",credit_type:void 0,on_hold:!1,reference_code:"",apply_finance_charges:!1,user_def_1:"",background_color_int:void 0,default_ship_to_code:"",foreground_color_int:void 0,user_def_2:"",udf_data:{},statement_type:"",payment_provider_id_int:void 0,special_code:"",spire_status:"",shipping_address_line_1:"",shipping_address_line_2:"",shipping_city:"",shipping_state_province:"",shipping_postal_code:"",shipping_country:""}))},[n,t,s,i,l]);const x=Oe({mutationFn:async b=>{if(!p||!["admin","controller","super-admin"].includes(p))throw new Error("Access Denied: You do not have permission to manage customers.");if(p!=="super-admin"&&r!==(u==null?void 0:u.company_id))throw new Error("Access Denied: You can only manage customers for your own company.");const E={...b,company_id:r,udf_data:b.udf_data||{}};if(t){const{error:N}=await X.from("customers").update({...E,updated_at:new Date().toISOString()}).eq("id",t.id);if(N)throw N}else{const{error:N}=await X.from("customers").insert(E);if(N)throw N}return null},onSuccess:()=>{c.invalidateQueries({queryKey:["customers"]}),m({title:"Customer Saved",description:"Customer details have been successfully saved."}),a(!1)},onError:b=>{m({title:"Error Saving Customer",description:b.message||"An unexpected error occurred.",variant:"destructive"})}}),y=b=>{x.mutate(b)},f=h||x.isPending||v,_=d==="view";return e.jsxs(ut,{className:"sm:max-w-[800px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(_t,{children:[e.jsx(jt,{children:t?_?"View Customer":"Edit Customer":"Add New Customer"}),e.jsx(Et,{children:t?_?"Details of this customer.":"Update the details of this customer.":"Add a new customer to your company's records."})]}),e.jsxs("form",{onSubmit:s.handleSubmit(y),className:"grid gap-4 py-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"General Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"name",children:"Customer Name"}),e.jsx(ne,{id:"name",...s.register("name"),disabled:f||_}),s.formState.errors.name&&e.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.name.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"contact_person",children:"Contact Person (Optional)"}),e.jsx(ne,{id:"contact_person",...s.register("contact_person"),disabled:f||_})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"email",children:"Email (Optional)"}),e.jsx(ne,{id:"email",type:"email",...s.register("email"),disabled:f||_}),s.formState.errors.email&&e.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.email.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"phone",children:"Phone (Optional)"}),e.jsx(ne,{id:"phone",...s.register("phone"),disabled:f||_})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"website",children:"Website (Optional)"}),e.jsx(ne,{id:"website",type:"url",...s.register("website"),disabled:f||_}),s.formState.errors.website&&e.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.website.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"tax_id",children:"Tax ID (Optional)"}),e.jsx(ne,{id:"tax_id",...s.register("tax_id"),disabled:f||_})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"account_number",children:"Account Number (Optional)"}),e.jsx(ne,{id:"account_number",...s.register("account_number"),disabled:f||_})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"spire_customer_id",children:"Spire Customer ID (Optional)"}),e.jsx(ne,{id:"spire_customer_id",...s.register("spire_customer_id"),disabled:f||_})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"code",children:"Spire Code (Optional)"}),e.jsx(ne,{id:"code",...s.register("code"),disabled:f||_})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"special_code",children:"Special Code (Optional)"}),e.jsx(ne,{id:"special_code",...s.register("special_code"),disabled:f||_})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"spire_status",children:"Spire Status (Optional)"}),e.jsx(ne,{id:"spire_status",...s.register("spire_status"),disabled:f||_})]})]}),e.jsx("h3",{className:"text-lg font-semibold mt-6",children:"Billing Address"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"address_line_1",children:"Address Line 1 (Optional)"}),e.jsx(ne,{id:"address_line_1",...s.register("address_line_1"),disabled:f||_})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"address_line_2",children:"Address Line 2 (Optional)"}),e.jsx(ne,{id:"address_line_2",...s.register("address_line_2"),disabled:f||_})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"city",children:"City (Optional)"}),e.jsx(ne,{id:"city",...s.register("city"),disabled:f||_})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"state_province",children:"State/Province (Optional)"}),e.jsx(ne,{id:"state_province",...s.register("state_province"),disabled:f||_})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"postal_code",children:"Zip/Postal Code (Optional)"}),e.jsx(ne,{id:"postal_code",...s.register("postal_code"),disabled:f||_})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"country",children:"Country (Optional)"}),e.jsx(ne,{id:"country",...s.register("country"),disabled:f||_})]})]}),e.jsx("h3",{className:"text-lg font-semibold mt-6",children:"Default Shipping Address"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"For a single default shipping address. Multiple shipping addresses would require a separate table."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"shipping_address_line_1",children:"Address Line 1 (Optional)"}),e.jsx(ne,{id:"shipping_address_line_1",...s.register("shipping_address_line_1"),disabled:f||_})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"shipping_address_line_2",children:"Address Line 2 (Optional)"}),e.jsx(ne,{id:"shipping_address_line_2",...s.register("shipping_address_line_2"),disabled:f||_})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"shipping_city",children:"City (Optional)"}),e.jsx(ne,{id:"shipping_city",...s.register("shipping_city"),disabled:f||_})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"shipping_state_province",children:"State/Province (Optional)"}),e.jsx(ne,{id:"shipping_state_province",...s.register("shipping_state_province"),disabled:f||_})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"shipping_postal_code",children:"Zip/Postal Code (Optional)"}),e.jsx(ne,{id:"shipping_postal_code",...s.register("shipping_postal_code"),disabled:f||_})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"shipping_country",children:"Country (Optional)"}),e.jsx(ne,{id:"shipping_country",...s.register("shipping_country"),disabled:f||_})]})]}),e.jsx("h3",{className:"text-lg font-semibold mt-6",children:"Financial & Other Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"default_currency_code",children:"Default Currency"}),e.jsxs(Je,{onValueChange:b=>s.setValue("default_currency_code",b),value:s.watch("default_currency_code")||"",disabled:f||_,children:[e.jsx(Qe,{id:"default_currency_code",children:e.jsx(et,{placeholder:"Select default currency"})}),e.jsx(Xe,{children:g==null?void 0:g.map(b=>e.jsxs(Ue,{value:b.code,children:[b.code," - ",b.name," (",b.symbol,")"]},b.code))})]}),s.formState.errors.default_currency_code&&e.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.default_currency_code.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"payment_terms",children:"Payment Terms (Optional)"}),e.jsx(ne,{id:"payment_terms",...s.register("payment_terms"),disabled:f||_})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"credit_limit",children:"Credit Limit (Optional)"}),e.jsx(ne,{id:"credit_limit",type:"number",step:"0.01",...s.register("credit_limit",{valueAsNumber:!0}),disabled:f||_}),s.formState.errors.credit_limit&&e.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.credit_limit.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"payment_method",children:"Payment Method (Optional)"}),e.jsx(ne,{id:"payment_method",...s.register("payment_method"),disabled:f||_})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"receivable_account",children:"Receivable Account (Optional)"}),e.jsx(ne,{id:"receivable_account",...s.register("receivable_account"),disabled:f||_})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"credit_type",children:"Credit Type (Optional)"}),e.jsx(ne,{id:"credit_type",type:"number",step:"1",...s.register("credit_type",{valueAsNumber:!0}),disabled:f||_})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"statement_type",children:"Statement Type (Optional)"}),e.jsx(ne,{id:"statement_type",...s.register("statement_type"),disabled:f||_})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"payment_provider_id_int",children:"Payment Provider ID (Optional)"}),e.jsx(ne,{id:"payment_provider_id_int",type:"number",step:"1",...s.register("payment_provider_id_int",{valueAsNumber:!0}),disabled:f||_})]}),e.jsxs("div",{className:"flex items-center space-x-2 col-span-1",children:[e.jsx(bt,{id:"tax_exempt",checked:s.watch("tax_exempt"),onCheckedChange:b=>s.setValue("tax_exempt",b),disabled:f||_}),e.jsx(G,{htmlFor:"tax_exempt",children:"Tax Exempt"})]}),e.jsxs("div",{className:"flex items-center space-x-2 col-span-1",children:[e.jsx(bt,{id:"on_hold",checked:s.watch("on_hold"),onCheckedChange:b=>s.setValue("on_hold",b),disabled:f||_}),e.jsx(G,{htmlFor:"on_hold",children:"On Hold"})]}),e.jsxs("div",{className:"flex items-center space-x-2 col-span-1",children:[e.jsx(bt,{id:"apply_finance_charges",checked:s.watch("apply_finance_charges"),onCheckedChange:b=>s.setValue("apply_finance_charges",b),disabled:f||_}),e.jsx(G,{htmlFor:"apply_finance_charges",children:"Apply Finance Charges"})]}),e.jsxs("div",{className:"flex items-center space-x-2 col-span-1",children:[e.jsx(bt,{id:"upload_flag",checked:s.watch("upload_flag"),onCheckedChange:b=>s.setValue("upload_flag",b),disabled:f||_}),e.jsx(G,{htmlFor:"upload_flag",children:"Upload Flag"})]})]}),e.jsx("h3",{className:"text-lg font-semibold mt-6",children:"User Defined Fields"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"user_def_1",children:"User Defined 1 (Optional)"}),e.jsx(ne,{id:"user_def_1",...s.register("user_def_1"),disabled:f||_})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"user_def_2",children:"User Defined 2 (Optional)"}),e.jsx(ne,{id:"user_def_2",...s.register("user_def_2"),disabled:f||_})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"background_color_int",children:"Background Color (Integer) (Optional)"}),e.jsx(ne,{id:"background_color_int",type:"number",step:"1",...s.register("background_color_int",{valueAsNumber:!0}),disabled:f||_})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"foreground_color_int",children:"Foreground Color (Integer) (Optional)"}),e.jsx(ne,{id:"foreground_color_int",type:"number",step:"1",...s.register("foreground_color_int",{valueAsNumber:!0}),disabled:f||_})]}),e.jsxs("div",{className:"space-y-2 col-span-full",children:[e.jsx(G,{htmlFor:"udf_data",children:"UDF Data (JSON) (Optional)"}),e.jsx(Ot,{id:"udf_data",value:s.watch("udf_data")?JSON.stringify(s.watch("udf_data"),null,2):"",onChange:b=>{try{s.setValue("udf_data",JSON.parse(b.target.value))}catch{}},disabled:f||_,rows:5,className:"font-mono text-sm"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Enter valid JSON for User Defined Fields."})]})]}),e.jsx("h3",{className:"text-lg font-semibold mt-6",children:"Notes & Status"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"notes",children:"Notes (Optional)"}),e.jsx(Ot,{id:"notes",...s.register("notes"),disabled:f||_,rows:3})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsx(bt,{id:"is_active",checked:s.watch("is_active"),onCheckedChange:b=>s.setValue("is_active",b),disabled:f||_}),e.jsx(G,{htmlFor:"is_active",children:"Active Customer"})]}),d!=="view"&&e.jsxs(ee,{type:"submit",disabled:f||!s.formState.isDirty,className:"mt-6",children:[f&&e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}),e.jsx(pn,{className:"mr-2 h-4 w-4"}),"Save Customer"]})]}),e.jsxs(sr,{children:[_&&e.jsxs(ee,{onClick:()=>o("edit"),disabled:f,variant:"secondary",children:[e.jsx(rn,{className:"mr-2 h-4 w-4"})," Edit"]}),!_&&e.jsxs(ee,{variant:"outline",onClick:()=>{t?(o("view"),s.reset({name:t.name,contact_person:t.contact_person||"",email:t.email||"",phone:t.phone||"",address_line_1:t.address_line_1||"",address_line_2:t.address_line_2||"",city:t.city||"",state_province:t.state_province||"",postal_code:t.postal_code||"",country:t.country||"",spire_customer_id:t.spire_customer_id||"",is_active:t.is_active??!0,website:t.website||"",tax_id:t.tax_id||"",payment_terms:t.payment_terms||"",default_currency_code:t.default_currency_code||"USD",notes:t.notes||"",account_number:t.account_number||"",tax_exempt:t.tax_exempt??!1,credit_limit:t.credit_limit||void 0,payment_method:t.payment_method||"",code:t.code||"",receivable_account:t.receivable_account||"",upload_flag:t.upload_flag??!0,discount_code:t.discount_code||"",credit_type:t.credit_type||void 0,on_hold:t.on_hold??!1,reference_code:t.reference_code||"",apply_finance_charges:t.apply_finance_charges??!1,user_def_1:t.user_def_1||"",background_color_int:t.background_color_int||void 0,default_ship_to_code:t.default_ship_to_code||"",foreground_color_int:t.foreground_color_int||void 0,user_def_2:t.user_def_2||"",udf_data:t.udf_data||{},statement_type:t.statement_type||"",payment_provider_id_int:t.payment_provider_id_int||void 0,special_code:t.special_code||"",spire_status:t.spire_status||"",shipping_address_line_1:t.shipping_address_line_1||"",shipping_address_line_2:t.shipping_address_line_2||"",shipping_city:t.shipping_city||"",shipping_state_province:t.state_province||"",shipping_postal_code:t.postal_code||"",shipping_country:t.country||""})):a(!1)},disabled:f,children:[e.jsx(Ft,{className:"mr-2 h-4 w-4"})," Cancel"]})]})]})},gh=()=>{const n=Ye(),{toast:a}=Ke(),{profile:t,isLoading:r}=Ie(),[i,l]=T.useState(!1),[c,m]=T.useState(null),[u,h]=T.useState(!1),[p,d]=T.useState(null),[o,s]=T.useState(!1),[g,v]=T.useState(null),x=t==null?void 0:t.company_id,y=t==null?void 0:t.role,{data:f,isLoading:_,isError:b}=je({queryKey:["customers",x],queryFn:async()=>{if(!x)return[];const{data:P,error:O}=await X.from("customers").select("*").eq("company_id",x).order("name",{ascending:!0});if(O)throw O;return P},enabled:!!x&&!r}),E=Oe({mutationFn:async P=>{if(!x)throw new Error("Company ID not found.");const{error:O}=await X.from("customers").delete().eq("id",P).eq("company_id",x);if(O)throw O;return null},onSuccess:()=>{n.invalidateQueries({queryKey:["customers"]}),a({title:"Customer Deleted",description:"Customer record has been successfully deleted."}),h(!1),d(null)},onError:P=>{a({title:"Error deleting customer",description:P.message||"An unexpected error occurred.",variant:"destructive"})}}),N=()=>{m(null),v(null),l(!0)},j=P=>{m(P),v(null),l(!0)},C=P=>{d(P),h(!0)},D=()=>{p&&E.mutate(p.id)},k=P=>{const O={...P,default_currency_code:P.default_currency_code??void 0,is_active:P.is_active??!0,tax_exempt:P.tax_exempt??!1,credit_limit:P.credit_limit??void 0,upload_flag:P.upload_flag??!0,credit_type:P.credit_type??void 0,on_hold:P.on_hold??!1,apply_finance_charges:P.apply_finance_charges??!1,background_color_int:P.background_color_int??void 0,foreground_color_int:P.foreground_color_int??void 0,udf_data:P.udf_data===null?{}:P.udf_data,payment_provider_id_int:P.payment_provider_id_int??void 0};v(O),m(null),l(!0)},w=E.isPending,S=y&&["admin","controller","super-admin"].includes(y);return r||_?e.jsxs("div",{className:"flex flex-1 items-center justify-center",children:[e.jsx(fe,{className:"h-8 w-8 animate-spin"}),e.jsx("p",{className:"ml-2",children:"Loading customers..."})]}):S?x?b?e.jsx("div",{className:"flex flex-1 items-center justify-center text-destructive",children:e.jsx("p",{children:"Error loading customers. Please try again."})}):e.jsxs(e.Fragment,{children:[e.jsxs(we,{children:[e.jsxs(Ae,{className:"flex flex-row items-start justify-between space-y-0 pb-2",children:[e.jsxs("div",{children:[e.jsxs(Ee,{className:"flex items-center gap-2",children:[e.jsx(Il,{className:"h-5 w-5"})," Customers"]}),e.jsx(Re,{children:"Manage your company's customer relationships."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ee,{onClick:()=>s(!0),disabled:_||!S,children:[e.jsx(Tt,{className:"mr-2 h-4 w-4"})," Smart Add"]}),e.jsxs(ee,{onClick:N,disabled:_||!S,children:[e.jsx(Kt,{className:"mr-2 h-4 w-4"})," Add New Customer"]})]})]}),e.jsx(ke,{children:_?e.jsxs("div",{className:"flex justify-center items-center py-4",children:[e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"})," Loading customers..."]}):b?e.jsx("div",{className:"text-red-500",children:"Error loading customers."}):!f||f.length===0?e.jsx("div",{children:"No customers defined for your company."}):e.jsx("div",{className:"space-y-2",children:f==null?void 0:f.map(P=>e.jsx(we,{className:"p-2 hover:bg-muted cursor-pointer",children:e.jsxs("div",{className:"flex justify-between items-center",onClick:()=>j(P),children:[e.jsx("div",{className:"font-semibold",children:P.name}),e.jsxs(ee,{variant:"destructive",size:"icon",onClick:O=>{O.stopPropagation(),C(P)},disabled:w,children:[w&&(p==null?void 0:p.id)===P.id?e.jsx(fe,{className:"h-4 w-4 animate-spin"}):e.jsx(qt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Delete"})]})]})},P.id))})})]}),e.jsx(vt,{open:i,onOpenChange:l,children:e.jsx(hh,{isOpen:i,onOpenChange:l,editingCustomer:c,companyId:x||"",initialMode:c?"view":"add",prefillData:g})}),e.jsx(Oc,{isOpen:o,onOpenChange:s,onAnalyzeSuccess:k,entityType:"customer"}),e.jsx(an,{open:u,onOpenChange:h,children:e.jsxs(zt,{children:[e.jsxs(Bt,{children:[e.jsx($t,{children:"Are you absolutely sure?"}),e.jsxs(Ht,{children:['This action cannot be undone. This will permanently delete the customer "',p==null?void 0:p.name,'".']})]}),e.jsxs(Ut,{children:[e.jsx(Wt,{disabled:w,children:"Cancel"}),e.jsxs(Vt,{onClick:D,disabled:w,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:[w?e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Delete"]})]})]})})]}):e.jsx("div",{className:"flex flex-1 items-center justify-center text-destructive",children:e.jsx("p",{children:"Error: Company ID not found. Please ensure your profile is linked to a company."})}):e.jsx("div",{className:"flex flex-1 items-center justify-center text-destructive",children:e.jsx("p",{children:"Access Denied: Only Admins, Controllers, or Super Admins can manage customers."})})},vh=n=>je({queryKey:["expenses-with-submitter",n],queryFn:async()=>{const{data:a,error:t}=await X.rpc("get_expenses_with_submitter",{company_id_param:n||null});if(t)throw console.error("Error fetching expenses with submitter:",t),t;return a}}),xh=()=>je({queryKey:["profile"],queryFn:async()=>{const{data:{user:n}}=await X.auth.getUser();if(!n)throw new Error("No authenticated user");const{data:a,error:t}=await X.from("profiles").select("*").eq("id",n.id).single();if(t)throw t;return a}}),si=768;function ns(){const[n,a]=T.useState(void 0);return T.useEffect(()=>{const t=window.matchMedia(`(max-width: ${si-1}px)`),r=()=>{a(window.innerWidth<si)};return t.addEventListener("change",r),a(window.innerWidth<si),()=>t.removeEventListener("change",r)},[]),!!n}const yh=Kr("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function It({className:n,variant:a,...t}){return e.jsx("div",{className:pe(yh({variant:a}),n),...t})}const _r=T.forwardRef(({className:n,...a},t)=>e.jsx(_l,{ref:t,className:pe("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",n),...a}));_r.displayName=_l.displayName;const jr=T.forwardRef(({className:n,...a},t)=>e.jsx(jl,{ref:t,className:pe("aspect-square h-full w-full",n),...a}));jr.displayName=jl.displayName;const wr=T.forwardRef(({className:n,...a},t)=>e.jsx(wl,{ref:t,className:pe("flex h-full w-full items-center justify-center rounded-full bg-muted",n),...a}));wr.displayName=wl.displayName;const rs=du,as=uu,bh=T.forwardRef(({className:n,inset:a,children:t,...r},i)=>e.jsxs(Nl,{ref:i,className:pe("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",a&&"pl-8",n),...r,children:[t,e.jsx(qn,{className:"ml-auto h-4 w-4"})]}));bh.displayName=Nl.displayName;const _h=T.forwardRef(({className:n,...a},t)=>e.jsx(Sl,{ref:t,className:pe("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n),...a}));_h.displayName=Sl.displayName;const Ba=T.forwardRef(({className:n,sideOffset:a=4,...t},r)=>e.jsx(cu,{children:e.jsx(El,{ref:r,sideOffset:a,className:pe("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n),...t})}));Ba.displayName=El.displayName;const Tn=T.forwardRef(({className:n,inset:a,...t},r)=>e.jsx(kl,{ref:r,className:pe("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a&&"pl-8",n),...t}));Tn.displayName=kl.displayName;const jh=T.forwardRef(({className:n,children:a,checked:t,...r},i)=>e.jsxs(Cl,{ref:i,className:pe("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),checked:t,...r,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Al,{children:e.jsx(Hi,{className:"h-4 w-4"})})}),a]}));jh.displayName=Cl.displayName;const wh=T.forwardRef(({className:n,children:a,...t},r)=>e.jsxs(Pl,{ref:r,className:pe("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Al,{children:e.jsx(Pu,{className:"h-2 w-2 fill-current"})})}),a]}));wh.displayName=Pl.displayName;const Dc=T.forwardRef(({className:n,inset:a,...t},r)=>e.jsx(Ol,{ref:r,className:pe("px-2 py-1.5 text-sm font-semibold",a&&"pl-8",n),...t}));Dc.displayName=Ol.displayName;const Pi=T.forwardRef(({className:n,...a},t)=>e.jsx(Dl,{ref:t,className:pe("-mx-1 my-1 h-px bg-muted",n),...a}));Pi.displayName=Dl.displayName;const xn=({amount:n,currencyCode:a})=>{const[t,r]=T.useState("...");return T.useEffect(()=>{(async()=>{r(await Dn(n??0,a))})()},[n,a]),e.jsx(e.Fragment,{children:t})},$n=({expense:n,fieldConfig:a})=>{const t=r=>{var i;return((i=a[r])==null?void 0:i.visible)??!0};return e.jsxs(we,{className:"w-full shadow-none border-0 bg-muted/20",children:[e.jsxs(Ae,{className:"pb-2",children:[e.jsxs(Ee,{className:"text-lg flex items-center justify-between",children:[t("title")&&n.title,e.jsx(It,{className:`text-sm font-medium px-2.5 py-0.5 rounded-full ${n.status==="draft"?"bg-gray-100 text-gray-800":n.status==="submitted"?"bg-blue-100 text-blue-800":n.status==="approved"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:n.status.charAt(0).toUpperCase()+n.status.slice(1)})]}),e.jsxs(Re,{children:["Submitted by ",n.submitter_full_name||n.submitter_email||"N/A"," on ",at(new Date(n.created_at),"PPP")]})]}),e.jsxs(ke,{className:"grid gap-4 text-sm",children:[(t("amount")||t("expense_date"))&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t("amount")&&e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-muted-foreground",children:"Original Amount"}),e.jsx("p",{className:"text-base font-bold",children:e.jsx(xn,{amount:n.amount,currencyCode:n.currency_code})})]}),t("expense_date")&&e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-muted-foreground",children:"Expense Date"}),e.jsx("p",{className:"text-base",children:at(new Date(n.expense_date),"PPP")})]})]}),(t("amount")||t("expense_date"))&&(t("vendor_name")||t("category_id"))&&e.jsx(lt,{}),(t("vendor_name")||t("category_id"))&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t("vendor_name")&&e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-muted-foreground",children:"Vendor Name"}),e.jsx("p",{children:n.vendor_name||"N/A"})]}),t("category_id")&&e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-muted-foreground",children:"Category"}),e.jsx("p",{children:n.category_name||"N/A"})," "]})]}),(t("vendor_name")||t("category_id"))&&(t("project_code")||t("cost_center"))&&e.jsx(lt,{}),(t("project_code")||t("cost_center"))&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t("project_code")&&e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-muted-foreground",children:"Project Code"}),e.jsx("p",{children:n.project_code||"N/A"})]}),t("cost_center")&&e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-muted-foreground",children:"Cost Center"}),e.jsx("p",{children:n.cost_center||"N/A"})]})]}),(t("project_code")||t("cost_center"))&&(n.description||n.receipt_summary)&&e.jsx(lt,{}),t("description")&&n.description&&e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-muted-foreground",children:"Description"}),e.jsx("p",{children:n.description})]})}),t("receipt_summary")&&n.receipt_summary&&e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-muted-foreground",children:"Receipt Summary"}),e.jsx("p",{children:n.receipt_summary})]})}),t("line_items")&&n.expense_line_items&&n.expense_line_items.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(lt,{}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-muted-foreground mb-2",children:"Line Items"}),e.jsx("div",{className:"border rounded-md",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-muted/50",children:[e.jsx("th",{className:"text-left p-2 font-semibold",children:"Description"}),e.jsx("th",{className:"text-right p-2 font-semibold",children:"Qty"}),e.jsx("th",{className:"text-right p-2 font-semibold",children:"Unit Price"}),e.jsx("th",{className:"text-right p-2 font-semibold",children:"Amount"})]})}),e.jsx("tbody",{children:n.expense_line_items.map(r=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2",children:r.description}),e.jsx("td",{className:"text-right p-2",children:r.quantity||"N/A"}),e.jsx("td",{className:"text-right p-2",children:e.jsx(xn,{amount:r.unit_price,currencyCode:r.currency_code})}),e.jsx("td",{className:"text-right p-2",children:e.jsx(xn,{amount:r.line_amount,currencyCode:r.currency_code})})]},r.id))})]})})]})]})]})]})},Gs=n=>{switch(n){case"draft":return"bg-gray-100 text-gray-800";case"submitted":return"bg-blue-100 text-blue-800";case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";case"info_requested":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},Nh=({expenses:n,onView:a,onEdit:t,onDelete:r,showActions:i=!0,isMobile:l=!1,showSubmitterColumn:c=!0,onRowClick:m,expandedRowId:u,userFieldsConfig:h})=>l?e.jsx("div",{className:"space-y-4",children:n.map(p=>{var d,o;return e.jsxs(we,{className:"p-4",children:[e.jsx(Ae,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Ee,{className:"text-sm font-medium",children:p.title}),e.jsx(It,{className:Gs(p.status),children:p.status})]})}),e.jsxs(ke,{className:"pt-2",children:[e.jsxs("div",{className:"space-y-2 text-sm",children:[c&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(_r,{className:"h-6 w-6",children:[e.jsx(jr,{src:p.submitter_avatar_url||""}),e.jsxs(wr,{children:[(d=p.submitter_first_name)==null?void 0:d[0],(o=p.submitter_last_name)==null?void 0:o[0]]})]}),e.jsx("span",{className:"text-muted-foreground",children:p.submitter_full_name||p.submitter_email})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Amount:"}),e.jsx("span",{className:"font-medium",children:Dn(p.amount,p.currency_code)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Date:"}),e.jsx("span",{children:new Date(p.expense_date).toLocaleDateString()})]}),p.category_name&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Category:"}),e.jsx("span",{children:p.category_name})]})]}),i&&e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx(ee,{variant:"outline",size:"sm",onClick:()=>a(p),children:e.jsx(mn,{className:"h-4 w-4"})}),e.jsx(ee,{variant:"outline",size:"sm",onClick:()=>t(p),children:e.jsx(rn,{className:"h-4 w-4"})}),p.status==="draft"&&e.jsx(ee,{variant:"outline",size:"sm",onClick:()=>r(p),children:e.jsx(qt,{className:"h-4 w-4"})})]})]})]},p.id)})}):e.jsx("div",{className:"rounded-md border",children:e.jsxs(Ct,{children:[e.jsx(At,{children:e.jsxs(Me,{children:[e.jsx(be,{className:"w-[40px]"})," ",e.jsx(be,{children:"Title"}),c&&e.jsx(be,{children:"Submitter"}),e.jsx(be,{children:"Amount"}),e.jsx(be,{children:"Date"}),e.jsx(be,{children:"Category"}),e.jsx(be,{children:"Status"}),i&&e.jsx(be,{className:"w-[100px]",children:"Actions"})]})}),e.jsx(Pt,{children:n.map(p=>{var s,g;const d=u===p.id,o=c?8:7;return e.jsxs(W.Fragment,{children:[e.jsxs(Me,{className:pe("h-8 border-b-0 hover:bg-muted/50 cursor-pointer",d&&"bg-muted/50"),onClick:()=>m==null?void 0:m(p),children:[e.jsx(ve,{className:"w-[40px] text-center",children:e.jsx(ee,{variant:"ghost",size:"icon",className:"h-6 w-6",children:d?e.jsx(Oa,{className:"h-4 w-4"}):e.jsx(Bn,{className:"h-4 w-4"})})}),e.jsx(ve,{className:"font-medium",children:Ia(p.title,50)}),c&&e.jsx(ve,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(_r,{className:"h-8 w-8",children:[e.jsx(jr,{src:p.submitter_avatar_url||""}),e.jsxs(wr,{children:[(s=p.submitter_first_name)==null?void 0:s[0],(g=p.submitter_last_name)==null?void 0:g[0]]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:p.submitter_full_name||p.submitter_email}),e.jsx("div",{className:"text-sm text-muted-foreground",children:p.submitter_email})]})]})}),e.jsx(ve,{children:Dn(p.amount,p.currency_code)}),e.jsx(ve,{children:new Date(p.expense_date).toLocaleDateString()}),e.jsx(ve,{children:p.category_name||"—"}),e.jsx(ve,{children:e.jsx(It,{className:Gs(p.status),children:p.status})}),i&&e.jsx(ve,{children:e.jsxs(rs,{children:[e.jsx(as,{asChild:!0,children:e.jsx(ee,{variant:"ghost",className:"h-8 w-8 p-0",children:e.jsx(ql,{className:"h-4 w-4"})})}),e.jsxs(Ba,{align:"end",children:[e.jsxs(Tn,{onClick:()=>a(p),children:[e.jsx(mn,{className:"mr-2 h-4 w-4"}),"View"]}),e.jsxs(Tn,{onClick:()=>t(p),children:[e.jsx(rn,{className:"mr-2 h-4 w-4"}),"Edit"]}),p.status==="draft"&&e.jsxs(Tn,{onClick:()=>r(p),children:[e.jsx(qt,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})})]}),d&&e.jsx(Me,{className:"hover:bg-transparent",children:e.jsx(ve,{colSpan:o,className:"p-0",children:e.jsx(we,{className:"w-full rounded-none border-0 border-t bg-muted/50 shadow-none",children:e.jsx(ke,{className:"p-4",children:e.jsx($n,{expense:p,fieldConfig:h})})})})})]},p.id)})})]})});var qe=function(){return qe=Object.assign||function(a){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var l in t)Object.prototype.hasOwnProperty.call(t,l)&&(a[l]=t[l])}return a},qe.apply(this,arguments)};function Sh(n,a){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&a.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)a.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t}function Tc(n,a,t){for(var r=0,i=a.length,l;r<i;r++)(l||!(r in a))&&(l||(l=Array.prototype.slice.call(a,0,r)),l[r]=a[r]);return n.concat(l||Array.prototype.slice.call(a))}function Xr(n){return n.mode==="multiple"}function Jr(n){return n.mode==="range"}function Ua(n){return n.mode==="single"}var Eh={root:"rdp",multiple_months:"rdp-multiple_months",with_weeknumber:"rdp-with_weeknumber",vhidden:"rdp-vhidden",button_reset:"rdp-button_reset",button:"rdp-button",caption:"rdp-caption",caption_start:"rdp-caption_start",caption_end:"rdp-caption_end",caption_between:"rdp-caption_between",caption_label:"rdp-caption_label",caption_dropdowns:"rdp-caption_dropdowns",dropdown:"rdp-dropdown",dropdown_month:"rdp-dropdown_month",dropdown_year:"rdp-dropdown_year",dropdown_icon:"rdp-dropdown_icon",months:"rdp-months",month:"rdp-month",table:"rdp-table",tbody:"rdp-tbody",tfoot:"rdp-tfoot",head:"rdp-head",head_row:"rdp-head_row",head_cell:"rdp-head_cell",nav:"rdp-nav",nav_button:"rdp-nav_button",nav_button_previous:"rdp-nav_button_previous",nav_button_next:"rdp-nav_button_next",nav_icon:"rdp-nav_icon",row:"rdp-row",weeknumber:"rdp-weeknumber",cell:"rdp-cell",day:"rdp-day",day_today:"rdp-day_today",day_outside:"rdp-day_outside",day_selected:"rdp-day_selected",day_disabled:"rdp-day_disabled",day_hidden:"rdp-day_hidden",day_range_start:"rdp-day_range_start",day_range_end:"rdp-day_range_end",day_range_middle:"rdp-day_range_middle"};function kh(n,a){return at(n,"LLLL y",a)}function Ch(n,a){return at(n,"d",a)}function Ah(n,a){return at(n,"LLLL",a)}function Ph(n){return"".concat(n)}function Oh(n,a){return at(n,"cccccc",a)}function Dh(n,a){return at(n,"yyyy",a)}var Th=Object.freeze({__proto__:null,formatCaption:kh,formatDay:Ch,formatMonthCaption:Ah,formatWeekNumber:Ph,formatWeekdayName:Oh,formatYearCaption:Dh}),Lh=function(n,a,t){return at(n,"do MMMM (EEEE)",t)},Rh=function(){return"Month: "},Mh=function(){return"Go to next month"},Fh=function(){return"Go to previous month"},Ih=function(n,a){return at(n,"cccc",a)},qh=function(n){return"Week n. ".concat(n)},zh=function(){return"Year: "},Bh=Object.freeze({__proto__:null,labelDay:Lh,labelMonthDropdown:Rh,labelNext:Mh,labelPrevious:Fh,labelWeekNumber:qh,labelWeekday:Ih,labelYearDropdown:zh});function Uh(){var n="buttons",a=Eh,t=Ou,r={},i={},l=1,c={},m=new Date;return{captionLayout:n,classNames:a,formatters:Th,labels:Bh,locale:t,modifiersClassNames:r,modifiers:i,numberOfMonths:l,styles:c,today:m,mode:"default"}}function $h(n){var a=n.fromYear,t=n.toYear,r=n.fromMonth,i=n.toMonth,l=n.fromDate,c=n.toDate;return r?l=cn(r):a&&(l=new Date(a,0,1)),i?c=Wi(i):t&&(c=new Date(t,11,31)),{fromDate:l?As(l):void 0,toDate:c?As(c):void 0}}var Lc=T.createContext(void 0);function Hh(n){var a,t=n.initialProps,r=Uh(),i=$h(t),l=i.fromDate,c=i.toDate,m=(a=t.captionLayout)!==null&&a!==void 0?a:r.captionLayout;m!=="buttons"&&(!l||!c)&&(m="buttons");var u;(Ua(t)||Xr(t)||Jr(t))&&(u=t.onSelect);var h=qe(qe(qe({},r),t),{captionLayout:m,classNames:qe(qe({},r.classNames),t.classNames),components:qe({},t.components),formatters:qe(qe({},r.formatters),t.formatters),fromDate:l,labels:qe(qe({},r.labels),t.labels),mode:t.mode||r.mode,modifiers:qe(qe({},r.modifiers),t.modifiers),modifiersClassNames:qe(qe({},r.modifiersClassNames),t.modifiersClassNames),onSelect:u,styles:qe(qe({},r.styles),t.styles),toDate:c});return e.jsx(Lc.Provider,{value:h,children:n.children})}function ot(){var n=T.useContext(Lc);if(!n)throw new Error("useDayPicker must be used within a DayPickerProvider.");return n}function Rc(n){var a=ot(),t=a.locale,r=a.classNames,i=a.styles,l=a.formatters.formatCaption;return e.jsx("div",{className:r.caption_label,style:i.caption_label,"aria-live":"polite",role:"presentation",id:n.id,children:l(n.displayMonth,{locale:t})})}function Vh(n){return e.jsx("svg",qe({width:"8px",height:"8px",viewBox:"0 0 120 120","data-testid":"iconDropdown"},n,{children:e.jsx("path",{d:"M4.22182541,48.2218254 C8.44222828,44.0014225 15.2388494,43.9273804 19.5496459,47.9996989 L19.7781746,48.2218254 L60,88.443 L100.221825,48.2218254 C104.442228,44.0014225 111.238849,43.9273804 115.549646,47.9996989 L115.778175,48.2218254 C119.998577,52.4422283 120.07262,59.2388494 116.000301,63.5496459 L115.778175,63.7781746 L67.7781746,111.778175 C63.5577717,115.998577 56.7611506,116.07262 52.4503541,112.000301 L52.2218254,111.778175 L4.22182541,63.7781746 C-0.0739418023,59.4824074 -0.0739418023,52.5175926 4.22182541,48.2218254 Z",fill:"currentColor",fillRule:"nonzero"})}))}function Mc(n){var a,t,r=n.onChange,i=n.value,l=n.children,c=n.caption,m=n.className,u=n.style,h=ot(),p=(t=(a=h.components)===null||a===void 0?void 0:a.IconDropdown)!==null&&t!==void 0?t:Vh;return e.jsxs("div",{className:m,style:u,children:[e.jsx("span",{className:h.classNames.vhidden,children:n["aria-label"]}),e.jsx("select",{name:n.name,"aria-label":n["aria-label"],className:h.classNames.dropdown,style:h.styles.dropdown,value:i,onChange:r,children:l}),e.jsxs("div",{className:h.classNames.caption_label,style:h.styles.caption_label,"aria-hidden":"true",children:[c,e.jsx(p,{className:h.classNames.dropdown_icon,style:h.styles.dropdown_icon})]})]})}function Wh(n){var a,t=ot(),r=t.fromDate,i=t.toDate,l=t.styles,c=t.locale,m=t.formatters.formatMonthCaption,u=t.classNames,h=t.components,p=t.labels.labelMonthDropdown;if(!r)return e.jsx(e.Fragment,{});if(!i)return e.jsx(e.Fragment,{});var d=[];if(Fu(r,i))for(var o=cn(r),s=r.getMonth();s<=i.getMonth();s++)d.push(Ja(o,s));else for(var o=cn(new Date),s=0;s<=11;s++)d.push(Ja(o,s));var g=function(x){var y=Number(x.target.value),f=Ja(cn(n.displayMonth),y);n.onChange(f)},v=(a=h==null?void 0:h.Dropdown)!==null&&a!==void 0?a:Mc;return e.jsx(v,{name:"months","aria-label":p(),className:u.dropdown_month,style:l.dropdown_month,onChange:g,value:n.displayMonth.getMonth(),caption:m(n.displayMonth,{locale:c}),children:d.map(function(x){return e.jsx("option",{value:x.getMonth(),children:m(x,{locale:c})},x.getMonth())})})}function Kh(n){var a,t=n.displayMonth,r=ot(),i=r.fromDate,l=r.toDate,c=r.locale,m=r.styles,u=r.classNames,h=r.components,p=r.formatters.formatYearCaption,d=r.labels.labelYearDropdown,o=[];if(!i)return e.jsx(e.Fragment,{});if(!l)return e.jsx(e.Fragment,{});for(var s=i.getFullYear(),g=l.getFullYear(),v=s;v<=g;v++)o.push(Ps(Iu(new Date),v));var x=function(f){var _=Ps(cn(t),Number(f.target.value));n.onChange(_)},y=(a=h==null?void 0:h.Dropdown)!==null&&a!==void 0?a:Mc;return e.jsx(y,{name:"years","aria-label":d(),className:u.dropdown_year,style:m.dropdown_year,onChange:x,value:t.getFullYear(),caption:p(t,{locale:c}),children:o.map(function(f){return e.jsx("option",{value:f.getFullYear(),children:p(f,{locale:c})},f.getFullYear())})})}function Yh(n,a){var t=T.useState(n),r=t[0],i=t[1],l=a===void 0?r:a;return[l,i]}function Gh(n){var a=n.month,t=n.defaultMonth,r=n.today,i=a||t||r||new Date,l=n.toDate,c=n.fromDate,m=n.numberOfMonths,u=m===void 0?1:m;if(l&&Br(l,i)<0){var h=-1*(u-1);i=Sn(l,h)}return c&&Br(i,c)<0&&(i=c),cn(i)}function Zh(){var n=ot(),a=Gh(n),t=Yh(a,n.month),r=t[0],i=t[1],l=function(c){var m;if(!n.disableNavigation){var u=cn(c);i(u),(m=n.onMonthChange)===null||m===void 0||m.call(n,u)}};return[r,l]}function Qh(n,a){for(var t=a.reverseMonths,r=a.numberOfMonths,i=cn(n),l=cn(Sn(i,r)),c=Br(l,i),m=[],u=0;u<c;u++){var h=Sn(i,u);m.push(h)}return t&&(m=m.reverse()),m}function Xh(n,a){if(!a.disableNavigation){var t=a.toDate,r=a.pagedNavigation,i=a.numberOfMonths,l=i===void 0?1:i,c=r?l:1,m=cn(n);if(!t)return Sn(m,c);var u=Br(t,n);if(!(u<l))return Sn(m,c)}}function Jh(n,a){if(!a.disableNavigation){var t=a.fromDate,r=a.pagedNavigation,i=a.numberOfMonths,l=i===void 0?1:i,c=r?l:1,m=cn(n);if(!t)return Sn(m,-c);var u=Br(m,t);if(!(u<=0))return Sn(m,-c)}}var Fc=T.createContext(void 0);function eg(n){var a=ot(),t=Zh(),r=t[0],i=t[1],l=Qh(r,a),c=Xh(r,a),m=Jh(r,a),u=function(d){return l.some(function(o){return Ki(d,o)})},h=function(d,o){u(d)||(o&&zl(d,o)?i(Sn(d,1+a.numberOfMonths*-1)):i(d))},p={currentMonth:r,displayMonths:l,goToMonth:i,goToDate:h,previousMonth:m,nextMonth:c,isDateDisplayed:u};return e.jsx(Fc.Provider,{value:p,children:n.children})}function ea(){var n=T.useContext(Fc);if(!n)throw new Error("useNavigation must be used within a NavigationProvider");return n}function Zs(n){var a,t=ot(),r=t.classNames,i=t.styles,l=t.components,c=ea().goToMonth,m=function(p){c(Sn(p,n.displayIndex?-n.displayIndex:0))},u=(a=l==null?void 0:l.CaptionLabel)!==null&&a!==void 0?a:Rc,h=e.jsx(u,{id:n.id,displayMonth:n.displayMonth});return e.jsxs("div",{className:r.caption_dropdowns,style:i.caption_dropdowns,children:[e.jsx("div",{className:r.vhidden,children:h}),e.jsx(Wh,{onChange:m,displayMonth:n.displayMonth}),e.jsx(Kh,{onChange:m,displayMonth:n.displayMonth})]})}function tg(n){return e.jsx("svg",qe({width:"16px",height:"16px",viewBox:"0 0 120 120"},n,{children:e.jsx("path",{d:"M69.490332,3.34314575 C72.6145263,0.218951416 77.6798462,0.218951416 80.8040405,3.34314575 C83.8617626,6.40086786 83.9268205,11.3179931 80.9992143,14.4548388 L80.8040405,14.6568542 L35.461,60 L80.8040405,105.343146 C83.8617626,108.400868 83.9268205,113.317993 80.9992143,116.454839 L80.8040405,116.656854 C77.7463184,119.714576 72.8291931,119.779634 69.6923475,116.852028 L69.490332,116.656854 L18.490332,65.6568542 C15.4326099,62.5991321 15.367552,57.6820069 18.2951583,54.5451612 L18.490332,54.3431458 L69.490332,3.34314575 Z",fill:"currentColor",fillRule:"nonzero"})}))}function ng(n){return e.jsx("svg",qe({width:"16px",height:"16px",viewBox:"0 0 120 120"},n,{children:e.jsx("path",{d:"M49.8040405,3.34314575 C46.6798462,0.218951416 41.6145263,0.218951416 38.490332,3.34314575 C35.4326099,6.40086786 35.367552,11.3179931 38.2951583,14.4548388 L38.490332,14.6568542 L83.8333725,60 L38.490332,105.343146 C35.4326099,108.400868 35.367552,113.317993 38.2951583,116.454839 L38.490332,116.656854 C41.5480541,119.714576 46.4651794,119.779634 49.602025,116.852028 L49.8040405,116.656854 L100.804041,65.6568542 C103.861763,62.5991321 103.926821,57.6820069 100.999214,54.5451612 L100.804041,54.3431458 L49.8040405,3.34314575 Z",fill:"currentColor"})}))}var ba=T.forwardRef(function(n,a){var t=ot(),r=t.classNames,i=t.styles,l=[r.button_reset,r.button];n.className&&l.push(n.className);var c=l.join(" "),m=qe(qe({},i.button_reset),i.button);return n.style&&Object.assign(m,n.style),e.jsx("button",qe({},n,{ref:a,type:"button",className:c,style:m}))});function rg(n){var a,t,r=ot(),i=r.dir,l=r.locale,c=r.classNames,m=r.styles,u=r.labels,h=u.labelPrevious,p=u.labelNext,d=r.components;if(!n.nextMonth&&!n.previousMonth)return e.jsx(e.Fragment,{});var o=h(n.previousMonth,{locale:l}),s=[c.nav_button,c.nav_button_previous].join(" "),g=p(n.nextMonth,{locale:l}),v=[c.nav_button,c.nav_button_next].join(" "),x=(a=d==null?void 0:d.IconRight)!==null&&a!==void 0?a:ng,y=(t=d==null?void 0:d.IconLeft)!==null&&t!==void 0?t:tg;return e.jsxs("div",{className:c.nav,style:m.nav,children:[!n.hidePrevious&&e.jsx(ba,{name:"previous-month","aria-label":o,className:s,style:m.nav_button_previous,disabled:!n.previousMonth,onClick:n.onPreviousClick,children:i==="rtl"?e.jsx(x,{className:c.nav_icon,style:m.nav_icon}):e.jsx(y,{className:c.nav_icon,style:m.nav_icon})}),!n.hideNext&&e.jsx(ba,{name:"next-month","aria-label":g,className:v,style:m.nav_button_next,disabled:!n.nextMonth,onClick:n.onNextClick,children:i==="rtl"?e.jsx(y,{className:c.nav_icon,style:m.nav_icon}):e.jsx(x,{className:c.nav_icon,style:m.nav_icon})})]})}function Qs(n){var a=ot().numberOfMonths,t=ea(),r=t.previousMonth,i=t.nextMonth,l=t.goToMonth,c=t.displayMonths,m=c.findIndex(function(g){return Ki(n.displayMonth,g)}),u=m===0,h=m===c.length-1,p=a>1&&(u||!h),d=a>1&&(h||!u),o=function(){r&&l(r)},s=function(){i&&l(i)};return e.jsx(rg,{displayMonth:n.displayMonth,hideNext:p,hidePrevious:d,nextMonth:i,previousMonth:r,onPreviousClick:o,onNextClick:s})}function ag(n){var a,t=ot(),r=t.classNames,i=t.disableNavigation,l=t.styles,c=t.captionLayout,m=t.components,u=(a=m==null?void 0:m.CaptionLabel)!==null&&a!==void 0?a:Rc,h;return i?h=e.jsx(u,{id:n.id,displayMonth:n.displayMonth}):c==="dropdown"?h=e.jsx(Zs,{displayMonth:n.displayMonth,id:n.id}):c==="dropdown-buttons"?h=e.jsxs(e.Fragment,{children:[e.jsx(Zs,{displayMonth:n.displayMonth,displayIndex:n.displayIndex,id:n.id}),e.jsx(Qs,{displayMonth:n.displayMonth,displayIndex:n.displayIndex,id:n.id})]}):h=e.jsxs(e.Fragment,{children:[e.jsx(u,{id:n.id,displayMonth:n.displayMonth,displayIndex:n.displayIndex}),e.jsx(Qs,{displayMonth:n.displayMonth,id:n.id})]}),e.jsx("div",{className:r.caption,style:l.caption,children:h})}function ig(n){var a=ot(),t=a.footer,r=a.styles,i=a.classNames.tfoot;return t?e.jsx("tfoot",{className:i,style:r.tfoot,children:e.jsx("tr",{children:e.jsx("td",{colSpan:8,children:t})})}):e.jsx(e.Fragment,{})}function sg(n,a,t){for(var r=t?Yi(new Date):Gi(new Date,{locale:n,weekStartsOn:a}),i=[],l=0;l<7;l++){var c=on(r,l);i.push(c)}return i}function og(){var n=ot(),a=n.classNames,t=n.styles,r=n.showWeekNumber,i=n.locale,l=n.weekStartsOn,c=n.ISOWeek,m=n.formatters.formatWeekdayName,u=n.labels.labelWeekday,h=sg(i,l,c);return e.jsxs("tr",{style:t.head_row,className:a.head_row,children:[r&&e.jsx("td",{style:t.head_cell,className:a.head_cell}),h.map(function(p,d){return e.jsx("th",{scope:"col",className:a.head_cell,style:t.head_cell,"aria-label":u(p,{locale:i}),children:m(p,{locale:i})},d)})]})}function lg(){var n,a=ot(),t=a.classNames,r=a.styles,i=a.components,l=(n=i==null?void 0:i.HeadRow)!==null&&n!==void 0?n:og;return e.jsx("thead",{style:r.head,className:t.head,children:e.jsx(l,{})})}function cg(n){var a=ot(),t=a.locale,r=a.formatters.formatDay;return e.jsx(e.Fragment,{children:r(n.date,{locale:t})})}var is=T.createContext(void 0);function dg(n){if(!Xr(n.initialProps)){var a={selected:void 0,modifiers:{disabled:[]}};return e.jsx(is.Provider,{value:a,children:n.children})}return e.jsx(ug,{initialProps:n.initialProps,children:n.children})}function ug(n){var a=n.initialProps,t=n.children,r=a.selected,i=a.min,l=a.max,c=function(h,p,d){var o,s;(o=a.onDayClick)===null||o===void 0||o.call(a,h,p,d);var g=!!(p.selected&&i&&(r==null?void 0:r.length)===i);if(!g){var v=!!(!p.selected&&l&&(r==null?void 0:r.length)===l);if(!v){var x=r?Tc([],r):[];if(p.selected){var y=x.findIndex(function(f){return nn(h,f)});x.splice(y,1)}else x.push(h);(s=a.onSelect)===null||s===void 0||s.call(a,x,h,p,d)}}},m={disabled:[]};r&&m.disabled.push(function(h){var p=l&&r.length>l-1,d=r.some(function(o){return nn(o,h)});return!!(p&&!d)});var u={selected:r,onDayClick:c,modifiers:m};return e.jsx(is.Provider,{value:u,children:t})}function ss(){var n=T.useContext(is);if(!n)throw new Error("useSelectMultiple must be used within a SelectMultipleProvider");return n}function mg(n,a){var t=a||{},r=t.from,i=t.to;return r&&i?nn(i,n)&&nn(r,n)?void 0:nn(i,n)?{from:i,to:void 0}:nn(r,n)?void 0:Ni(r,n)?{from:n,to:i}:{from:r,to:n}:i?Ni(n,i)?{from:i,to:n}:{from:n,to:i}:r?zl(n,r)?{from:n,to:r}:{from:r,to:n}:{from:n,to:void 0}}var os=T.createContext(void 0);function pg(n){if(!Jr(n.initialProps)){var a={selected:void 0,modifiers:{range_start:[],range_end:[],range_middle:[],disabled:[]}};return e.jsx(os.Provider,{value:a,children:n.children})}return e.jsx(fg,{initialProps:n.initialProps,children:n.children})}function fg(n){var a=n.initialProps,t=n.children,r=a.selected,i=r||{},l=i.from,c=i.to,m=a.min,u=a.max,h=function(s,g,v){var x,y;(x=a.onDayClick)===null||x===void 0||x.call(a,s,g,v);var f=mg(s,r);(y=a.onSelect)===null||y===void 0||y.call(a,f,s,g,v)},p={range_start:[],range_end:[],range_middle:[],disabled:[]};if(l?(p.range_start=[l],c?(p.range_end=[c],nn(l,c)||(p.range_middle=[{after:l,before:c}])):p.range_end=[l]):c&&(p.range_start=[c],p.range_end=[c]),m&&(l&&!c&&p.disabled.push({after:Xa(l,m-1),before:on(l,m-1)}),l&&c&&p.disabled.push({after:l,before:on(l,m-1)}),!l&&c&&p.disabled.push({after:Xa(c,m-1),before:on(c,m-1)})),u){if(l&&!c&&(p.disabled.push({before:on(l,-u+1)}),p.disabled.push({after:on(l,u-1)})),l&&c){var d=On(c,l)+1,o=u-d;p.disabled.push({before:Xa(l,o)}),p.disabled.push({after:on(c,o)})}!l&&c&&(p.disabled.push({before:on(c,-u+1)}),p.disabled.push({after:on(c,u-1)}))}return e.jsx(os.Provider,{value:{selected:r,onDayClick:h,modifiers:p},children:t})}function ls(){var n=T.useContext(os);if(!n)throw new Error("useSelectRange must be used within a SelectRangeProvider");return n}function ga(n){return Array.isArray(n)?Tc([],n):n!==void 0?[n]:[]}function hg(n){var a={};return Object.entries(n).forEach(function(t){var r=t[0],i=t[1];a[r]=ga(i)}),a}var bn;(function(n){n.Outside="outside",n.Disabled="disabled",n.Selected="selected",n.Hidden="hidden",n.Today="today",n.RangeStart="range_start",n.RangeEnd="range_end",n.RangeMiddle="range_middle"})(bn||(bn={}));var gg=bn.Selected,Cn=bn.Disabled,vg=bn.Hidden,xg=bn.Today,oi=bn.RangeEnd,li=bn.RangeMiddle,ci=bn.RangeStart,yg=bn.Outside;function bg(n,a,t){var r,i=(r={},r[gg]=ga(n.selected),r[Cn]=ga(n.disabled),r[vg]=ga(n.hidden),r[xg]=[n.today],r[oi]=[],r[li]=[],r[ci]=[],r[yg]=[],r);return n.fromDate&&i[Cn].push({before:n.fromDate}),n.toDate&&i[Cn].push({after:n.toDate}),Xr(n)?i[Cn]=i[Cn].concat(a.modifiers[Cn]):Jr(n)&&(i[Cn]=i[Cn].concat(t.modifiers[Cn]),i[ci]=t.modifiers[ci],i[li]=t.modifiers[li],i[oi]=t.modifiers[oi]),i}var Ic=T.createContext(void 0);function _g(n){var a=ot(),t=ss(),r=ls(),i=bg(a,t,r),l=hg(a.modifiers),c=qe(qe({},i),l);return e.jsx(Ic.Provider,{value:c,children:n.children})}function qc(){var n=T.useContext(Ic);if(!n)throw new Error("useModifiers must be used within a ModifiersProvider");return n}function jg(n){return!!(n&&typeof n=="object"&&"before"in n&&"after"in n)}function wg(n){return!!(n&&typeof n=="object"&&"from"in n)}function Ng(n){return!!(n&&typeof n=="object"&&"after"in n)}function Sg(n){return!!(n&&typeof n=="object"&&"before"in n)}function Eg(n){return!!(n&&typeof n=="object"&&"dayOfWeek"in n)}function kg(n,a){var t,r=a.from,i=a.to;if(r&&i){var l=On(i,r)<0;l&&(t=[i,r],r=t[0],i=t[1]);var c=On(n,r)>=0&&On(i,n)>=0;return c}return i?nn(i,n):r?nn(r,n):!1}function Cg(n){return $l(n)}function Ag(n){return Array.isArray(n)&&n.every($l)}function Pg(n,a){return a.some(function(t){if(typeof t=="boolean")return t;if(Cg(t))return nn(n,t);if(Ag(t))return t.includes(n);if(wg(t))return kg(n,t);if(Eg(t))return t.dayOfWeek.includes(n.getDay());if(jg(t)){var r=On(t.before,n),i=On(t.after,n),l=r>0,c=i<0,m=Ni(t.before,t.after);return m?c&&l:l||c}return Ng(t)?On(n,t.after)>0:Sg(t)?On(t.before,n)>0:typeof t=="function"?t(n):!1})}function cs(n,a,t){var r=Object.keys(a).reduce(function(l,c){var m=a[c];return Pg(n,m)&&l.push(c),l},[]),i={};return r.forEach(function(l){return i[l]=!0}),t&&!Ki(n,t)&&(i.outside=!0),i}function Og(n,a){for(var t=cn(n[0]),r=Wi(n[n.length-1]),i,l,c=t;c<=r;){var m=cs(c,a),u=!m.disabled&&!m.hidden;if(!u){c=on(c,1);continue}if(m.selected)return c;m.today&&!l&&(l=c),i||(i=c),c=on(c,1)}return l||i}var Dg=365;function zc(n,a){var t=a.moveBy,r=a.direction,i=a.context,l=a.modifiers,c=a.retry,m=c===void 0?{count:0,lastFocused:n}:c,u=i.weekStartsOn,h=i.fromDate,p=i.toDate,d=i.locale,o={day:on,week:wi,month:Sn,year:Lu,startOfWeek:function(x){return i.ISOWeek?Yi(x):Gi(x,{locale:d,weekStartsOn:u})},endOfWeek:function(x){return i.ISOWeek?Bl(x):Ul(x,{locale:d,weekStartsOn:u})}},s=o[t](n,r==="after"?1:-1);r==="before"&&h?s=Ru([h,s]):r==="after"&&p&&(s=Mu([p,s]));var g=!0;if(l){var v=cs(s,l);g=!v.disabled&&!v.hidden}return g?s:m.count>Dg?m.lastFocused:zc(s,{moveBy:t,direction:r,context:i,modifiers:l,retry:qe(qe({},m),{count:m.count+1})})}var Bc=T.createContext(void 0);function Tg(n){var a=ea(),t=qc(),r=T.useState(),i=r[0],l=r[1],c=T.useState(),m=c[0],u=c[1],h=Og(a.displayMonths,t),p=i??(m&&a.isDateDisplayed(m))?m:h,d=function(){u(i),l(void 0)},o=function(x){l(x)},s=ot(),g=function(x,y){if(i){var f=zc(i,{moveBy:x,direction:y,context:s,modifiers:t});nn(i,f)||(a.goToDate(f,i),o(f))}},v={focusedDay:i,focusTarget:p,blur:d,focus:o,focusDayAfter:function(){return g("day","after")},focusDayBefore:function(){return g("day","before")},focusWeekAfter:function(){return g("week","after")},focusWeekBefore:function(){return g("week","before")},focusMonthBefore:function(){return g("month","before")},focusMonthAfter:function(){return g("month","after")},focusYearBefore:function(){return g("year","before")},focusYearAfter:function(){return g("year","after")},focusStartOfWeek:function(){return g("startOfWeek","before")},focusEndOfWeek:function(){return g("endOfWeek","after")}};return e.jsx(Bc.Provider,{value:v,children:n.children})}function ds(){var n=T.useContext(Bc);if(!n)throw new Error("useFocusContext must be used within a FocusProvider");return n}function Lg(n,a){var t=qc(),r=cs(n,t,a);return r}var us=T.createContext(void 0);function Rg(n){if(!Ua(n.initialProps)){var a={selected:void 0};return e.jsx(us.Provider,{value:a,children:n.children})}return e.jsx(Mg,{initialProps:n.initialProps,children:n.children})}function Mg(n){var a=n.initialProps,t=n.children,r=function(l,c,m){var u,h,p;if((u=a.onDayClick)===null||u===void 0||u.call(a,l,c,m),c.selected&&!a.required){(h=a.onSelect)===null||h===void 0||h.call(a,void 0,l,c,m);return}(p=a.onSelect)===null||p===void 0||p.call(a,l,l,c,m)},i={selected:a.selected,onDayClick:r};return e.jsx(us.Provider,{value:i,children:t})}function Uc(){var n=T.useContext(us);if(!n)throw new Error("useSelectSingle must be used within a SelectSingleProvider");return n}function Fg(n,a){var t=ot(),r=Uc(),i=ss(),l=ls(),c=ds(),m=c.focusDayAfter,u=c.focusDayBefore,h=c.focusWeekAfter,p=c.focusWeekBefore,d=c.blur,o=c.focus,s=c.focusMonthBefore,g=c.focusMonthAfter,v=c.focusYearBefore,x=c.focusYearAfter,y=c.focusStartOfWeek,f=c.focusEndOfWeek,_=function(B){var Y,U,q,R;Ua(t)?(Y=r.onDayClick)===null||Y===void 0||Y.call(r,n,a,B):Xr(t)?(U=i.onDayClick)===null||U===void 0||U.call(i,n,a,B):Jr(t)?(q=l.onDayClick)===null||q===void 0||q.call(l,n,a,B):(R=t.onDayClick)===null||R===void 0||R.call(t,n,a,B)},b=function(B){var Y;o(n),(Y=t.onDayFocus)===null||Y===void 0||Y.call(t,n,a,B)},E=function(B){var Y;d(),(Y=t.onDayBlur)===null||Y===void 0||Y.call(t,n,a,B)},N=function(B){var Y;(Y=t.onDayMouseEnter)===null||Y===void 0||Y.call(t,n,a,B)},j=function(B){var Y;(Y=t.onDayMouseLeave)===null||Y===void 0||Y.call(t,n,a,B)},C=function(B){var Y;(Y=t.onDayPointerEnter)===null||Y===void 0||Y.call(t,n,a,B)},D=function(B){var Y;(Y=t.onDayPointerLeave)===null||Y===void 0||Y.call(t,n,a,B)},k=function(B){var Y;(Y=t.onDayTouchCancel)===null||Y===void 0||Y.call(t,n,a,B)},w=function(B){var Y;(Y=t.onDayTouchEnd)===null||Y===void 0||Y.call(t,n,a,B)},S=function(B){var Y;(Y=t.onDayTouchMove)===null||Y===void 0||Y.call(t,n,a,B)},P=function(B){var Y;(Y=t.onDayTouchStart)===null||Y===void 0||Y.call(t,n,a,B)},O=function(B){var Y;(Y=t.onDayKeyUp)===null||Y===void 0||Y.call(t,n,a,B)},L=function(B){var Y;switch(B.key){case"ArrowLeft":B.preventDefault(),B.stopPropagation(),t.dir==="rtl"?m():u();break;case"ArrowRight":B.preventDefault(),B.stopPropagation(),t.dir==="rtl"?u():m();break;case"ArrowDown":B.preventDefault(),B.stopPropagation(),h();break;case"ArrowUp":B.preventDefault(),B.stopPropagation(),p();break;case"PageUp":B.preventDefault(),B.stopPropagation(),B.shiftKey?v():s();break;case"PageDown":B.preventDefault(),B.stopPropagation(),B.shiftKey?x():g();break;case"Home":B.preventDefault(),B.stopPropagation(),y();break;case"End":B.preventDefault(),B.stopPropagation(),f();break}(Y=t.onDayKeyDown)===null||Y===void 0||Y.call(t,n,a,B)},$={onClick:_,onFocus:b,onBlur:E,onKeyDown:L,onKeyUp:O,onMouseEnter:N,onMouseLeave:j,onPointerEnter:C,onPointerLeave:D,onTouchCancel:k,onTouchEnd:w,onTouchMove:S,onTouchStart:P};return $}function Ig(){var n=ot(),a=Uc(),t=ss(),r=ls(),i=Ua(n)?a.selected:Xr(n)?t.selected:Jr(n)?r.selected:void 0;return i}function qg(n){return Object.values(bn).includes(n)}function zg(n,a){var t=[n.classNames.day];return Object.keys(a).forEach(function(r){var i=n.modifiersClassNames[r];if(i)t.push(i);else if(qg(r)){var l=n.classNames["day_".concat(r)];l&&t.push(l)}}),t}function Bg(n,a){var t=qe({},n.styles.day);return Object.keys(a).forEach(function(r){var i;t=qe(qe({},t),(i=n.modifiersStyles)===null||i===void 0?void 0:i[r])}),t}function Ug(n,a,t){var r,i,l,c=ot(),m=ds(),u=Lg(n,a),h=Fg(n,u),p=Ig(),d=!!(c.onDayClick||c.mode!=="default");T.useEffect(function(){var N;u.outside||m.focusedDay&&d&&nn(m.focusedDay,n)&&((N=t.current)===null||N===void 0||N.focus())},[m.focusedDay,n,t,d,u.outside]);var o=zg(c,u).join(" "),s=Bg(c,u),g=!!(u.outside&&!c.showOutsideDays||u.hidden),v=(l=(i=c.components)===null||i===void 0?void 0:i.DayContent)!==null&&l!==void 0?l:cg,x=e.jsx(v,{date:n,displayMonth:a,activeModifiers:u}),y={style:s,className:o,children:x,role:"gridcell"},f=m.focusTarget&&nn(m.focusTarget,n)&&!u.outside,_=m.focusedDay&&nn(m.focusedDay,n),b=qe(qe(qe({},y),(r={disabled:u.disabled,role:"gridcell"},r["aria-selected"]=u.selected,r.tabIndex=_||f?0:-1,r)),h),E={isButton:d,isHidden:g,activeModifiers:u,selectedDays:p,buttonProps:b,divProps:y};return E}function $g(n){var a=T.useRef(null),t=Ug(n.date,n.displayMonth,a);return t.isHidden?e.jsx("div",{role:"gridcell"}):t.isButton?e.jsx(ba,qe({name:"day",ref:a},t.buttonProps)):e.jsx("div",qe({},t.divProps))}function Hg(n){var a=n.number,t=n.dates,r=ot(),i=r.onWeekNumberClick,l=r.styles,c=r.classNames,m=r.locale,u=r.labels.labelWeekNumber,h=r.formatters.formatWeekNumber,p=h(Number(a),{locale:m});if(!i)return e.jsx("span",{className:c.weeknumber,style:l.weeknumber,children:p});var d=u(Number(a),{locale:m}),o=function(s){i(a,t,s)};return e.jsx(ba,{name:"week-number","aria-label":d,className:c.weeknumber,style:l.weeknumber,onClick:o,children:p})}function Vg(n){var a,t,r=ot(),i=r.styles,l=r.classNames,c=r.showWeekNumber,m=r.components,u=(a=m==null?void 0:m.Day)!==null&&a!==void 0?a:$g,h=(t=m==null?void 0:m.WeekNumber)!==null&&t!==void 0?t:Hg,p;return c&&(p=e.jsx("td",{className:l.cell,style:i.cell,children:e.jsx(h,{number:n.weekNumber,dates:n.dates})})),e.jsxs("tr",{className:l.row,style:i.row,children:[p,n.dates.map(function(d){return e.jsx("td",{className:l.cell,style:i.cell,role:"presentation",children:e.jsx(u,{displayMonth:n.displayMonth,date:d})},Tu(d))})]})}function Xs(n,a,t){for(var r=t!=null&&t.ISOWeek?Bl(a):Ul(a,t),i=t!=null&&t.ISOWeek?Yi(n):Gi(n,t),l=On(r,i),c=[],m=0;m<=l;m++)c.push(on(i,m));var u=c.reduce(function(h,p){var d=t!=null&&t.ISOWeek?qu(p):zu(p,t),o=h.find(function(s){return s.weekNumber===d});return o?(o.dates.push(p),h):(h.push({weekNumber:d,dates:[p]}),h)},[]);return u}function Wg(n,a){var t=Xs(cn(n),Wi(n),a);if(a!=null&&a.useFixedWeeks){var r=Du(n,a);if(r<6){var i=t[t.length-1],l=i.dates[i.dates.length-1],c=wi(l,6-r),m=Xs(wi(l,1),c,a);t.push.apply(t,m)}}return t}function Kg(n){var a,t,r,i=ot(),l=i.locale,c=i.classNames,m=i.styles,u=i.hideHead,h=i.fixedWeeks,p=i.components,d=i.weekStartsOn,o=i.firstWeekContainsDate,s=i.ISOWeek,g=Wg(n.displayMonth,{useFixedWeeks:!!h,ISOWeek:s,locale:l,weekStartsOn:d,firstWeekContainsDate:o}),v=(a=p==null?void 0:p.Head)!==null&&a!==void 0?a:lg,x=(t=p==null?void 0:p.Row)!==null&&t!==void 0?t:Vg,y=(r=p==null?void 0:p.Footer)!==null&&r!==void 0?r:ig;return e.jsxs("table",{id:n.id,className:c.table,style:m.table,role:"grid","aria-labelledby":n["aria-labelledby"],children:[!u&&e.jsx(v,{}),e.jsx("tbody",{className:c.tbody,style:m.tbody,children:g.map(function(f){return e.jsx(x,{displayMonth:n.displayMonth,dates:f.dates,weekNumber:f.weekNumber},f.weekNumber)})}),e.jsx(y,{displayMonth:n.displayMonth})]})}function Yg(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}var Gg=Yg()?T.useLayoutEffect:T.useEffect,di=!1,Zg=0;function Js(){return"react-day-picker-".concat(++Zg)}function Qg(n){var a,t=n??(di?Js():null),r=T.useState(t),i=r[0],l=r[1];return Gg(function(){i===null&&l(Js())},[]),T.useEffect(function(){di===!1&&(di=!0)},[]),(a=n??i)!==null&&a!==void 0?a:void 0}function Xg(n){var a,t,r=ot(),i=r.dir,l=r.classNames,c=r.styles,m=r.components,u=ea().displayMonths,h=Qg(r.id?"".concat(r.id,"-").concat(n.displayIndex):void 0),p=r.id?"".concat(r.id,"-grid-").concat(n.displayIndex):void 0,d=[l.month],o=c.month,s=n.displayIndex===0,g=n.displayIndex===u.length-1,v=!s&&!g;i==="rtl"&&(a=[s,g],g=a[0],s=a[1]),s&&(d.push(l.caption_start),o=qe(qe({},o),c.caption_start)),g&&(d.push(l.caption_end),o=qe(qe({},o),c.caption_end)),v&&(d.push(l.caption_between),o=qe(qe({},o),c.caption_between));var x=(t=m==null?void 0:m.Caption)!==null&&t!==void 0?t:ag;return e.jsxs("div",{className:d.join(" "),style:o,children:[e.jsx(x,{id:h,displayMonth:n.displayMonth,displayIndex:n.displayIndex}),e.jsx(Kg,{id:p,"aria-labelledby":h,displayMonth:n.displayMonth})]},n.displayIndex)}function Jg(n){var a=ot(),t=a.classNames,r=a.styles;return e.jsx("div",{className:t.months,style:r.months,children:n.children})}function ev(n){var a,t,r=n.initialProps,i=ot(),l=ds(),c=ea(),m=T.useState(!1),u=m[0],h=m[1];T.useEffect(function(){i.initialFocus&&l.focusTarget&&(u||(l.focus(l.focusTarget),h(!0)))},[i.initialFocus,u,l.focus,l.focusTarget,l]);var p=[i.classNames.root,i.className];i.numberOfMonths>1&&p.push(i.classNames.multiple_months),i.showWeekNumber&&p.push(i.classNames.with_weeknumber);var d=qe(qe({},i.styles.root),i.style),o=Object.keys(r).filter(function(g){return g.startsWith("data-")}).reduce(function(g,v){var x;return qe(qe({},g),(x={},x[v]=r[v],x))},{}),s=(t=(a=r.components)===null||a===void 0?void 0:a.Months)!==null&&t!==void 0?t:Jg;return e.jsx("div",qe({className:p.join(" "),style:d,dir:i.dir,id:i.id,nonce:r.nonce,title:r.title,lang:r.lang},o,{children:e.jsx(s,{children:c.displayMonths.map(function(g,v){return e.jsx(Xg,{displayIndex:v,displayMonth:g},v)})})}))}function tv(n){var a=n.children,t=Sh(n,["children"]);return e.jsx(Hh,{initialProps:t,children:e.jsx(eg,{children:e.jsx(Rg,{initialProps:t,children:e.jsx(dg,{initialProps:t,children:e.jsx(pg,{initialProps:t,children:e.jsx(_g,{children:e.jsx(Tg,{children:a})})})})})})})}function nv(n){return e.jsx(tv,qe({},n,{children:e.jsx(ev,{initialProps:n})}))}function $a({className:n,classNames:a,showOutsideDays:t=!0,...r}){return e.jsx(nv,{showOutsideDays:t,className:pe("p-3",n),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:pe(Ur({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-range-start)]:rounded-l-md [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:pe(Ur({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_start:"day-range-start",day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...a},components:{IconLeft:i=>e.jsx(Xn,{className:"h-4 w-4"}),IconRight:i=>e.jsx(qn,{className:"h-4 w-4"})},...r})}$a.displayName="Calendar";const ms=pu,ps=fu,Ha=T.forwardRef(({className:n,align:a="center",sideOffset:t=4,...r},i)=>e.jsx(mu,{children:e.jsx(Tl,{ref:i,align:a,sideOffset:t,className:pe("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n),...r})}));Ha.displayName=Tl.displayName;const rv=new Map([["1km","application/vnd.1000minds.decision-model+xml"],["3dml","text/vnd.in3d.3dml"],["3ds","image/x-3ds"],["3g2","video/3gpp2"],["3gp","video/3gp"],["3gpp","video/3gpp"],["3mf","model/3mf"],["7z","application/x-7z-compressed"],["7zip","application/x-7z-compressed"],["123","application/vnd.lotus-1-2-3"],["aab","application/x-authorware-bin"],["aac","audio/x-acc"],["aam","application/x-authorware-map"],["aas","application/x-authorware-seg"],["abw","application/x-abiword"],["ac","application/vnd.nokia.n-gage.ac+xml"],["ac3","audio/ac3"],["acc","application/vnd.americandynamics.acc"],["ace","application/x-ace-compressed"],["acu","application/vnd.acucobol"],["acutc","application/vnd.acucorp"],["adp","audio/adpcm"],["aep","application/vnd.audiograph"],["afm","application/x-font-type1"],["afp","application/vnd.ibm.modcap"],["ahead","application/vnd.ahead.space"],["ai","application/pdf"],["aif","audio/x-aiff"],["aifc","audio/x-aiff"],["aiff","audio/x-aiff"],["air","application/vnd.adobe.air-application-installer-package+zip"],["ait","application/vnd.dvb.ait"],["ami","application/vnd.amiga.ami"],["amr","audio/amr"],["apk","application/vnd.android.package-archive"],["apng","image/apng"],["appcache","text/cache-manifest"],["application","application/x-ms-application"],["apr","application/vnd.lotus-approach"],["arc","application/x-freearc"],["arj","application/x-arj"],["asc","application/pgp-signature"],["asf","video/x-ms-asf"],["asm","text/x-asm"],["aso","application/vnd.accpac.simply.aso"],["asx","video/x-ms-asf"],["atc","application/vnd.acucorp"],["atom","application/atom+xml"],["atomcat","application/atomcat+xml"],["atomdeleted","application/atomdeleted+xml"],["atomsvc","application/atomsvc+xml"],["atx","application/vnd.antix.game-component"],["au","audio/x-au"],["avi","video/x-msvideo"],["avif","image/avif"],["aw","application/applixware"],["azf","application/vnd.airzip.filesecure.azf"],["azs","application/vnd.airzip.filesecure.azs"],["azv","image/vnd.airzip.accelerator.azv"],["azw","application/vnd.amazon.ebook"],["b16","image/vnd.pco.b16"],["bat","application/x-msdownload"],["bcpio","application/x-bcpio"],["bdf","application/x-font-bdf"],["bdm","application/vnd.syncml.dm+wbxml"],["bdoc","application/x-bdoc"],["bed","application/vnd.realvnc.bed"],["bh2","application/vnd.fujitsu.oasysprs"],["bin","application/octet-stream"],["blb","application/x-blorb"],["blorb","application/x-blorb"],["bmi","application/vnd.bmi"],["bmml","application/vnd.balsamiq.bmml+xml"],["bmp","image/bmp"],["book","application/vnd.framemaker"],["box","application/vnd.previewsystems.box"],["boz","application/x-bzip2"],["bpk","application/octet-stream"],["bpmn","application/octet-stream"],["bsp","model/vnd.valve.source.compiled-map"],["btif","image/prs.btif"],["buffer","application/octet-stream"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["c","text/x-c"],["c4d","application/vnd.clonk.c4group"],["c4f","application/vnd.clonk.c4group"],["c4g","application/vnd.clonk.c4group"],["c4p","application/vnd.clonk.c4group"],["c4u","application/vnd.clonk.c4group"],["c11amc","application/vnd.cluetrust.cartomobile-config"],["c11amz","application/vnd.cluetrust.cartomobile-config-pkg"],["cab","application/vnd.ms-cab-compressed"],["caf","audio/x-caf"],["cap","application/vnd.tcpdump.pcap"],["car","application/vnd.curl.car"],["cat","application/vnd.ms-pki.seccat"],["cb7","application/x-cbr"],["cba","application/x-cbr"],["cbr","application/x-cbr"],["cbt","application/x-cbr"],["cbz","application/x-cbr"],["cc","text/x-c"],["cco","application/x-cocoa"],["cct","application/x-director"],["ccxml","application/ccxml+xml"],["cdbcmsg","application/vnd.contact.cmsg"],["cda","application/x-cdf"],["cdf","application/x-netcdf"],["cdfx","application/cdfx+xml"],["cdkey","application/vnd.mediastation.cdkey"],["cdmia","application/cdmi-capability"],["cdmic","application/cdmi-container"],["cdmid","application/cdmi-domain"],["cdmio","application/cdmi-object"],["cdmiq","application/cdmi-queue"],["cdr","application/cdr"],["cdx","chemical/x-cdx"],["cdxml","application/vnd.chemdraw+xml"],["cdy","application/vnd.cinderella"],["cer","application/pkix-cert"],["cfs","application/x-cfs-compressed"],["cgm","image/cgm"],["chat","application/x-chat"],["chm","application/vnd.ms-htmlhelp"],["chrt","application/vnd.kde.kchart"],["cif","chemical/x-cif"],["cii","application/vnd.anser-web-certificate-issue-initiation"],["cil","application/vnd.ms-artgalry"],["cjs","application/node"],["cla","application/vnd.claymore"],["class","application/octet-stream"],["clkk","application/vnd.crick.clicker.keyboard"],["clkp","application/vnd.crick.clicker.palette"],["clkt","application/vnd.crick.clicker.template"],["clkw","application/vnd.crick.clicker.wordbank"],["clkx","application/vnd.crick.clicker"],["clp","application/x-msclip"],["cmc","application/vnd.cosmocaller"],["cmdf","chemical/x-cmdf"],["cml","chemical/x-cml"],["cmp","application/vnd.yellowriver-custom-menu"],["cmx","image/x-cmx"],["cod","application/vnd.rim.cod"],["coffee","text/coffeescript"],["com","application/x-msdownload"],["conf","text/plain"],["cpio","application/x-cpio"],["cpp","text/x-c"],["cpt","application/mac-compactpro"],["crd","application/x-mscardfile"],["crl","application/pkix-crl"],["crt","application/x-x509-ca-cert"],["crx","application/x-chrome-extension"],["cryptonote","application/vnd.rig.cryptonote"],["csh","application/x-csh"],["csl","application/vnd.citationstyles.style+xml"],["csml","chemical/x-csml"],["csp","application/vnd.commonspace"],["csr","application/octet-stream"],["css","text/css"],["cst","application/x-director"],["csv","text/csv"],["cu","application/cu-seeme"],["curl","text/vnd.curl"],["cww","application/prs.cww"],["cxt","application/x-director"],["cxx","text/x-c"],["dae","model/vnd.collada+xml"],["daf","application/vnd.mobius.daf"],["dart","application/vnd.dart"],["dataless","application/vnd.fdsn.seed"],["davmount","application/davmount+xml"],["dbf","application/vnd.dbf"],["dbk","application/docbook+xml"],["dcr","application/x-director"],["dcurl","text/vnd.curl.dcurl"],["dd2","application/vnd.oma.dd2+xml"],["ddd","application/vnd.fujixerox.ddd"],["ddf","application/vnd.syncml.dmddf+xml"],["dds","image/vnd.ms-dds"],["deb","application/x-debian-package"],["def","text/plain"],["deploy","application/octet-stream"],["der","application/x-x509-ca-cert"],["dfac","application/vnd.dreamfactory"],["dgc","application/x-dgc-compressed"],["dic","text/x-c"],["dir","application/x-director"],["dis","application/vnd.mobius.dis"],["disposition-notification","message/disposition-notification"],["dist","application/octet-stream"],["distz","application/octet-stream"],["djv","image/vnd.djvu"],["djvu","image/vnd.djvu"],["dll","application/octet-stream"],["dmg","application/x-apple-diskimage"],["dmn","application/octet-stream"],["dmp","application/vnd.tcpdump.pcap"],["dms","application/octet-stream"],["dna","application/vnd.dna"],["doc","application/msword"],["docm","application/vnd.ms-word.template.macroEnabled.12"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["dot","application/msword"],["dotm","application/vnd.ms-word.template.macroEnabled.12"],["dotx","application/vnd.openxmlformats-officedocument.wordprocessingml.template"],["dp","application/vnd.osgi.dp"],["dpg","application/vnd.dpgraph"],["dra","audio/vnd.dra"],["drle","image/dicom-rle"],["dsc","text/prs.lines.tag"],["dssc","application/dssc+der"],["dtb","application/x-dtbook+xml"],["dtd","application/xml-dtd"],["dts","audio/vnd.dts"],["dtshd","audio/vnd.dts.hd"],["dump","application/octet-stream"],["dvb","video/vnd.dvb.file"],["dvi","application/x-dvi"],["dwd","application/atsc-dwd+xml"],["dwf","model/vnd.dwf"],["dwg","image/vnd.dwg"],["dxf","image/vnd.dxf"],["dxp","application/vnd.spotfire.dxp"],["dxr","application/x-director"],["ear","application/java-archive"],["ecelp4800","audio/vnd.nuera.ecelp4800"],["ecelp7470","audio/vnd.nuera.ecelp7470"],["ecelp9600","audio/vnd.nuera.ecelp9600"],["ecma","application/ecmascript"],["edm","application/vnd.novadigm.edm"],["edx","application/vnd.novadigm.edx"],["efif","application/vnd.picsel"],["ei6","application/vnd.pg.osasli"],["elc","application/octet-stream"],["emf","image/emf"],["eml","message/rfc822"],["emma","application/emma+xml"],["emotionml","application/emotionml+xml"],["emz","application/x-msmetafile"],["eol","audio/vnd.digital-winds"],["eot","application/vnd.ms-fontobject"],["eps","application/postscript"],["epub","application/epub+zip"],["es","application/ecmascript"],["es3","application/vnd.eszigno3+xml"],["esa","application/vnd.osgi.subsystem"],["esf","application/vnd.epson.esf"],["et3","application/vnd.eszigno3+xml"],["etx","text/x-setext"],["eva","application/x-eva"],["evy","application/x-envoy"],["exe","application/octet-stream"],["exi","application/exi"],["exp","application/express"],["exr","image/aces"],["ext","application/vnd.novadigm.ext"],["ez","application/andrew-inset"],["ez2","application/vnd.ezpix-album"],["ez3","application/vnd.ezpix-package"],["f","text/x-fortran"],["f4v","video/mp4"],["f77","text/x-fortran"],["f90","text/x-fortran"],["fbs","image/vnd.fastbidsheet"],["fcdt","application/vnd.adobe.formscentral.fcdt"],["fcs","application/vnd.isac.fcs"],["fdf","application/vnd.fdf"],["fdt","application/fdt+xml"],["fe_launch","application/vnd.denovo.fcselayout-link"],["fg5","application/vnd.fujitsu.oasysgp"],["fgd","application/x-director"],["fh","image/x-freehand"],["fh4","image/x-freehand"],["fh5","image/x-freehand"],["fh7","image/x-freehand"],["fhc","image/x-freehand"],["fig","application/x-xfig"],["fits","image/fits"],["flac","audio/x-flac"],["fli","video/x-fli"],["flo","application/vnd.micrografx.flo"],["flv","video/x-flv"],["flw","application/vnd.kde.kivio"],["flx","text/vnd.fmi.flexstor"],["fly","text/vnd.fly"],["fm","application/vnd.framemaker"],["fnc","application/vnd.frogans.fnc"],["fo","application/vnd.software602.filler.form+xml"],["for","text/x-fortran"],["fpx","image/vnd.fpx"],["frame","application/vnd.framemaker"],["fsc","application/vnd.fsc.weblaunch"],["fst","image/vnd.fst"],["ftc","application/vnd.fluxtime.clip"],["fti","application/vnd.anser-web-funds-transfer-initiation"],["fvt","video/vnd.fvt"],["fxp","application/vnd.adobe.fxp"],["fxpl","application/vnd.adobe.fxp"],["fzs","application/vnd.fuzzysheet"],["g2w","application/vnd.geoplan"],["g3","image/g3fax"],["g3w","application/vnd.geospace"],["gac","application/vnd.groove-account"],["gam","application/x-tads"],["gbr","application/rpki-ghostbusters"],["gca","application/x-gca-compressed"],["gdl","model/vnd.gdl"],["gdoc","application/vnd.google-apps.document"],["geo","application/vnd.dynageo"],["geojson","application/geo+json"],["gex","application/vnd.geometry-explorer"],["ggb","application/vnd.geogebra.file"],["ggt","application/vnd.geogebra.tool"],["ghf","application/vnd.groove-help"],["gif","image/gif"],["gim","application/vnd.groove-identity-message"],["glb","model/gltf-binary"],["gltf","model/gltf+json"],["gml","application/gml+xml"],["gmx","application/vnd.gmx"],["gnumeric","application/x-gnumeric"],["gpg","application/gpg-keys"],["gph","application/vnd.flographit"],["gpx","application/gpx+xml"],["gqf","application/vnd.grafeq"],["gqs","application/vnd.grafeq"],["gram","application/srgs"],["gramps","application/x-gramps-xml"],["gre","application/vnd.geometry-explorer"],["grv","application/vnd.groove-injector"],["grxml","application/srgs+xml"],["gsf","application/x-font-ghostscript"],["gsheet","application/vnd.google-apps.spreadsheet"],["gslides","application/vnd.google-apps.presentation"],["gtar","application/x-gtar"],["gtm","application/vnd.groove-tool-message"],["gtw","model/vnd.gtw"],["gv","text/vnd.graphviz"],["gxf","application/gxf"],["gxt","application/vnd.geonext"],["gz","application/gzip"],["gzip","application/gzip"],["h","text/x-c"],["h261","video/h261"],["h263","video/h263"],["h264","video/h264"],["hal","application/vnd.hal+xml"],["hbci","application/vnd.hbci"],["hbs","text/x-handlebars-template"],["hdd","application/x-virtualbox-hdd"],["hdf","application/x-hdf"],["heic","image/heic"],["heics","image/heic-sequence"],["heif","image/heif"],["heifs","image/heif-sequence"],["hej2","image/hej2k"],["held","application/atsc-held+xml"],["hh","text/x-c"],["hjson","application/hjson"],["hlp","application/winhlp"],["hpgl","application/vnd.hp-hpgl"],["hpid","application/vnd.hp-hpid"],["hps","application/vnd.hp-hps"],["hqx","application/mac-binhex40"],["hsj2","image/hsj2"],["htc","text/x-component"],["htke","application/vnd.kenameaapp"],["htm","text/html"],["html","text/html"],["hvd","application/vnd.yamaha.hv-dic"],["hvp","application/vnd.yamaha.hv-voice"],["hvs","application/vnd.yamaha.hv-script"],["i2g","application/vnd.intergeo"],["icc","application/vnd.iccprofile"],["ice","x-conference/x-cooltalk"],["icm","application/vnd.iccprofile"],["ico","image/x-icon"],["ics","text/calendar"],["ief","image/ief"],["ifb","text/calendar"],["ifm","application/vnd.shana.informed.formdata"],["iges","model/iges"],["igl","application/vnd.igloader"],["igm","application/vnd.insors.igm"],["igs","model/iges"],["igx","application/vnd.micrografx.igx"],["iif","application/vnd.shana.informed.interchange"],["img","application/octet-stream"],["imp","application/vnd.accpac.simply.imp"],["ims","application/vnd.ms-ims"],["in","text/plain"],["ini","text/plain"],["ink","application/inkml+xml"],["inkml","application/inkml+xml"],["install","application/x-install-instructions"],["iota","application/vnd.astraea-software.iota"],["ipfix","application/ipfix"],["ipk","application/vnd.shana.informed.package"],["irm","application/vnd.ibm.rights-management"],["irp","application/vnd.irepository.package+xml"],["iso","application/x-iso9660-image"],["itp","application/vnd.shana.informed.formtemplate"],["its","application/its+xml"],["ivp","application/vnd.immervision-ivp"],["ivu","application/vnd.immervision-ivu"],["jad","text/vnd.sun.j2me.app-descriptor"],["jade","text/jade"],["jam","application/vnd.jam"],["jar","application/java-archive"],["jardiff","application/x-java-archive-diff"],["java","text/x-java-source"],["jhc","image/jphc"],["jisp","application/vnd.jisp"],["jls","image/jls"],["jlt","application/vnd.hp-jlyt"],["jng","image/x-jng"],["jnlp","application/x-java-jnlp-file"],["joda","application/vnd.joost.joda-archive"],["jp2","image/jp2"],["jpe","image/jpeg"],["jpeg","image/jpeg"],["jpf","image/jpx"],["jpg","image/jpeg"],["jpg2","image/jp2"],["jpgm","video/jpm"],["jpgv","video/jpeg"],["jph","image/jph"],["jpm","video/jpm"],["jpx","image/jpx"],["js","application/javascript"],["json","application/json"],["json5","application/json5"],["jsonld","application/ld+json"],["jsonl","application/jsonl"],["jsonml","application/jsonml+json"],["jsx","text/jsx"],["jxr","image/jxr"],["jxra","image/jxra"],["jxrs","image/jxrs"],["jxs","image/jxs"],["jxsc","image/jxsc"],["jxsi","image/jxsi"],["jxss","image/jxss"],["kar","audio/midi"],["karbon","application/vnd.kde.karbon"],["kdb","application/octet-stream"],["kdbx","application/x-keepass2"],["key","application/x-iwork-keynote-sffkey"],["kfo","application/vnd.kde.kformula"],["kia","application/vnd.kidspiration"],["kml","application/vnd.google-earth.kml+xml"],["kmz","application/vnd.google-earth.kmz"],["kne","application/vnd.kinar"],["knp","application/vnd.kinar"],["kon","application/vnd.kde.kontour"],["kpr","application/vnd.kde.kpresenter"],["kpt","application/vnd.kde.kpresenter"],["kpxx","application/vnd.ds-keypoint"],["ksp","application/vnd.kde.kspread"],["ktr","application/vnd.kahootz"],["ktx","image/ktx"],["ktx2","image/ktx2"],["ktz","application/vnd.kahootz"],["kwd","application/vnd.kde.kword"],["kwt","application/vnd.kde.kword"],["lasxml","application/vnd.las.las+xml"],["latex","application/x-latex"],["lbd","application/vnd.llamagraphics.life-balance.desktop"],["lbe","application/vnd.llamagraphics.life-balance.exchange+xml"],["les","application/vnd.hhe.lesson-player"],["less","text/less"],["lgr","application/lgr+xml"],["lha","application/octet-stream"],["link66","application/vnd.route66.link66+xml"],["list","text/plain"],["list3820","application/vnd.ibm.modcap"],["listafp","application/vnd.ibm.modcap"],["litcoffee","text/coffeescript"],["lnk","application/x-ms-shortcut"],["log","text/plain"],["lostxml","application/lost+xml"],["lrf","application/octet-stream"],["lrm","application/vnd.ms-lrm"],["ltf","application/vnd.frogans.ltf"],["lua","text/x-lua"],["luac","application/x-lua-bytecode"],["lvp","audio/vnd.lucent.voice"],["lwp","application/vnd.lotus-wordpro"],["lzh","application/octet-stream"],["m1v","video/mpeg"],["m2a","audio/mpeg"],["m2v","video/mpeg"],["m3a","audio/mpeg"],["m3u","text/plain"],["m3u8","application/vnd.apple.mpegurl"],["m4a","audio/x-m4a"],["m4p","application/mp4"],["m4s","video/iso.segment"],["m4u","application/vnd.mpegurl"],["m4v","video/x-m4v"],["m13","application/x-msmediaview"],["m14","application/x-msmediaview"],["m21","application/mp21"],["ma","application/mathematica"],["mads","application/mads+xml"],["maei","application/mmt-aei+xml"],["mag","application/vnd.ecowin.chart"],["maker","application/vnd.framemaker"],["man","text/troff"],["manifest","text/cache-manifest"],["map","application/json"],["mar","application/octet-stream"],["markdown","text/markdown"],["mathml","application/mathml+xml"],["mb","application/mathematica"],["mbk","application/vnd.mobius.mbk"],["mbox","application/mbox"],["mc1","application/vnd.medcalcdata"],["mcd","application/vnd.mcd"],["mcurl","text/vnd.curl.mcurl"],["md","text/markdown"],["mdb","application/x-msaccess"],["mdi","image/vnd.ms-modi"],["mdx","text/mdx"],["me","text/troff"],["mesh","model/mesh"],["meta4","application/metalink4+xml"],["metalink","application/metalink+xml"],["mets","application/mets+xml"],["mfm","application/vnd.mfmp"],["mft","application/rpki-manifest"],["mgp","application/vnd.osgeo.mapguide.package"],["mgz","application/vnd.proteus.magazine"],["mid","audio/midi"],["midi","audio/midi"],["mie","application/x-mie"],["mif","application/vnd.mif"],["mime","message/rfc822"],["mj2","video/mj2"],["mjp2","video/mj2"],["mjs","application/javascript"],["mk3d","video/x-matroska"],["mka","audio/x-matroska"],["mkd","text/x-markdown"],["mks","video/x-matroska"],["mkv","video/x-matroska"],["mlp","application/vnd.dolby.mlp"],["mmd","application/vnd.chipnuts.karaoke-mmd"],["mmf","application/vnd.smaf"],["mml","text/mathml"],["mmr","image/vnd.fujixerox.edmics-mmr"],["mng","video/x-mng"],["mny","application/x-msmoney"],["mobi","application/x-mobipocket-ebook"],["mods","application/mods+xml"],["mov","video/quicktime"],["movie","video/x-sgi-movie"],["mp2","audio/mpeg"],["mp2a","audio/mpeg"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mp4a","audio/mp4"],["mp4s","application/mp4"],["mp4v","video/mp4"],["mp21","application/mp21"],["mpc","application/vnd.mophun.certificate"],["mpd","application/dash+xml"],["mpe","video/mpeg"],["mpeg","video/mpeg"],["mpg","video/mpeg"],["mpg4","video/mp4"],["mpga","audio/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["mpm","application/vnd.blueice.multipass"],["mpn","application/vnd.mophun.application"],["mpp","application/vnd.ms-project"],["mpt","application/vnd.ms-project"],["mpy","application/vnd.ibm.minipay"],["mqy","application/vnd.mobius.mqy"],["mrc","application/marc"],["mrcx","application/marcxml+xml"],["ms","text/troff"],["mscml","application/mediaservercontrol+xml"],["mseed","application/vnd.fdsn.mseed"],["mseq","application/vnd.mseq"],["msf","application/vnd.epson.msf"],["msg","application/vnd.ms-outlook"],["msh","model/mesh"],["msi","application/x-msdownload"],["msl","application/vnd.mobius.msl"],["msm","application/octet-stream"],["msp","application/octet-stream"],["msty","application/vnd.muvee.style"],["mtl","model/mtl"],["mts","model/vnd.mts"],["mus","application/vnd.musician"],["musd","application/mmt-usd+xml"],["musicxml","application/vnd.recordare.musicxml+xml"],["mvb","application/x-msmediaview"],["mvt","application/vnd.mapbox-vector-tile"],["mwf","application/vnd.mfer"],["mxf","application/mxf"],["mxl","application/vnd.recordare.musicxml"],["mxmf","audio/mobile-xmf"],["mxml","application/xv+xml"],["mxs","application/vnd.triscape.mxs"],["mxu","video/vnd.mpegurl"],["n-gage","application/vnd.nokia.n-gage.symbian.install"],["n3","text/n3"],["nb","application/mathematica"],["nbp","application/vnd.wolfram.player"],["nc","application/x-netcdf"],["ncx","application/x-dtbncx+xml"],["nfo","text/x-nfo"],["ngdat","application/vnd.nokia.n-gage.data"],["nitf","application/vnd.nitf"],["nlu","application/vnd.neurolanguage.nlu"],["nml","application/vnd.enliven"],["nnd","application/vnd.noblenet-directory"],["nns","application/vnd.noblenet-sealer"],["nnw","application/vnd.noblenet-web"],["npx","image/vnd.net-fpx"],["nq","application/n-quads"],["nsc","application/x-conference"],["nsf","application/vnd.lotus-notes"],["nt","application/n-triples"],["ntf","application/vnd.nitf"],["numbers","application/x-iwork-numbers-sffnumbers"],["nzb","application/x-nzb"],["oa2","application/vnd.fujitsu.oasys2"],["oa3","application/vnd.fujitsu.oasys3"],["oas","application/vnd.fujitsu.oasys"],["obd","application/x-msbinder"],["obgx","application/vnd.openblox.game+xml"],["obj","model/obj"],["oda","application/oda"],["odb","application/vnd.oasis.opendocument.database"],["odc","application/vnd.oasis.opendocument.chart"],["odf","application/vnd.oasis.opendocument.formula"],["odft","application/vnd.oasis.opendocument.formula-template"],["odg","application/vnd.oasis.opendocument.graphics"],["odi","application/vnd.oasis.opendocument.image"],["odm","application/vnd.oasis.opendocument.text-master"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogex","model/vnd.opengex"],["ogg","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["omdoc","application/omdoc+xml"],["onepkg","application/onenote"],["onetmp","application/onenote"],["onetoc","application/onenote"],["onetoc2","application/onenote"],["opf","application/oebps-package+xml"],["opml","text/x-opml"],["oprc","application/vnd.palm"],["opus","audio/ogg"],["org","text/x-org"],["osf","application/vnd.yamaha.openscoreformat"],["osfpvg","application/vnd.yamaha.openscoreformat.osfpvg+xml"],["osm","application/vnd.openstreetmap.data+xml"],["otc","application/vnd.oasis.opendocument.chart-template"],["otf","font/otf"],["otg","application/vnd.oasis.opendocument.graphics-template"],["oth","application/vnd.oasis.opendocument.text-web"],["oti","application/vnd.oasis.opendocument.image-template"],["otp","application/vnd.oasis.opendocument.presentation-template"],["ots","application/vnd.oasis.opendocument.spreadsheet-template"],["ott","application/vnd.oasis.opendocument.text-template"],["ova","application/x-virtualbox-ova"],["ovf","application/x-virtualbox-ovf"],["owl","application/rdf+xml"],["oxps","application/oxps"],["oxt","application/vnd.openofficeorg.extension"],["p","text/x-pascal"],["p7a","application/x-pkcs7-signature"],["p7b","application/x-pkcs7-certificates"],["p7c","application/pkcs7-mime"],["p7m","application/pkcs7-mime"],["p7r","application/x-pkcs7-certreqresp"],["p7s","application/pkcs7-signature"],["p8","application/pkcs8"],["p10","application/x-pkcs10"],["p12","application/x-pkcs12"],["pac","application/x-ns-proxy-autoconfig"],["pages","application/x-iwork-pages-sffpages"],["pas","text/x-pascal"],["paw","application/vnd.pawaafile"],["pbd","application/vnd.powerbuilder6"],["pbm","image/x-portable-bitmap"],["pcap","application/vnd.tcpdump.pcap"],["pcf","application/x-font-pcf"],["pcl","application/vnd.hp-pcl"],["pclxl","application/vnd.hp-pclxl"],["pct","image/x-pict"],["pcurl","application/vnd.curl.pcurl"],["pcx","image/x-pcx"],["pdb","application/x-pilot"],["pde","text/x-processing"],["pdf","application/pdf"],["pem","application/x-x509-user-cert"],["pfa","application/x-font-type1"],["pfb","application/x-font-type1"],["pfm","application/x-font-type1"],["pfr","application/font-tdpfr"],["pfx","application/x-pkcs12"],["pgm","image/x-portable-graymap"],["pgn","application/x-chess-pgn"],["pgp","application/pgp"],["php","application/x-httpd-php"],["php3","application/x-httpd-php"],["php4","application/x-httpd-php"],["phps","application/x-httpd-php-source"],["phtml","application/x-httpd-php"],["pic","image/x-pict"],["pkg","application/octet-stream"],["pki","application/pkixcmp"],["pkipath","application/pkix-pkipath"],["pkpass","application/vnd.apple.pkpass"],["pl","application/x-perl"],["plb","application/vnd.3gpp.pic-bw-large"],["plc","application/vnd.mobius.plc"],["plf","application/vnd.pocketlearn"],["pls","application/pls+xml"],["pm","application/x-perl"],["pml","application/vnd.ctc-posml"],["png","image/png"],["pnm","image/x-portable-anymap"],["portpkg","application/vnd.macports.portpkg"],["pot","application/vnd.ms-powerpoint"],["potm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["potx","application/vnd.openxmlformats-officedocument.presentationml.template"],["ppa","application/vnd.ms-powerpoint"],["ppam","application/vnd.ms-powerpoint.addin.macroEnabled.12"],["ppd","application/vnd.cups-ppd"],["ppm","image/x-portable-pixmap"],["pps","application/vnd.ms-powerpoint"],["ppsm","application/vnd.ms-powerpoint.slideshow.macroEnabled.12"],["ppsx","application/vnd.openxmlformats-officedocument.presentationml.slideshow"],["ppt","application/powerpoint"],["pptm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["pqa","application/vnd.palm"],["prc","application/x-pilot"],["pre","application/vnd.lotus-freelance"],["prf","application/pics-rules"],["provx","application/provenance+xml"],["ps","application/postscript"],["psb","application/vnd.3gpp.pic-bw-small"],["psd","application/x-photoshop"],["psf","application/x-font-linux-psf"],["pskcxml","application/pskc+xml"],["pti","image/prs.pti"],["ptid","application/vnd.pvi.ptid1"],["pub","application/x-mspublisher"],["pvb","application/vnd.3gpp.pic-bw-var"],["pwn","application/vnd.3m.post-it-notes"],["pya","audio/vnd.ms-playready.media.pya"],["pyv","video/vnd.ms-playready.media.pyv"],["qam","application/vnd.epson.quickanime"],["qbo","application/vnd.intu.qbo"],["qfx","application/vnd.intu.qfx"],["qps","application/vnd.publishare-delta-tree"],["qt","video/quicktime"],["qwd","application/vnd.quark.quarkxpress"],["qwt","application/vnd.quark.quarkxpress"],["qxb","application/vnd.quark.quarkxpress"],["qxd","application/vnd.quark.quarkxpress"],["qxl","application/vnd.quark.quarkxpress"],["qxt","application/vnd.quark.quarkxpress"],["ra","audio/x-realaudio"],["ram","audio/x-pn-realaudio"],["raml","application/raml+yaml"],["rapd","application/route-apd+xml"],["rar","application/x-rar"],["ras","image/x-cmu-raster"],["rcprofile","application/vnd.ipunplugged.rcprofile"],["rdf","application/rdf+xml"],["rdz","application/vnd.data-vision.rdz"],["relo","application/p2p-overlay+xml"],["rep","application/vnd.businessobjects"],["res","application/x-dtbresource+xml"],["rgb","image/x-rgb"],["rif","application/reginfo+xml"],["rip","audio/vnd.rip"],["ris","application/x-research-info-systems"],["rl","application/resource-lists+xml"],["rlc","image/vnd.fujixerox.edmics-rlc"],["rld","application/resource-lists-diff+xml"],["rm","audio/x-pn-realaudio"],["rmi","audio/midi"],["rmp","audio/x-pn-realaudio-plugin"],["rms","application/vnd.jcp.javame.midlet-rms"],["rmvb","application/vnd.rn-realmedia-vbr"],["rnc","application/relax-ng-compact-syntax"],["rng","application/xml"],["roa","application/rpki-roa"],["roff","text/troff"],["rp9","application/vnd.cloanto.rp9"],["rpm","audio/x-pn-realaudio-plugin"],["rpss","application/vnd.nokia.radio-presets"],["rpst","application/vnd.nokia.radio-preset"],["rq","application/sparql-query"],["rs","application/rls-services+xml"],["rsa","application/x-pkcs7"],["rsat","application/atsc-rsat+xml"],["rsd","application/rsd+xml"],["rsheet","application/urc-ressheet+xml"],["rss","application/rss+xml"],["rtf","text/rtf"],["rtx","text/richtext"],["run","application/x-makeself"],["rusd","application/route-usd+xml"],["rv","video/vnd.rn-realvideo"],["s","text/x-asm"],["s3m","audio/s3m"],["saf","application/vnd.yamaha.smaf-audio"],["sass","text/x-sass"],["sbml","application/sbml+xml"],["sc","application/vnd.ibm.secure-container"],["scd","application/x-msschedule"],["scm","application/vnd.lotus-screencam"],["scq","application/scvp-cv-request"],["scs","application/scvp-cv-response"],["scss","text/x-scss"],["scurl","text/vnd.curl.scurl"],["sda","application/vnd.stardivision.draw"],["sdc","application/vnd.stardivision.calc"],["sdd","application/vnd.stardivision.impress"],["sdkd","application/vnd.solent.sdkm+xml"],["sdkm","application/vnd.solent.sdkm+xml"],["sdp","application/sdp"],["sdw","application/vnd.stardivision.writer"],["sea","application/octet-stream"],["see","application/vnd.seemail"],["seed","application/vnd.fdsn.seed"],["sema","application/vnd.sema"],["semd","application/vnd.semd"],["semf","application/vnd.semf"],["senmlx","application/senml+xml"],["sensmlx","application/sensml+xml"],["ser","application/java-serialized-object"],["setpay","application/set-payment-initiation"],["setreg","application/set-registration-initiation"],["sfd-hdstx","application/vnd.hydrostatix.sof-data"],["sfs","application/vnd.spotfire.sfs"],["sfv","text/x-sfv"],["sgi","image/sgi"],["sgl","application/vnd.stardivision.writer-global"],["sgm","text/sgml"],["sgml","text/sgml"],["sh","application/x-sh"],["shar","application/x-shar"],["shex","text/shex"],["shf","application/shf+xml"],["shtml","text/html"],["sid","image/x-mrsid-image"],["sieve","application/sieve"],["sig","application/pgp-signature"],["sil","audio/silk"],["silo","model/mesh"],["sis","application/vnd.symbian.install"],["sisx","application/vnd.symbian.install"],["sit","application/x-stuffit"],["sitx","application/x-stuffitx"],["siv","application/sieve"],["skd","application/vnd.koan"],["skm","application/vnd.koan"],["skp","application/vnd.koan"],["skt","application/vnd.koan"],["sldm","application/vnd.ms-powerpoint.slide.macroenabled.12"],["sldx","application/vnd.openxmlformats-officedocument.presentationml.slide"],["slim","text/slim"],["slm","text/slim"],["sls","application/route-s-tsid+xml"],["slt","application/vnd.epson.salt"],["sm","application/vnd.stepmania.stepchart"],["smf","application/vnd.stardivision.math"],["smi","application/smil"],["smil","application/smil"],["smv","video/x-smv"],["smzip","application/vnd.stepmania.package"],["snd","audio/basic"],["snf","application/x-font-snf"],["so","application/octet-stream"],["spc","application/x-pkcs7-certificates"],["spdx","text/spdx"],["spf","application/vnd.yamaha.smaf-phrase"],["spl","application/x-futuresplash"],["spot","text/vnd.in3d.spot"],["spp","application/scvp-vp-response"],["spq","application/scvp-vp-request"],["spx","audio/ogg"],["sql","application/x-sql"],["src","application/x-wais-source"],["srt","application/x-subrip"],["sru","application/sru+xml"],["srx","application/sparql-results+xml"],["ssdl","application/ssdl+xml"],["sse","application/vnd.kodak-descriptor"],["ssf","application/vnd.epson.ssf"],["ssml","application/ssml+xml"],["sst","application/octet-stream"],["st","application/vnd.sailingtracker.track"],["stc","application/vnd.sun.xml.calc.template"],["std","application/vnd.sun.xml.draw.template"],["stf","application/vnd.wt.stf"],["sti","application/vnd.sun.xml.impress.template"],["stk","application/hyperstudio"],["stl","model/stl"],["stpx","model/step+xml"],["stpxz","model/step-xml+zip"],["stpz","model/step+zip"],["str","application/vnd.pg.format"],["stw","application/vnd.sun.xml.writer.template"],["styl","text/stylus"],["stylus","text/stylus"],["sub","text/vnd.dvb.subtitle"],["sus","application/vnd.sus-calendar"],["susp","application/vnd.sus-calendar"],["sv4cpio","application/x-sv4cpio"],["sv4crc","application/x-sv4crc"],["svc","application/vnd.dvb.service"],["svd","application/vnd.svd"],["svg","image/svg+xml"],["svgz","image/svg+xml"],["swa","application/x-director"],["swf","application/x-shockwave-flash"],["swi","application/vnd.aristanetworks.swi"],["swidtag","application/swid+xml"],["sxc","application/vnd.sun.xml.calc"],["sxd","application/vnd.sun.xml.draw"],["sxg","application/vnd.sun.xml.writer.global"],["sxi","application/vnd.sun.xml.impress"],["sxm","application/vnd.sun.xml.math"],["sxw","application/vnd.sun.xml.writer"],["t","text/troff"],["t3","application/x-t3vm-image"],["t38","image/t38"],["taglet","application/vnd.mynfc"],["tao","application/vnd.tao.intent-module-archive"],["tap","image/vnd.tencent.tap"],["tar","application/x-tar"],["tcap","application/vnd.3gpp2.tcap"],["tcl","application/x-tcl"],["td","application/urc-targetdesc+xml"],["teacher","application/vnd.smart.teacher"],["tei","application/tei+xml"],["teicorpus","application/tei+xml"],["tex","application/x-tex"],["texi","application/x-texinfo"],["texinfo","application/x-texinfo"],["text","text/plain"],["tfi","application/thraud+xml"],["tfm","application/x-tex-tfm"],["tfx","image/tiff-fx"],["tga","image/x-tga"],["tgz","application/x-tar"],["thmx","application/vnd.ms-officetheme"],["tif","image/tiff"],["tiff","image/tiff"],["tk","application/x-tcl"],["tmo","application/vnd.tmobile-livetv"],["toml","application/toml"],["torrent","application/x-bittorrent"],["tpl","application/vnd.groove-tool-template"],["tpt","application/vnd.trid.tpt"],["tr","text/troff"],["tra","application/vnd.trueapp"],["trig","application/trig"],["trm","application/x-msterminal"],["ts","video/mp2t"],["tsd","application/timestamped-data"],["tsv","text/tab-separated-values"],["ttc","font/collection"],["ttf","font/ttf"],["ttl","text/turtle"],["ttml","application/ttml+xml"],["twd","application/vnd.simtech-mindmapper"],["twds","application/vnd.simtech-mindmapper"],["txd","application/vnd.genomatix.tuxedo"],["txf","application/vnd.mobius.txf"],["txt","text/plain"],["u8dsn","message/global-delivery-status"],["u8hdr","message/global-headers"],["u8mdn","message/global-disposition-notification"],["u8msg","message/global"],["u32","application/x-authorware-bin"],["ubj","application/ubjson"],["udeb","application/x-debian-package"],["ufd","application/vnd.ufdl"],["ufdl","application/vnd.ufdl"],["ulx","application/x-glulx"],["umj","application/vnd.umajin"],["unityweb","application/vnd.unity"],["uoml","application/vnd.uoml+xml"],["uri","text/uri-list"],["uris","text/uri-list"],["urls","text/uri-list"],["usdz","model/vnd.usdz+zip"],["ustar","application/x-ustar"],["utz","application/vnd.uiq.theme"],["uu","text/x-uuencode"],["uva","audio/vnd.dece.audio"],["uvd","application/vnd.dece.data"],["uvf","application/vnd.dece.data"],["uvg","image/vnd.dece.graphic"],["uvh","video/vnd.dece.hd"],["uvi","image/vnd.dece.graphic"],["uvm","video/vnd.dece.mobile"],["uvp","video/vnd.dece.pd"],["uvs","video/vnd.dece.sd"],["uvt","application/vnd.dece.ttml+xml"],["uvu","video/vnd.uvvu.mp4"],["uvv","video/vnd.dece.video"],["uvva","audio/vnd.dece.audio"],["uvvd","application/vnd.dece.data"],["uvvf","application/vnd.dece.data"],["uvvg","image/vnd.dece.graphic"],["uvvh","video/vnd.dece.hd"],["uvvi","image/vnd.dece.graphic"],["uvvm","video/vnd.dece.mobile"],["uvvp","video/vnd.dece.pd"],["uvvs","video/vnd.dece.sd"],["uvvt","application/vnd.dece.ttml+xml"],["uvvu","video/vnd.uvvu.mp4"],["uvvv","video/vnd.dece.video"],["uvvx","application/vnd.dece.unspecified"],["uvvz","application/vnd.dece.zip"],["uvx","application/vnd.dece.unspecified"],["uvz","application/vnd.dece.zip"],["vbox","application/x-virtualbox-vbox"],["vbox-extpack","application/x-virtualbox-vbox-extpack"],["vcard","text/vcard"],["vcd","application/x-cdlink"],["vcf","text/x-vcard"],["vcg","application/vnd.groove-vcard"],["vcs","text/x-vcalendar"],["vcx","application/vnd.vcx"],["vdi","application/x-virtualbox-vdi"],["vds","model/vnd.sap.vds"],["vhd","application/x-virtualbox-vhd"],["vis","application/vnd.visionary"],["viv","video/vnd.vivo"],["vlc","application/videolan"],["vmdk","application/x-virtualbox-vmdk"],["vob","video/x-ms-vob"],["vor","application/vnd.stardivision.writer"],["vox","application/x-authorware-bin"],["vrml","model/vrml"],["vsd","application/vnd.visio"],["vsf","application/vnd.vsf"],["vss","application/vnd.visio"],["vst","application/vnd.visio"],["vsw","application/vnd.visio"],["vtf","image/vnd.valve.source.texture"],["vtt","text/vtt"],["vtu","model/vnd.vtu"],["vxml","application/voicexml+xml"],["w3d","application/x-director"],["wad","application/x-doom"],["wadl","application/vnd.sun.wadl+xml"],["war","application/java-archive"],["wasm","application/wasm"],["wav","audio/x-wav"],["wax","audio/x-ms-wax"],["wbmp","image/vnd.wap.wbmp"],["wbs","application/vnd.criticaltools.wbs+xml"],["wbxml","application/wbxml"],["wcm","application/vnd.ms-works"],["wdb","application/vnd.ms-works"],["wdp","image/vnd.ms-photo"],["weba","audio/webm"],["webapp","application/x-web-app-manifest+json"],["webm","video/webm"],["webmanifest","application/manifest+json"],["webp","image/webp"],["wg","application/vnd.pmi.widget"],["wgt","application/widget"],["wks","application/vnd.ms-works"],["wm","video/x-ms-wm"],["wma","audio/x-ms-wma"],["wmd","application/x-ms-wmd"],["wmf","image/wmf"],["wml","text/vnd.wap.wml"],["wmlc","application/wmlc"],["wmls","text/vnd.wap.wmlscript"],["wmlsc","application/vnd.wap.wmlscriptc"],["wmv","video/x-ms-wmv"],["wmx","video/x-ms-wmx"],["wmz","application/x-msmetafile"],["woff","font/woff"],["woff2","font/woff2"],["word","application/msword"],["wpd","application/vnd.wordperfect"],["wpl","application/vnd.ms-wpl"],["wps","application/vnd.ms-works"],["wqd","application/vnd.wqd"],["wri","application/x-mswrite"],["wrl","model/vrml"],["wsc","message/vnd.wfa.wsc"],["wsdl","application/wsdl+xml"],["wspolicy","application/wspolicy+xml"],["wtb","application/vnd.webturbo"],["wvx","video/x-ms-wvx"],["x3d","model/x3d+xml"],["x3db","model/x3d+fastinfoset"],["x3dbz","model/x3d+binary"],["x3dv","model/x3d-vrml"],["x3dvz","model/x3d+vrml"],["x3dz","model/x3d+xml"],["x32","application/x-authorware-bin"],["x_b","model/vnd.parasolid.transmit.binary"],["x_t","model/vnd.parasolid.transmit.text"],["xaml","application/xaml+xml"],["xap","application/x-silverlight-app"],["xar","application/vnd.xara"],["xav","application/xcap-att+xml"],["xbap","application/x-ms-xbap"],["xbd","application/vnd.fujixerox.docuworks.binder"],["xbm","image/x-xbitmap"],["xca","application/xcap-caps+xml"],["xcs","application/calendar+xml"],["xdf","application/xcap-diff+xml"],["xdm","application/vnd.syncml.dm+xml"],["xdp","application/vnd.adobe.xdp+xml"],["xdssc","application/dssc+xml"],["xdw","application/vnd.fujixerox.docuworks"],["xel","application/xcap-el+xml"],["xenc","application/xenc+xml"],["xer","application/patch-ops-error+xml"],["xfdf","application/vnd.adobe.xfdf"],["xfdl","application/vnd.xfdl"],["xht","application/xhtml+xml"],["xhtml","application/xhtml+xml"],["xhvml","application/xv+xml"],["xif","image/vnd.xiff"],["xl","application/excel"],["xla","application/vnd.ms-excel"],["xlam","application/vnd.ms-excel.addin.macroEnabled.12"],["xlc","application/vnd.ms-excel"],["xlf","application/xliff+xml"],["xlm","application/vnd.ms-excel"],["xls","application/vnd.ms-excel"],["xlsb","application/vnd.ms-excel.sheet.binary.macroEnabled.12"],["xlsm","application/vnd.ms-excel.sheet.macroEnabled.12"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xlt","application/vnd.ms-excel"],["xltm","application/vnd.ms-excel.template.macroEnabled.12"],["xltx","application/vnd.openxmlformats-officedocument.spreadsheetml.template"],["xlw","application/vnd.ms-excel"],["xm","audio/xm"],["xml","application/xml"],["xns","application/xcap-ns+xml"],["xo","application/vnd.olpc-sugar"],["xop","application/xop+xml"],["xpi","application/x-xpinstall"],["xpl","application/xproc+xml"],["xpm","image/x-xpixmap"],["xpr","application/vnd.is-xpr"],["xps","application/vnd.ms-xpsdocument"],["xpw","application/vnd.intercon.formnet"],["xpx","application/vnd.intercon.formnet"],["xsd","application/xml"],["xsl","application/xml"],["xslt","application/xslt+xml"],["xsm","application/vnd.syncml+xml"],["xspf","application/xspf+xml"],["xul","application/vnd.mozilla.xul+xml"],["xvm","application/xv+xml"],["xvml","application/xv+xml"],["xwd","image/x-xwindowdump"],["xyz","chemical/x-xyz"],["xz","application/x-xz"],["yaml","text/yaml"],["yang","application/yang"],["yin","application/yin+xml"],["yml","text/yaml"],["ymp","text/x-suse-ymp"],["z","application/x-compress"],["z1","application/x-zmachine"],["z2","application/x-zmachine"],["z3","application/x-zmachine"],["z4","application/x-zmachine"],["z5","application/x-zmachine"],["z6","application/x-zmachine"],["z7","application/x-zmachine"],["z8","application/x-zmachine"],["zaz","application/vnd.zzazz.deck+xml"],["zip","application/zip"],["zir","application/vnd.zul"],["zirz","application/vnd.zul"],["zmm","application/vnd.handheld-entertainment+xml"],["zsh","text/x-scriptzsh"]]);function Nr(n,a,t){const r=av(n),{webkitRelativePath:i}=n,l=typeof a=="string"?a:typeof i=="string"&&i.length>0?i:`./${n.name}`;return typeof r.path!="string"&&eo(r,"path",l),eo(r,"relativePath",l),r}function av(n){const{name:a}=n;if(a&&a.lastIndexOf(".")!==-1&&!n.type){const r=a.split(".").pop().toLowerCase(),i=rv.get(r);i&&Object.defineProperty(n,"type",{value:i,writable:!1,configurable:!1,enumerable:!0})}return n}function eo(n,a,t){Object.defineProperty(n,a,{value:t,writable:!1,configurable:!1,enumerable:!0})}const iv=[".DS_Store","Thumbs.db"];function sv(n){return tr(this,void 0,void 0,function*(){return _a(n)&&ov(n.dataTransfer)?uv(n.dataTransfer,n.type):lv(n)?cv(n):Array.isArray(n)&&n.every(a=>"getFile"in a&&typeof a.getFile=="function")?dv(n):[]})}function ov(n){return _a(n)}function lv(n){return _a(n)&&_a(n.target)}function _a(n){return typeof n=="object"&&n!==null}function cv(n){return Oi(n.target.files).map(a=>Nr(a))}function dv(n){return tr(this,void 0,void 0,function*(){return(yield Promise.all(n.map(t=>t.getFile()))).map(t=>Nr(t))})}function uv(n,a){return tr(this,void 0,void 0,function*(){if(n.items){const t=Oi(n.items).filter(i=>i.kind==="file");if(a!=="drop")return t;const r=yield Promise.all(t.map(mv));return to($c(r))}return to(Oi(n.files).map(t=>Nr(t)))})}function to(n){return n.filter(a=>iv.indexOf(a.name)===-1)}function Oi(n){if(n===null)return[];const a=[];for(let t=0;t<n.length;t++){const r=n[t];a.push(r)}return a}function mv(n){if(typeof n.webkitGetAsEntry!="function")return no(n);const a=n.webkitGetAsEntry();return a&&a.isDirectory?Hc(a):no(n,a)}function $c(n){return n.reduce((a,t)=>[...a,...Array.isArray(t)?$c(t):[t]],[])}function no(n,a){return tr(this,void 0,void 0,function*(){var t;if(globalThis.isSecureContext&&typeof n.getAsFileSystemHandle=="function"){const l=yield n.getAsFileSystemHandle();if(l===null)throw new Error(`${n} is not a File`);if(l!==void 0){const c=yield l.getFile();return c.handle=l,Nr(c)}}const r=n.getAsFile();if(!r)throw new Error(`${n} is not a File`);return Nr(r,(t=a==null?void 0:a.fullPath)!==null&&t!==void 0?t:void 0)})}function pv(n){return tr(this,void 0,void 0,function*(){return n.isDirectory?Hc(n):fv(n)})}function Hc(n){const a=n.createReader();return new Promise((t,r)=>{const i=[];function l(){a.readEntries(c=>tr(this,void 0,void 0,function*(){if(c.length){const m=Promise.all(c.map(pv));i.push(m),l()}else try{const m=yield Promise.all(i);t(m)}catch(m){r(m)}}),c=>{r(c)})}l()})}function fv(n){return tr(this,void 0,void 0,function*(){return new Promise((a,t)=>{n.file(r=>{const i=Nr(r,n.fullPath);a(i)},r=>{t(r)})})})}var ia={},ro;function hv(){return ro||(ro=1,ia.__esModule=!0,ia.default=function(n,a){if(n&&a){var t=Array.isArray(a)?a:a.split(",");if(t.length===0)return!0;var r=n.name||"",i=(n.type||"").toLowerCase(),l=i.replace(/\/.*$/,"");return t.some(function(c){var m=c.trim().toLowerCase();return m.charAt(0)==="."?r.toLowerCase().endsWith(m):m.endsWith("/*")?l===m.replace(/\/.*$/,""):i===m})}return!0}),ia}var gv=hv();const ui=Bi(gv);function ao(n){return yv(n)||xv(n)||Wc(n)||vv()}function vv(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xv(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function yv(n){if(Array.isArray(n))return Di(n)}function io(n,a){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);a&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function so(n){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?io(Object(t),!0).forEach(function(r){Vc(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):io(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function Vc(n,a,t){return a in n?Object.defineProperty(n,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[a]=t,n}function $r(n,a){return jv(n)||_v(n,a)||Wc(n,a)||bv()}function bv(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Wc(n,a){if(n){if(typeof n=="string")return Di(n,a);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Di(n,a)}}function Di(n,a){(a==null||a>n.length)&&(a=n.length);for(var t=0,r=new Array(a);t<a;t++)r[t]=n[t];return r}function _v(n,a){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r=[],i=!0,l=!1,c,m;try{for(t=t.call(n);!(i=(c=t.next()).done)&&(r.push(c.value),!(a&&r.length===a));i=!0);}catch(u){l=!0,m=u}finally{try{!i&&t.return!=null&&t.return()}finally{if(l)throw m}}return r}}function jv(n){if(Array.isArray(n))return n}var wv=typeof ui=="function"?ui:ui.default,Nv="file-invalid-type",Sv="file-too-large",Ev="file-too-small",kv="too-many-files",Cv=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",t=a.split(","),r=t.length>1?"one of ".concat(t.join(", ")):t[0];return{code:Nv,message:"File type must be ".concat(r)}},oo=function(a){return{code:Sv,message:"File is larger than ".concat(a," ").concat(a===1?"byte":"bytes")}},lo=function(a){return{code:Ev,message:"File is smaller than ".concat(a," ").concat(a===1?"byte":"bytes")}},Av={code:kv,message:"Too many files"};function Kc(n,a){var t=n.type==="application/x-moz-file"||wv(n,a);return[t,t?null:Cv(a)]}function Yc(n,a,t){if(Hn(n.size))if(Hn(a)&&Hn(t)){if(n.size>t)return[!1,oo(t)];if(n.size<a)return[!1,lo(a)]}else{if(Hn(a)&&n.size<a)return[!1,lo(a)];if(Hn(t)&&n.size>t)return[!1,oo(t)]}return[!0,null]}function Hn(n){return n!=null}function Pv(n){var a=n.files,t=n.accept,r=n.minSize,i=n.maxSize,l=n.multiple,c=n.maxFiles,m=n.validator;return!l&&a.length>1||l&&c>=1&&a.length>c?!1:a.every(function(u){var h=Kc(u,t),p=$r(h,1),d=p[0],o=Yc(u,r,i),s=$r(o,1),g=s[0],v=m?m(u):null;return d&&g&&!v})}function ja(n){return typeof n.isPropagationStopped=="function"?n.isPropagationStopped():typeof n.cancelBubble<"u"?n.cancelBubble:!1}function sa(n){return n.dataTransfer?Array.prototype.some.call(n.dataTransfer.types,function(a){return a==="Files"||a==="application/x-moz-file"}):!!n.target&&!!n.target.files}function co(n){n.preventDefault()}function Ov(n){return n.indexOf("MSIE")!==-1||n.indexOf("Trident/")!==-1}function Dv(n){return n.indexOf("Edge/")!==-1}function Tv(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.navigator.userAgent;return Ov(n)||Dv(n)}function jn(){for(var n=arguments.length,a=new Array(n),t=0;t<n;t++)a[t]=arguments[t];return function(r){for(var i=arguments.length,l=new Array(i>1?i-1:0),c=1;c<i;c++)l[c-1]=arguments[c];return a.some(function(m){return!ja(r)&&m&&m.apply(void 0,[r].concat(l)),ja(r)})}}function Lv(){return"showOpenFilePicker"in window}function Rv(n){if(Hn(n)){var a=Object.entries(n).filter(function(t){var r=$r(t,2),i=r[0],l=r[1],c=!0;return Gc(i)||(console.warn('Skipped "'.concat(i,'" because it is not a valid MIME type. Check https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types for a list of valid MIME types.')),c=!1),(!Array.isArray(l)||!l.every(Zc))&&(console.warn('Skipped "'.concat(i,'" because an invalid file extension was provided.')),c=!1),c}).reduce(function(t,r){var i=$r(r,2),l=i[0],c=i[1];return so(so({},t),{},Vc({},l,c))},{});return[{description:"Files",accept:a}]}return n}function Mv(n){if(Hn(n))return Object.entries(n).reduce(function(a,t){var r=$r(t,2),i=r[0],l=r[1];return[].concat(ao(a),[i],ao(l))},[]).filter(function(a){return Gc(a)||Zc(a)}).join(",")}function Fv(n){return n instanceof DOMException&&(n.name==="AbortError"||n.code===n.ABORT_ERR)}function Iv(n){return n instanceof DOMException&&(n.name==="SecurityError"||n.code===n.SECURITY_ERR)}function Gc(n){return n==="audio/*"||n==="video/*"||n==="image/*"||n==="text/*"||n==="application/*"||/\w+\/[-+.\w]+/g.test(n)}function Zc(n){return/^.*\.[\w]+$/.test(n)}var qv=["children"],zv=["open"],Bv=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],Uv=["refKey","onChange","onClick"];function $v(n){return Wv(n)||Vv(n)||Qc(n)||Hv()}function Hv(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Vv(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function Wv(n){if(Array.isArray(n))return Ti(n)}function mi(n,a){return Gv(n)||Yv(n,a)||Qc(n,a)||Kv()}function Kv(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Qc(n,a){if(n){if(typeof n=="string")return Ti(n,a);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Ti(n,a)}}function Ti(n,a){(a==null||a>n.length)&&(a=n.length);for(var t=0,r=new Array(a);t<a;t++)r[t]=n[t];return r}function Yv(n,a){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r=[],i=!0,l=!1,c,m;try{for(t=t.call(n);!(i=(c=t.next()).done)&&(r.push(c.value),!(a&&r.length===a));i=!0);}catch(u){l=!0,m=u}finally{try{!i&&t.return!=null&&t.return()}finally{if(l)throw m}}return r}}function Gv(n){if(Array.isArray(n))return n}function uo(n,a){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);a&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function ft(n){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?uo(Object(t),!0).forEach(function(r){Li(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):uo(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function Li(n,a,t){return a in n?Object.defineProperty(n,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[a]=t,n}function wa(n,a){if(n==null)return{};var t=Zv(n,a),r,i;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(n);for(i=0;i<l.length;i++)r=l[i],!(a.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(n,r)&&(t[r]=n[r])}return t}function Zv(n,a){if(n==null)return{};var t={},r=Object.keys(n),i,l;for(l=0;l<r.length;l++)i=r[l],!(a.indexOf(i)>=0)&&(t[i]=n[i]);return t}var fs=T.forwardRef(function(n,a){var t=n.children,r=wa(n,qv),i=Va(r),l=i.open,c=wa(i,zv);return T.useImperativeHandle(a,function(){return{open:l}},[l]),W.createElement(T.Fragment,null,t(ft(ft({},c),{},{open:l})))});fs.displayName="Dropzone";var Xc={disabled:!1,getFilesFromEvent:sv,maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!1,autoFocus:!1};fs.defaultProps=Xc;fs.propTypes={children:st.func,accept:st.objectOf(st.arrayOf(st.string)),multiple:st.bool,preventDropOnDocument:st.bool,noClick:st.bool,noKeyboard:st.bool,noDrag:st.bool,noDragEventsBubbling:st.bool,minSize:st.number,maxSize:st.number,maxFiles:st.number,disabled:st.bool,getFilesFromEvent:st.func,onFileDialogCancel:st.func,onFileDialogOpen:st.func,useFsAccessApi:st.bool,autoFocus:st.bool,onDragEnter:st.func,onDragLeave:st.func,onDragOver:st.func,onDrop:st.func,onDropAccepted:st.func,onDropRejected:st.func,onError:st.func,validator:st.func};var Ri={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,acceptedFiles:[],fileRejections:[]};function Va(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=ft(ft({},Xc),n),t=a.accept,r=a.disabled,i=a.getFilesFromEvent,l=a.maxSize,c=a.minSize,m=a.multiple,u=a.maxFiles,h=a.onDragEnter,p=a.onDragLeave,d=a.onDragOver,o=a.onDrop,s=a.onDropAccepted,g=a.onDropRejected,v=a.onFileDialogCancel,x=a.onFileDialogOpen,y=a.useFsAccessApi,f=a.autoFocus,_=a.preventDropOnDocument,b=a.noClick,E=a.noKeyboard,N=a.noDrag,j=a.noDragEventsBubbling,C=a.onError,D=a.validator,k=T.useMemo(function(){return Mv(t)},[t]),w=T.useMemo(function(){return Rv(t)},[t]),S=T.useMemo(function(){return typeof x=="function"?x:mo},[x]),P=T.useMemo(function(){return typeof v=="function"?v:mo},[v]),O=T.useRef(null),L=T.useRef(null),$=T.useReducer(Qv,Ri),B=mi($,2),Y=B[0],U=B[1],q=Y.isFocused,R=Y.isFileDialogActive,F=T.useRef(typeof window<"u"&&window.isSecureContext&&y&&Lv()),M=function(){!F.current&&R&&setTimeout(function(){if(L.current){var ue=L.current.files;ue.length||(U({type:"closeDialog"}),P())}},300)};T.useEffect(function(){return window.addEventListener("focus",M,!1),function(){window.removeEventListener("focus",M,!1)}},[L,R,P,F]);var z=T.useRef([]),H=function(ue){O.current&&O.current.contains(ue.target)||(ue.preventDefault(),z.current=[])};T.useEffect(function(){return _&&(document.addEventListener("dragover",co,!1),document.addEventListener("drop",H,!1)),function(){_&&(document.removeEventListener("dragover",co),document.removeEventListener("drop",H))}},[O,_]),T.useEffect(function(){return!r&&f&&O.current&&O.current.focus(),function(){}},[O,f,r]);var I=T.useCallback(function(ae){C?C(ae):console.error(ae)},[C]),A=T.useCallback(function(ae){ae.preventDefault(),ae.persist(),ge(ae),z.current=[].concat($v(z.current),[ae.target]),sa(ae)&&Promise.resolve(i(ae)).then(function(ue){if(!(ja(ae)&&!j)){var _e=ue.length,ie=_e>0&&Pv({files:ue,accept:k,minSize:c,maxSize:l,multiple:m,maxFiles:u,validator:D}),he=_e>0&&!ie;U({isDragAccept:ie,isDragReject:he,isDragActive:!0,type:"setDraggedFiles"}),h&&h(ae)}}).catch(function(ue){return I(ue)})},[i,h,I,j,k,c,l,m,u,D]),V=T.useCallback(function(ae){ae.preventDefault(),ae.persist(),ge(ae);var ue=sa(ae);if(ue&&ae.dataTransfer)try{ae.dataTransfer.dropEffect="copy"}catch{}return ue&&d&&d(ae),!1},[d,j]),K=T.useCallback(function(ae){ae.preventDefault(),ae.persist(),ge(ae);var ue=z.current.filter(function(ie){return O.current&&O.current.contains(ie)}),_e=ue.indexOf(ae.target);_e!==-1&&ue.splice(_e,1),z.current=ue,!(ue.length>0)&&(U({type:"setDraggedFiles",isDragActive:!1,isDragAccept:!1,isDragReject:!1}),sa(ae)&&p&&p(ae))},[O,p,j]),Q=T.useCallback(function(ae,ue){var _e=[],ie=[];ae.forEach(function(he){var We=Kc(he,k),Fe=mi(We,2),$e=Fe[0],me=Fe[1],Pe=Yc(he,c,l),Te=mi(Pe,2),mt=Te[0],oe=Te[1],Le=D?D(he):null;if($e&&mt&&!Le)_e.push(he);else{var nt=[me,oe];Le&&(nt=nt.concat(Le)),ie.push({file:he,errors:nt.filter(function(wt){return wt})})}}),(!m&&_e.length>1||m&&u>=1&&_e.length>u)&&(_e.forEach(function(he){ie.push({file:he,errors:[Av]})}),_e.splice(0)),U({acceptedFiles:_e,fileRejections:ie,isDragReject:ie.length>0,type:"setFiles"}),o&&o(_e,ie,ue),ie.length>0&&g&&g(ie,ue),_e.length>0&&s&&s(_e,ue)},[U,m,k,c,l,u,o,s,g,D]),de=T.useCallback(function(ae){ae.preventDefault(),ae.persist(),ge(ae),z.current=[],sa(ae)&&Promise.resolve(i(ae)).then(function(ue){ja(ae)&&!j||Q(ue,ae)}).catch(function(ue){return I(ue)}),U({type:"reset"})},[i,Q,I,j]),xe=T.useCallback(function(){if(F.current){U({type:"openDialog"}),S();var ae={multiple:m,types:w};window.showOpenFilePicker(ae).then(function(ue){return i(ue)}).then(function(ue){Q(ue,null),U({type:"closeDialog"})}).catch(function(ue){Fv(ue)?(P(ue),U({type:"closeDialog"})):Iv(ue)?(F.current=!1,L.current?(L.current.value=null,L.current.click()):I(new Error("Cannot open the file picker because the https://developer.mozilla.org/en-US/docs/Web/API/File_System_Access_API is not supported and no <input> was provided."))):I(ue)});return}L.current&&(U({type:"openDialog"}),S(),L.current.value=null,L.current.click())},[U,S,P,y,Q,I,w,m]),Z=T.useCallback(function(ae){!O.current||!O.current.isEqualNode(ae.target)||(ae.key===" "||ae.key==="Enter"||ae.keyCode===32||ae.keyCode===13)&&(ae.preventDefault(),xe())},[O,xe]),re=T.useCallback(function(){U({type:"focus"})},[]),ye=T.useCallback(function(){U({type:"blur"})},[]),Se=T.useCallback(function(){b||(Tv()?setTimeout(xe,0):xe())},[b,xe]),De=function(ue){return r?null:ue},te=function(ue){return E?null:De(ue)},se=function(ue){return N?null:De(ue)},ge=function(ue){j&&ue.stopPropagation()},ce=T.useMemo(function(){return function(){var ae=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},ue=ae.refKey,_e=ue===void 0?"ref":ue,ie=ae.role,he=ae.onKeyDown,We=ae.onFocus,Fe=ae.onBlur,$e=ae.onClick,me=ae.onDragEnter,Pe=ae.onDragOver,Te=ae.onDragLeave,mt=ae.onDrop,oe=wa(ae,Bv);return ft(ft(Li({onKeyDown:te(jn(he,Z)),onFocus:te(jn(We,re)),onBlur:te(jn(Fe,ye)),onClick:De(jn($e,Se)),onDragEnter:se(jn(me,A)),onDragOver:se(jn(Pe,V)),onDragLeave:se(jn(Te,K)),onDrop:se(jn(mt,de)),role:typeof ie=="string"&&ie!==""?ie:"presentation"},_e,O),!r&&!E?{tabIndex:0}:{}),oe)}},[O,Z,re,ye,Se,A,V,K,de,E,N,r]),le=T.useCallback(function(ae){ae.stopPropagation()},[]),Ne=T.useMemo(function(){return function(){var ae=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},ue=ae.refKey,_e=ue===void 0?"ref":ue,ie=ae.onChange,he=ae.onClick,We=wa(ae,Uv),Fe=Li({accept:k,multiple:m,type:"file",style:{border:0,clip:"rect(0, 0, 0, 0)",clipPath:"inset(50%)",height:"1px",margin:"0 -1px -1px 0",overflow:"hidden",padding:0,position:"absolute",width:"1px",whiteSpace:"nowrap"},onChange:De(jn(ie,de)),onClick:De(jn(he,le)),tabIndex:-1},_e,L);return ft(ft({},Fe),We)}},[L,t,m,de,r]);return ft(ft({},Y),{},{isFocused:q&&!r,getRootProps:ce,getInputProps:Ne,rootRef:O,inputRef:L,open:De(xe)})}function Qv(n,a){switch(a.type){case"focus":return ft(ft({},n),{},{isFocused:!0});case"blur":return ft(ft({},n),{},{isFocused:!1});case"openDialog":return ft(ft({},Ri),{},{isFileDialogActive:!0});case"closeDialog":return ft(ft({},n),{},{isFileDialogActive:!1});case"setDraggedFiles":return ft(ft({},n),{},{isDragActive:a.isDragActive,isDragAccept:a.isDragAccept,isDragReject:a.isDragReject});case"setFiles":return ft(ft({},n),{},{acceptedFiles:a.acceptedFiles,fileRejections:a.fileRejections,isDragReject:a.isDragReject});case"reset":return ft({},Ri);default:return n}}function mo(){}vm.workerSrc="/pdf.worker.min.js";const Jc=({pdfUrl:n})=>{const a=T.useRef(null),[t,r]=T.useState(!0),[i,l]=T.useState(null),[c,m]=T.useState(0),[u,h]=T.useState(1);T.useEffect(()=>{(async()=>{if(!n||!a.current){console.log("PdfViewer: Missing pdfUrl or canvasRef.current. Skipping render."),l("No PDF URL provided or canvas not ready."),r(!1);return}r(!0),l(null),console.log(`PdfViewer: Attempting to render PDF from URL: ${n} (Page: ${u})`);try{const g=await xm(n).promise;m(g.numPages);const v=await g.getPage(u),x=v.getViewport({scale:1.5}),y=a.current,f=y.getContext("2d");if(!f)throw new Error("Could not get 2D context for canvas.");y.height=x.height,y.width=x.width;const _={canvasContext:f,viewport:x};await v.render(_).promise,r(!1),console.log(`PdfViewer: Successfully rendered page ${u} of ${c}.`)}catch(s){console.error("PdfViewer: Error rendering PDF:",s),l(`Failed to load PDF: ${s.message||"Unknown error"}. Check console for details.`),r(!1)}})()},[n,u]);const p=()=>{u>1&&h(u-1)},d=()=>{u<c&&h(u+1)};return e.jsxs("div",{className:"flex flex-col items-center w-full h-full",children:[t&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-muted-foreground",children:[e.jsx(fe,{className:"h-8 w-8 animate-spin"}),e.jsx("p",{className:"mt-2",children:"Loading PDF..."})]}),i&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-destructive",children:[e.jsx(xt,{className:"h-8 w-8"}),e.jsx("p",{className:"mt-2",children:i})]}),!t&&!i&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[e.jsx(ee,{onClick:p,disabled:u<=1,variant:"outline",size:"sm",children:"Prev"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",u," of ",c]}),e.jsx(ee,{onClick:d,disabled:u>=c,variant:"outline",size:"sm",children:"Next"})]}),e.jsx("div",{className:"overflow-auto flex-1 flex items-center justify-center w-full",children:e.jsx("canvas",{ref:a,className:"max-w-full h-auto border rounded-md shadow-sm"})})]})]})},Xv=.7,Jv=({onFileSelected:n,onRemoveFile:a,isLoading:t,setIsAnalyzing:r,currentPreviewUrl:i,companyId:l,userId:c})=>{const{toast:m}=Ke(),u=T.useRef(null),[h,p]=T.useState(i),[d,o]=T.useState(null),[s,g]=T.useState(!1),[v,x]=T.useState(null),[y,f]=T.useState(!1),[_,b]=T.useState(null),[E,N]=T.useState(null),[j,C]=T.useState(null),[D,k]=T.useState(null);W.useEffect(()=>{var F;if(p(i),i){const M=(F=i.split(".").pop())==null?void 0:F.toLowerCase();M==="pdf"?o("application/pdf"):["jpg","jpeg","png","gif","webp"].includes(M||"")?o(`image/${M==="jpg"?"jpeg":M}`):o(null)}else o(null)},[i]);const w=()=>{g(!1),x(null),f(!1),b(null),N(null),C(null),k(null)},S=async F=>{if(!F)return;if(F.size>5*1024*1024){m({title:"File Too Large",description:"Please upload a file smaller than 5MB.",variant:"destructive"});return}r(!0),w();const M=new FileReader;M.readAsDataURL(F),M.onloadend=async()=>{var H;const z=(H=M.result)==null?void 0:H.toString().split(",")[1];if(!z){m({title:"Error",description:"Failed to read file.",variant:"destructive"}),r(!1);return}try{const{data:I,error:A}=await X.functions.invoke("analyze-expense",{body:{fileBase64:z,mimeType:F.type,companyId:l}});if(A)throw A;const V=I.data,K=URL.createObjectURL(F);N(V),C(F),k(K);const Q=V.document_type_classification,de=V.document_type_confidence??0,xe=Q==="other"||(Q==="receipt"||Q==="invoice")&&de<Xv;V.is_duplicate?(x(V.duplicate_expense_id),g(!0)):xe?(b("This document appears to be something other than an expense receipt or invoice."),f(!0)):(p(K),o(F.type),n(V,F,K),r(!1))}catch(I){console.error("AI analysis failed:",I),m({title:"AI Analysis Failed",description:I.message||"Could not extract details from the receipt. Please enter manually.",variant:"destructive"});const A=URL.createObjectURL(F);p(A),o(F.type),n({},F,A),r(!1)}},M.onerror=z=>{console.error("File reader error:",z),m({title:"Error",description:"Failed to read file.",variant:"destructive"}),r(!1)}},P=()=>{E&&j&&D&&(p(D),o(j.type),n(E,j,D)),r(!1),w()},O=()=>{a(),p(null),o(null),u.current&&(u.current.value=""),r(!1),w(),m({title:"Upload Canceled",description:"The file upload was canceled."})},L=T.useCallback(F=>{F.length>0&&S(F[0])},[l,c,n,r,m]),{getRootProps:$,getInputProps:B,isDragActive:Y}=Va({onDrop:L,accept:{"image/*":[".jpeg",".png",".gif",".webp"],"application/pdf":[".pdf"]},maxFiles:1,disabled:t}),U=F=>{var z;const M=(z=F.target.files)==null?void 0:z[0];M&&S(M)},q=F=>{F.stopPropagation(),a(),p(null),o(null),u.current&&(u.current.value=""),w()},R=F=>{F.preventDefault(),F.stopPropagation(),u.current&&!t&&u.current.click()};return e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{...$({onClick:R}),className:pe("flex flex-col items-center justify-center p-6 border-2 border-dashed rounded-lg text-center cursor-pointer transition-colors","hover:border-primary hover:bg-muted/50",Y&&"border-primary bg-muted/50",t&&"opacity-70 cursor-not-allowed",h&&"border-solid border-primary/50"),children:[e.jsx("input",{...B(),ref:u,onChange:U}),t?e.jsx(fe,{className:"h-8 w-8 animate-spin text-primary"}):e.jsx(xa,{className:"h-8 w-8 text-muted-foreground"}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:t?"Analyzing receipt...":"Drag & drop a receipt image or PDF here, or click to select"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"(Max 5MB)"})]}),e.jsxs(ee,{type:"button",variant:"outline",disabled:t,className:"flex items-center gap-2 w-full",onClick:()=>{var F;return(F=u.current)==null?void 0:F.click()},children:[e.jsx(xa,{className:"h-4 w-4"}),"Choose File"]}),h&&e.jsxs("div",{className:"relative border rounded-lg p-4 bg-muted/50 h-96 flex items-center justify-center",children:[d==="application/pdf"?e.jsx(Jc,{pdfUrl:h}):e.jsx("img",{src:h,alt:"Receipt preview",className:"max-h-full max-w-full object-contain rounded"}),e.jsxs(ee,{variant:"ghost",size:"icon",onClick:q,className:"absolute top-2 right-2 h-6 w-6 rounded-full bg-background/80 hover:bg-background",disabled:t,children:[e.jsx(Yr,{className:"h-4 w-4 text-destructive"}),e.jsx("span",{className:"sr-only",children:"Remove receipt"})]})]}),e.jsx(an,{open:s,onOpenChange:g,children:e.jsxs(zt,{children:[e.jsxs(Bt,{children:[e.jsxs($t,{className:"flex items-center gap-2 text-orange-600",children:[e.jsx(xt,{className:"h-5 w-5"})," Potential Duplicate Detected"]}),e.jsxs(Ht,{children:["This document appears to be a duplicate of an existing expense.",v&&e.jsxs(e.Fragment,{children:[" ","You can view the existing expense ",e.jsx(Dt,{to:`/expenses/${v}`,className:"text-blue-600 hover:underline",target:"_blank",rel:"noopener noreferrer",children:"here"}),"."]}),e.jsx("br",{}),e.jsx("br",{}),"Are you sure you want to continue uploading this file?"]})]}),e.jsxs(Ut,{children:[e.jsx(Wt,{onClick:O,children:"Cancel"}),e.jsx(Vt,{onClick:P,children:"Continue Upload"})]})]})}),e.jsx(an,{open:y,onOpenChange:f,children:e.jsxs(zt,{children:[e.jsxs(Bt,{children:[e.jsxs($t,{className:"flex items-center gap-2 text-orange-600",children:[e.jsx(xt,{className:"h-5 w-5"})," Are you sure this is an expense?"]}),e.jsxs(Ht,{children:[_,e.jsx("br",{}),e.jsx("br",{}),"Are you sure you want to continue?"]})]}),e.jsxs(Ut,{children:[e.jsx(Wt,{onClick:O,children:"Cancel"}),e.jsx(Vt,{onClick:P,children:"Continue Upload"})]})]})})]})},An=[{key:"title",label:"Title"},{key:"description",label:"Description"},{key:"amount",label:"Amount"},{key:"expense_date",label:"Expense Date"},{key:"currency_code",label:"Currency"},{key:"vendor_name",label:"Vendor Name"},{key:"merchant_address",label:"Merchant Address"},{key:"receipt_summary",label:"Receipt Summary"},{key:"category_id",label:"Category"},{key:"gl_account_id",label:"GL Account"},{key:"is_reimbursable",label:"Is Reimbursable"},{key:"project_code",label:"Project Code"},{key:"cost_center",label:"Cost Center"},{key:"line_items",label:"Line Items"},{key:"receipt_upload",label:"Receipt Upload"},{key:"review_notes",label:"Review Notes"}],ex=tt({id:J().optional(),description:J().min(1,"Description is required"),quantity:gt(n=>n===""?null:Number(n),yt().positive("Quantity must be positive").nullable().optional()),unit_price:gt(n=>n===""?null:Number(n),yt().positive("Unit price must be positive").nullable().optional()),line_amount:gt(n=>Number(n),yt().positive("Line amount must be positive")),currency_code:J().min(1,"Currency is required").default("USD")}),tx=tt({title:J().optional().nullable(),description:J().optional().nullable(),amount:gt(n=>n===""?0:Number(n),yt().min(0,"Amount must be non-negative")),expense_date:Ji().optional().nullable(),category_id:J().optional().nullable(),gl_account_id:J().optional().nullable(),currency_code:J().optional().nullable(),vendor_name:J().optional().nullable(),merchant_address:J().optional().nullable(),receipt_summary:J().optional().nullable(),ai_confidence_score:yt().optional().nullable(),is_reimbursable:St().default(!0),project_code:J().optional().nullable(),cost_center:J().optional().nullable(),line_items:Zr(ex).optional()}),nx=({isOpen:n,onOpenChange:a,editingExpense:t,onSuccess:r})=>{var de,xe;const i=Ye(),{toast:l}=Ke(),{profile:c,isLoading:m}=Ie(),[u,h]=T.useState(null),[p,d]=T.useState(null),[o,s]=T.useState(null),[g,v]=T.useState(!1),[x,y]=T.useState("draft"),f=c==null?void 0:c.company_id,_=c==null?void 0:c.user_id,b=c==null?void 0:c.role,{data:E,isLoading:N}=je({queryKey:["expenseModuleSystemId"],queryFn:async()=>{const{data:Z,error:re}=await X.from("modules").select("id").eq("name","Expense Management").single();if(re&&re.code!=="PGRST116")throw re;return(Z==null?void 0:Z.id)||null}}),{data:j,isLoading:C}=je({queryKey:["expenseModuleConfig",f,E],queryFn:async()=>{if(!f||!E)return null;const{data:Z,error:re}=await X.from("module_configurations").select("settings").eq("company_id",f).eq("module_id",E).eq("config_key","expense_management_fields").single();if(re&&re.code!=="PGRST116")throw re;return Z},enabled:!!f&&!!E&&!m}),D=Z=>tx.superRefine((re,ye)=>{var Se,De,te,se,ge,ce,le,Ne;x==="submitted"&&((!re.title||re.title.trim()==="")&&ye.addIssue({code:Xt.custom,message:"Title is required for submission",path:["title"]}),(!re.amount||re.amount<=0)&&ye.addIssue({code:Xt.custom,message:"Amount must be positive for submission",path:["amount"]}),re.expense_date||ye.addIssue({code:Xt.custom,message:"Expense date is required for submission",path:["expense_date"]}),(!re.currency_code||re.currency_code.trim()==="")&&ye.addIssue({code:Xt.custom,message:"Currency is required for submission",path:["currency_code"]}));for(const ae of An.map(ue=>ue.key)){const ue=Z[ae];ue!=null&&ue.required&&x==="submitted"&&(ae==="title"&&(!re.title||re.title.trim()==="")?ye.addIssue({code:Xt.custom,message:`${(Se=An.find(_e=>_e.key===ae))==null?void 0:Se.label} is required`,path:[ae]}):ae==="amount"&&(!re.amount||re.amount<=0)?ye.addIssue({code:Xt.custom,message:`${(De=An.find(_e=>_e.key===ae))==null?void 0:De.label} must be positive`,path:[ae]}):ae==="expense_date"&&!re.expense_date?ye.addIssue({code:Xt.custom,message:`${(te=An.find(_e=>_e.key===ae))==null?void 0:te.label} is required`,path:[ae]}):ae==="currency_code"&&(!re.currency_code||re.currency_code.trim()==="")?ye.addIssue({code:Xt.custom,message:`${(se=An.find(_e=>_e.key===ae))==null?void 0:se.label} is required`,path:[ae]}):ae==="category_id"&&!re.category_id?ye.addIssue({code:Xt.custom,message:`${(ge=An.find(_e=>_e.key===ae))==null?void 0:ge.label} is required`,path:[ae]}):ae==="gl_account_id"&&!re.gl_account_id?ye.addIssue({code:Xt.custom,message:`${(ce=An.find(_e=>_e.key===ae))==null?void 0:ce.label} is required`,path:[ae]}):ae==="vendor_name"&&(!re.vendor_name||re.vendor_name.trim()==="")?ye.addIssue({code:Xt.custom,message:`${(le=An.find(_e=>_e.key===ae))==null?void 0:le.label} is required`,path:[ae]}):ae==="receipt_upload"&&!u&&!((Ne=t==null?void 0:t.receipts)!=null&&Ne.length)&&ye.addIssue({code:Xt.custom,message:"A receipt upload is required",path:["receipt_upload"]}))}}),k=((de=j==null?void 0:j.settings)==null?void 0:de.user_fields)||{},w=D(k),S=ct({resolver:dt(w),defaultValues:{title:"",description:null,amount:0,expense_date:null,category_id:null,gl_account_id:null,currency_code:"USD",vendor_name:null,merchant_address:null,receipt_summary:null,ai_confidence_score:null,is_reimbursable:!0,project_code:null,cost_center:null,line_items:[]},mode:"onChange"}),{fields:P,append:O,remove:L}=um({control:S.control,name:"line_items"}),{data:$}=je({queryKey:["allCurrencies"],queryFn:async()=>{const{data:Z,error:re}=await X.from("currencies").select("*").eq("is_active",!0).order("code");if(re)throw re;return Z}}),{data:B}=je({queryKey:["expense_categories",f],queryFn:async()=>{if(!f)return[];const{data:Z,error:re}=await X.from("expense_categories").select("id, name, description").eq("company_id",f).eq("is_active",!0);if(re)throw re;return Z},enabled:!!f}),{data:Y}=je({queryKey:["gl_accounts",f],queryFn:async()=>{if(!f)return[];const{data:Z,error:re}=await X.from("gl_accounts").select("id, account_code, account_name").eq("company_id",f).eq("is_active",!0);if(re)throw re;return Z},enabled:!!f&&["admin","controller","super-admin"].includes(b||"")});T.useEffect(()=>{(async()=>{if(n){if(t)if(S.reset({title:t.title,description:t.description||null,amount:t.amount,expense_date:new Date(t.expense_date),category_id:t.category_id||null,gl_account_id:t.gl_account_id||null,currency_code:t.currency_code||"USD",vendor_name:t.vendor_name||null,merchant_address:t.merchant_address||null,receipt_summary:t.receipt_summary||null,ai_confidence_score:t.ai_confidence_score||null,is_reimbursable:t.is_reimbursable??!0,project_code:t.project_code||null,cost_center:t.cost_center||null,line_items:t.expense_line_items||[]}),t.receipts&&t.receipts.length>0){const re=t.receipts[0],ye=re.file_url.split("/storage/v1/object/public/expense-receipts/")[1];if(ye){const{data:Se,error:De}=await X.storage.from("expense-receipts").createSignedUrl(ye,3600);De?(console.error("Error creating signed URL for existing receipt:",De),l({title:"Error",description:"Failed to load existing receipt preview.",variant:"destructive"}),d(null)):d(Se.signedUrl)}else d(re.file_url)}else d(null);else S.reset({title:"",description:null,amount:0,expense_date:null,category_id:null,gl_account_id:null,currency_code:"USD",vendor_name:null,merchant_address:null,receipt_summary:null,ai_confidence_score:null,is_reimbursable:!0,project_code:null,cost_center:null,line_items:[]}),d(null);h(null),s(null),v(!1),y("draft")}})()},[n,t,S,l]);const U=Oe({mutationFn:async Z=>{var Fe;if(!f)throw new Error("Company not identified.");let re=null,ye=null,Se=null,De=null,te=null,se=null,ge=null,ce=null;if(u){const $e=u.name.split(".").pop(),me=`${_}/receipts/${Date.now()}.${$e}`,{data:Pe,error:Te}=await X.storage.from("expense-receipts").upload(me,u,{upsert:!0});if(Te)throw Te;const{data:mt}=X.storage.from("expense-receipts").getPublicUrl(Pe.path);re=mt.publicUrl,ye=u.name,Se=u.type,De=(o==null?void 0:o.ai_extracted_text)||null,te=(o==null?void 0:o.ai_raw_json)||null,se=(o==null?void 0:o.text_hash)||null,ge=(o==null?void 0:o.document_type_classification)||null,ce=(o==null?void 0:o.document_type_confidence)||null}const{data:le,error:Ne}=await X.from("companies").select("default_currency").eq("id",f).single();Ne&&console.error("Error fetching company default currency:",Ne);const ae=(le==null?void 0:le.default_currency)||"USD";let ue=null,_e=null;Z.amount&&Z.currency_code&&ae&&(Z.currency_code===ae?(ue=Z.amount,_e=1):(console.warn(`DEBUG: Currency conversion from ${Z.currency_code} to ${ae} is a placeholder.`),Z.currency_code==="USD"&&ae==="CAD"?(_e=1.35,ue=Z.amount*_e):Z.currency_code==="CAD"&&ae==="USD"?(_e=.74,ue=Z.amount*_e):(_e=1,ue=Z.amount)));const{data:ie,error:he}=await X.from("expenses").insert({title:Z.title||null,description:Z.description||null,amount:Z.amount,expense_date:Z.expense_date?at(Z.expense_date,"yyyy-MM-dd"):null,category_id:Z.category_id||null,gl_account_id:Z.gl_account_id||null,currency_code:Z.currency_code||null,company_id:f,submitted_by:_,status:Z.status,base_currency_amount:ue,exchange_rate:_e,vendor_name:Z.vendor_name||null,merchant_address:Z.merchant_address||null,receipt_summary:Z.receipt_summary||null,ai_confidence_score:Z.ai_confidence_score||null,is_reimbursable:Z.is_reimbursable,project_code:Z.project_code||null,cost_center:Z.cost_center||null}).select().single();if(he){if(console.error("Expense insert error:",he),he.code==="42501"||he.code==="PGRST401"){console.warn("Potential RLS violation. Current user ID (from profile):",_);const{data:$e,error:me}=await X.auth.getUser();me?console.error("Error fetching auth user for RLS debug:",me):console.log("Supabase auth.user.id (from client-side getUser):",(Fe=$e.user)==null?void 0:Fe.id)}throw he}let We=null;if(re&&ie){const{data:$e,error:me}=await X.from("receipts").insert({expense_id:ie.id,file_url:re,file_name:ye,mime_type:Se,uploaded_by:_,ai_extracted_text:De,ai_raw_json:te,text_hash:se,document_type_classification:ge,document_type_confidence:ce}).select("id").single();me&&console.error("Error inserting receipt record:",me),We=($e==null?void 0:$e.id)||null}if(Z.line_items&&ie){const $e=Z.line_items.map(Pe=>({...Pe,expense_id:ie.id,extracted_from_receipt_id:We})),{error:me}=await X.from("expense_line_items").insert($e);me&&console.error("Error inserting line items:",me)}return ie},onSuccess:Z=>{i.invalidateQueries({queryKey:["expenses-with-submitter"]}),Z!=null&&Z.id&&i.invalidateQueries({queryKey:["expense",Z.id]}),l({title:`Expense ${x==="draft"?"Saved as Draft":"Submitted"}`,description:`Your expense has been successfully ${x==="draft"?"saved as a draft.":"submitted for review."}`}),a(!1),r==null||r()},onError:Z=>{l({title:`Error ${x==="draft"?"saving draft":"submitting expense"}`,description:Z.message||"An unexpected error occurred.",variant:"destructive"})}}),q=Oe({mutationFn:async Z=>{var We,Fe,$e,me,Pe,Te,mt,oe,Le,nt,wt,_n,Dr,or,fn,na,Be,Ze,it,Gt,Zt,hn;if(!_||!t)throw new Error("User not authenticated or no expense to edit.");let re=((Fe=(We=t.receipts)==null?void 0:We[0])==null?void 0:Fe.file_url)||null,ye=((me=($e=t.receipts)==null?void 0:$e[0])==null?void 0:me.file_name)||null,Se=((Te=(Pe=t.receipts)==null?void 0:Pe[0])==null?void 0:Te.mime_type)||null,De=((oe=(mt=t.receipts)==null?void 0:mt[0])==null?void 0:oe.ai_extracted_text)||null,te=((nt=(Le=t.receipts)==null?void 0:Le[0])==null?void 0:nt.ai_raw_json)||null,se=((_n=(wt=t.receipts)==null?void 0:wt[0])==null?void 0:_n.text_hash)||null,ge=((or=(Dr=t.receipts)==null?void 0:Dr[0])==null?void 0:or.document_type_classification)||null,ce=((na=(fn=t.receipts)==null?void 0:fn[0])==null?void 0:na.document_type_confidence)||null,le=((Ze=(Be=t.receipts)==null?void 0:Be[0])==null?void 0:Ze.id)||null;if(u){const pt=u.name.split(".").pop(),kt=`${_}/receipts/${Date.now()}.${pt}`,{data:un,error:Es}=await X.storage.from("expense-receipts").upload(kt,u,{upsert:!0});if(Es)throw Es;const{data:Wd}=X.storage.from("expense-receipts").getPublicUrl(un.path);if(re=Wd.publicUrl,ye=u.name,Se=u.type,De=(o==null?void 0:o.ai_extracted_text)||null,te=(o==null?void 0:o.ai_raw_json)||null,se=(o==null?void 0:o.text_hash)||null,ge=(o==null?void 0:o.document_type_classification)||null,ce=(o==null?void 0:o.document_type_confidence)||null,(Gt=(it=t.receipts)==null?void 0:it[0])!=null&&Gt.file_url){const ks=t.receipts[0].file_url.split("/public/expense-receipts/")[1];ks&&await X.storage.from("expense-receipts").remove([ks])}}else if(p===null&&((hn=(Zt=t.receipts)==null?void 0:Zt[0])!=null&&hn.file_url)){const pt=t.receipts[0].file_url.split("/public/expense-receipts/")[1];pt&&await X.storage.from("expense-receipts").remove([pt]),re=null,ye=null,Se=null,De=null,te=null,se=null,ge=null,ce=null}if(re&&le){const{error:pt}=await X.from("receipts").update({file_url:re,file_name:ye,mime_type:Se,ai_extracted_text:De,ai_raw_json:te,text_hash:se,document_type_classification:ge,document_type_confidence:ce,uploaded_at:new Date().toISOString()}).eq("id",le);pt&&console.error("Error updating receipt record:",pt)}else if(re&&!le){const{data:pt,error:kt}=await X.from("receipts").insert({expense_id:t.id,file_url:re,file_name:ye,mime_type:Se,uploaded_by:_,ai_extracted_text:De,ai_raw_json:te,text_hash:se,document_type_classification:ge,document_type_confidence:ce}).select("id").single();kt&&console.error("Error inserting new receipt record:",kt),le=(pt==null?void 0:pt.id)||null}else if(!re&&le){const{error:pt}=await X.from("receipts").delete().eq("id",le);pt&&console.error("Error deleting receipt record:",pt),le=null}const{data:Ne,error:ae}=await X.from("companies").select("default_currency").eq("id",f).single();ae&&console.error("Error fetching company default currency:",ae);const ue=(Ne==null?void 0:Ne.default_currency)||"USD";let _e=null,ie=null;Z.amount&&Z.currency_code&&ue&&(Z.currency_code===ue?(_e=Z.amount,ie=1):(console.warn(`DEBUG: Currency conversion from ${Z.currency_code} to ${ue} is a placeholder.`),Z.currency_code==="USD"&&ue==="CAD"?(ie=1.35,_e=Z.amount*ie):Z.currency_code==="CAD"&&ue==="USD"?(ie=.74,_e=Z.amount*ie):(ie=1,_e=Z.amount)));const{error:he}=await X.from("expenses").update({title:Z.title||null,description:Z.description||null,amount:Z.amount,expense_date:Z.expense_date?at(Z.expense_date,"yyyy-MM-dd"):null,category_id:Z.category_id||null,gl_account_id:Z.gl_account_id||null,currency_code:Z.currency_code||null,base_currency_amount:_e,exchange_rate:ie,vendor_name:Z.vendor_name||null,merchant_address:Z.merchant_address||null,receipt_summary:Z.receipt_summary||null,ai_confidence_score:Z.ai_confidence_score||null,is_reimbursable:Z.is_reimbursable,project_code:Z.project_code||null,cost_center:Z.cost_center||null,status:Z.status,updated_at:new Date().toISOString()}).eq("id",t.id).eq("submitted_by",_);if(he)throw he;if(await X.from("expense_line_items").delete().eq("expense_id",t.id),Z.line_items&&Z.line_items.length>0){const pt=Z.line_items.map(un=>({...un,expense_id:t.id,extracted_from_receipt_id:le})),{error:kt}=await X.from("expense_line_items").insert(pt);kt&&console.error("Error inserting line items during update:",kt)}return null},onSuccess:()=>{i.invalidateQueries({queryKey:["expenses-with-submitter"]}),i.invalidateQueries({queryKey:["expense",t==null?void 0:t.id]}),l({title:`Expense ${x==="draft"?"Saved as Draft":"Submitted"}`,description:`Your expense has been successfully ${x==="draft"?"saved as a draft.":"submitted for review."}`}),a(!1),r==null||r()},onError:Z=>{l({title:`Error ${x==="draft"?"saving draft":"submitting expense"}`,description:Z.message||"An unexpected error occurred.",variant:"destructive"})}}),R=(Z,re,ye)=>{s(Z),h(re),d(ye),v(!1),S.setValue("title",Z.title||""),S.setValue("description",Z.description||null),S.setValue("amount",Z.original_currency_amount||0),S.setValue("currency_code",Z.original_currency_code||"USD"),Z.expense_date&&S.setValue("expense_date",new Date(Z.expense_date)),S.setValue("category_id",Z.category_id||null),S.setValue("gl_account_id",Z.gl_account_id||null),S.setValue("vendor_name",Z.vendor_name||null),S.setValue("merchant_address",Z.merchant_address||null),S.setValue("receipt_summary",Z.receipt_summary||null),S.setValue("ai_confidence_score",Z.ai_confidence_score||null),S.setValue("is_reimbursable",Z.is_reimbursable??!0),S.setValue("project_code",Z.project_code||null),S.setValue("cost_center",Z.cost_center||null),Z.line_items&&Z.line_items.length>0?S.setValue("line_items",Z.line_items.map(Se=>({description:Se.description,quantity:Se.quantity,unit_price:Se.unit_price,line_amount:Se.line_amount,currency_code:Se.currency_code}))):S.setValue("line_items",[]),l({title:"AI Analysis Complete",description:"Expense details have been extracted. Please review and adjust as needed."})},F=()=>{h(null),d(null),s(null),S.setValue("vendor_name",null),S.setValue("merchant_address",null),S.setValue("receipt_summary",null),S.setValue("ai_confidence_score",null),S.setValue("line_items",[]),l({title:"Receipt Removed",description:"AI analysis data cleared."})},M=(Z,re)=>{if(y(re),re==="submitted"){const ye=w.safeParse(Z);if(!ye.success){ye.error.errors.forEach(Se=>{S.setError(Se.path.join("."),{type:"manual",message:Se.message})}),l({title:"Validation Error",description:"Please fill out all required fields before submitting.",variant:"destructive"});return}}t?q.mutate({...Z,status:re}):U.mutate({...Z,status:re})},z=m||N||C,H=U.isPending||q.isPending,I=["admin","controller","super-admin"].includes(b||""),A=S.watch("amount"),V=S.watch("currency_code"),K=S.watch("ai_confidence_score"),Q=Z=>k[Z]||{visible:!0,required:!1};return z?e.jsxs("div",{className:"flex flex-1 items-center justify-center p-8",children:[e.jsx(fe,{className:"h-8 w-8 animate-spin"}),e.jsx("p",{className:"ml-2",children:"Loading expense form configuration..."})]}):e.jsxs(ut,{className:"sm:max-w-[900px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(_t,{children:[e.jsx(jt,{children:t?"Edit Expense":"Add New Expense"}),e.jsx(Et,{children:t?"Update your expense details.":"Create a new expense by uploading a receipt or entering details manually."})]}),e.jsxs("div",{className:"grid gap-6",children:[Q("receipt_upload").visible&&e.jsxs(we,{children:[e.jsxs(Ae,{children:[e.jsxs(Ee,{className:"text-lg flex items-center gap-2",children:[e.jsx(Tt,{className:"h-5 w-5"}),"Smart Receipt Upload"]}),e.jsxs(Re,{children:["Upload an image or PDF of your receipt for automatic data extraction.",Q("receipt_upload").required&&e.jsx("span",{className:"text-destructive ml-1",children:"* Required"})]})]}),e.jsxs(ke,{children:[e.jsx(Jv,{onFileSelected:R,onRemoveFile:F,isLoading:g,currentPreviewUrl:p,companyId:f||"",userId:_||"",setIsAnalyzing:v}),K!==null&&(K??0)<.5&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-orange-600 dark:text-orange-400 mt-4",children:[e.jsx(xt,{className:"h-4 w-4"}),e.jsxs("p",{children:["AI confidence is low (",Math.round((K??0)*100),"%). Please review extracted details carefully."]})]}),Q("receipt_upload").required&&!u&&!((xe=t==null?void 0:t.receipts)!=null&&xe.length)&&x==="submitted"&&e.jsxs("p",{className:"text-sm text-destructive flex items-center gap-1 mt-2",children:[e.jsx(xt,{className:"h-3 w-3"}),"A receipt upload is required."]})]})]}),e.jsxs(we,{children:[e.jsxs(Ae,{children:[e.jsx(Ee,{className:"text-lg",children:"Expense Details"}),e.jsx(Re,{children:"Fill in the expense information below."})]}),e.jsx(ke,{children:e.jsxs("form",{className:"grid gap-4",children:[Q("title").visible&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(G,{htmlFor:"title",children:["Title ",Q("title").required&&"*"]}),e.jsx(ne,{id:"title",...S.register("title"),disabled:H}),S.formState.errors.title&&e.jsxs("p",{className:"text-sm text-destructive flex items-center gap-1",children:[e.jsx(xt,{className:"h-3 w-3"}),S.formState.errors.title.message]})]}),Q("expense_date").visible&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(G,{htmlFor:"expense_date",children:["Expense Date ",Q("expense_date").required&&"*"]}),e.jsxs(ms,{children:[e.jsx(ps,{asChild:!0,children:e.jsxs(ee,{variant:"outline",className:pe("w-full justify-start text-left font-normal",!S.watch("expense_date")&&"text-muted-foreground"),disabled:H,children:[e.jsx(Zi,{className:"mr-2 h-4 w-4"}),S.watch("expense_date")?at(S.watch("expense_date"),"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(Ha,{className:"w-auto p-0",children:e.jsx($a,{mode:"single",selected:S.watch("expense_date")||void 0,onSelect:Z=>S.setValue("expense_date",Z||null),initialFocus:!0})})]}),S.formState.errors.expense_date&&e.jsxs("p",{className:"text-sm text-destructive flex items-center gap-1",children:[e.jsx(xt,{className:"h-3 w-3"}),S.formState.errors.expense_date.message]})]})]}),Q("description").visible&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(G,{htmlFor:"description",children:["Description ",Q("description").required&&"*"]}),e.jsx(Ot,{id:"description",...S.register("description"),disabled:H,rows:3}),S.formState.errors.description&&e.jsxs("p",{className:"text-sm text-destructive flex items-center gap-1",children:[e.jsx(xt,{className:"h-3 w-3"}),S.formState.errors.description.message]})]}),(Q("amount").visible||Q("currency_code").visible)&&e.jsxs(e.Fragment,{children:[e.jsx(lt,{}),e.jsx("h4",{className:"text-md font-semibold",children:"Amount Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Q("amount").visible&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(G,{htmlFor:"amount",children:["Amount ",Q("amount").required&&"*"]}),e.jsx(ne,{id:"amount",type:"number",step:"0.01",...S.register("amount",{valueAsNumber:!0}),disabled:H}),S.formState.errors.amount&&e.jsxs("p",{className:"text-sm text-destructive flex items-center gap-1",children:[e.jsx(xt,{className:"h-3 w-3"}),S.formState.errors.amount.message]})]}),Q("currency_code").visible&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(G,{htmlFor:"currency_code",children:["Currency ",Q("currency_code").required&&"*"]}),e.jsxs(Je,{onValueChange:Z=>S.setValue("currency_code",Z),value:S.watch("currency_code")||"",disabled:H,children:[e.jsx(Qe,{id:"currency_code",children:e.jsx(et,{placeholder:"Select currency"})}),e.jsx(Xe,{children:$==null?void 0:$.map(Z=>e.jsxs(Ue,{value:Z.code,children:[Z.code," - ",Z.name," (",Z.symbol,")"]},Z.code))})]}),S.formState.errors.currency_code&&e.jsxs("p",{className:"text-sm text-destructive flex items-center gap-1",children:[e.jsx(xt,{className:"h-3 w-3"}),S.formState.errors.currency_code.message]})]})]}),A>0&&V&&e.jsxs("div",{className:"text-sm text-muted-foreground mt-2",children:["Expense Amount: ",e.jsx(xn,{amount:A,currencyCode:V})]})]}),(Q("vendor_name").visible||Q("merchant_address").visible||Q("project_code").visible||Q("cost_center").visible)&&e.jsxs(e.Fragment,{children:[e.jsx(lt,{}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Q("vendor_name").visible&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(G,{htmlFor:"vendor_name",children:["Vendor Name ",Q("vendor_name").required&&"*"]}),e.jsx(ne,{id:"vendor_name",...S.register("vendor_name"),disabled:H}),S.formState.errors.vendor_name&&e.jsxs("p",{className:"text-sm text-destructive flex items-center gap-1",children:[e.jsx(xt,{className:"h-3 w-3"}),S.formState.errors.vendor_name.message]})]}),Q("merchant_address").visible&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(G,{htmlFor:"merchant_address",children:["Merchant Address ",Q("merchant_address").required&&"*"]}),e.jsx(ne,{id:"merchant_address",...S.register("merchant_address"),disabled:H}),S.formState.errors.merchant_address&&e.jsxs("p",{className:"text-sm text-destructive flex items-center gap-1",children:[e.jsx(xt,{className:"h-3 w-3"}),S.formState.errors.merchant_address.message]})]}),Q("project_code").visible&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(G,{htmlFor:"project_code",children:["Project Code ",Q("project_code").required&&"*"]}),e.jsx(ne,{id:"project_code",...S.register("project_code"),disabled:H}),S.formState.errors.project_code&&e.jsxs("p",{className:"text-sm text-destructive flex items-center gap-1",children:[e.jsx(xt,{className:"h-3 w-3"}),S.formState.errors.project_code.message]})]}),Q("cost_center").visible&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(G,{htmlFor:"cost_center",children:["Cost Center ",Q("cost_center").required&&"*"]}),e.jsx(ne,{id:"cost_center",...S.register("cost_center"),disabled:H}),S.formState.errors.cost_center&&e.jsxs("p",{className:"text-sm text-destructive flex items-center gap-1",children:[e.jsx(xt,{className:"h-3 w-3"}),S.formState.errors.cost_center.message]})]})]})]}),(Q("category_id").visible||Q("gl_account_id").visible&&I)&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Q("category_id").visible&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(G,{htmlFor:"category_id",children:["Category ",Q("category_id").required&&"*"]}),e.jsxs(Je,{onValueChange:Z=>S.setValue("category_id",Z),value:S.watch("category_id")||"",disabled:H,children:[e.jsx(Qe,{children:e.jsx(et,{placeholder:"Select a category"})}),e.jsx(Xe,{children:B==null?void 0:B.map(Z=>e.jsx(Ue,{value:Z.id,children:Z.name},Z.id))})]}),S.formState.errors.category_id&&e.jsxs("p",{className:"text-sm text-destructive flex items-center gap-1",children:[e.jsx(xt,{className:"h-3 w-3"}),S.formState.errors.category_id.message]})]}),Q("gl_account_id").visible&&I&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(G,{htmlFor:"gl_account_id",children:["GL Account ",Q("gl_account_id").required&&"*"]}),e.jsxs(Je,{onValueChange:Z=>S.setValue("gl_account_id",Z),value:S.watch("gl_account_id")||"",disabled:H,children:[e.jsx(Qe,{children:e.jsx(et,{placeholder:"Select a GL account"})}),e.jsx(Xe,{children:Y==null?void 0:Y.map(Z=>e.jsxs(Ue,{value:Z.id,children:[Z.account_code," - ",Z.account_name]},Z.id))})]}),S.formState.errors.gl_account_id&&e.jsxs("p",{className:"text-sm text-destructive flex items-center gap-1",children:[e.jsx(xt,{className:"h-3 w-3"}),S.formState.errors.gl_account_id.message]})]})]}),Q("is_reimbursable").visible&&e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsx(bt,{id:"is_reimbursable",checked:S.watch("is_reimbursable"),onCheckedChange:Z=>S.setValue("is_reimbursable",Z),disabled:H}),e.jsxs(G,{htmlFor:"is_reimbursable",children:["Is Reimbursable ",Q("is_reimbursable").required&&"*"]}),S.formState.errors.is_reimbursable&&e.jsxs("p",{className:"text-sm text-destructive flex items-center gap-1",children:[e.jsx(xt,{className:"h-3 w-3"}),S.formState.errors.is_reimbursable.message]})]}),Q("line_items").visible&&e.jsxs(e.Fragment,{children:[e.jsx(lt,{}),e.jsxs("h4",{className:"text-md font-semibold flex items-center gap-2",children:["Line Items ",Q("line_items").required&&"*",e.jsxs(ee,{type:"button",variant:"outline",size:"sm",onClick:()=>O({description:"",line_amount:0,currency_code:S.watch("currency_code")||"USD"}),disabled:H,children:[e.jsx(Kt,{className:"h-3 w-3 mr-1"})," Add Line Item"]})]}),S.formState.errors.line_items&&e.jsxs("p",{className:"text-sm text-destructive flex items-center gap-1",children:[e.jsx(xt,{className:"h-3 w-3"}),S.formState.errors.line_items.message]}),P.length===0?e.jsx("p",{className:"text-muted-foreground text-sm",children:'No line items extracted or added yet. Click "Add Line Item" to manually add one.'}):e.jsx("div",{className:"space-y-3",children:P.map((Z,re)=>{var ye,Se,De,te,se,ge,ce,le;return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-2 items-end border p-3 rounded-md",children:[e.jsxs("div",{className:"col-span-full md:col-span-2 space-y-1",children:[e.jsx(G,{htmlFor:`line_items.${re}.description`,children:"Description *"}),e.jsx(ne,{id:`line_items.${re}.description`,...S.register(`line_items.${re}.description`),disabled:H}),((Se=(ye=S.formState.errors.line_items)==null?void 0:ye[re])==null?void 0:Se.description)&&e.jsxs("p",{className:"text-sm text-destructive flex items-center gap-1",children:[e.jsx(xt,{className:"h-3 w-3"}),(te=(De=S.formState.errors.line_items[re])==null?void 0:De.description)==null?void 0:te.message]})]}),e.jsxs("div",{className:"col-span-full md:col-span-1 space-y-1",children:[e.jsx(G,{htmlFor:`line_items.${re}.quantity`,children:"Qty"}),e.jsx(ne,{id:`line_items.${re}.quantity`,type:"number",step:"0.01",...S.register(`line_items.${re}.quantity`,{valueAsNumber:!0}),disabled:H})]}),e.jsxs("div",{className:"col-span-full md:col-span-1 space-y-1",children:[e.jsx(G,{htmlFor:`line_items.${re}.unit_price`,children:"Unit Price"}),e.jsx(zn,{id:`line_items.${re}.unit_price`,value:S.watch(`line_items.${re}.unit_price`)??0,onChange:Ne=>S.setValue(`line_items.${re}.unit_price`,Ne),disabled:H,currencyCode:S.watch(`line_items.${re}.currency_code`)||"USD"})]}),e.jsxs("div",{className:"col-span-full md:col-span-1 space-y-1",children:[e.jsx(G,{htmlFor:`line_items.${re}.line_amount`,children:"Amount *"}),e.jsx(zn,{id:`line_items.${re}.line_amount`,value:S.watch(`line_items.${re}.line_amount`)??0,onChange:Ne=>S.setValue(`line_items.${re}.line_amount`,Ne),disabled:H,currencyCode:S.watch(`line_items.${re}.currency_code`)||"USD"}),((ge=(se=S.formState.errors.line_items)==null?void 0:se[re])==null?void 0:ge.line_amount)&&e.jsxs("p",{className:"text-sm text-destructive flex items-center gap-1",children:[e.jsx(xt,{className:"h-3 w-3"}),(le=(ce=S.formState.errors.line_items[re])==null?void 0:ce.line_amount)==null?void 0:le.message]})]}),e.jsx("div",{className:"col-span-full md:col-span-1 flex justify-end items-center",children:e.jsx(ee,{type:"button",variant:"destructive",size:"icon",onClick:()=>L(re),disabled:H,children:e.jsx(qt,{className:"h-4 w-4"})})})]},Z.id)})})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(ee,{type:"button",variant:"outline",onClick:()=>a(!1),disabled:H,children:"Cancel"}),e.jsxs(ee,{type:"button",onClick:S.handleSubmit(Z=>M(Z,"draft")),disabled:H,children:[H&&x==="draft"&&e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Draft"]}),e.jsxs(ee,{type:"button",onClick:S.handleSubmit(Z=>M(Z,"submitted")),disabled:H,children:[" ",H&&x==="submitted"&&e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"})," ",e.jsx(ya,{className:"mr-2 h-4 w-4"})," Submit Expense"]})]})]})})]})]})]})},rx=()=>{const n=kn(),a=ns(),t=Ye(),[r,i]=T.useState("all"),{data:l,isLoading:c}=xh(),{data:m=[],isLoading:u,error:h}=vh((l==null?void 0:l.company_id)||void 0),[p,d]=T.useState(!1),[o,s]=T.useState(null),[g,v]=T.useState(null),{data:x,isLoading:y}=je({queryKey:["expenseModuleSystemId"],queryFn:async()=>{const{data:O,error:L}=await X.from("modules").select("id").eq("name","Expense Management").single();if(L&&L.code!=="PGRST116")throw L;return(O==null?void 0:O.id)||null}}),{data:f,isLoading:_}=je({queryKey:["expenseModuleUserConfig",l==null?void 0:l.company_id,x],queryFn:async()=>{if(!(l!=null&&l.company_id)||!x)return null;const{data:O,error:L}=await X.from("module_configurations").select("settings").eq("company_id",l.company_id).eq("module_id",x).eq("config_key","expense_management_fields").single();if(L&&L.code!=="PGRST116")throw L;return O},enabled:!!(l!=null&&l.company_id)&&!!x&&!c}),b=T.useCallback(O=>{var L,$;return(($=(L=f==null?void 0:f.settings)==null?void 0:L.user_fields)==null?void 0:$[O])||{visible:!0,required:!1}},[f]),E=T.useMemo(()=>{const O={};return An.forEach(L=>{O[L.key]=b(L.key)}),O},[b]),{data:N}=je({queryKey:["expense",o],queryFn:async()=>{if(!o)return null;const{data:O,error:L}=await X.from("expenses").select(`
          *,
          expense_categories (id, name),
          gl_accounts (id, account_code, account_name),
          receipts (id, file_url, file_name, mime_type, ai_extracted_text, ai_raw_json, text_hash, document_type_classification, document_type_confidence),
          expense_line_items (id, description, quantity, unit_price, line_amount, currency_code)
        `).eq("id",o).single();if(L)throw L;return O},enabled:!!o}),j=T.useMemo(()=>r==="all"?m:m.filter(O=>O.status===r),[m,r]),C=T.useMemo(()=>{const O={all:m.length,draft:0,submitted:0,approved:0,rejected:0,info_requested:0};return m.forEach(L=>{L.status in O&&O[L.status]++}),O},[m]),D=O=>{n(`/expenses/${O.id}`)},k=()=>{s(null),d(!0)},w=O=>{s(O.id),d(!0)},S=async O=>{if(O.status!=="draft"){fa.error("Only draft expenses can be deleted");return}try{const{error:L}=await X.from("expenses").delete().eq("id",O.id);if(L)throw L;fa.success("Expense deleted successfully"),t.invalidateQueries({queryKey:["expenses-with-submitter"]})}catch(L){console.error("Error deleting expense:",L),fa.error("Failed to delete expense")}},P=T.useCallback(O=>{v(L=>L===O.id?null:O.id)},[]);return h?e.jsx("div",{className:"container mx-auto p-6",children:e.jsxs("div",{className:"text-center text-red-600",children:["Error loading expenses: ",h.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(we,{children:[e.jsxs(Ae,{className:"flex flex-row items-start justify-between space-y-0 pb-2",children:[e.jsxs("div",{children:[e.jsxs(Ee,{className:"text-2xl flex items-center gap-2",children:[e.jsx(Hl,{className:"h-5 w-5"})," Expenses"]}),e.jsx(Re,{children:"Manage and track your expense reports"})]}),e.jsxs(ee,{onClick:k,className:"w-full sm:w-auto",children:[e.jsx(Bu,{className:"mr-2 h-4 w-4"}),"New Expense"]})]}),e.jsx(ke,{children:e.jsxs(dn,{value:r,onValueChange:i,className:"w-full",children:[e.jsxs(sn,{className:"grid w-full grid-cols-3 lg:grid-cols-6",children:[e.jsxs(ze,{value:"all",className:"text-xs sm:text-sm",children:["All (",C.all,")"]}),e.jsxs(ze,{value:"draft",className:"text-xs sm:text-sm",children:["Draft (",C.draft,")"]}),e.jsxs(ze,{value:"submitted",className:"text-xs sm:text-sm",children:["Submitted (",C.submitted,")"]}),e.jsxs(ze,{value:"approved",className:"text-xs sm:text-sm",children:["Approved (",C.approved,")"]}),e.jsxs(ze,{value:"rejected",className:"text-xs sm:text-sm",children:["Rejected (",C.rejected,")"]}),e.jsxs(ze,{value:"info_requested",className:"text-xs sm:text-sm",children:["Info Requested (",C.info_requested,")"]})]}),e.jsx(Ve,{value:r,className:"mt-6",children:u||c||y||_?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):j.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:["No ",r==="all"?"":r," expenses found"]}):e.jsx(Nh,{expenses:j,onView:D,onEdit:w,onDelete:S,isMobile:a,showSubmitterColumn:!1,onRowClick:P,expandedRowId:g,userFieldsConfig:E})})]})})]}),e.jsx(vt,{open:p,onOpenChange:O=>{d(O),O||s(null)},children:e.jsx(nx,{isOpen:p,onOpenChange:d,editingExpense:N,onSuccess:()=>{d(!1),s(null)}})})]})},ax=()=>{var Ne,ae,ue,_e;const{id:n}=ju(),a=kn(),t=Ye(),{toast:r}=Ke(),{profile:i,isLoading:l}=Ie(),[c,m]=T.useState(""),[u,h]=T.useState(""),[p,d]=T.useState(!1),[o,s]=T.useState(null),[g,v]=T.useState(null),[x,y]=T.useState(!1),[f,_]=T.useState(null),[b,E]=T.useState(null),[N,j]=T.useState(null),C=i==null?void 0:i.user_id,D=i==null?void 0:i.role,k=i==null?void 0:i.company_id,{data:w,isLoading:S}=je({queryKey:["expenseModuleSystemId"],queryFn:async()=>{const{data:ie,error:he}=await X.from("modules").select("id").eq("name","Expense Management").single();if(he&&he.code!=="PGRST116")throw he;return(ie==null?void 0:ie.id)||null}}),{data:P,isLoading:O}=je({queryKey:["expenseModuleControllerConfig",k,w],queryFn:async()=>{if(!k||!w)return null;const{data:ie,error:he}=await X.from("module_configurations").select("settings").eq("company_id",k).eq("module_id",w).eq("config_key","expense_management_fields").single();if(he&&he.code!=="PGRST116")throw he;return ie},enabled:!!k&&!!w&&!l}),{data:L,isLoading:$,isError:B}=je({queryKey:["expense",n],queryFn:async()=>{var We,Fe,$e;if(!n)throw new Error("Expense ID is missing.");const{data:ie,error:he}=await X.from("expenses").select(`
          *,
          expense_categories (name),
          gl_accounts (account_code, account_name),
          receipts (id, file_url, file_name, mime_type),
          expense_line_items (id, description, quantity, unit_price, line_amount, currency_code)
        `).eq("id",n).single();if(he)throw he;return{...ie,category_name:((We=ie.expense_categories)==null?void 0:We.name)||null,gl_account_code:((Fe=ie.gl_accounts)==null?void 0:Fe.account_code)||null,gl_account_name:(($e=ie.gl_accounts)==null?void 0:$e.account_name)||null}},enabled:!!n}),{data:Y,isLoading:U}=je({queryKey:["submitterProfile",L==null?void 0:L.submitted_by],queryFn:async()=>{if(!(L!=null&&L.submitted_by))return null;const{data:ie,error:he}=await X.from("profiles").select("user_id, full_name, email").eq("user_id",L.submitted_by).single();if(he&&he.code!=="PGRST116")throw he;return ie},enabled:!!(L!=null&&L.submitted_by)}),{data:q,isLoading:R}=je({queryKey:["reviewerProfile",L==null?void 0:L.reviewer_id],queryFn:async()=>{if(!(L!=null&&L.reviewer_id))return null;const{data:ie,error:he}=await X.from("profiles").select("user_id, full_name, email").eq("user_id",L.reviewer_id).single();if(he&&he.code!=="PGRST116")throw he;return ie},enabled:!!(L!=null&&L.reviewer_id)}),{data:F,isLoading:M}=je({queryKey:["controllerProfile",L==null?void 0:L.controller_id],queryFn:async()=>{if(!(L!=null&&L.controller_id))return null;const{data:ie,error:he}=await X.from("profiles").select("user_id, full_name, email").eq("user_id",L.controller_id).single();if(he&&he.code!=="PGRST116")throw he;return ie},enabled:!!(L!=null&&L.controller_id)}),{data:z,isLoading:H}=je({queryKey:["companyDefaultCurrency",L==null?void 0:L.company_id],queryFn:async()=>{if(!(L!=null&&L.company_id))return null;const{data:ie,error:he}=await X.from("companies").select("default_currency").eq("id",L.company_id).single();if(he&&he.code!=="PGRST116")throw he;return ie},enabled:!!(L!=null&&L.company_id)}),I=(z==null?void 0:z.default_currency)||"USD",A=T.useMemo(()=>L?{...L,submitter_profile:Y,reviewer_profile:q,controller_profile:F}:null,[L,Y,q,F]),{data:V,isLoading:K}=je({queryKey:["expense_comments",n],queryFn:async()=>{if(!n)return[];const{data:ie,error:he}=await X.from("expense_comments").select(`
          *,
          profiles (full_name, email)
        `).eq("expense_id",n).order("created_at",{ascending:!0});if(he)throw he;return ie},enabled:!!n}),{data:Q,isLoading:de}=je({queryKey:["expense_audit_log",n],queryFn:async()=>{if(!n)return[];const{data:ie,error:he}=await X.from("expense_audit_log").select(`
          *,
          profiles (full_name, email)
        `).eq("expense_id",n).order("created_at",{ascending:!0});if(he)throw he;return ie},enabled:!!n}),xe=D&&["admin","controller","super-admin"].includes(D),{data:Z,isLoading:re}=je({queryKey:n&&xe?["companyDuplicates",n]:[],queryFn:async()=>{if(!n)return[];const{data:ie,error:he}=await X.functions.invoke("check-company-duplicates",{body:{expense_id:n}});if(he)throw he;return ie.duplicates||[]},enabled:!!n&&!!xe}),ye=Oe({mutationFn:async ie=>{if(!n||!C)throw new Error("Expense ID or User ID missing.");const{error:he}=await X.from("expense_comments").insert({expense_id:n,user_id:C,comment:ie.comment,is_internal:ie.is_internal});if(he)throw he;return null},onSuccess:()=>{t.invalidateQueries({queryKey:["expense_comments",n]}),m(""),r({title:"Comment Added",description:"Your comment has been added."})},onError:ie=>{r({title:"Error adding comment",description:ie.message,variant:"destructive"})}}),Se=Oe({mutationFn:async({expenseId:ie,status:he,notes:We})=>{if(!ie)throw new Error("Expense ID missing.");const{data:Fe,error:$e}=await X.rpc("update_expense_status",{expense_id:ie,new_status:he,notes:We});if($e)throw $e;return Fe},onSuccess:()=>{t.invalidateQueries({queryKey:["expense",n]}),t.invalidateQueries({queryKey:["expense_audit_log",n]}),t.invalidateQueries({queryKey:["notifications",C]}),t.invalidateQueries({queryKey:["expensesForReview"]}),t.invalidateQueries({queryKey:["expenses"]}),r({title:"Expense Status Updated",description:"Expense status has been updated."}),d(!1),h(""),s(null),o==="request_info"&&a("/expense-review",{replace:!0})},onError:ie=>{r({title:"Error updating status",description:ie.message,variant:"destructive"})}}),De=D&&["admin","controller","super-admin"].includes(D)&&(A==null?void 0:A.status)==="submitted",te=D&&["admin","controller","super-admin"].includes(D)&&((A==null?void 0:A.status)==="submitted"||(A==null?void 0:A.status)==="info_requested")&&(A==null?void 0:A.submitted_by)!==C,se=(A==null?void 0:A.status)==="info_requested"&&(A==null?void 0:A.submitted_by)===C,ge=async(ie,he)=>{E(he);const We=ie.split("/storage/v1/object/public/expense-receipts/")[1];if(!We){console.error("Could not extract path from file URL:",ie),r({title:"Error",description:"Invalid receipt file URL.",variant:"destructive"}),_(null),j(null);return}const{data:Fe,error:$e}=await X.storage.from("expense-receipts").createSignedUrl(We,3600);$e?(console.error("Error creating signed URL:",$e),r({title:"Error",description:"Failed to load receipt. Access denied or file not found.",variant:"destructive"}),_(null),j(null)):he==="application/pdf"?(j(Fe.signedUrl),_(null)):(_(Fe.signedUrl),j(null)),y(!0)},ce=ie=>{var he,We;return((We=(he=P==null?void 0:P.settings)==null?void 0:he.controller_fields)==null?void 0:We[ie])||{visible:!0,required:!1}};return l||S||O||$||U||R||M||H||K||de||re?e.jsxs("div",{className:"flex flex-1 items-center justify-center",children:[e.jsx(fe,{className:"h-8 w-8 animate-spin"}),e.jsx("p",{className:"ml-2",children:"Loading expense details..."})]}):B||!A?e.jsxs("div",{className:"flex flex-1 items-center justify-center text-destructive",children:[e.jsx("p",{children:"Error loading expense or expense not found."}),e.jsxs(ee,{onClick:()=>a(-1),className:"ml-4",children:[e.jsx(Os,{className:"h-4 w-4 mr-2"})," Back to Expenses"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(we,{className:"mb-6",children:[e.jsxs(Ae,{className:"flex flex-row items-start justify-between space-y-0 pb-2",children:[e.jsxs("div",{children:[e.jsxs(ee,{variant:"outline",onClick:()=>a(-1),className:"mb-2",children:[e.jsx(Os,{className:"h-4 w-4 mr-2"})," Back to Expenses"]}),e.jsxs(Ee,{className:"flex items-center",children:[A.title,e.jsx("span",{className:`ml-2 text-sm font-medium px-2.5 py-0.5 rounded-full ${A.status==="draft"?"bg-gray-100 text-gray-800":A.status==="submitted"?"bg-blue-100 text-blue-800":A.status==="approved"?"bg-brand-green text-brand-green-foreground":A.status==="rejected"?"bg-destructive text-destructive-foreground":"bg-yellow-100 text-yellow-800"}`,children:A.status.charAt(0).toUpperCase()+A.status.slice(1).replace(/_/g," ")})]}),e.jsxs(Re,{children:["Submitted by ",((Ne=A.submitter_profile)==null?void 0:Ne.full_name)||((ae=A.submitter_profile)==null?void 0:ae.email)," on ",at(new Date(A.created_at),"PPP")]})]}),e.jsxs("div",{className:"flex gap-2",children:[De&&e.jsxs(e.Fragment,{children:[e.jsxs(ee,{className:"bg-brand-green hover:bg-brand-green/90 text-brand-green-foreground",onClick:()=>{v(A),s("approve"),d(!0)},disabled:Se.isPending,children:[e.jsx(wn,{className:"h-4 w-4 mr-2"})," Approve"]}),e.jsxs(ee,{variant:"destructive",onClick:()=>{v(A),s("reject"),d(!0)},disabled:Se.isPending,children:[e.jsx(Ft,{className:"h-4 w-4 mr-2"})," Reject"]})]}),te&&e.jsxs(ee,{variant:"outline",onClick:()=>{v(A),s("request_info"),d(!0)},disabled:Se.isPending,children:[e.jsx(vr,{className:"h-4 w-4 mr-2"})," Request Info"]}),se&&e.jsxs(ee,{variant:"default",onClick:()=>{},disabled:Se.isPending,children:[e.jsx(vr,{className:"h-4 w-4 mr-2"})," Respond to Request"]})]})]}),e.jsxs(ke,{className:"grid gap-4",children:[ce("amount").visible&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Original Amount"}),e.jsx("p",{className:"text-lg font-bold",children:e.jsx(xn,{amount:A.amount,currencyCode:A.currency_code})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Base Currency Amount"}),e.jsx("p",{className:"text-lg font-bold",children:e.jsx(xn,{amount:A.base_currency_amount,currencyCode:I})})]})]}),e.jsx(lt,{}),ce("expense_date").visible&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Expense Date"}),e.jsx("p",{className:"text-lg",children:at(new Date(A.expense_date),"PPP")})]}),ce("vendor_name").visible&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Vendor Name"}),e.jsx("p",{children:A.vendor_name||"N/A"})]})]}),ce("merchant_address").visible&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Merchant Address"}),e.jsx("p",{children:A.merchant_address||"N/A"})]}),ce("receipt_summary").visible&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Receipt Summary"}),e.jsx("p",{children:A.receipt_summary||"N/A"})]})]}),ce("category_id").visible&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Category"}),e.jsx("p",{children:A.category_name||"N/A"})," "]}),ce("gl_account_id").visible&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"GL Account"}),e.jsx("p",{children:A.gl_account_code&&A.gl_account_name?`${A.gl_account_code} - ${A.gl_account_name}`:"N/A"})," "]})]}),ce("project_code").visible&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Project Code"}),e.jsx("p",{children:A.project_code||"N/A"})]}),ce("cost_center").visible&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Cost Center"}),e.jsx("p",{children:A.cost_center||"N/A"})]})]}),ce("is_reimbursable").visible&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Is Reimbursable"}),e.jsx("p",{children:A.is_reimbursable?"Yes":"No"})]}),ce("ai_confidence_score").visible&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"AI Confidence Score"}),e.jsx("p",{children:A.ai_confidence_score?`${Math.round(A.ai_confidence_score*100)}%`:"N/A"})]})]}),ce("description").visible&&A.description&&e.jsxs(e.Fragment,{children:[e.jsx(lt,{}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Description"}),e.jsx("p",{children:A.description})]})]}),ce("receipt_upload").visible&&A.receipts&&A.receipts.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(lt,{}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Receipts"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:A.receipts.map(ie=>e.jsxs("div",{className:"relative group border rounded-lg overflow-hidden",children:[ie.mime_type.startsWith("image/")?e.jsx("img",{src:ie.file_url,alt:ie.file_name,className:"w-full h-32 object-cover"}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-32 bg-gray-100 dark:bg-gray-700 text-muted-foreground",children:[e.jsx(Ta,{className:"h-8 w-8"}),e.jsx("p",{className:"text-xs text-center mt-1 truncate w-full px-2",children:ie.file_name})]}),e.jsxs("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsxs(ee,{variant:"secondary",size:"sm",onClick:()=>ge(ie.file_url,ie.mime_type),children:[e.jsx(mn,{className:"h-4 w-4 mr-2"})," View"]}),e.jsx("a",{href:ie.file_url,download:ie.file_name,target:"_blank",rel:"noopener noreferrer",children:e.jsxs(ee,{variant:"secondary",size:"sm",className:"ml-2",children:[e.jsx(Uu,{className:"h-4 w-4 mr-2"})," Download"]})})]})]},ie.id))})]})]}),ce("line_items").visible&&A.expense_line_items&&A.expense_line_items.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(lt,{}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Line Items"}),e.jsx("div",{className:"border rounded-md",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-muted/50",children:[e.jsx("th",{className:"text-left p-2 font-semibold",children:"Description"}),e.jsx("th",{className:"text-right p-2 font-semibold",children:"Qty"}),e.jsx("th",{className:"text-right p-2 font-semibold",children:"Unit Price"}),e.jsx("th",{className:"text-right p-2 font-semibold",children:"Amount"})]})}),e.jsx("tbody",{children:A.expense_line_items.map(ie=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2",children:ie.description}),e.jsx("td",{className:"text-right p-2",children:ie.quantity||"N/A"}),e.jsx("td",{className:"text-right p-2",children:e.jsx(xn,{amount:ie.unit_price,currencyCode:ie.currency_code})}),e.jsx("td",{className:"text-right p-2",children:e.jsx(xn,{amount:ie.line_amount,currencyCode:ie.currency_code})})]},ie.id))})]})})]})]}),(A.reviewer_id||A.controller_id)&&e.jsxs(e.Fragment,{children:[e.jsx(lt,{}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Review Details"}),A.reviewer_profile&&e.jsxs("p",{children:["Reviewed by: ",A.reviewer_profile.full_name||A.reviewer_profile.email]}),A.reviewed_at&&e.jsxs("p",{children:["Reviewed at: ",at(new Date(A.reviewed_at),"PPP p")]}),A.review_notes&&e.jsxs("p",{children:["Review Notes: ",A.review_notes]}),A.controller_profile&&e.jsxs("p",{children:["Controller: ",A.controller_profile.full_name||A.controller_profile.email]}),A.controller_notes&&e.jsxs("p",{children:["Controller Notes: ",A.controller_notes]}),A.approved_at&&e.jsxs("p",{children:["Approved at: ",at(new Date(A.approved_at),"PPP p")]})]})]}),xe&&(Z||[]).length>0&&e.jsxs(e.Fragment,{children:[e.jsx(lt,{}),e.jsxs(we,{className:"border-orange-300 bg-orange-50/50 dark:bg-orange-950/20",children:[e.jsxs(Ae,{className:"flex flex-row items-center gap-2 pb-2",children:[e.jsx($u,{className:"h-5 w-5 text-orange-600"}),e.jsx(Ee,{className:"text-lg text-orange-600",children:"Potential Company-Wide Duplicates"})]}),e.jsx(Re,{className:"px-6",children:"Other receipts in your company with the same content hash. Review these carefully."}),e.jsx(ke,{className:"pt-4 grid gap-3",children:(Z||[]).map(ie=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-md bg-background",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(Dt,{to:`/expenses/${ie.expense_id}`,className:"font-medium text-blue-600 hover:underline",target:"_blank",rel:"noopener noreferrer",children:ie.expense_title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Submitted by ",ie.submitted_by_user_name," on ",at(new Date(ie.uploaded_at),"PPP")]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Receipt: ",ie.file_name]})]}),e.jsxs(ee,{variant:"outline",size:"sm",onClick:()=>ge(ie.file_url,ie.file_name.endsWith(".pdf")?"application/pdf":"image/jpeg"),children:[e.jsx(mn,{className:"h-4 w-4 mr-2"})," View Receipt"]})]},ie.receipt_id))})]})]})]})]}),e.jsxs(we,{className:"mb-6",children:[e.jsx(Ae,{children:e.jsx(Ee,{children:"Comments"})}),e.jsxs(ke,{children:[e.jsx("div",{className:"space-y-4",children:(V==null?void 0:V.length)===0?e.jsx("p",{className:"text-muted-foreground",children:"No comments yet."}):V==null?void 0:V.map(ie=>{var he,We;return e.jsxs("div",{className:"border-b pb-2 last:border-b-0 last:pb-0",children:[e.jsxs("p",{className:"text-sm font-medium",children:[((he=ie.profiles)==null?void 0:he.full_name)||((We=ie.profiles)==null?void 0:We.email),ie.is_internal&&e.jsx("span",{className:"ml-2 px-2 py-0.5 bg-gray-100 text-gray-600 text-xs rounded-full",children:"Internal"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:ie.comment}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:at(new Date(ie.created_at),"PPP p")})]},ie.id)})}),e.jsx(lt,{className:"my-4"}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"comment",children:"Add a Comment"}),e.jsx(Ot,{id:"comment",placeholder:"Type your comment here...",value:c,onChange:ie=>m(ie.target.value),disabled:ye.isPending}),e.jsxs(ee,{onClick:()=>ye.mutate({comment:c,is_internal:!1}),disabled:ye.isPending||!c.trim(),className:"self-end",children:[ye.isPending&&e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}),e.jsx(vr,{className:"h-4 w-4 mr-2"})," Post Comment"]})]})]})]}),e.jsxs(we,{children:[e.jsx(Ae,{children:e.jsx(Ee,{children:"Audit Log"})}),e.jsx(ke,{children:e.jsx("div",{className:"space-y-4",children:(Q==null?void 0:Q.length)===0?e.jsx("p",{className:"text-muted-foreground",children:"No audit entries."}):Q==null?void 0:Q.map(ie=>{var he,We;return e.jsxs("div",{className:"border-b pb-2 last:border-b-0 last:pb-0",children:[e.jsxs("p",{className:"text-sm font-medium",children:[ie.action.charAt(0).toUpperCase()+ie.action.slice(1)," by ",((he=ie.profiles)==null?void 0:he.full_name)||((We=ie.profiles)==null?void 0:We.email)]}),ie.old_status&&ie.new_status&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Status changed from ",e.jsx("span",{className:"font-semibold",children:ie.old_status})," to ",e.jsx("span",{className:"font-semibold",children:ie.new_status})]}),ie.notes&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Notes: ",ie.notes]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:at(new Date(ie.created_at),"PPP p")})]},ie.id)})})})]}),e.jsx(an,{open:p,onOpenChange:d,children:e.jsxs(zt,{children:[e.jsxs(Bt,{children:[e.jsx($t,{children:o==="approve"?"Approve Expense?":o==="reject"?"Reject Expense?":"Request Information?"}),e.jsx(Ht,{children:o==="approve"?`Are you sure you want to approve this expense (${g==null?void 0:g.title})?`:o==="reject"?`Are you sure you want to reject this expense (${g==null?void 0:g.title})? Please provide a reason.`:`Are you sure you want to request more information for this expense (${g==null?void 0:g.title})? Please provide details for the submitter.`})]}),(ce("review_notes").visible||o==="request_info")&&e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(G,{htmlFor:"review-notes",children:[o==="request_info"?"Message to Submitter":"Notes",ce("review_notes").required&&o!=="request_info"||o==="request_info"?"*":""]}),e.jsx(Ot,{id:"review-notes",placeholder:o==="request_info"?"Explain what information is needed...":"Add any review notes here...",value:u,onChange:ie=>h(ie.target.value),disabled:Se.isPending}),(ce("review_notes").required&&o==="reject"||o==="request_info")&&!u.trim()&&e.jsxs("p",{className:"text-sm text-destructive flex items-center gap-1",children:[e.jsx(xt,{className:"h-3 w-3"}),o==="request_info"?"A message is required to request information.":"Review notes are required to reject this expense."]})]}),e.jsxs(Ut,{children:[e.jsx(Wt,{disabled:Se.isPending,children:"Cancel"}),e.jsxs(Vt,{onClick:()=>{let ie="";o==="approve"?ie="approved":o==="reject"?ie="rejected":o==="request_info"&&(ie="info_requested"),Se.mutate({expenseId:g.id,status:ie,notes:u})},disabled:Se.isPending||(o==="reject"||o==="request_info")&&!u.trim(),className:o==="reject"?"bg-destructive text-destructive-foreground hover:bg-destructive/90":"",children:[Se.isPending?e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}):null,o==="approve"?"Confirm Approve":o==="reject"?"Confirm Reject":"Confirm Request"]})]})]})}),e.jsx(vt,{open:x,onOpenChange:y,children:e.jsxs(ut,{className:"sm:max-w-[90vw] max-h-[90vh] flex flex-col",children:[e.jsxs(_t,{children:[e.jsxs(jt,{children:["Receipt: ",((_e=(ue=A==null?void 0:A.receipts)==null?void 0:ue[0])==null?void 0:_e.file_name)||"View Receipt"]}),e.jsx(Et,{children:b!=null&&b.startsWith("image/")?"Image preview":"PDF document"})]}),e.jsxs("div",{className:"flex-1 flex items-center justify-center overflow-hidden p-2",children:[f&&(b==null?void 0:b.startsWith("image/"))&&e.jsx("img",{src:f,alt:"Receipt",className:"max-w-full max-h-full object-contain"}),N&&b==="application/pdf"&&e.jsx(Jc,{pdfUrl:N}),!f&&!N&&e.jsx("p",{className:"text-muted-foreground",children:"No receipt to display."})]})]})})]})};function ix(n){const a=Ye(),{user:t,isLoading:r}=Ie(),i=t==null?void 0:t.id,[l,c]=T.useState({}),{data:m,isLoading:u}=je({queryKey:["userTablePreferences",i,n],queryFn:async()=>{if(!i)return null;const{data:o,error:s}=await X.from("user_table_preferences").select("*").eq("user_id",i).eq("table_id",n).single();if(s&&s.code!=="PGRST116")throw console.error(`Error fetching table preferences for ${n}:`,s),s;return o},enabled:!!i&&!r,staleTime:1/0});T.useEffect(()=>{m!=null&&m.column_widths?c(m.column_widths):c({})},[m]);const h=Oe({mutationFn:async o=>{if(!i)throw new Error("User not authenticated.");const s={user_id:i,table_id:n,column_widths:o},{data:g,error:v}=await X.from("user_table_preferences").upsert(s,{onConflict:"user_id, table_id"}).select().single();if(v)throw console.error(`Error saving table preferences for ${n}:`,v),v;return g},onSuccess:o=>{a.setQueryData(["userTablePreferences",i,n],o)}}),p=T.useCallback((o,s)=>{c(g=>{const v={...g,[o]:s},x=setTimeout(()=>{h.mutate(v)},500);return clearTimeout(window[`debounce-${n}-${o}`]),window[`debounce-${n}-${o}`]=x,v})},[h,n]);return{columnWidths:l,updateColumnWidth:p,isLoading:r||u,isSaving:h.isPending}}const pi=8;function pr({tableId:n,columns:a,data:t,isLoading:r=!1,emptyMessage:i="No data available.",containerClassName:l,tableClassName:c,renderRow:m,isSubmitPending:u,isDeletePending:h,expenseToDeleteId:p,onEditClick:d,onSubmitClick:o,onDeleteClick:s,onRowClick:g,expandedRowId:v}){const{columnWidths:x,updateColumnWidth:y,isLoading:f}=ix(n),[_,b]=T.useState({}),E=T.useRef(null);T.useEffect(()=>{const C={};a.forEach(D=>{C[D.key]=x[D.key]||D.initialWidth||150}),b(C)},[a,x]);const N=T.useCallback((C,D)=>{C.preventDefault();const k=C.clientX,w=_[D],S=O=>{var U,q;const L=w+(O.clientX-k),$=((U=a.find(R=>R.key===D))==null?void 0:U.minWidth)||50,B=((q=a.find(R=>R.key===D))==null?void 0:q.maxWidth)||1/0,Y=Math.max($,Math.min(B,L));b(R=>({...R,[D]:Y}))},P=()=>{y(D,_[D]),window.removeEventListener("mousemove",S),window.removeEventListener("mouseup",P),document.body.style.cursor="default",document.body.style.userSelect="auto"};window.addEventListener("mousemove",S),window.addEventListener("mouseup",P),document.body.style.cursor="col-resize",document.body.style.userSelect="none"},[_,y,a]);if(r||f)return e.jsxs("div",{className:"flex flex-1 items-center justify-center p-8",children:[e.jsx(fe,{className:"h-8 w-8 animate-spin"}),e.jsx("p",{className:"ml-2 text-muted-foreground",children:"Loading table data..."})]});const j={isSubmitPending:u,isDeletePending:h,expenseToDeleteId:p,onEditClick:d,onSubmitClick:o,onDeleteClick:s,onRowClick:g,expandedRowId:v};return e.jsx("div",{className:pe("w-full overflow-x-auto rounded-md border",l),children:e.jsxs(Ct,{ref:E,className:pe("min-w-full text-sm",c),children:[e.jsx(At,{className:"[&_tr]:border-b-0",children:e.jsxs(Me,{className:"h-8 hover:bg-transparent",children:[" ",a.map(C=>e.jsx(be,{className:pe("relative h-8 px-2 py-1 text-left align-middle font-semibold text-muted-foreground [&:has([role=checkbox])]:pr-0","whitespace-nowrap overflow-hidden text-ellipsis",C.headerClassName,C.className),style:{width:_[C.key],minWidth:C.minWidth||50},children:e.jsxs("div",{className:"flex items-center h-full",children:[e.jsx("span",{className:"flex-1 overflow-hidden text-ellipsis whitespace-nowrap",children:C.header}),e.jsx("div",{className:"absolute right-0 top-0 h-full cursor-col-resize bg-transparent hover:bg-border",style:{width:pi,transform:`translateX(${pi/2}px)`},onMouseDown:D=>N(D,C.key)})]})},C.key))]})}),e.jsx(Pt,{children:t.length===0?e.jsx(Me,{className:"h-8 hover:bg-transparent",children:e.jsx(ve,{colSpan:a.length,className:"h-8 text-center text-muted-foreground px-2 py-1",children:i})}):t.map((C,D)=>m?m(C,D,a,_,j):e.jsxs(Me,{className:"h-8 border-b-0 hover:bg-muted/50",children:[" ",a.map(k=>e.jsxs(ve,{className:pe("h-8 px-2 py-1 align-middle [&:has([role=checkbox])]:pr-0","whitespace-nowrap overflow-hidden text-ellipsis",k.cellClassName,k.className),style:{width:_[k.key],minWidth:k.minWidth||50},title:typeof k.render(C,j)=="string"?k.render(C,j):void 0,children:[Ia(k.render(C,j),_[k.key]-(pi+10))," "]},k.key))]},D))})]})})}const sx=()=>{var I;const n=Ye(),{toast:a}=Ke(),{profile:t,isLoading:r,user:i}=Ie(),l=ns(),[c,m]=T.useState(!1),[u,h]=T.useState(null),[p,d]=T.useState(null),[o,s]=T.useState(""),[g,v]=T.useState("submitted"),[x,y]=T.useState(null),f=t==null?void 0:t.company_id,_=t==null?void 0:t.role,b=i==null?void 0:i.id,{data:E,isLoading:N}=je({queryKey:["expenseModuleSystemId"],queryFn:async()=>{const{data:A,error:V}=await X.from("modules").select("id").eq("name","Expense Management").single();if(V&&V.code!=="PGRST116")throw V;return(A==null?void 0:A.id)||null}}),{data:j,isLoading:C}=je({queryKey:["expenseModuleControllerConfig",f,E],queryFn:async()=>{if(!f||!E)return null;const{data:A,error:V}=await X.from("module_configurations").select("settings").eq("company_id",f).eq("module_id",E).eq("config_key","expense_management_fields").single();if(V&&V.code!=="PGRST116")throw V;return A},enabled:!!f&&!!E&&!r}),D=T.useCallback(A=>{var V,K;return((K=(V=j==null?void 0:j.settings)==null?void 0:V.controller_fields)==null?void 0:K[A])||{visible:!0,required:!1}},[j]),k=T.useMemo(()=>{const A={};return["title","description","amount","expense_date","currency_code","vendor_name","merchant_address","receipt_summary","category_id","gl_account_id","is_reimbursable","project_code","cost_center","line_items","receipt_upload","review_notes"].forEach(K=>{A[K]={visible:!0,required:!1}}),A},[]),w=((I=j==null?void 0:j.settings)==null?void 0:I.controller_fields)||k,{data:S,isLoading:P,error:O,refetch:L}=je({queryKey:["expensesForReview",f],queryFn:async()=>{if(!f||!_||!["admin","controller","super-admin"].includes(_))return[];const{data:A,error:V}=await X.from("expenses").select(`
          *,
          expense_categories (name),
          gl_accounts (account_code, account_name),
          receipts (id, file_url, file_name, mime_type),
          expense_line_items (id, description, quantity, unit_price, line_amount, currency_code)
        `).eq("company_id",f).order("expense_date",{ascending:!1});if(V)throw console.error("Supabase error fetching expenses for review:",V),new Error(V.message);return A.map(K=>{var Q,de,xe;return{...K,category_name:((Q=K.expense_categories)==null?void 0:Q.name)||null,gl_account_code:((de=K.gl_accounts)==null?void 0:de.account_code)||null,gl_account_name:((xe=K.gl_accounts)==null?void 0:xe.account_name)||null}})},enabled:!!f&&!!_&&["admin","controller","super-admin"].includes(_)&&!C}),{data:$,isLoading:B}=je({queryKey:["submitterProfiles",S==null?void 0:S.map(A=>A.submitted_by)],queryFn:async()=>{if(!S||S.length===0)return new Map;const A=[...new Set(S.map(de=>de.submitted_by))],{data:V,error:K}=await X.from("profiles").select("user_id, full_name, email").in("user_id",A);if(K)throw console.error("Supabase error fetching submitter profiles for expenses page:",K),new Error(K.message);const Q=new Map;return V.forEach(de=>Q.set(de.user_id,{full_name:de.full_name,email:de.email})),Q},enabled:!!S&&S.length>0}),Y=T.useMemo(()=>!S||!$?[]:S.map(A=>{var V,K;return{...A,submitter_profile:$.get(A.submitted_by)||null,submitter_full_name:((V=$.get(A.submitted_by))==null?void 0:V.full_name)||null,submitter_email:((K=$.get(A.submitted_by))==null?void 0:K.email)||null}}),[S,$]),U=T.useMemo(()=>{if(!Y)return[];switch(g){case"approved":return Y.filter(A=>A.status==="approved");case"rejected":return Y.filter(A=>A.status==="rejected");case"submitted":return Y.filter(A=>A.status==="submitted");case"info_requested":return Y.filter(A=>A.status==="info_requested");case"all":default:return Y}},[Y,g]),q=Oe({mutationFn:async({expenseId:A,status:V,notes:K})=>{const{data:Q,error:de}=await X.rpc("update_expense_status",{expense_id:A,new_status:V,notes:K});if(de)throw de;return Q},onSuccess:()=>{n.invalidateQueries({queryKey:["expensesForReview"]}),n.invalidateQueries({queryKey:["expenses"]}),n.invalidateQueries({queryKey:["notifications",b]}),a({title:"Expense Status Updated",description:"Expense status has been updated."}),m(!1),h(null),d(null),s("")},onError:A=>{console.error("Error updating expense status:",A),a({title:"Error updating status",description:A.message,variant:"destructive"})}}),R=T.useCallback((A,V)=>{h(A),d(V),m(!0)},[]),F=T.useMemo(()=>[{key:"expand",header:"",render:(A,{expandedRowId:V})=>e.jsx(ee,{variant:"ghost",size:"icon",className:"h-6 w-6",children:V===A.id?e.jsx(Oa,{className:"h-4 w-4"}):e.jsx(Bn,{className:"h-4 w-4"})}),initialWidth:40,minWidth:40,cellClassName:"text-center",headerClassName:"text-center"},{key:"vendor_name",header:"Vendor",render:A=>A.vendor_name||"N/A",initialWidth:150},{key:"amount",header:"Amount",render:A=>e.jsx(xn,{amount:A.amount,currencyCode:A.currency_code}),initialWidth:120},{key:"expense_date",header:"Date",render:A=>at(new Date(A.expense_date),"MM-dd-yy"),initialWidth:120},{key:"category",header:"Category",render:A=>A.category_name||"N/A",initialWidth:150},{key:"submitted_by",header:"Submitted By",render:A=>A.submitter_full_name||A.submitter_email||"N/A",initialWidth:180},{key:"actions",header:"Actions",render:A=>e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(Dt,{to:`/expenses/${A.id}`,children:e.jsx(ee,{variant:"outline",size:"sm",children:e.jsx(mn,{className:"h-4 w-4"})})}),A.status==="submitted"&&e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"bg-brand-green hover:bg-brand-green/90 text-brand-green-foreground",size:"sm",onClick:()=>R(A,"approve"),disabled:q.isPending,children:e.jsx(wn,{className:"h-4 w-4"})}),e.jsx(ee,{variant:"destructive",size:"sm",onClick:()=>R(A,"reject"),disabled:q.isPending,children:e.jsx(Ft,{className:"h-4 w-4"})}),e.jsx(ee,{variant:"outline",size:"sm",onClick:()=>R(A,"request_info"),disabled:q.isPending,children:e.jsx(vr,{className:"h-4 w-4"})})]}),A.status==="info_requested"&&e.jsx(ee,{className:"bg-brand-green hover:bg-brand-green/90 text-brand-green-foreground",size:"sm",onClick:()=>R(A,"approve"),disabled:q.isPending,children:e.jsx(wn,{className:"h-4 w-4"})})]}),initialWidth:200,minWidth:150,cellClassName:"text-right",headerClassName:"text-right"}],[q.isPending,R,x]),M=T.useMemo(()=>g==="all"?[F[0],...F.slice(1,6),{key:"status",header:"Status",render:A=>{let V=null,K="";switch(A.status){case"draft":V="outline",K="bg-gray-100 text-gray-800 border-gray-300";break;case"submitted":V="default",K="bg-blue-100 text-blue-800 border-blue-300 hover:bg-blue-200";break;case"approved":V="default",K="bg-green-100 text-green-800 border-green-300 hover:bg-green-200";break;case"rejected":V="destructive",K="bg-red-100 text-red-800 border-red-300 hover:bg-red-200";break;case"info_requested":V="secondary",K="bg-yellow-100 text-yellow-800 border-yellow-300 hover:bg-yellow-200";break;default:V="secondary";break}return e.jsx(It,{variant:V,className:K,children:A.status.charAt(0).toUpperCase()+A.status.slice(1).replace(/_/g," ")})},initialWidth:100},F[F.length-1]]:F,[F,g]),z=T.useCallback(A=>{y(V=>V===A.id?null:A.id)},[]),H=T.useCallback((A,V,K,Q,de)=>{const xe=de.expandedRowId===A.id,Z=K.length;return e.jsxs(W.Fragment,{children:[e.jsx(Me,{className:pe("h-8 border-b-0 hover:bg-muted/50 cursor-pointer",xe&&"bg-muted/50"),onClick:()=>de.onRowClick(A),children:K.map(re=>e.jsx(ve,{className:pe("h-8 px-2 py-1 align-middle [&:has([role=checkbox])]:pr-0","whitespace-nowrap overflow-hidden text-ellipsis",re.cellClassName,re.className),style:{width:Q[re.key],minWidth:re.minWidth||50},title:typeof re.render(A,de)=="string"?re.render(A,de):void 0,children:Ia(re.render(A,de),Q[re.key]-18)},re.key))}),xe&&e.jsx(Me,{className:"hover:bg-transparent",children:e.jsx(ve,{colSpan:Z,className:"p-0",children:e.jsx(we,{className:"w-full rounded-none border-0 border-t bg-muted/50 shadow-none",children:e.jsx(ke,{className:"p-4",children:e.jsx($n,{expense:A,fieldConfig:w})})})})})]},A.id)},[x,w]);return r||P||B||N||C?e.jsxs("div",{className:"flex flex-1 items-center justify-center",children:[e.jsx(fe,{className:"h-8 w-8 animate-spin"}),e.jsx("p",{className:"ml-2",children:"Loading expenses for review..."})]}):!_||!["admin","controller","super-admin"].includes(_)?e.jsx("div",{className:"flex flex-1 items-center justify-center text-destructive",children:e.jsx("p",{children:"Access Denied: Only Admins, Controllers, or Super Admins can access this page."})}):O?e.jsxs("div",{className:"flex flex-1 items-center justify-center text-destructive",children:[e.jsxs("p",{children:["Error loading expenses for review: ",O.message]}),e.jsx(ee,{onClick:()=>L(),className:"ml-4",children:"Refresh"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(we,{children:[e.jsxs(Ae,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Vl,{className:"h-5 w-5"}),e.jsx(Ee,{children:"Expenses for Review"})]}),e.jsxs(ee,{onClick:()=>L(),variant:"outline",size:"sm",disabled:P||B,children:[e.jsx(fe,{className:pe("mr-2 h-4 w-4",{"animate-spin":P||B})})," Refresh"]})]}),e.jsxs(ke,{children:[e.jsx(Re,{className:"mb-4",children:"A list of expenses submitted by users in your company awaiting your review."}),e.jsxs(dn,{value:g,onValueChange:v,className:"w-full",children:[e.jsxs(sn,{className:"grid w-full grid-cols-5",children:[e.jsx(ze,{value:"all",children:"All"}),e.jsx(ze,{value:"submitted",children:"Submitted"}),e.jsx(ze,{value:"approved",children:"Approved"}),e.jsx(ze,{value:"rejected",children:"Rejected"}),e.jsx(ze,{value:"info_requested",children:"Info Requested"})]}),e.jsx(Ve,{value:"all",className:"mt-4",children:l?e.jsx("div",{className:"grid grid-cols-1 gap-4",children:U.length===0?e.jsx("p",{className:"text-center text-muted-foreground",children:"No expenses found."}):U.map(A=>e.jsxs(we,{className:"p-4",children:[e.jsx($n,{expense:A,fieldConfig:w}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(Dt,{to:`/expenses/${A.id}`,children:e.jsx(ee,{variant:"outline",size:"sm",children:e.jsx(mn,{className:"h-4 w-4"})})}),A.status==="submitted"&&e.jsxs(e.Fragment,{children:[e.jsxs(ee,{className:"bg-brand-green hover:bg-brand-green/90 text-brand-green-foreground",size:"sm",onClick:()=>R(A,"approve"),disabled:q.isPending,children:[e.jsx(wn,{className:"h-4 w-4"})," Approve"]}),e.jsxs(ee,{variant:"destructive",size:"sm",onClick:()=>R(A,"reject"),disabled:q.isPending,children:[e.jsx(Ft,{className:"h-4 w-4"})," Reject"]}),e.jsxs(ee,{variant:"outline",size:"sm",onClick:()=>R(A,"request_info"),disabled:q.isPending,children:[e.jsx(vr,{className:"h-4 w-4"})," Request Info"]})]}),A.status==="info_requested"&&e.jsxs(ee,{className:"bg-brand-green hover:bg-brand-green/90 text-brand-green-foreground",size:"sm",onClick:()=>R(A,"approve"),disabled:q.isPending,children:[e.jsx(wn,{className:"h-4 w-4"})," Approve"]})]})]},A.id))}):e.jsx(pr,{tableId:"expense-review-table-all",columns:M,data:U||[],isLoading:P||B,emptyMessage:"No expenses found.",renderRow:H,onRowClick:z,expandedRowId:x})}),e.jsx(Ve,{value:"submitted",className:"mt-4",children:l?e.jsx("div",{className:"grid grid-cols-1 gap-4",children:U.length===0?e.jsx("p",{className:"text-center text-muted-foreground",children:"No submitted expenses found."}):U.map(A=>e.jsxs(we,{className:"p-4",children:[e.jsx($n,{expense:A,fieldConfig:w}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(Dt,{to:`/expenses/${A.id}`,children:e.jsx(ee,{variant:"outline",size:"sm",children:e.jsx(mn,{className:"h-4 w-4"})})}),e.jsxs(ee,{className:"bg-brand-green hover:bg-brand-green/90 text-brand-green-foreground",size:"sm",onClick:()=>R(A,"approve"),disabled:q.isPending,children:[e.jsx(wn,{className:"h-4 w-4"})," Approve"]}),e.jsxs(ee,{variant:"destructive",size:"sm",onClick:()=>R(A,"reject"),disabled:q.isPending,children:[e.jsx(Ft,{className:"h-4 w-4"})," Reject"]}),e.jsxs(ee,{variant:"outline",size:"sm",onClick:()=>R(A,"request_info"),disabled:q.isPending,children:[e.jsx(vr,{className:"h-4 w-4"})," Request Info"]})]})]},A.id))}):e.jsx(pr,{tableId:"expense-review-table-submitted",columns:M,data:U||[],isLoading:P||B,emptyMessage:"No submitted expenses found.",renderRow:H,onRowClick:z,expandedRowId:x})}),e.jsx(Ve,{value:"approved",className:"mt-4",children:l?e.jsx("div",{className:"grid grid-cols-1 gap-4",children:U.length===0?e.jsx("p",{className:"text-center text-muted-foreground",children:"No approved expenses found."}):U.map(A=>e.jsxs(we,{className:"p-4",children:[e.jsx($n,{expense:A,fieldConfig:w}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(Dt,{to:`/expenses/${A.id}`,children:e.jsx(ee,{variant:"outline",size:"sm",children:e.jsx(mn,{className:"h-4 w-4"})})}),e.jsxs(ee,{className:"bg-brand-green hover:bg-brand-green/90 text-brand-green-foreground",size:"sm",onClick:()=>R(A,"approve"),disabled:q.isPending,children:[e.jsx(wn,{className:"h-4 w-4"})," Approve"]}),e.jsxs(ee,{variant:"destructive",size:"sm",onClick:()=>R(A,"reject"),disabled:q.isPending,children:[e.jsx(Ft,{className:"h-4 w-4"})," Reject"]})]})]},A.id))}):e.jsx(pr,{tableId:"expense-review-table-approved",columns:M,data:U||[],isLoading:P||B,emptyMessage:"No approved expenses found.",renderRow:H,onRowClick:z,expandedRowId:x})}),e.jsx(Ve,{value:"rejected",className:"mt-4",children:l?e.jsx("div",{className:"grid grid-cols-1 gap-4",children:U.length===0?e.jsx("p",{className:"text-center text-muted-foreground",children:"No rejected expenses found."}):U.map(A=>e.jsxs(we,{className:"p-4",children:[e.jsx($n,{expense:A,fieldConfig:w}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(Dt,{to:`/expenses/${A.id}`,children:e.jsx(ee,{variant:"outline",size:"sm",children:e.jsx(mn,{className:"h-4 w-4"})})}),e.jsxs(ee,{className:"bg-brand-green hover:bg-brand-green/90 text-brand-green-foreground",size:"sm",onClick:()=>R(A,"approve"),disabled:q.isPending,children:[e.jsx(wn,{className:"h-4 w-4"})," Approve"]}),e.jsxs(ee,{variant:"destructive",size:"sm",onClick:()=>R(A,"reject"),disabled:q.isPending,children:[e.jsx(Ft,{className:"h-4 w-4"})," Reject"]})]})]},A.id))}):e.jsx(pr,{tableId:"expense-review-table-rejected",columns:M,data:U||[],isLoading:P||B,emptyMessage:"No rejected expenses found.",renderRow:H,onRowClick:z,expandedRowId:x})}),e.jsx(Ve,{value:"info_requested",className:"mt-4",children:l?e.jsx("div",{className:"grid grid-cols-1 gap-4",children:U.length===0?e.jsx("p",{className:"text-center text-muted-foreground",children:"No expenses with information requested."}):U.map(A=>e.jsxs(we,{className:"p-4",children:[e.jsx($n,{expense:A,fieldConfig:w}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(Dt,{to:`/expenses/${A.id}`,children:e.jsx(ee,{variant:"outline",size:"sm",children:e.jsx(mn,{className:"h-4 w-4"})})}),e.jsxs(ee,{className:"bg-brand-green hover:bg-brand-green/90 text-brand-green-foreground",size:"sm",onClick:()=>R(A,"approve"),disabled:q.isPending,children:[e.jsx(wn,{className:"h-4 w-4"})," Approve"]}),e.jsxs(ee,{variant:"destructive",size:"sm",onClick:()=>R(A,"reject"),disabled:q.isPending,children:[e.jsx(Ft,{className:"h-4 w-4"})," Reject"]})]})]},A.id))}):e.jsx(pr,{tableId:"expense-review-table-info-requested",columns:M,data:U||[],isLoading:P||B,emptyMessage:"No expenses with information requested.",renderRow:H,onRowClick:z,expandedRowId:x})})]})]})]}),e.jsx(an,{open:c,onOpenChange:m,children:e.jsxs(zt,{children:[e.jsxs(Bt,{children:[e.jsx($t,{children:p==="approve"?"Approve Expense?":p==="reject"?"Reject Expense?":"Request Information?"}),e.jsx(Ht,{children:p==="approve"?`Are you sure you want to approve this expense (${u==null?void 0:u.title})?`:p==="reject"?`Are you sure you want to reject this expense (${u==null?void 0:u.title})? Please provide a reason.`:`Are you sure you want to request more information for this expense (${u==null?void 0:u.title})? Please provide details for the submitter.`})]}),(D("review_notes").visible||p==="request_info")&&e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(G,{htmlFor:"review-notes",children:[p==="request_info"?"Message to Submitter":"Notes",D("review_notes").required&&p!=="request_info"||p==="request_info"?"*":""]}),e.jsx(Ot,{id:"review-notes",placeholder:p==="request_info"?"Explain what information is needed...":"Add any review notes here...",value:o,onChange:A=>s(A.target.value),disabled:q.isPending}),(D("review_notes").required&&p==="reject"||p==="request_info")&&!o.trim()&&e.jsxs("p",{className:"text-sm text-destructive flex items-center gap-1",children:[e.jsx(xt,{className:"h-3 w-3"}),p==="request_info"?"A message is required to request information.":"Review notes are required to reject this expense."]})]}),e.jsxs(Ut,{children:[e.jsx(Wt,{disabled:q.isPending,children:"Cancel"}),e.jsxs(Vt,{onClick:()=>{let A="";p==="approve"?A="approved":p==="reject"?A="rejected":p==="request_info"&&(A="info_requested"),q.mutate({expenseId:u.id,status:A,notes:o})},disabled:q.isPending||(p==="reject"||p==="request_info")&&!o.trim(),className:p==="reject"?"bg-destructive text-destructive-foreground hover:bg-destructive/90":"",children:[q.isPending?e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}):null,p==="approve"?"Confirm Approve":p==="reject"?"Confirm Reject":"Confirm Request"]})]})]})})]})},ox=tt({name:J().min(1,"Category name is required"),description:J().optional().nullable(),is_active:St().default(!0)}),lx=()=>{const n=Ye(),{toast:a}=Ke(),{profile:t,isLoading:r}=Ie(),[i,l]=T.useState(!1),[c,m]=T.useState(null),[u,h]=T.useState(!1),[p,d]=T.useState(null),o=t==null?void 0:t.company_id,s=t==null?void 0:t.role,{data:g,isLoading:v,isError:x}=je({queryKey:["expense_categories",o],queryFn:async()=>{if(!o)return[];const{data:w,error:S}=await X.from("expense_categories").select("*").eq("company_id",o).order("name",{ascending:!0});if(S)throw S;return w},enabled:!!o}),y=ct({resolver:dt(ox),defaultValues:{name:"",description:"",is_active:!0}});T.useEffect(()=>{i&&c?y.reset({name:c.name,description:c.description||"",is_active:c.is_active}):i||y.reset({name:"",description:"",is_active:!0})},[i,c,y]);const f=Oe({mutationFn:async w=>{if(!o)throw new Error("Company ID not found.");const{data:S,error:P}=await X.from("expense_categories").insert({...w,company_id:o}).select().single();if(P)throw P;return S},onSuccess:()=>{n.invalidateQueries({queryKey:["expense_categories"]}),a({title:"Category Created",description:"New expense category added."}),l(!1)},onError:w=>{a({title:"Error creating category",description:w.message,variant:"destructive"})}}),_=Oe({mutationFn:async w=>{if(!o)throw new Error("Company ID not found.");const{id:S,...P}=w,{error:O}=await X.from("expense_categories").update({...P,updated_at:new Date().toISOString()}).eq("id",S).eq("company_id",o);if(O)throw O;return null},onSuccess:()=>{n.invalidateQueries({queryKey:["expense_categories"]}),a({title:"Category Updated",description:"Expense category updated."}),l(!1)},onError:w=>{a({title:"Error updating category",description:w.message,variant:"destructive"})}}),b=Oe({mutationFn:async w=>{if(!o)throw new Error("Company ID not found.");const{error:S}=await X.from("expense_categories").delete().eq("id",w).eq("company_id",o);if(S)throw S;return null},onSuccess:()=>{n.invalidateQueries({queryKey:["expense_categories"]}),a({title:"Category Deleted",description:"Expense category deleted."}),h(!1),d(null)},onError:w=>{a({title:"Error deleting category",description:w.message,variant:"destructive"})}}),E=w=>{c?_.mutate({...w,id:c.id}):f.mutate(w)},N=()=>{m(null),l(!0)},j=w=>{m(w),l(!0)},C=w=>{d(w),h(!0)},D=()=>{p&&b.mutate(p.id)},k=f.isPending||_.isPending||b.isPending;return r||v?e.jsxs("div",{className:"flex flex-1 items-center justify-center",children:[e.jsx(fe,{className:"h-8 w-8 animate-spin"}),e.jsx("p",{className:"ml-2",children:"Loading expense categories..."})]}):!s||!["admin","super-admin"].includes(s)?e.jsx("div",{className:"flex flex-1 items-center justify-center text-destructive",children:e.jsx("p",{children:"Access Denied: Only Admins or Super Admins can manage expense categories."})}):x?e.jsx("div",{className:"flex flex-1 items-center justify-center text-destructive",children:e.jsx("p",{children:"Error loading expense categories. Please try again."})}):e.jsxs(e.Fragment,{children:[e.jsxs(we,{children:[e.jsxs(Ae,{className:"flex flex-row items-start justify-between space-y-0 pb-2",children:[e.jsxs("div",{children:[e.jsxs(Ee,{className:"flex items-center gap-2",children:[e.jsx(Wl,{className:"h-5 w-5"})," Expense Categories"]}),e.jsx(Re,{children:"Manage the categories used for classifying expenses in your company."})]}),e.jsxs(vt,{open:i,onOpenChange:l,children:[e.jsx(ir,{asChild:!0,children:e.jsxs(ee,{onClick:N,children:[e.jsx(Kt,{className:"mr-2 h-4 w-4"})," Add New Category"]})}),e.jsxs(ut,{className:"sm:max-w-[425px]",children:[e.jsxs(_t,{children:[e.jsx(jt,{children:c?"Edit Expense Category":"Add New Expense Category"}),e.jsx(Et,{children:c?"Update the details of this expense category.":"Define a new category for your company's expenses."})]}),e.jsxs("form",{onSubmit:y.handleSubmit(E),className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(G,{htmlFor:"name",className:"text-right",children:"Name"}),e.jsx(ne,{id:"name",...y.register("name"),className:"col-span-3",disabled:k}),y.formState.errors.name&&e.jsx("p",{className:"col-span-4 text-right text-sm text-destructive",children:y.formState.errors.name.message})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(G,{htmlFor:"description",className:"text-right",children:"Description"}),e.jsx(Ot,{id:"description",...y.register("description"),className:"col-span-3",disabled:k})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(G,{htmlFor:"is_active",className:"text-right",children:"Active"}),e.jsx(bt,{id:"is_active",checked:y.watch("is_active"),onCheckedChange:w=>y.setValue("is_active",w),className:"col-span-3",disabled:k})]}),e.jsxs(ee,{type:"submit",disabled:k,children:[k&&e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}),c?"Update Category":"Create Category"]})]})]})]})]}),e.jsx(ke,{children:e.jsxs(Ct,{children:[e.jsx(At,{children:e.jsxs(Me,{children:[e.jsx(be,{children:"Name"}),e.jsx(be,{children:"Description"}),e.jsx(be,{children:"Active"}),e.jsx(be,{className:"text-right",children:"Actions"})]})}),e.jsx(Pt,{children:(g==null?void 0:g.length)===0?e.jsx(Me,{children:e.jsx(ve,{colSpan:4,className:"text-center text-muted-foreground",children:"No expense categories defined."})}):g==null?void 0:g.map(w=>e.jsxs(Me,{children:[e.jsx(ve,{className:"font-medium",children:w.name}),e.jsx(ve,{children:w.description||"N/A"}),e.jsx(ve,{children:w.is_active?"Yes":"No"}),e.jsxs(ve,{className:"text-right space-x-2",children:[e.jsxs(ee,{variant:"outline",size:"sm",onClick:()=>j(w),children:[e.jsx(rn,{className:"h-4 w-4 mr-1"})," Edit"]}),e.jsxs(ee,{variant:"destructive",size:"sm",onClick:()=>C(w),disabled:k,children:[k&&(p==null?void 0:p.id)===w.id?e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(qt,{className:"h-4 w-4 mr-1"}),"Delete"]})]})]},w.id))})]})})]}),e.jsx(an,{open:u,onOpenChange:h,children:e.jsxs(zt,{children:[e.jsxs(Bt,{children:[e.jsx($t,{children:"Are you absolutely sure?"}),e.jsxs(Ht,{children:['This action cannot be undone. This will permanently delete the expense category "',p==null?void 0:p.name,'".']})]}),e.jsxs(Ut,{children:[e.jsx(Wt,{disabled:k,children:"Cancel"}),e.jsxs(Vt,{onClick:D,disabled:k,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:[k?e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Delete"]})]})]})})]})},cx=tt({account_code:J().min(1,"Account code is required"),account_name:J().min(1,"Account name is required"),account_type:J().min(1,"Account type is required"),is_active:St().default(!0)}),dx=()=>{const n=Ye(),{toast:a}=Ke(),{profile:t,isLoading:r}=Ie(),[i,l]=T.useState(!1),[c,m]=T.useState(null),[u,h]=T.useState(!1),[p,d]=T.useState(null),o=t==null?void 0:t.company_id,s=t==null?void 0:t.role,{data:g,isLoading:v,isError:x}=je({queryKey:["gl_accounts",o],queryFn:async()=>{if(!o)return[];const{data:w,error:S}=await X.from("gl_accounts").select("*").eq("company_id",o).order("account_code",{ascending:!0});if(S)throw S;return w},enabled:!!o}),y=ct({resolver:dt(cx),defaultValues:{account_code:"",account_name:"",account_type:"",is_active:!0}});T.useEffect(()=>{i&&c?y.reset({account_code:c.account_code,account_name:c.account_name,account_type:c.account_type,is_active:c.is_active}):i||y.reset({account_code:"",account_name:"",account_type:"",is_active:!0})},[i,c,y]);const f=Oe({mutationFn:async w=>{if(!o)throw new Error("Company ID not found.");const{data:S,error:P}=await X.from("gl_accounts").insert({...w,company_id:o}).select().single();if(P)throw P;return S},onSuccess:()=>{n.invalidateQueries({queryKey:["gl_accounts"]}),a({title:"GL Account Created",description:"New GL account added."}),l(!1)},onError:w=>{a({title:"Error creating GL account",description:w.message,variant:"destructive"})}}),_=Oe({mutationFn:async w=>{if(!o)throw new Error("Company ID not found.");const{id:S,...P}=w,{error:O}=await X.from("gl_accounts").update({...P,updated_at:new Date().toISOString()}).eq("id",S).eq("company_id",o);if(O)throw O;return null},onSuccess:()=>{n.invalidateQueries({queryKey:["gl_accounts"]}),a({title:"GL Account Updated",description:"GL account updated."}),l(!1)},onError:w=>{a({title:"Error updating GL account",description:w.message,variant:"destructive"})}}),b=Oe({mutationFn:async w=>{if(!o)throw new Error("Company ID not found.");const{error:S}=await X.from("gl_accounts").delete().eq("id",w).eq("company_id",o);if(S)throw S;return null},onSuccess:()=>{n.invalidateQueries({queryKey:["gl_accounts"]}),a({title:"GL Account Deleted",description:"GL account deleted."}),h(!1),d(null)},onError:w=>{a({title:"Error deleting GL account",description:w.message,variant:"destructive"})}}),E=w=>{c?_.mutate({...w,id:c.id}):f.mutate(w)},N=()=>{m(null),l(!0)},j=w=>{m(w),l(!0)},C=w=>{d(w),h(!0)},D=()=>{p&&b.mutate(p.id)},k=f.isPending||_.isPending||b.isPending;return r||v?e.jsxs("div",{className:"flex flex-1 items-center justify-center",children:[e.jsx(fe,{className:"h-8 w-8 animate-spin"}),e.jsx("p",{className:"ml-2",children:"Loading GL accounts..."})]}):!s||!["admin","super-admin"].includes(s)?e.jsx("div",{className:"flex flex-1 items-center justify-center text-destructive",children:e.jsx("p",{children:"Access Denied: Only Admins or Super Admins can manage GL accounts."})}):x?e.jsx("div",{className:"flex flex-1 items-center justify-center text-destructive",children:e.jsx("p",{children:"Error loading GL accounts. Please try again."})}):e.jsxs(e.Fragment,{children:[e.jsxs(we,{children:[e.jsxs(Ae,{className:"flex flex-row items-start justify-between space-y-0 pb-2",children:[e.jsxs("div",{children:[e.jsxs(Ee,{className:"flex items-center gap-2",children:[e.jsx(Si,{className:"h-5 w-5"})," General Ledger Accounts"]}),e.jsx(Re,{children:"Manage the General Ledger accounts for your company."})]}),e.jsxs(vt,{open:i,onOpenChange:l,children:[e.jsx(ir,{asChild:!0,children:e.jsxs(ee,{onClick:N,children:[e.jsx(Kt,{className:"mr-2 h-4 w-4"})," Add New GL Account"]})}),e.jsxs(ut,{className:"sm:max-w-[425px]",children:[e.jsxs(_t,{children:[e.jsx(jt,{children:c?"Edit GL Account":"Add New GL Account"}),e.jsx(Et,{children:c?"Update the details of this General Ledger account.":"Define a new General Ledger account for your company."})]}),e.jsxs("form",{onSubmit:y.handleSubmit(E),className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(G,{htmlFor:"account_code",className:"text-right",children:"Code"}),e.jsx(ne,{id:"account_code",...y.register("account_code"),className:"col-span-3",disabled:k}),y.formState.errors.account_code&&e.jsx("p",{className:"col-span-4 text-right text-sm text-destructive",children:y.formState.errors.account_code.message})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(G,{htmlFor:"account_name",className:"text-right",children:"Name"}),e.jsx(ne,{id:"account_name",...y.register("account_name"),className:"col-span-3",disabled:k}),y.formState.errors.account_name&&e.jsx("p",{className:"col-span-4 text-right text-sm text-destructive",children:y.formState.errors.account_name.message})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(G,{htmlFor:"account_type",className:"text-right",children:"Type"}),e.jsxs(Je,{onValueChange:w=>y.setValue("account_type",w),value:y.watch("account_type"),disabled:k,children:[e.jsx(Qe,{className:"col-span-3",children:e.jsx(et,{placeholder:"Select account type"})}),e.jsxs(Xe,{children:[e.jsx(Ue,{value:"Asset",children:"Asset"}),e.jsx(Ue,{value:"Liability",children:"Liability"}),e.jsx(Ue,{value:"Equity",children:"Equity"}),e.jsx(Ue,{value:"Revenue",children:"Revenue"}),e.jsx(Ue,{value:"Expense",children:"Expense"})]})]}),y.formState.errors.account_type&&e.jsx("p",{className:"col-span-4 text-right text-sm text-destructive",children:y.formState.errors.account_type.message})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(G,{htmlFor:"is_active",className:"text-right",children:"Active"}),e.jsx(bt,{id:"is_active",checked:y.watch("is_active"),onCheckedChange:w=>y.setValue("is_active",w),className:"col-span-3",disabled:k})]}),e.jsxs(ee,{type:"submit",disabled:k,children:[k&&e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}),c?"Update Account":"Create Account"]})]})]})]})]}),e.jsx(ke,{children:e.jsxs(Ct,{children:[e.jsx(At,{children:e.jsxs(Me,{children:[e.jsx(be,{children:"Code"}),e.jsx(be,{children:"Name"}),e.jsx(be,{children:"Type"}),e.jsx(be,{children:"Active"}),e.jsx(be,{className:"text-right",children:"Actions"})]})}),e.jsx(Pt,{children:(g==null?void 0:g.length)===0?e.jsx(Me,{children:e.jsx(ve,{colSpan:5,className:"text-center text-muted-foreground",children:"No GL accounts defined."})}):g==null?void 0:g.map(w=>e.jsxs(Me,{children:[e.jsx(ve,{className:"font-medium",children:w.account_code}),e.jsx(ve,{children:w.account_name}),e.jsx(ve,{children:w.account_type}),e.jsx(ve,{children:w.is_active?"Yes":"No"}),e.jsxs(ve,{className:"text-right space-x-2",children:[e.jsxs(ee,{variant:"outline",size:"sm",onClick:()=>j(w),children:[e.jsx(rn,{className:"h-4 w-4 mr-1"})," Edit"]}),e.jsxs(ee,{variant:"destructive",size:"sm",onClick:()=>C(w),disabled:k,children:[k&&(p==null?void 0:p.id)===w.id?e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(qt,{className:"h-4 w-4 mr-1"}),"Delete"]})]})]},w.id))})]})})]}),e.jsx(an,{open:u,onOpenChange:h,children:e.jsxs(zt,{children:[e.jsxs(Bt,{children:[e.jsx($t,{children:"Are you absolutely sure?"}),e.jsxs(Ht,{children:['This action cannot be undone. This will permanently delete the GL account "',p==null?void 0:p.account_name,'".']})]}),e.jsxs(Ut,{children:[e.jsx(Wt,{disabled:k,children:"Cancel"}),e.jsxs(Vt,{onClick:D,disabled:k,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:[k?e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Delete"]})]})]})})]})},ux=()=>{const n=Ye(),{toast:a}=Ke(),{profile:t,isLoading:r}=Ie(),i=t==null?void 0:t.user_id,[l,c]=T.useState("all"),[m,u]=T.useState(null),{data:h,isLoading:p,isError:d,refetch:o}=je({queryKey:["notifications",i],queryFn:async()=>{if(!i)return[];const{data:N,error:j}=await X.from("expense_notifications").select(`
          *,
          expenses (title)
        `).eq("user_id",i).order("created_at",{ascending:!1});if(j)throw j;return N.map(D=>({...D,expenses:D.expenses&&D.expenses.length>0?D.expenses[0]:null}))},enabled:!!i}),s=T.useMemo(()=>{if(!h)return[];switch(l){case"unread":return h.filter(N=>!N.is_read&&!N.is_archived);case"read":return h.filter(N=>N.is_read&&!N.is_archived);case"archive":return h.filter(N=>N.is_archived);case"all":default:return h.filter(N=>!N.is_archived)}},[h,l]),g=Oe({mutationFn:async N=>{const{error:j}=await X.from("expense_notifications").update({is_read:!0}).eq("id",N).eq("user_id",i);if(j)throw j;return null},onSuccess:()=>{n.invalidateQueries({queryKey:["notifications",i]}),n.invalidateQueries({queryKey:["unreadNotifications",i]}),a({title:"Notification Marked as Read",description:"The notification has been marked as read."})},onError:N=>{a({title:"Error marking notification as read",description:N.message||"An unexpected error occurred.",variant:"destructive"})}}),v=Oe({mutationFn:async N=>{const{error:j}=await X.from("expense_notifications").update({is_archived:!0,is_read:!0}).eq("id",N).eq("user_id",i);if(j)throw j;return null},onSuccess:()=>{n.invalidateQueries({queryKey:["notifications",i]}),n.invalidateQueries({queryKey:["unreadNotifications",i]}),a({title:"Notification Cleared",description:"The notification has been moved to archive."})},onError:N=>{a({title:"Error clearing notification",description:N.message||"An unexpected error occurred.",variant:"destructive"})}}),x=Oe({mutationFn:async N=>{const{error:j}=await X.from("expense_notifications").update({is_archived:!1,is_read:!0}).eq("id",N).eq("user_id",i);if(j)throw j;return null},onSuccess:()=>{n.invalidateQueries({queryKey:["notifications",i]}),n.invalidateQueries({queryKey:["unreadNotifications",i]}),a({title:"Notification Unarchived",description:"The notification has been moved out of archive."})},onError:N=>{a({title:"Error unarchiving notification",description:N.message||"An unexpected error occurred.",variant:"destructive"})}}),y=Oe({mutationFn:async({notificationId:N,isFlagged:j})=>{const{error:C}=await X.from("expense_notifications").update({is_flagged:j}).eq("id",N).eq("user_id",i);if(C)throw C;return null},onSuccess:()=>{n.invalidateQueries({queryKey:["notifications",i]}),a({title:"Notification Flagged",description:"The notification flag status has been updated."})},onError:N=>{a({title:"Error flagging notification",description:N.message||"An unexpected error occurred.",variant:"destructive"})}}),f=T.useCallback(N=>{u(j=>j===N?null:N)},[]),_=N=>N.replace(/_/g," ").split(" ").map(j=>j.charAt(0).toUpperCase()+j.slice(1)).join(" "),b=T.useMemo(()=>[{key:"expand",header:"",render:N=>e.jsx(ee,{variant:"ghost",size:"icon",className:"h-6 w-6",children:m===N.id?e.jsx(Oa,{className:"h-4 w-4"}):e.jsx(Bn,{className:"h-4 w-4"})}),initialWidth:40,minWidth:40,cellClassName:"text-center",headerClassName:"text-center"},{key:"type",header:"Type",render:N=>e.jsx(It,{variant:"secondary",className:"bg-gray-100 text-gray-800 border-gray-300",children:_(N.type)}),initialWidth:150},{key:"title",header:"Title",render:N=>e.jsxs("div",{className:"flex items-center gap-2",children:[N.is_flagged&&e.jsx(ei,{className:"h-4 w-4 text-yellow-500"}),N.title]}),initialWidth:400},{key:"actions",header:"Actions",render:N=>e.jsxs("div",{className:"flex space-x-2 justify-end",children:[l!=="archive"&&!N.is_read&&e.jsx(ee,{variant:"outline",size:"sm",onClick:j=>{j.stopPropagation(),g.mutate(N.id)},disabled:g.isPending,children:e.jsx(wn,{className:"h-4 w-4"})}),e.jsx(ee,{variant:"outline",size:"sm",onClick:j=>{j.stopPropagation(),y.mutate({notificationId:N.id,isFlagged:!N.is_flagged})},disabled:y.isPending,children:e.jsx(ei,{className:pe("h-4 w-4",N.is_flagged?"text-yellow-500 fill-yellow-500":"text-muted-foreground")})}),l!=="archive"?e.jsxs(ee,{variant:"destructive",size:"sm",onClick:j=>{j.stopPropagation(),v.mutate(N.id)},disabled:v.isPending,children:[e.jsx(Hu,{className:"h-4 w-4"})," "]}):e.jsx(ee,{variant:"outline",size:"sm",onClick:j=>{j.stopPropagation(),x.mutate(N.id)},disabled:x.isPending,children:e.jsx(Vu,{className:"h-4 w-4"})})]}),initialWidth:200,minWidth:150,cellClassName:"text-right",headerClassName:"text-right"}],[m,g.isPending,v.isPending,x.isPending,y.isPending,f,l]),E=T.useCallback((N,j,C,D,k)=>{var P;const w=m===N.id,S=C.length;return e.jsxs(W.Fragment,{children:[e.jsxs(Me,{className:pe("h-8 border-b-0 hover:bg-muted/50 cursor-pointer",w&&"bg-muted/50",!N.is_read&&"bg-blue-50/50 dark:bg-blue-950/20"),onClick:()=>f(N.id),children:[!N.is_read&&e.jsx("span",{className:"absolute left-0 top-1/2 -translate-y-1/2 h-2 w-2 rounded-full bg-blue-500 ml-1"}),C.map(O=>e.jsx(ve,{className:pe("h-8 px-2 py-1 align-middle [&:has([role=checkbox])]:pr-0","whitespace-nowrap overflow-hidden text-ellipsis",O.cellClassName,O.className,O.key==="expand"&&!N.is_read&&"pl-4"),style:{width:D[O.key],minWidth:O.minWidth||50},title:typeof O.render(N,k)=="string"?O.render(N,k):void 0,children:Ia(O.render(N,k),D[O.key]-(O.key==="expand"&&!N.is_read?20:18))},O.key))]}),w&&e.jsx(Me,{className:"hover:bg-transparent",children:e.jsx(ve,{colSpan:S,className:"p-0",children:e.jsx(we,{className:"w-full rounded-none border-0 border-t bg-muted/50 shadow-none",children:e.jsxs(ke,{className:"p-4 grid gap-3 text-sm",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-muted-foreground",children:"Status"}),e.jsx(It,{variant:N.is_read?"outline":"default",children:N.is_read?"Read":"Unread"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-muted-foreground",children:"Received"}),e.jsx("p",{children:at(new Date(N.created_at),"PPP p")}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["(",Kl(new Date(N.created_at),{addSuffix:!0}),")"]})]})]}),N.is_flagged&&e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-muted-foreground flex items-center gap-1",children:[e.jsx(ei,{className:"h-4 w-4 text-yellow-500"})," Flagged"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This notification has been flagged for follow-up."})]}),e.jsxs("div",{className:"col-span-full",children:[e.jsx("p",{className:"font-medium text-muted-foreground",children:"Message"}),e.jsx("p",{className:"whitespace-pre-wrap",children:N.message})]}),((P=N.expenses)==null?void 0:P.title)&&e.jsxs("div",{className:"col-span-full",children:[e.jsx("p",{className:"font-medium text-muted-foreground",children:"Related Expense"}),e.jsx(Dt,{to:`/expenses/${N.expense_id}`,className:"text-blue-600 hover:underline",children:N.expenses.title})]})]})})})})]},N.id)},[m,f]);return r||p?e.jsxs("div",{className:"flex flex-1 items-center justify-center",children:[e.jsx(fe,{className:"h-8 w-8 animate-spin"}),e.jsx("p",{className:"ml-2",children:"Loading notifications..."})]}):d?e.jsxs("div",{className:"flex flex-1 items-center justify-center text-destructive",children:[e.jsx("p",{children:"Error loading notifications. Please try again."}),e.jsx(ee,{onClick:()=>o(),className:"ml-4",children:"Refresh"})]}):e.jsx(e.Fragment,{children:e.jsxs(we,{children:[e.jsxs(Ae,{className:"flex flex-row items-start justify-between space-y-0 pb-2",children:[e.jsxs("div",{children:[e.jsxs(Ee,{className:"flex items-center gap-2",children:[e.jsx(La,{className:"h-5 w-5"})," My Notifications"]}),e.jsx(Re,{children:"Manage all your system notifications."})]}),e.jsxs(ee,{onClick:()=>o(),variant:"outline",size:"sm",disabled:p,children:[e.jsx(fe,{className:pe("mr-2 h-4 w-4",{"animate-spin":p})})," Refresh"]})]}),e.jsx(ke,{children:e.jsxs(dn,{value:l,onValueChange:c,className:"w-full",children:[e.jsxs(sn,{className:"grid w-full grid-cols-4",children:[e.jsx(ze,{value:"all",children:"All"}),e.jsx(ze,{value:"unread",children:"Unread"}),e.jsx(ze,{value:"read",children:"Read"}),e.jsx(ze,{value:"archive",children:"Archive"})]}),e.jsx(Ve,{value:l,className:"mt-4",children:e.jsx(pr,{tableId:"notifications-table",columns:b,data:s||[],isLoading:p,emptyMessage:"No notifications found.",renderRow:E})})]})})]})})},mx=()=>{const[n]=Ui(),a=kn(),{toast:t}=Ke(),{session:r,isLoading:i}=Ie(),l=Ye(),[c,m]=T.useState("idle"),[u,h]=T.useState(null),p=n.get("token");T.useEffect(()=>{i||(async()=>{var s;if(!p){m("error"),h("No invitation token found in the URL."),t({title:"Error",description:"No invitation token found.",variant:"destructive"});return}if(r){m("processing");const{data:g,error:v}=await X.rpc("accept_invitation",{invitation_token:p});if(v)m("error"),h(v.message||"Failed to accept invitation due to a server error."),t({title:"Error accepting invitation",description:v.message||"An unexpected server error occurred.",variant:"destructive"});else if(g&&typeof g=="object"&&"success"in g)if(g.success){m("success"),t({title:"Invitation Accepted!",description:"You have successfully joined the company."}),(s=r.user)!=null&&s.id&&l.invalidateQueries({queryKey:["profiles",r.user.id]});const{data:x,error:y}=await X.auth.refreshSession();y?(console.error("Error refreshing session after invitation acceptance:",y),t({title:"Session Refresh Error",description:"Please log out and log back in to ensure full access.",variant:"destructive"})):console.log("Session refreshed successfully after invitation acceptance."),a("/",{replace:!0})}else m("error"),h(g.error_message||"Failed to accept invitation."),t({title:"Error accepting invitation",description:g.error_message||"An unexpected error occurred.",variant:"destructive"});else m("error"),h("Received an unexpected response from the invitation service."),t({title:"Error accepting invitation",description:"Received an unexpected response from the invitation service.",variant:"destructive"})}else c==="idle"&&m("idle")})()},[p,r,i,a,t,c,l]);const d=()=>i||c==="processing"?e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(fe,{className:"h-12 w-12 animate-spin text-brand-accent"}),e.jsx("p",{className:"text-lg text-muted-foreground",children:"Processing your invitation..."})]}):c==="success"?e.jsxs("div",{className:"flex flex-col items-center gap-4 text-center",children:[e.jsx(ua,{className:"h-12 w-12 text-green-500"}),e.jsx(Ee,{className:"text-2xl",children:"Invitation Accepted!"}),e.jsx(Re,{children:"You've successfully joined the company. Redirecting to your dashboard..."})]}):c==="error"?e.jsxs("div",{className:"flex flex-col items-center gap-4 text-center",children:[e.jsx(Ft,{className:"h-12 w-12 text-destructive"}),e.jsx(Ee,{className:"text-2xl",children:"Invitation Error"}),e.jsx(Re,{children:u||"There was an issue accepting your invitation."}),e.jsx(ee,{onClick:()=>a("/login"),className:"mt-4",children:"Go to Login"})]}):!r&&p?e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-2xl font-bold text-center mb-6 text-gray-900 dark:text-white",children:"Accept Invitation"}),e.jsx(Re,{className:"text-center mb-4",children:"Please sign up or log in to accept your invitation."}),e.jsx(ar,{supabaseClient:X,providers:[],appearance:{theme:fc,variables:{default:{colors:{brand:"hsl(var(--brand-accent))",brandAccent:"hsl(var(--brand-accent-foreground))"}}}},theme:"light",redirectTo:window.location.origin+`/accept-invite?token=${p}`,view:"sign_up"})]}):e.jsxs("div",{className:"flex flex-col items-center gap-4 text-center",children:[e.jsx(Ee,{className:"text-2xl",children:"Invalid Access"}),e.jsx(Re,{children:"Please use a valid invitation link."}),e.jsx(ee,{onClick:()=>a("/login"),className:"mt-4",children:"Go to Login"})]});return e.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gray-100 dark:bg-gray-900 p-4",children:e.jsx("div",{className:"w-full max-w-md bg-white dark:bg-gray-800 p-8 rounded-lg shadow-md",children:d()})})},px=()=>{const{profile:n,isLoading:a}=Ie(),t=(n==null?void 0:n.role)==="super-admin",{data:r,isLoading:i,isError:l}=je({queryKey:["billingRecords"],queryFn:async()=>{if(!t)return[];const{data:c,error:m}=await X.from("billing_records").select(`
          *,
          companies (name, default_currency)
        `).order("billing_period_end",{ascending:!1});if(m)throw m;return c.map(h=>({...h,companies:h.companies&&h.companies.length>0?h.companies[0]:null}))},enabled:t});return a||i?e.jsxs("div",{className:"flex flex-1 items-center justify-center",children:[e.jsx(fe,{className:"h-8 w-8 animate-spin"}),e.jsx("p",{className:"ml-2",children:"Loading billing records..."})]}):t?l?e.jsx("div",{className:"flex flex-1 items-center justify-center text-destructive",children:e.jsx("p",{children:"Error loading billing records. Please try again."})}):e.jsx(e.Fragment,{children:e.jsxs(we,{children:[e.jsxs(Ae,{children:[e.jsxs(Ee,{className:"flex items-center gap-2",children:[e.jsx(Yl,{className:"h-5 w-5"})," Billing Records"]}),e.jsx(Re,{children:"Overview of all company billing records."})]}),e.jsx(ke,{children:e.jsxs(Ct,{children:[e.jsx(At,{children:e.jsxs(Me,{children:[e.jsx(be,{children:"Company"}),e.jsx(be,{children:"Period Start"}),e.jsx(be,{children:"Period End"}),e.jsx(be,{children:"Amount"}),e.jsx(be,{children:"Status"}),e.jsx(be,{children:"Created At"})]})}),e.jsx(Pt,{children:(r==null?void 0:r.length)===0?e.jsx(Me,{children:e.jsx(ve,{colSpan:6,className:"text-center text-muted-foreground",children:"No billing records found."})}):r==null?void 0:r.map(c=>{var m,u;return e.jsxs(Me,{children:[e.jsx(ve,{className:"font-medium",children:((m=c.companies)==null?void 0:m.name)||"N/A"}),e.jsx(ve,{children:at(new Date(c.billing_period_start),"PPP")}),e.jsx(ve,{children:at(new Date(c.billing_period_end),"PPP")}),e.jsx(ve,{children:e.jsx(xn,{amount:c.total_amount,currencyCode:((u=c.companies)==null?void 0:u.default_currency)||"USD"})}),e.jsx(ve,{children:e.jsx(It,{variant:"secondary",children:c.status})}),e.jsx(ve,{children:at(new Date(c.created_at),"PPP")})]},c.id)})})]})})]})}):e.jsx("div",{className:"flex flex-1 items-center justify-center text-destructive",children:e.jsx("p",{children:"Access Denied: Only Super Admins can access this page."})})};var ed=["PageUp","PageDown"],td=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],nd={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},Pr="Slider",[Mi,fx,hx]=hu(Pr),[rd,__]=xl(Pr,[hx]),[gx,Wa]=rd(Pr),ad=T.forwardRef((n,a)=>{const{name:t,min:r=0,max:i=100,step:l=1,orientation:c="horizontal",disabled:m=!1,minStepsBetweenThumbs:u=0,defaultValue:h=[r],value:p,onValueChange:d=()=>{},onValueCommit:o=()=>{},inverted:s=!1,form:g,...v}=n,x=T.useRef(new Set),y=T.useRef(0),_=c==="horizontal"?vx:xx,[b=[],E]=vl({prop:p,defaultProp:h,onChange:w=>{var P;(P=[...x.current][y.current])==null||P.focus(),d(w)}}),N=T.useRef(b);function j(w){const S=wx(b,w);k(w,S)}function C(w){k(w,y.current)}function D(){const w=N.current[y.current];b[y.current]!==w&&o(b)}function k(w,S,{commit:P}={commit:!1}){const O=kx(l),L=Cx(Math.round((w-r)/l)*l+r,O),$=Ll(L,[r,i]);E((B=[])=>{const Y=_x(B,$,S);if(Ex(Y,u*l)){y.current=Y.indexOf($);const U=String(Y)!==String(B);return U&&P&&o(Y),U?Y:B}else return B})}return e.jsx(gx,{scope:n.__scopeSlider,name:t,disabled:m,min:r,max:i,valueIndexToChangeRef:y,thumbs:x.current,values:b,orientation:c,form:g,children:e.jsx(Mi.Provider,{scope:n.__scopeSlider,children:e.jsx(Mi.Slot,{scope:n.__scopeSlider,children:e.jsx(_,{"aria-disabled":m,"data-disabled":m?"":void 0,...v,ref:a,onPointerDown:Vn(v.onPointerDown,()=>{m||(N.current=b)}),min:r,max:i,inverted:s,onSlideStart:m?void 0:j,onSlideMove:m?void 0:C,onSlideEnd:m?void 0:D,onHomeKeyDown:()=>!m&&k(r,0,{commit:!0}),onEndKeyDown:()=>!m&&k(i,b.length-1,{commit:!0}),onStepKeyDown:({event:w,direction:S})=>{if(!m){const L=ed.includes(w.key)||w.shiftKey&&td.includes(w.key)?10:1,$=y.current,B=b[$],Y=l*L*S;k(B+Y,$,{commit:!0})}}})})})})});ad.displayName=Pr;var[id,sd]=rd(Pr,{startEdge:"left",endEdge:"right",size:"width",direction:1}),vx=T.forwardRef((n,a)=>{const{min:t,max:r,dir:i,inverted:l,onSlideStart:c,onSlideMove:m,onSlideEnd:u,onStepKeyDown:h,...p}=n,[d,o]=T.useState(null),s=Cr(a,_=>o(_)),g=T.useRef(void 0),v=gu(i),x=v==="ltr",y=x&&!l||!x&&l;function f(_){const b=g.current||d.getBoundingClientRect(),E=[0,b.width],j=hs(E,y?[t,r]:[r,t]);return g.current=b,j(_-b.left)}return e.jsx(id,{scope:n.__scopeSlider,startEdge:y?"left":"right",endEdge:y?"right":"left",direction:y?1:-1,size:"width",children:e.jsx(od,{dir:v,"data-orientation":"horizontal",...p,ref:s,style:{...p.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:_=>{const b=f(_.clientX);c==null||c(b)},onSlideMove:_=>{const b=f(_.clientX);m==null||m(b)},onSlideEnd:()=>{g.current=void 0,u==null||u()},onStepKeyDown:_=>{const E=nd[y?"from-left":"from-right"].includes(_.key);h==null||h({event:_,direction:E?-1:1})}})})}),xx=T.forwardRef((n,a)=>{const{min:t,max:r,inverted:i,onSlideStart:l,onSlideMove:c,onSlideEnd:m,onStepKeyDown:u,...h}=n,p=T.useRef(null),d=Cr(a,p),o=T.useRef(void 0),s=!i;function g(v){const x=o.current||p.current.getBoundingClientRect(),y=[0,x.height],_=hs(y,s?[r,t]:[t,r]);return o.current=x,_(v-x.top)}return e.jsx(id,{scope:n.__scopeSlider,startEdge:s?"bottom":"top",endEdge:s?"top":"bottom",size:"height",direction:s?1:-1,children:e.jsx(od,{"data-orientation":"vertical",...h,ref:d,style:{...h.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:v=>{const x=g(v.clientY);l==null||l(x)},onSlideMove:v=>{const x=g(v.clientY);c==null||c(x)},onSlideEnd:()=>{o.current=void 0,m==null||m()},onStepKeyDown:v=>{const y=nd[s?"from-bottom":"from-top"].includes(v.key);u==null||u({event:v,direction:y?-1:1})}})})}),od=T.forwardRef((n,a)=>{const{__scopeSlider:t,onSlideStart:r,onSlideMove:i,onSlideEnd:l,onHomeKeyDown:c,onEndKeyDown:m,onStepKeyDown:u,...h}=n,p=Wa(Pr,t);return e.jsx(er.span,{...h,ref:a,onKeyDown:Vn(n.onKeyDown,d=>{d.key==="Home"?(c(d),d.preventDefault()):d.key==="End"?(m(d),d.preventDefault()):ed.concat(td).includes(d.key)&&(u(d),d.preventDefault())}),onPointerDown:Vn(n.onPointerDown,d=>{const o=d.target;o.setPointerCapture(d.pointerId),d.preventDefault(),p.thumbs.has(o)?o.focus():r(d)}),onPointerMove:Vn(n.onPointerMove,d=>{d.target.hasPointerCapture(d.pointerId)&&i(d)}),onPointerUp:Vn(n.onPointerUp,d=>{const o=d.target;o.hasPointerCapture(d.pointerId)&&(o.releasePointerCapture(d.pointerId),l(d))})})}),ld="SliderTrack",cd=T.forwardRef((n,a)=>{const{__scopeSlider:t,...r}=n,i=Wa(ld,t);return e.jsx(er.span,{"data-disabled":i.disabled?"":void 0,"data-orientation":i.orientation,...r,ref:a})});cd.displayName=ld;var Fi="SliderRange",dd=T.forwardRef((n,a)=>{const{__scopeSlider:t,...r}=n,i=Wa(Fi,t),l=sd(Fi,t),c=T.useRef(null),m=Cr(a,c),u=i.values.length,h=i.values.map(o=>md(o,i.min,i.max)),p=u>1?Math.min(...h):0,d=100-Math.max(...h);return e.jsx(er.span,{"data-orientation":i.orientation,"data-disabled":i.disabled?"":void 0,...r,ref:m,style:{...n.style,[l.startEdge]:p+"%",[l.endEdge]:d+"%"}})});dd.displayName=Fi;var Ii="SliderThumb",ud=T.forwardRef((n,a)=>{const t=fx(n.__scopeSlider),[r,i]=T.useState(null),l=Cr(a,m=>i(m)),c=T.useMemo(()=>r?t().findIndex(m=>m.ref.current===r):-1,[t,r]);return e.jsx(yx,{...n,ref:l,index:c})}),yx=T.forwardRef((n,a)=>{const{__scopeSlider:t,index:r,name:i,...l}=n,c=Wa(Ii,t),m=sd(Ii,t),[u,h]=T.useState(null),p=Cr(a,f=>h(f)),d=u?c.form||!!u.closest("form"):!0,o=bl(u),s=c.values[r],g=s===void 0?0:md(s,c.min,c.max),v=jx(r,c.values.length),x=o==null?void 0:o[m.size],y=x?Nx(x,g,m.direction):0;return T.useEffect(()=>{if(u)return c.thumbs.add(u),()=>{c.thumbs.delete(u)}},[u,c.thumbs]),e.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[m.startEdge]:`calc(${g}% + ${y}px)`},children:[e.jsx(Mi.ItemSlot,{scope:n.__scopeSlider,children:e.jsx(er.span,{role:"slider","aria-label":n["aria-label"]||v,"aria-valuemin":c.min,"aria-valuenow":s,"aria-valuemax":c.max,"aria-orientation":c.orientation,"data-orientation":c.orientation,"data-disabled":c.disabled?"":void 0,tabIndex:c.disabled?void 0:0,...l,ref:p,style:s===void 0?{display:"none"}:n.style,onFocus:Vn(n.onFocus,()=>{c.valueIndexToChangeRef.current=r})})}),d&&e.jsx(bx,{name:i??(c.name?c.name+(c.values.length>1?"[]":""):void 0),form:c.form,value:s},r)]})});ud.displayName=Ii;var bx=n=>{const{value:a,...t}=n,r=T.useRef(null),i=yl(a);return T.useEffect(()=>{const l=r.current,c=window.HTMLInputElement.prototype,u=Object.getOwnPropertyDescriptor(c,"value").set;if(i!==a&&u){const h=new Event("input",{bubbles:!0});u.call(l,a),l.dispatchEvent(h)}},[i,a]),e.jsx("input",{style:{display:"none"},...t,ref:r,defaultValue:a})};function _x(n=[],a,t){const r=[...n];return r[t]=a,r.sort((i,l)=>i-l)}function md(n,a,t){const l=100/(t-a)*(n-a);return Ll(l,[0,100])}function jx(n,a){return a>2?`Value ${n+1} of ${a}`:a===2?["Minimum","Maximum"][n]:void 0}function wx(n,a){if(n.length===1)return 0;const t=n.map(i=>Math.abs(i-a)),r=Math.min(...t);return t.indexOf(r)}function Nx(n,a,t){const r=n/2,l=hs([0,50],[0,r]);return(r-l(a)*t)*t}function Sx(n){return n.slice(0,-1).map((a,t)=>n[t+1]-a)}function Ex(n,a){if(a>0){const t=Sx(n);return Math.min(...t)>=a}return!0}function hs(n,a){return t=>{if(n[0]===n[1]||a[0]===a[1])return a[0];const r=(a[1]-a[0])/(n[1]-n[0]);return a[0]+r*(t-n[0])}}function kx(n){return(String(n).split(".")[1]||"").length}function Cx(n,a){const t=Math.pow(10,a);return Math.round(n*t)/t}var pd=ad,Ax=cd,Px=dd,Ox=ud;const fd=T.forwardRef(({className:n,...a},t)=>e.jsxs(pd,{ref:t,className:pe("relative flex w-full touch-none select-none items-center",n),...a,children:[e.jsx(Ax,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:e.jsx(Px,{className:"absolute h-full bg-primary"})}),e.jsx(Ox,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));fd.displayName=pd.displayName;var fi,po;function Dx(){if(po)return fi;po=1;var n=!1,a,t,r,i,l,c,m,u,h,p,d,o,s,g,v;function x(){if(!n){n=!0;var f=navigator.userAgent,_=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))|(?:Trident\/\d+\.\d+.*rv:(\d+\.\d+))/.exec(f),b=/(Mac OS X)|(Windows)|(Linux)/.exec(f);if(o=/\b(iPhone|iP[ao]d)/.exec(f),s=/\b(iP[ao]d)/.exec(f),p=/Android/i.exec(f),g=/FBAN\/\w+;/i.exec(f),v=/Mobile/i.exec(f),d=!!/Win64/.exec(f),_){a=_[1]?parseFloat(_[1]):_[5]?parseFloat(_[5]):NaN,a&&document&&document.documentMode&&(a=document.documentMode);var E=/(?:Trident\/(\d+.\d+))/.exec(f);c=E?parseFloat(E[1])+4:a,t=_[2]?parseFloat(_[2]):NaN,r=_[3]?parseFloat(_[3]):NaN,i=_[4]?parseFloat(_[4]):NaN,i?(_=/(?:Chrome\/(\d+\.\d+))/.exec(f),l=_&&_[1]?parseFloat(_[1]):NaN):l=NaN}else a=t=r=l=i=NaN;if(b){if(b[1]){var N=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(f);m=N?parseFloat(N[1].replace("_",".")):!0}else m=!1;u=!!b[2],h=!!b[3]}else m=u=h=!1}}var y={ie:function(){return x()||a},ieCompatibilityMode:function(){return x()||c>a},ie64:function(){return y.ie()&&d},firefox:function(){return x()||t},opera:function(){return x()||r},webkit:function(){return x()||i},safari:function(){return y.webkit()},chrome:function(){return x()||l},windows:function(){return x()||u},osx:function(){return x()||m},linux:function(){return x()||h},iphone:function(){return x()||o},mobile:function(){return x()||o||s||p||v},nativeApp:function(){return x()||g},android:function(){return x()||p},ipad:function(){return x()||s}};return fi=y,fi}var hi,fo;function Tx(){if(fo)return hi;fo=1;var n=!!(typeof window<"u"&&window.document&&window.document.createElement),a={canUseDOM:n,canUseWorkers:typeof Worker<"u",canUseEventListeners:n&&!!(window.addEventListener||window.attachEvent),canUseViewport:n&&!!window.screen,isInWorker:!n};return hi=a,hi}var gi,ho;function Lx(){if(ho)return gi;ho=1;var n=Tx(),a;n.canUseDOM&&(a=document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("","")!==!0);/**
 * Checks if an event is supported in the current execution environment.
 *
 * NOTE: This will not work correctly for non-generic events such as `change`,
 * `reset`, `load`, `error`, and `select`.
 *
 * Borrows from Modernizr.
 *
 * @param {string} eventNameSuffix Event name, e.g. "click".
 * @param {?boolean} capture Check if the capture phase is supported.
 * @return {boolean} True if the event is supported.
 * @internal
 * @license Modernizr 3.0.0pre (Custom Build) | MIT
 */function t(r,i){if(!n.canUseDOM||i&&!("addEventListener"in document))return!1;var l="on"+r,c=l in document;if(!c){var m=document.createElement("div");m.setAttribute(l,"return;"),c=typeof m[l]=="function"}return!c&&a&&r==="wheel"&&(c=document.implementation.hasFeature("Events.wheel","3.0")),c}return gi=t,gi}var vi,go;function Rx(){if(go)return vi;go=1;var n=Dx(),a=Lx(),t=10,r=40,i=800;function l(c){var m=0,u=0,h=0,p=0;return"detail"in c&&(u=c.detail),"wheelDelta"in c&&(u=-c.wheelDelta/120),"wheelDeltaY"in c&&(u=-c.wheelDeltaY/120),"wheelDeltaX"in c&&(m=-c.wheelDeltaX/120),"axis"in c&&c.axis===c.HORIZONTAL_AXIS&&(m=u,u=0),h=m*t,p=u*t,"deltaY"in c&&(p=c.deltaY),"deltaX"in c&&(h=c.deltaX),(h||p)&&c.deltaMode&&(c.deltaMode==1?(h*=r,p*=r):(h*=i,p*=i)),h&&!m&&(m=h<1?-1:1),p&&!u&&(u=p<1?-1:1),{spinX:m,spinY:u,pixelX:h,pixelY:p}}return l.getEventType=function(){return n.firefox()?"DOMMouseScroll":a("wheel")?"wheel":"mousewheel"},vi=l,vi}var xi,vo;function Mx(){return vo||(vo=1,xi=Rx()),xi}var Fx=Mx();const Ix=Bi(Fx);function qx(n,a,t,r,i,l){l===void 0&&(l=0);var c=Sr(n,a,l),m=c.width,u=c.height,h=Math.min(m,t),p=Math.min(u,r);return h>p*i?{width:p*i,height:p}:{width:h,height:h/i}}function zx(n){return n.width>n.height?n.width/n.naturalWidth:n.height/n.naturalHeight}function Lr(n,a,t,r,i){i===void 0&&(i=0);var l=Sr(a.width,a.height,i),c=l.width,m=l.height;return{x:xo(n.x,c,t.width,r),y:xo(n.y,m,t.height,r)}}function xo(n,a,t,r){var i=a*r/2-t/2;return Ka(n,-i,i)}function yo(n,a){return Math.sqrt(Math.pow(n.y-a.y,2)+Math.pow(n.x-a.x,2))}function bo(n,a){return Math.atan2(a.y-n.y,a.x-n.x)*180/Math.PI}function Bx(n,a,t,r,i,l,c){l===void 0&&(l=0),c===void 0&&(c=!0);var m=c?Ux:$x,u=Sr(a.width,a.height,l),h=Sr(a.naturalWidth,a.naturalHeight,l),p={x:m(100,((u.width-t.width/i)/2-n.x/i)/u.width*100),y:m(100,((u.height-t.height/i)/2-n.y/i)/u.height*100),width:m(100,t.width/u.width*100/i),height:m(100,t.height/u.height*100/i)},d=Math.round(m(h.width,p.width*h.width/100)),o=Math.round(m(h.height,p.height*h.height/100)),s=h.width>=h.height*r,g=s?{width:Math.round(o*r),height:o}:{width:d,height:Math.round(d/r)},v=Rt(Rt({},g),{x:Math.round(m(h.width-g.width,p.x*h.width/100)),y:Math.round(m(h.height-g.height,p.y*h.height/100))});return{croppedAreaPercentages:p,croppedAreaPixels:v}}function Ux(n,a){return Math.min(n,Math.max(0,a))}function $x(n,a){return a}function _o(n,a,t,r,i,l){var c=Sr(a.width,a.height,t),m=Ka(r.width/c.width*(100/n.width),i,l),u={x:m*c.width/2-r.width/2-c.width*m*(n.x/100),y:m*c.height/2-r.height/2-c.height*m*(n.y/100)};return{crop:u,zoom:m}}function Hx(n,a,t){var r=zx(a);return t.height>t.width?t.height/(n.height*r):t.width/(n.width*r)}function Vx(n,a,t,r,i,l){t===void 0&&(t=0);var c=Sr(a.naturalWidth,a.naturalHeight,t),m=Ka(Hx(n,a,r),i,l),u=r.height>r.width?r.height/n.height:r.width/n.width,h={x:((c.width-n.width)/2-n.x)*u,y:((c.height-n.height)/2-n.y)*u};return{crop:h,zoom:m}}function jo(n,a){return{x:(a.x+n.x)/2,y:(a.y+n.y)/2}}function Wx(n){return n*Math.PI/180}function Sr(n,a,t){var r=Wx(t);return{width:Math.abs(Math.cos(r)*n)+Math.abs(Math.sin(r)*a),height:Math.abs(Math.sin(r)*n)+Math.abs(Math.cos(r)*a)}}function Ka(n,a,t){return Math.min(Math.max(n,a),t)}function oa(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];return n.filter(function(t){return typeof t=="string"&&t.length>0}).join(" ").trim()}var Kx=`.reactEasyCrop_Container {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: hidden;
  user-select: none;
  touch-action: none;
  cursor: move;
  display: flex;
  justify-content: center;
  align-items: center;
}

.reactEasyCrop_Image,
.reactEasyCrop_Video {
  will-change: transform; /* this improves performances and prevent painting issues on iOS Chrome */
}

.reactEasyCrop_Contain {
  max-width: 100%;
  max-height: 100%;
  margin: auto;
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
}
.reactEasyCrop_Cover_Horizontal {
  width: 100%;
  height: auto;
}
.reactEasyCrop_Cover_Vertical {
  width: auto;
  height: 100%;
}

.reactEasyCrop_CropArea {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  border: 1px solid rgba(255, 255, 255, 0.5);
  box-sizing: border-box;
  box-shadow: 0 0 0 9999em;
  color: rgba(0, 0, 0, 0.5);
  overflow: hidden;
}

.reactEasyCrop_CropAreaRound {
  border-radius: 50%;
}

.reactEasyCrop_CropAreaGrid::before {
  content: ' ';
  box-sizing: border-box;
  position: absolute;
  border: 1px solid rgba(255, 255, 255, 0.5);
  top: 0;
  bottom: 0;
  left: 33.33%;
  right: 33.33%;
  border-top: 0;
  border-bottom: 0;
}

.reactEasyCrop_CropAreaGrid::after {
  content: ' ';
  box-sizing: border-box;
  position: absolute;
  border: 1px solid rgba(255, 255, 255, 0.5);
  top: 33.33%;
  bottom: 33.33%;
  left: 0;
  right: 0;
  border-left: 0;
  border-right: 0;
}
`,Yx=1,Gx=3,Zx=1,Qx=function(n){vu(a,n);function a(){var t=n!==null&&n.apply(this,arguments)||this;return t.cropperRef=T.createRef(),t.imageRef=T.createRef(),t.videoRef=T.createRef(),t.containerPosition={x:0,y:0},t.containerRef=null,t.styleRef=null,t.containerRect=null,t.mediaSize={width:0,height:0,naturalWidth:0,naturalHeight:0},t.dragStartPosition={x:0,y:0},t.dragStartCrop={x:0,y:0},t.gestureZoomStart=0,t.gestureRotationStart=0,t.isTouching=!1,t.lastPinchDistance=0,t.lastPinchRotation=0,t.rafDragTimeout=null,t.rafPinchTimeout=null,t.wheelTimer=null,t.currentDoc=typeof document<"u"?document:null,t.currentWindow=typeof window<"u"?window:null,t.resizeObserver=null,t.canonicalCroppedAreaPercentages=null,t.cachedCroppedAreaPixels=null,t.state={cropSize:null,hasWheelJustStarted:!1,mediaObjectFit:void 0},t.initResizeObserver=function(){if(!(typeof window.ResizeObserver>"u"||!t.containerRef)){var r=!0;t.resizeObserver=new window.ResizeObserver(function(i){if(r){r=!1;return}t.computeSizes()}),t.resizeObserver.observe(t.containerRef)}},t.preventZoomSafari=function(r){return r.preventDefault()},t.cleanEvents=function(){t.currentDoc&&(t.currentDoc.removeEventListener("mousemove",t.onMouseMove),t.currentDoc.removeEventListener("mouseup",t.onDragStopped),t.currentDoc.removeEventListener("touchmove",t.onTouchMove),t.currentDoc.removeEventListener("touchend",t.onDragStopped),t.currentDoc.removeEventListener("gesturechange",t.onGestureChange),t.currentDoc.removeEventListener("gestureend",t.onGestureEnd),t.currentDoc.removeEventListener("scroll",t.onScroll))},t.clearScrollEvent=function(){t.containerRef&&t.containerRef.removeEventListener("wheel",t.onWheel),t.wheelTimer&&clearTimeout(t.wheelTimer)},t.onMediaLoad=function(){var r=t.computeSizes();r&&(t.emitCropData(),t.setInitialCrop(r)),t.props.onMediaLoaded&&t.props.onMediaLoaded(t.mediaSize)},t.setInitialCrop=function(r){if(t.props.initialCroppedAreaPercentages){var i=_o(t.props.initialCroppedAreaPercentages,t.mediaSize,t.props.rotation,r,t.props.minZoom,t.props.maxZoom),l=i.crop,c=i.zoom;t.props.onCropChange(l),t.props.onZoomChange&&t.props.onZoomChange(c)}else if(t.props.initialCroppedAreaPixels){var m=Vx(t.props.initialCroppedAreaPixels,t.mediaSize,t.props.rotation,r,t.props.minZoom,t.props.maxZoom),l=m.crop,c=m.zoom;t.props.onCropChange(l),t.props.onZoomChange&&t.props.onZoomChange(c)}},t.computeSizes=function(){var r,i,l,c,m,u,h=t.imageRef.current||t.videoRef.current;if(h&&t.containerRef){t.containerRect=t.containerRef.getBoundingClientRect(),t.saveContainerPosition();var p=t.containerRect.width/t.containerRect.height,d=((r=t.imageRef.current)===null||r===void 0?void 0:r.naturalWidth)||((i=t.videoRef.current)===null||i===void 0?void 0:i.videoWidth)||0,o=((l=t.imageRef.current)===null||l===void 0?void 0:l.naturalHeight)||((c=t.videoRef.current)===null||c===void 0?void 0:c.videoHeight)||0,s=h.offsetWidth<d||h.offsetHeight<o,g=d/o,v=void 0;if(s)switch(t.state.mediaObjectFit){default:case"contain":v=p>g?{width:t.containerRect.height*g,height:t.containerRect.height}:{width:t.containerRect.width,height:t.containerRect.width/g};break;case"horizontal-cover":v={width:t.containerRect.width,height:t.containerRect.width/g};break;case"vertical-cover":v={width:t.containerRect.height*g,height:t.containerRect.height};break}else v={width:h.offsetWidth,height:h.offsetHeight};t.mediaSize=Rt(Rt({},v),{naturalWidth:d,naturalHeight:o}),t.props.setMediaSize&&t.props.setMediaSize(t.mediaSize);var x=t.props.cropSize?t.props.cropSize:qx(t.mediaSize.width,t.mediaSize.height,t.containerRect.width,t.containerRect.height,t.props.aspect,t.props.rotation);return(((m=t.state.cropSize)===null||m===void 0?void 0:m.height)!==x.height||((u=t.state.cropSize)===null||u===void 0?void 0:u.width)!==x.width)&&t.props.onCropSizeChange&&t.props.onCropSizeChange(x),t.setState({cropSize:x},function(){t.applyCanonical(x)||t.recomputeCropPosition()}),t.props.setCropSize&&t.props.setCropSize(x),x}},t.applyCanonical=function(r){if(!t.canonicalCroppedAreaPercentages)return!1;var i=_o(t.canonicalCroppedAreaPercentages,t.mediaSize,t.props.rotation,r,t.props.minZoom,t.props.maxZoom),l=i.crop,c=i.zoom;t.props.onZoomChange&&Math.abs(c-t.props.zoom)>1e-6&&t.props.onZoomChange(c);var m=Math.abs(l.x-t.props.crop.x),u=Math.abs(l.y-t.props.crop.y);return(m>1e-6||u>1e-6)&&t.props.onCropChange(l),t.emitCropData(),!0},t.saveContainerPosition=function(){if(t.containerRef){var r=t.containerRef.getBoundingClientRect();t.containerPosition={x:r.left,y:r.top}}},t.onMouseDown=function(r){t.currentDoc&&(r.preventDefault(),t.currentDoc.addEventListener("mousemove",t.onMouseMove),t.currentDoc.addEventListener("mouseup",t.onDragStopped),t.saveContainerPosition(),t.onDragStart(a.getMousePoint(r)))},t.onMouseMove=function(r){return t.onDrag(a.getMousePoint(r))},t.onScroll=function(r){t.currentDoc&&(r.preventDefault(),t.saveContainerPosition())},t.onTouchStart=function(r){t.currentDoc&&(t.isTouching=!0,!(t.props.onTouchRequest&&!t.props.onTouchRequest(r))&&(t.currentDoc.addEventListener("touchmove",t.onTouchMove,{passive:!1}),t.currentDoc.addEventListener("touchend",t.onDragStopped),t.saveContainerPosition(),r.touches.length===2?t.onPinchStart(r):r.touches.length===1&&t.onDragStart(a.getTouchPoint(r.touches[0]))))},t.onTouchMove=function(r){r.preventDefault(),r.touches.length===2?t.onPinchMove(r):r.touches.length===1&&t.onDrag(a.getTouchPoint(r.touches[0]))},t.onGestureStart=function(r){t.currentDoc&&(r.preventDefault(),t.currentDoc.addEventListener("gesturechange",t.onGestureChange),t.currentDoc.addEventListener("gestureend",t.onGestureEnd),t.gestureZoomStart=t.props.zoom,t.gestureRotationStart=t.props.rotation)},t.onGestureChange=function(r){if(r.preventDefault(),!t.isTouching){var i=a.getMousePoint(r),l=t.gestureZoomStart-1+r.scale;if(t.setNewZoom(l,i,{shouldUpdatePosition:!0}),t.props.onRotationChange){var c=t.gestureRotationStart+r.rotation;t.props.onRotationChange(c)}}},t.onGestureEnd=function(r){t.cleanEvents()},t.onDragStart=function(r){var i,l,c=r.x,m=r.y;t.dragStartPosition={x:c,y:m},t.dragStartCrop=Rt({},t.props.crop),(l=(i=t.props).onInteractionStart)===null||l===void 0||l.call(i)},t.onDrag=function(r){var i=r.x,l=r.y;t.currentWindow&&(t.rafDragTimeout&&t.currentWindow.cancelAnimationFrame(t.rafDragTimeout),t.rafDragTimeout=t.currentWindow.requestAnimationFrame(function(){if(t.state.cropSize&&!(i===void 0||l===void 0)){var c=i-t.dragStartPosition.x,m=l-t.dragStartPosition.y,u={x:t.dragStartCrop.x+c,y:t.dragStartCrop.y+m},h=t.props.restrictPosition?Lr(u,t.mediaSize,t.state.cropSize,t.props.zoom,t.props.rotation):u;t.props.onCropChange(h)}}))},t.onDragStopped=function(){var r,i;t.isTouching=!1,t.cleanEvents(),t.emitCropData(),(i=(r=t.props).onInteractionEnd)===null||i===void 0||i.call(r)},t.onWheel=function(r){if(t.currentWindow&&!(t.props.onWheelRequest&&!t.props.onWheelRequest(r))){r.preventDefault();var i=a.getMousePoint(r),l=Ix(r).pixelY,c=t.props.zoom-l*t.props.zoomSpeed/200;t.setNewZoom(c,i,{shouldUpdatePosition:!0}),t.state.hasWheelJustStarted||t.setState({hasWheelJustStarted:!0},function(){var m,u;return(u=(m=t.props).onInteractionStart)===null||u===void 0?void 0:u.call(m)}),t.wheelTimer&&clearTimeout(t.wheelTimer),t.wheelTimer=t.currentWindow.setTimeout(function(){return t.setState({hasWheelJustStarted:!1},function(){var m,u;return(u=(m=t.props).onInteractionEnd)===null||u===void 0?void 0:u.call(m)})},250)}},t.getPointOnContainer=function(r,i){var l=r.x,c=r.y;if(!t.containerRect)throw new Error("The Cropper is not mounted");return{x:t.containerRect.width/2-(l-i.x),y:t.containerRect.height/2-(c-i.y)}},t.getPointOnMedia=function(r){var i=r.x,l=r.y,c=t.props,m=c.crop,u=c.zoom;return{x:(i+m.x)/u,y:(l+m.y)/u}},t.setNewZoom=function(r,i,l){var c=l===void 0?{}:l,m=c.shouldUpdatePosition,u=m===void 0?!0:m;if(!(!t.state.cropSize||!t.props.onZoomChange)){var h=Ka(r,t.props.minZoom,t.props.maxZoom);if(u){var p=t.getPointOnContainer(i,t.containerPosition),d=t.getPointOnMedia(p),o={x:d.x*h-p.x,y:d.y*h-p.y},s=t.props.restrictPosition?Lr(o,t.mediaSize,t.state.cropSize,h,t.props.rotation):o;t.props.onCropChange(s)}t.props.onZoomChange(h)}},t.getCropData=function(){if(!t.state.cropSize)return null;var r=t.props.restrictPosition?Lr(t.props.crop,t.mediaSize,t.state.cropSize,t.props.zoom,t.props.rotation):t.props.crop;return Bx(r,t.mediaSize,t.state.cropSize,t.getAspect(),t.props.zoom,t.props.rotation,t.props.restrictPosition)},t.emitCropData=function(){var r=t.getCropData();if(r){var i=r.croppedAreaPercentages,l=r.croppedAreaPixels;t.canonicalCroppedAreaPercentages=i,t.cachedCroppedAreaPixels=l,t.props.onCropComplete&&t.props.onCropComplete(i,l),t.props.onCropAreaChange&&t.props.onCropAreaChange(i,l)}},t.emitCropAreaChange=function(){var r=t.getCropData();if(r){var i=r.croppedAreaPercentages,l=r.croppedAreaPixels;t.canonicalCroppedAreaPercentages=i,t.cachedCroppedAreaPixels=l,t.props.onCropAreaChange&&t.props.onCropAreaChange(i,l)}},t.recomputeCropPosition=function(){if(t.state.cropSize){var r=t.props.restrictPosition?Lr(t.props.crop,t.mediaSize,t.state.cropSize,t.props.zoom,t.props.rotation):t.props.crop;t.props.onCropChange(r),t.emitCropData()}},t.onKeyDown=function(r){var i,l,c=t.props,m=c.crop,u=c.onCropChange,h=c.keyboardStep,p=c.zoom,d=c.rotation,o=h;if(t.state.cropSize){r.shiftKey&&(o*=.2);var s=Rt({},m);switch(r.key){case"ArrowUp":s.y-=o,r.preventDefault();break;case"ArrowDown":s.y+=o,r.preventDefault();break;case"ArrowLeft":s.x-=o,r.preventDefault();break;case"ArrowRight":s.x+=o,r.preventDefault();break;default:return}t.props.restrictPosition&&(s=Lr(s,t.mediaSize,t.state.cropSize,p,d)),r.repeat||(l=(i=t.props).onInteractionStart)===null||l===void 0||l.call(i),u(s)}},t.onKeyUp=function(r){var i,l;switch(r.key){case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":r.preventDefault();break;default:return}t.emitCropData(),(l=(i=t.props).onInteractionEnd)===null||l===void 0||l.call(i)},t}return a.prototype.componentDidMount=function(){!this.currentDoc||!this.currentWindow||(this.containerRef&&(this.containerRef.ownerDocument&&(this.currentDoc=this.containerRef.ownerDocument),this.currentDoc.defaultView&&(this.currentWindow=this.currentDoc.defaultView),this.initResizeObserver(),typeof window.ResizeObserver>"u"&&this.currentWindow.addEventListener("resize",this.computeSizes),this.props.zoomWithScroll&&this.containerRef.addEventListener("wheel",this.onWheel,{passive:!1}),this.containerRef.addEventListener("gesturestart",this.onGestureStart)),this.currentDoc.addEventListener("scroll",this.onScroll),this.props.disableAutomaticStylesInjection||(this.styleRef=this.currentDoc.createElement("style"),this.styleRef.setAttribute("type","text/css"),this.props.nonce&&this.styleRef.setAttribute("nonce",this.props.nonce),this.styleRef.innerHTML=Kx,this.currentDoc.head.appendChild(this.styleRef)),this.imageRef.current&&this.imageRef.current.complete&&this.onMediaLoad(),this.props.setImageRef&&this.props.setImageRef(this.imageRef),this.props.setVideoRef&&this.props.setVideoRef(this.videoRef),this.props.setCropperRef&&this.props.setCropperRef(this.cropperRef))},a.prototype.componentWillUnmount=function(){var t,r;!this.currentDoc||!this.currentWindow||(typeof window.ResizeObserver>"u"&&this.currentWindow.removeEventListener("resize",this.computeSizes),(t=this.resizeObserver)===null||t===void 0||t.disconnect(),this.containerRef&&this.containerRef.removeEventListener("gesturestart",this.preventZoomSafari),this.styleRef&&((r=this.styleRef.parentNode)===null||r===void 0||r.removeChild(this.styleRef)),this.cleanEvents(),this.props.zoomWithScroll&&this.clearScrollEvent())},a.prototype.componentDidUpdate=function(t){var r,i,l,c,m,u,h,p,d;t.rotation!==this.props.rotation?(this.computeSizes(),this.recomputeCropPosition()):t.aspect!==this.props.aspect?this.computeSizes():t.objectFit!==this.props.objectFit?this.computeSizes():t.zoom!==this.props.zoom?this.recomputeCropPosition():((r=t.cropSize)===null||r===void 0?void 0:r.height)!==((i=this.props.cropSize)===null||i===void 0?void 0:i.height)||((l=t.cropSize)===null||l===void 0?void 0:l.width)!==((c=this.props.cropSize)===null||c===void 0?void 0:c.width)?this.computeSizes():(((m=t.crop)===null||m===void 0?void 0:m.x)!==((u=this.props.crop)===null||u===void 0?void 0:u.x)||((h=t.crop)===null||h===void 0?void 0:h.y)!==((p=this.props.crop)===null||p===void 0?void 0:p.y))&&this.emitCropAreaChange(),t.zoomWithScroll!==this.props.zoomWithScroll&&this.containerRef&&(this.props.zoomWithScroll?this.containerRef.addEventListener("wheel",this.onWheel,{passive:!1}):this.clearScrollEvent()),t.video!==this.props.video&&((d=this.videoRef.current)===null||d===void 0||d.load());var o=this.getObjectFit();o!==this.state.mediaObjectFit&&this.setState({mediaObjectFit:o},this.computeSizes)},a.prototype.getAspect=function(){var t=this.props,r=t.cropSize,i=t.aspect;return r?r.width/r.height:i},a.prototype.getObjectFit=function(){var t,r,i,l;if(this.props.objectFit==="cover"){var c=this.imageRef.current||this.videoRef.current;if(c&&this.containerRef){this.containerRect=this.containerRef.getBoundingClientRect();var m=this.containerRect.width/this.containerRect.height,u=((t=this.imageRef.current)===null||t===void 0?void 0:t.naturalWidth)||((r=this.videoRef.current)===null||r===void 0?void 0:r.videoWidth)||0,h=((i=this.imageRef.current)===null||i===void 0?void 0:i.naturalHeight)||((l=this.videoRef.current)===null||l===void 0?void 0:l.videoHeight)||0,p=u/h;return p<m?"horizontal-cover":"vertical-cover"}return"horizontal-cover"}return this.props.objectFit},a.prototype.onPinchStart=function(t){var r=a.getTouchPoint(t.touches[0]),i=a.getTouchPoint(t.touches[1]);this.lastPinchDistance=yo(r,i),this.lastPinchRotation=bo(r,i),this.onDragStart(jo(r,i))},a.prototype.onPinchMove=function(t){var r=this;if(!(!this.currentDoc||!this.currentWindow)){var i=a.getTouchPoint(t.touches[0]),l=a.getTouchPoint(t.touches[1]),c=jo(i,l);this.onDrag(c),this.rafPinchTimeout&&this.currentWindow.cancelAnimationFrame(this.rafPinchTimeout),this.rafPinchTimeout=this.currentWindow.requestAnimationFrame(function(){var m=yo(i,l),u=r.props.zoom*(m/r.lastPinchDistance);r.setNewZoom(u,c,{shouldUpdatePosition:!1}),r.lastPinchDistance=m;var h=bo(i,l),p=r.props.rotation+(h-r.lastPinchRotation);r.props.onRotationChange&&r.props.onRotationChange(p),r.lastPinchRotation=h})}},a.prototype.render=function(){var t=this,r,i=this.props,l=i.image,c=i.video,m=i.mediaProps,u=i.cropperProps,h=i.transform,p=i.crop,d=p.x,o=p.y,s=i.rotation,g=i.zoom,v=i.cropShape,x=i.showGrid,y=i.roundCropAreaPixels,f=i.style,_=f.containerStyle,b=f.cropAreaStyle,E=f.mediaStyle,N=i.classes,j=N.containerClassName,C=N.cropAreaClassName,D=N.mediaClassName,k=(r=this.state.mediaObjectFit)!==null&&r!==void 0?r:this.getObjectFit();return T.createElement("div",{onMouseDown:this.onMouseDown,onTouchStart:this.onTouchStart,ref:function(S){return t.containerRef=S},"data-testid":"container",style:_,className:oa("reactEasyCrop_Container",j)},l?T.createElement("img",Rt({alt:"",className:oa("reactEasyCrop_Image",k==="contain"&&"reactEasyCrop_Contain",k==="horizontal-cover"&&"reactEasyCrop_Cover_Horizontal",k==="vertical-cover"&&"reactEasyCrop_Cover_Vertical",D)},m,{src:l,ref:this.imageRef,style:Rt(Rt({},E),{transform:h||"translate(".concat(d,"px, ").concat(o,"px) rotate(").concat(s,"deg) scale(").concat(g,")")}),onLoad:this.onMediaLoad})):c&&T.createElement("video",Rt({autoPlay:!0,playsInline:!0,loop:!0,muted:!0,className:oa("reactEasyCrop_Video",k==="contain"&&"reactEasyCrop_Contain",k==="horizontal-cover"&&"reactEasyCrop_Cover_Horizontal",k==="vertical-cover"&&"reactEasyCrop_Cover_Vertical",D)},m,{ref:this.videoRef,onLoadedMetadata:this.onMediaLoad,style:Rt(Rt({},E),{transform:h||"translate(".concat(d,"px, ").concat(o,"px) rotate(").concat(s,"deg) scale(").concat(g,")")}),controls:!1}),(Array.isArray(c)?c:[{src:c}]).map(function(w){return T.createElement("source",Rt({key:w.src},w))})),this.state.cropSize&&T.createElement("div",Rt({ref:this.cropperRef,style:Rt(Rt({},b),{width:y?Math.round(this.state.cropSize.width):this.state.cropSize.width,height:y?Math.round(this.state.cropSize.height):this.state.cropSize.height}),tabIndex:0,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,"data-testid":"cropper",className:oa("reactEasyCrop_CropArea",v==="round"&&"reactEasyCrop_CropAreaRound",x&&"reactEasyCrop_CropAreaGrid",C)},u)))},a.defaultProps={zoom:1,rotation:0,aspect:4/3,maxZoom:Gx,minZoom:Yx,cropShape:"rect",objectFit:"contain",showGrid:!0,style:{},classes:{},mediaProps:{},cropperProps:{},zoomSpeed:1,restrictPosition:!0,zoomWithScroll:!0,keyboardStep:Zx},a.getMousePoint=function(t){return{x:Number(t.clientX),y:Number(t.clientY)}},a.getTouchPoint=function(t){return{x:Number(t.clientX),y:Number(t.clientY)}},a}(T.Component);const Xx=n=>new Promise((a,t)=>{const r=new Image;r.addEventListener("load",()=>a(r)),r.addEventListener("error",i=>t(i)),r.setAttribute("crossOrigin","anonymous"),r.src=n});async function Jx(n,a,t){const r=await Xx(n),i=document.createElement("canvas"),l=i.getContext("2d");if(!l)throw new Error("No 2D context available for canvas.");const c=256;i.width=c,i.height=c;const m=c/a.width,u=c/a.height,h=Math.min(m,u),p=a.width*h,d=a.height*h,o=(c-p)/2,s=(c-d)/2;return l.drawImage(r,a.x,a.y,a.width,a.height,o,s,p,d),l.globalCompositeOperation="destination-in",l.beginPath(),l.arc(c/2,c/2,c/2,0,Math.PI*2),l.closePath(),l.fill(),new Promise((g,v)=>{i.toBlob(x=>{if(!x){v(new Error("Canvas is empty"));return}const y=new File([x],t,{type:"image/png"});g(y)},"image/png")})}const hd=({isOpen:n,onOpenChange:a,imageSrc:t,onSave:r})=>{const[i,l]=T.useState({x:0,y:0}),[c,m]=T.useState(1),[u,h]=T.useState(null);T.useEffect(()=>{n&&t&&(l({x:0,y:0}),m(1),h(null))},[n,t]);const p=T.useCallback((o,s)=>{h(s)},[]),d=async()=>{if(t&&u)try{const o=await Jx(t,u,"avatar.png");r(o),a(!1)}catch(o){console.error("Error creating cropped image file:",o)}};return t?e.jsx(vt,{open:n,onOpenChange:a,children:e.jsxs(ut,{className:"sm:max-w-[425px]",children:[e.jsx(_t,{children:e.jsx(jt,{children:"Crop your new avatar"})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsx("div",{className:"relative w-64 h-64 mx-auto rounded-full overflow-hidden border border-gray-300 dark:border-gray-700",children:e.jsx(Qx,{image:t,crop:i,zoom:c,aspect:1,cropShape:"round",onCropChange:l,onZoomChange:m,onCropComplete:p,showGrid:!1,restrictPosition:!0,minZoom:1})}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{htmlFor:"zoom",children:"Zoom"}),e.jsx(fd,{id:"zoom",min:1,max:3,step:.05,value:[c],onValueChange:o=>m(o[0])})]})]}),e.jsxs(sr,{children:[e.jsx(ee,{variant:"outline",onClick:()=>a(!1),children:"Cancel"}),e.jsx(ee,{onClick:d,children:"Save"})]})]})}):null},gs=({currentAvatarUrl:n,onFileSelected:a,isLoading:t=!1,disabled:r=!1})=>{const[i,l]=T.useState(null),[c,m]=T.useState(null),[u,h]=T.useState(null),[p,d]=T.useState(!1);T.useEffect(()=>{l(n||null)},[n]);const o=T.useCallback((f,_)=>{if(m(null),_.length>0){m("Invalid file type or size. Please upload an image (max 2MB).");return}if(f.length>0){const b=f[0];if(b.size>2*1024*1024){m("File size exceeds 2MB limit.");return}const E=new FileReader;E.addEventListener("load",()=>{h(E.result),d(!0)}),E.readAsDataURL(b)}},[]),{getRootProps:s,getInputProps:g,isDragActive:v}=Va({onDrop:o,accept:{"image/*":[".jpeg",".png",".gif",".webp"]},maxFiles:1,disabled:t||r}),x=f=>{a(f),l(URL.createObjectURL(f)),h(null)},y=f=>{f==null||f.stopPropagation(),a(null),l(n||null),m(null)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs("div",{...s(),className:pe("relative flex items-center justify-center h-24 w-24 rounded-full border-2 border-dashed transition-colors","hover:border-primary hover:bg-muted/50",v&&"border-primary bg-muted/50",(t||r)&&"opacity-70 cursor-not-allowed",c&&"border-destructive","cursor-pointer"),children:[e.jsx("input",{...g()}),e.jsxs(_r,{className:"h-20 w-20",children:[e.jsx(jr,{src:i||void 0,alt:"Avatar Preview"}),e.jsx(wr,{className:"bg-muted-foreground/20",children:t?e.jsx(fe,{className:"h-8 w-8 animate-spin text-primary"}):e.jsx(Wu,{className:"h-8 w-8 text-muted-foreground"})})]}),!t&&i&&i!==n&&e.jsxs(ee,{variant:"ghost",size:"icon",onClick:y,className:"absolute -top-2 -right-2 h-6 w-6 rounded-full bg-background/80 hover:bg-background",children:[e.jsx(Ft,{className:"h-4 w-4 text-destructive"}),e.jsx("span",{className:"sr-only",children:"Clear image"})]})]}),c&&e.jsx("p",{className:"text-sm text-destructive text-center",children:c}),e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Drag & drop or click to upload image (max 2MB)"})]}),e.jsx(hd,{isOpen:p,onOpenChange:d,imageSrc:u,onSave:x})]})},vs=xu,xs=yu,ys=bu,ey=tt({first_name:J().min(1,"First name is required").optional().nullable(),last_name:J().min(1,"Last name is required").optional().nullable(),avatar_file:nr().optional().nullable()}),ty=()=>{const n=Ye(),{toast:a}=Ke(),{profile:t,user:r,isLoading:i}=Ie(),[l,c]=T.useState(null),m=ct({resolver:dt(ey),defaultValues:{first_name:(t==null?void 0:t.first_name)||"",last_name:(t==null?void 0:t.last_name)||"",avatar_file:null}});T.useEffect(()=>{t&&m.reset({first_name:t.first_name||"",last_name:t.last_name||"",avatar_file:null})},[t,m]);const u=Oe({mutationFn:async p=>{var s;if(!(r!=null&&r.id))throw new Error("User not authenticated.");let d=t==null?void 0:t.avatar_url;if(l){const g=l.name.split(".").pop(),v=`${r.id}/avatar.${g}`,{error:x}=await X.storage.from("avatars").upload(v,l,{upsert:!0});if(x)throw x;const{data:y}=X.storage.from("avatars").getPublicUrl(v);d=`${y.publicUrl}?t=${Date.now()}`}else if(l===null&&(t!=null&&t.avatar_url)){const g=(s=t.avatar_url.split("/public/avatars/")[1])==null?void 0:s.split("?")[0];g&&await X.storage.from("avatars").remove([g]),d=null}const{error:o}=await X.from("profiles").update({first_name:p.first_name,last_name:p.last_name,full_name:(p.first_name||"")+" "+(p.last_name||""),avatar_url:d,updated_at:new Date().toISOString()}).eq("user_id",r.id);if(o)throw o;return null},onSuccess:()=>{n.invalidateQueries({queryKey:["userMenuPreferences",r==null?void 0:r.id]}),n.invalidateQueries({queryKey:["profiles"]}),a({title:"Profile Updated",description:"Your profile settings have been successfully saved."}),c(null)},onError:p=>{a({title:"Error updating profile",description:p.message||"An unexpected error occurred.",variant:"destructive"})}}),h=p=>{u.mutate(p)};return i?e.jsxs("div",{className:"flex flex-1 items-center justify-center",children:[e.jsx(fe,{className:"h-8 w-8 animate-spin"}),e.jsx("p",{className:"ml-2",children:"Loading settings..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(vs,{defaultOpen:!0,asChild:!0,children:e.jsxs(we,{children:[e.jsx(xs,{asChild:!0,children:e.jsxs("div",{className:"flex w-full cursor-pointer items-center justify-between p-6 data-[state=open]:border-b",children:[e.jsxs("div",{children:[e.jsxs(Ee,{className:"flex items-center gap-2",children:[e.jsx(Qi,{className:"h-5 w-5"})," Profile Settings"]}),e.jsx(Re,{children:"Manage your personal profile information."})]}),e.jsx(Bn,{className:"h-5 w-5 transition-transform duration-300 data-[state=open]:rotate-180"})]})}),e.jsx(ys,{children:e.jsx(ke,{className:"pt-6",children:e.jsxs("form",{onSubmit:m.handleSubmit(h),className:"grid gap-6",children:[e.jsx("div",{className:"flex flex-col items-center gap-4",children:e.jsx(gs,{currentAvatarUrl:t==null?void 0:t.avatar_url,onFileSelected:c,isLoading:u.isPending,disabled:u.isPending})}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"first_name",children:"First Name"}),e.jsx(ne,{id:"first_name",...m.register("first_name"),disabled:u.isPending}),m.formState.errors.first_name&&e.jsx("p",{className:"text-sm text-destructive",children:m.formState.errors.first_name.message})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"last_name",children:"Last Name"}),e.jsx(ne,{id:"last_name",...m.register("last_name"),disabled:u.isPending}),m.formState.errors.last_name&&e.jsx("p",{className:"text-sm text-destructive",children:m.formState.errors.last_name.message})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"email",children:"Email"}),e.jsx(ne,{id:"email",type:"email",value:(t==null?void 0:t.email)||"",readOnly:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"role",children:"Role"}),e.jsx(ne,{id:"role",value:(t==null?void 0:t.role)||"",readOnly:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"company",children:"Company ID"}),e.jsx(ne,{id:"company",value:(t==null?void 0:t.company_id)||"N/A",readOnly:!0})]}),e.jsxs(ee,{type:"submit",disabled:u.isPending,children:[u.isPending&&e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Profile"]})]})})})]})}),e.jsxs(we,{className:"mt-6",children:[e.jsxs(Ae,{children:[e.jsx(Ee,{children:"Account Settings"}),e.jsx(Re,{children:"Manage your account preferences."})]}),e.jsxs(ke,{className:"grid gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"password",children:"Password"}),e.jsx(ee,{variant:"outline",disabled:!0,children:"Change Password"})]}),e.jsx(lt,{}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"deleteAccount",className:"text-destructive",children:"Delete Account"}),e.jsx(ee,{variant:"destructive",disabled:!0,children:"Delete My Account"})]})]})]})]})},ny=n=>je({queryKey:["invitations-with-details",n],queryFn:async()=>{const{data:a,error:t}=await X.rpc("get_invitations_with_details",{company_id_param:null});if(t)throw console.error("Error fetching invitations with details:",t),t;return a}}),ry=()=>{const{data:n=[],isLoading:a}=ny(),{data:t}=je({queryKey:["companies-count"],queryFn:async()=>{const{count:c,error:m}=await X.from("companies").select("*",{count:"exact",head:!0});if(m)throw m;return c||0}}),{data:r}=je({queryKey:["users-count"],queryFn:async()=>{const{count:c,error:m}=await X.from("profiles").select("*",{count:"exact",head:!0});if(m)throw m;return c||0}}),{data:i}=je({queryKey:["expenses-count"],queryFn:async()=>{const{count:c,error:m}=await X.from("expenses").select("*",{count:"exact",head:!0});if(m)throw m;return c||0}}),l=c=>c.accepted_at?e.jsx(It,{className:"bg-green-100 text-green-800",children:"Accepted"}):new Date(c.expires_at)<new Date?e.jsx(It,{className:"bg-red-100 text-red-800",children:"Expired"}):e.jsx(It,{className:"bg-yellow-100 text-yellow-800",children:"Pending"});return e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Super Admin Dashboard"}),e.jsx("p",{className:"text-muted-foreground",children:"System overview and management tools"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(we,{children:[e.jsxs(Ae,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(Ee,{className:"text-sm font-medium",children:"Total Companies"}),e.jsx(Gr,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(ke,{children:e.jsx("div",{className:"text-2xl font-bold",children:t||0})})]}),e.jsxs(we,{children:[e.jsxs(Ae,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(Ee,{className:"text-sm font-medium",children:"Total Users"}),e.jsx(Vi,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(ke,{children:e.jsx("div",{className:"text-2xl font-bold",children:r||0})})]}),e.jsxs(we,{children:[e.jsxs(Ae,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(Ee,{className:"text-sm font-medium",children:"Total Expenses"}),e.jsx(Ta,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(ke,{children:e.jsx("div",{className:"text-2xl font-bold",children:i||0})})]}),e.jsxs(we,{children:[e.jsxs(Ae,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(Ee,{className:"text-sm font-medium",children:"Pending Invitations"}),e.jsx(Xi,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(ke,{children:e.jsx("div",{className:"text-2xl font-bold",children:n.filter(c=>!c.accepted_at&&new Date(c.expires_at)>new Date).length})})]})]}),e.jsxs(we,{children:[e.jsxs(Ae,{children:[e.jsx(Ee,{children:"Recent Invitations"}),e.jsx(Re,{children:"Latest user invitations across all companies"})]}),e.jsx(ke,{children:a?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):n.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No invitations found"}):e.jsx("div",{className:"rounded-md border",children:e.jsxs(Ct,{children:[e.jsx(At,{children:e.jsxs(Me,{children:[e.jsx(be,{children:"Email"}),e.jsx(be,{children:"Company"}),e.jsx(be,{children:"Role"}),e.jsx(be,{children:"Invited By"}),e.jsx(be,{children:"Status"}),e.jsx(be,{children:"Created"}),e.jsx(be,{className:"w-[100px]",children:"Actions"})]})}),e.jsx(Pt,{children:n.slice(0,10).map(c=>e.jsxs(Me,{children:[e.jsx(ve,{className:"font-medium",children:c.email}),e.jsx(ve,{children:c.company_name||"—"}),e.jsx(ve,{children:e.jsx(It,{variant:"outline",children:c.role})}),e.jsx(ve,{children:c.inviter_full_name||c.inviter_email||"—"}),e.jsx(ve,{children:l(c)}),e.jsx(ve,{children:new Date(c.created_at).toLocaleDateString()}),e.jsx(ve,{children:e.jsxs(rs,{children:[e.jsx(as,{asChild:!0,children:e.jsx(ee,{variant:"ghost",className:"h-8 w-8 p-0",children:e.jsx(ql,{className:"h-4 w-4"})})}),e.jsxs(Ba,{align:"end",children:[e.jsxs(Tn,{children:[e.jsx(mn,{className:"mr-2 h-4 w-4"}),"View Details"]}),e.jsxs(Tn,{children:[e.jsx(rn,{className:"mr-2 h-4 w-4"}),"Resend"]}),e.jsxs(Tn,{className:"text-red-600",children:[e.jsx(qt,{className:"mr-2 h-4 w-4"}),"Cancel"]})]})]})})]},c.id))})]})})})]})]})},ay=tt({companyName:J().min(1,"Company name is required"),companyDomain:J().optional().nullable(),defaultCurrency:J().min(1,"Default currency is required"),modules:Zr(tt({module_id:J(),name:J(),description:J().optional().nullable(),is_enabled:St(),monthly_price:gt(n=>n===""?0:Number(n),yt().min(0,"Monthly price must be non-negative").default(0)),per_user_price:gt(n=>n===""?0:Number(n),yt().min(0,"Per-user price must be non-negative").default(0)),is_locked_by_system:St(),module_type:Ma(["core","super","add-on"])})),adminFirstName:J().min(1,"Admin first name is required"),adminLastName:J().min(1,"Admin last name is required"),adminEmail:J().email("Invalid email address for admin"),adminPassword:J().min(6,"Password must be at least 6 characters long"),adminRole:J().default("admin")}),iy=()=>{const n=Ye(),{toast:a}=Ke(),{user:t,profile:r,isLoading:i}=Ie(),l=kn(),[c,m]=T.useState("company-details"),u=ct({resolver:dt(ay),defaultValues:{companyName:"",companyDomain:"",defaultCurrency:"USD",modules:[],adminFirstName:"",adminLastName:"",adminEmail:"",adminPassword:"",adminRole:"admin"}}),{data:h,isLoading:p}=je({queryKey:["currencies"],queryFn:async()=>{const{data:N,error:j}=await X.from("currencies").select("id, code, name, symbol").eq("is_active",!0).order("code");if(j)throw j;return N}}),{data:d,isLoading:o}=je({queryKey:["allSystemModulesForCompanySetup"],queryFn:async()=>{const{data:N,error:j}=await X.from("modules").select("id, name, description, is_active, default_monthly_price, default_per_user_price, module_type");if(j)throw j;return N||[]},enabled:(r==null?void 0:r.role)==="super-admin"});T.useEffect(()=>{if(d&&u.getValues("modules").length===0){const N=d.map(j=>{const C=j.module_type==="core";return{module_id:j.id,name:j.name,description:j.description,is_enabled:C,monthly_price:j.default_monthly_price??0,per_user_price:j.default_per_user_price??0,is_locked_by_system:C,module_type:j.module_type}});u.setValue("modules",N)}},[d,u]),T.useEffect(()=>{r&&!u.formState.isDirty&&u.reset({...u.getValues(),adminEmail:"",adminFirstName:"",adminLastName:"",adminPassword:""})},[r,u]);const s=Oe({mutationFn:async N=>{if((r==null?void 0:r.role)!=="super-admin")throw new Error("Only super-admins can perform this action.");if(!(t!=null&&t.id))throw new Error("Current user ID is missing.");const{data:j,error:C}=await X.from("companies").insert({name:N.companyName,domain:N.companyDomain,default_currency:N.defaultCurrency}).select().single();if(C)throw console.error("Supabase company insert error:",C),C;if(!j)throw new Error("Failed to create company.");const D=N.modules.filter(O=>O.is_enabled).map(O=>({company_id:j.id,module_id:O.module_id,is_enabled:!0,is_locked_by_system:O.is_locked_by_system,monthly_price:O.monthly_price,per_user_price:O.per_user_price}));if(D&&D.length>0){const{error:O}=await X.from("company_modules").insert(D);O&&console.error("Error inserting default company modules:",O)}const{data:{session:k}}=await X.auth.getSession(),w=k==null?void 0:k.access_token;if(!w)throw new Error("Authentication token missing. Please log in again.");const{data:S,error:P}=await X.functions.invoke("create-user-by-admin",{body:{email:N.adminEmail,password:N.adminPassword,first_name:N.adminFirstName,last_name:N.adminLastName,role:N.adminRole,company_id:j.id},headers:{Authorization:`Bearer ${w}`}});if(P)throw console.error("Supabase create-user-by-admin Edge Function error:",P),P;return{company:j,adminUserId:S.userId}},onSuccess:N=>{n.invalidateQueries({queryKey:["companies"]}),n.invalidateQueries({queryKey:["invitations"]}),r!=null&&r.user_id&&n.invalidateQueries({queryKey:["profiles",r.user_id]}),a({title:"Company & Admin Created",description:`Company "${N.company.name}" created and admin user "${u.getValues("adminEmail")}" set up.`}),l("/companies",{replace:!0})},onError:N=>{console.error("SuperAdminCompanySetupPage: Error during company setup mutation:",N),a({title:"Error during company setup",description:N.message||"An unexpected error occurred.",variant:"destructive"})}}),g=N=>{s.mutate(N)},v=i||p||o,x=s.isPending,y=N=>u.watch("modules").filter(j=>j.module_type===N).sort((j,C)=>j.name.localeCompare(C.name)),f=y("core"),_=y("super"),b=y("add-on"),E=N=>e.jsxs(Ct,{children:[e.jsx(At,{children:e.jsxs(Me,{children:[e.jsx(be,{children:"Module"}),e.jsx(be,{children:"Description"}),e.jsx(be,{children:"Enabled"}),e.jsx(be,{children:"Monthly Price (USD)"}),e.jsx(be,{children:"Per-User Price (USD)"})]})}),e.jsx(Pt,{children:N.length===0?e.jsx(Me,{children:e.jsx(ve,{colSpan:5,className:"text-center text-muted-foreground",children:"No modules found in this category."})}):N.map(j=>{var w,S,P,O,L,$,B,Y;const C=u.watch("modules").findIndex(U=>U.module_id===j.module_id);if(C===-1)return null;const D=j.is_locked_by_system,k=x||!u.watch(`modules.${C}.is_enabled`)||D;return e.jsxs(Me,{children:[e.jsx(ve,{className:"font-medium",children:j.name}),e.jsx(ve,{children:j.description||"N/A"}),e.jsx(ve,{children:e.jsx(bt,{checked:u.watch(`modules.${C}.is_enabled`),onCheckedChange:U=>u.setValue(`modules.${C}.is_enabled`,U),disabled:x||D})}),e.jsxs(ve,{children:[e.jsx(zn,{value:u.watch(`modules.${C}.monthly_price`),onChange:U=>u.setValue(`modules.${C}.monthly_price`,U),disabled:k,currencyCode:"USD"}),((S=(w=u.formState.errors.modules)==null?void 0:w[C])==null?void 0:S.monthly_price)&&e.jsx("p",{className:"text-sm text-destructive",children:(O=(P=u.formState.errors.modules[C])==null?void 0:P.monthly_price)==null?void 0:O.message})]}),e.jsxs(ve,{children:[e.jsx(zn,{value:u.watch(`modules.${C}.per_user_price`),onChange:U=>u.setValue(`modules.${C}.per_user_price`,U),disabled:k,currencyCode:"USD"}),(($=(L=u.formState.errors.modules)==null?void 0:L[C])==null?void 0:$.per_user_price)&&e.jsx("p",{className:"text-sm text-destructive",children:(Y=(B=u.formState.errors.modules[C])==null?void 0:B.per_user_price)==null?void 0:Y.message})]})]},j.module_id)})})]});return v?e.jsxs("div",{className:"flex min-h-screen w-full flex-col items-center justify-center",children:[e.jsx(fe,{className:"h-8 w-8 animate-spin"}),e.jsx("p",{className:"ml-2",children:"Loading..."})]}):(r==null?void 0:r.role)!=="super-admin"?e.jsx("div",{className:"flex flex-1 items-center justify-center text-destructive",children:e.jsx("p",{children:"Access Denied: Only Super Admins can access this page."})}):e.jsx("div",{className:"flex flex-col items-center bg-gray-100 dark:bg-gray-900 p-4",children:e.jsxs("div",{className:"w-full max-w-4xl bg-white dark:bg-gray-800 p-8 rounded-lg shadow-md my-8",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx("img",{src:"/infotrac-logo.png",alt:"INFOtrac Logo",className:"h-16 w-auto object-contain"})}),e.jsxs("h2",{className:"text-2xl font-bold text-center mb-6 text-gray-900 dark:text-white flex items-center justify-center gap-2",children:[e.jsx(Gr,{className:"h-6 w-6"})," Add New Company to INFOtrac"]}),e.jsxs(dn,{value:c,onValueChange:m,className:"w-full",children:[e.jsxs(sn,{className:"grid w-full grid-cols-3",children:[e.jsx(ze,{value:"company-details",children:"Step 1: Company Details"}),e.jsx(ze,{value:"module-assignment",children:"Step 2: Module Assignment"}),e.jsx(ze,{value:"admin-details",children:"Step 3: Admin Details"})]}),e.jsxs("form",{onSubmit:u.handleSubmit(g),className:"grid gap-4 py-4",children:[e.jsx(Ve,{value:"company-details",children:e.jsxs(we,{children:[e.jsxs(Ae,{children:[e.jsx(Ee,{className:"text-lg",children:"Company Information"}),e.jsx(Re,{children:"Enter the basic details for the new company."})]}),e.jsxs(ke,{className:"grid gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"companyName",children:"Company Name"}),e.jsx(ne,{id:"companyName",...u.register("companyName"),disabled:x}),u.formState.errors.companyName&&e.jsx("p",{className:"text-sm text-destructive",children:u.formState.errors.companyName.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"companyDomain",children:"Company Domain (Optional)"}),e.jsx(ne,{id:"companyDomain",...u.register("companyDomain"),disabled:x}),u.formState.errors.companyDomain&&e.jsx("p",{className:"text-sm text-destructive",children:u.formState.errors.companyDomain.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"defaultCurrency",children:"Default Currency"}),e.jsxs(Je,{onValueChange:N=>u.setValue("defaultCurrency",N),value:u.watch("defaultCurrency"),disabled:x,children:[e.jsx(Qe,{id:"defaultCurrency",children:e.jsx(et,{placeholder:"Select default currency"})}),e.jsx(Xe,{children:h==null?void 0:h.map(N=>e.jsxs(Ue,{value:N.code,children:[N.code," - ",N.name," (",N.symbol,")"]},N.code))})]}),u.formState.errors.defaultCurrency&&e.jsx("p",{className:"text-sm text-destructive",children:u.formState.errors.defaultCurrency.message})]})]}),e.jsx("div",{className:"flex justify-end p-6 pt-0",children:e.jsxs(ee,{type:"button",onClick:()=>m("module-assignment"),disabled:x,children:["Next ",e.jsx(qn,{className:"ml-2 h-4 w-4"})]})})]})}),e.jsx(Ve,{value:"module-assignment",children:e.jsxs(we,{children:[e.jsxs(Ae,{children:[e.jsx(Ee,{className:"text-lg",children:"Module Assignment"}),e.jsx(Re,{children:"Select which modules this new company will have access to. Core modules are enabled and locked by default."})]}),e.jsx(ke,{className:"grid gap-4",children:e.jsxs(dn,{defaultValue:"core-modules",children:[e.jsxs(sn,{className:"grid w-full grid-cols-3",children:[e.jsx(ze,{value:"core-modules",children:"Core Modules"}),e.jsx(ze,{value:"super-modules",children:"Super Modules"}),e.jsx(ze,{value:"add-on-modules",children:"Add-On Modules"})]}),e.jsx(Ve,{value:"core-modules",className:"mt-4",children:E(f)}),e.jsx(Ve,{value:"super-modules",className:"mt-4",children:E(_)}),e.jsx(Ve,{value:"add-on-modules",className:"mt-4",children:E(b)})]})}),e.jsxs("div",{className:"flex justify-between p-6 pt-0",children:[e.jsxs(ee,{type:"button",variant:"outline",onClick:()=>m("company-details"),disabled:x,children:[e.jsx(Xn,{className:"mr-2 h-4 w-4"})," Previous"]}),e.jsxs(ee,{type:"button",onClick:()=>m("admin-details"),disabled:x,children:["Next ",e.jsx(qn,{className:"ml-2 h-4 w-4"})]})]})]})}),e.jsx(Ve,{value:"admin-details",children:e.jsxs(we,{children:[e.jsxs(Ae,{children:[e.jsx(Ee,{className:"text-lg",children:"New Company Admin Details"}),e.jsx(Re,{children:"Create the first administrator account for this new company."})]}),e.jsxs(ke,{className:"grid gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"adminFirstName",children:"Admin First Name"}),e.jsx(ne,{id:"adminFirstName",...u.register("adminFirstName"),disabled:x}),u.formState.errors.adminFirstName&&e.jsx("p",{className:"text-sm text-destructive",children:u.formState.errors.adminFirstName.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"adminLastName",children:"Admin Last Name"}),e.jsx(ne,{id:"adminLastName",...u.register("adminLastName"),disabled:x}),u.formState.errors.adminLastName&&e.jsx("p",{className:"text-sm text-destructive",children:u.formState.errors.adminLastName.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"adminEmail",children:"Admin Email"}),e.jsx(ne,{id:"adminEmail",type:"email",...u.register("adminEmail"),disabled:x}),u.formState.errors.adminEmail&&e.jsx("p",{className:"text-sm text-destructive",children:u.formState.errors.adminEmail.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"adminPassword",children:"Admin Password"}),e.jsx(ne,{id:"adminPassword",type:"password",...u.register("adminPassword"),disabled:x}),u.formState.errors.adminPassword&&e.jsx("p",{className:"text-sm text-destructive",children:u.formState.errors.adminPassword.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"adminRole",children:"Admin Role"}),e.jsx(ne,{id:"adminRole",value:"admin",readOnly:!0,disabled:!0})]})]}),e.jsxs("div",{className:"flex justify-between p-6 pt-0",children:[e.jsxs(ee,{type:"button",variant:"outline",onClick:()=>m("module-assignment"),disabled:x,children:[e.jsx(Xn,{className:"mr-2 h-4 w-4"})," Previous"]}),e.jsxs(ee,{type:"submit",disabled:x,children:[x?e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Ku,{className:"mr-2 h-4 w-4"}),"Add Company & Admin"]})]})]})})]})]})]})})},sy=tt({first_name:J().min(1,"First name is required"),last_name:J().min(1,"Last name is required"),avatar_file:nr().optional().nullable()}),oy=()=>{const n=Ye(),{toast:a}=Ke(),t=kn(),{user:r,profile:i,isLoading:l}=Ie(),[c,m]=T.useState(null),u=ct({resolver:dt(sy),defaultValues:{first_name:(i==null?void 0:i.first_name)||"",last_name:(i==null?void 0:i.last_name)||"",avatar_file:null}});T.useEffect(()=>{i&&u.reset({first_name:i.first_name||"",last_name:i.last_name||"",avatar_file:null})},[i,u]),T.useEffect(()=>{!l&&i&&(i.first_name&&i.last_name?i.role==="super-admin"?t("/super-admin-dashboard",{replace:!0}):t("/",{replace:!0}):i.role==="admin"&&i.company_id&&t("/onboarding",{replace:!0}))},[i,l,t]);const h=Oe({mutationFn:async d=>{var g;if(!(r!=null&&r.id))throw new Error("User not authenticated.");let o=i==null?void 0:i.avatar_url;if(c){const v=c.name.split(".").pop(),x=`${r.id}/avatar.${v}`,{error:y}=await X.storage.from("avatars").upload(x,c,{upsert:!0});if(y)throw y;const{data:f}=X.storage.from("avatars").getPublicUrl(x);o=`${f.publicUrl}?t=${Date.now()}`}else if(c===null&&(i!=null&&i.avatar_url)){const v=(g=i.avatar_url.split("/public/avatars/")[1])==null?void 0:g.split("?")[0];v&&await X.storage.from("avatars").remove([v]),o=null}const{error:s}=await X.from("profiles").update({first_name:d.first_name,last_name:d.last_name,full_name:(d.first_name||"")+" "+(d.last_name||""),avatar_url:o,updated_at:new Date().toISOString()}).eq("user_id",r.id);if(s)throw s;return null},onSuccess:()=>{n.invalidateQueries({queryKey:["profiles"]}),a({title:"Profile Updated",description:"Your profile has been successfully completed."}),m(null),(i==null?void 0:i.role)==="super-admin"?t("/super-admin-dashboard",{replace:!0}):t("/",{replace:!0})},onError:d=>{a({title:"Error completing profile",description:d.message||"An unexpected error occurred.",variant:"destructive"})}}),p=d=>{h.mutate(d)};return l?e.jsxs("div",{className:"flex min-h-screen w-full flex-col items-center justify-center",children:[e.jsx(fe,{className:"h-8 w-8 animate-spin"}),e.jsx("p",{className:"ml-2",children:"Loading profile..."})]}):r?e.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gray-100 dark:bg-gray-900 p-4",children:e.jsxs("div",{className:"w-full max-w-md bg-white dark:bg-gray-800 p-8 rounded-lg shadow-md",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx("img",{src:"/infotrac-logo.png",alt:"INFOtrac Logo",className:"h-16 w-auto object-contain"})}),e.jsx("h2",{className:"text-2xl font-bold text-center mb-6 text-gray-900 dark:text-white",children:"Complete Your Profile"}),e.jsxs(we,{children:[e.jsxs(Ae,{children:[e.jsx(Ee,{children:"Personal Details"}),e.jsx(Re,{children:"Please provide your first name, last name, and an optional avatar."})]}),e.jsx(ke,{children:e.jsxs("form",{onSubmit:u.handleSubmit(p),className:"grid gap-6",children:[e.jsx("div",{className:"flex flex-col items-center gap-4",children:e.jsx(gs,{currentAvatarUrl:i==null?void 0:i.avatar_url,onFileSelected:m,isLoading:h.isPending,disabled:h.isPending})}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"first_name",children:"First Name"}),e.jsx(ne,{id:"first_name",...u.register("first_name"),disabled:h.isPending}),u.formState.errors.first_name&&e.jsx("p",{className:"text-sm text-destructive",children:u.formState.errors.first_name.message})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"last_name",children:"Last Name"}),e.jsx(ne,{id:"last_name",...u.register("last_name"),disabled:h.isPending}),u.formState.errors.last_name&&e.jsx("p",{className:"text-sm text-destructive",children:u.formState.errors.last_name.message})]}),e.jsxs(ee,{type:"submit",disabled:h.isPending,children:[h.isPending&&e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Profile"]})]})})]})]})}):(t("/login",{replace:!0}),null)},ly=tt({sender_email:J().email("Invalid email address").min(1,"Sender email is required"),smtp_host:J().optional().nullable(),smtp_port:gt(n=>n===""?null:Number(n),yt().int().positive("Port must be a positive integer").nullable().optional()),smtp_username:J().optional().nullable(),smtp_password:J().optional().nullable(),email_api_key:J().optional().nullable()}),cy=({companyId:n})=>{const a=Ye(),{toast:t}=Ke(),{profile:r,isLoading:i}=Ie(),l=r==null?void 0:r.role,{data:c,isLoading:m}=je({queryKey:["companySmtpSettings",n],queryFn:async()=>{if(!n)return null;const{data:o,error:s}=await X.from("company_smtp_settings").select("*").eq("company_id",n).single();if(s&&s.code!=="PGRST116")throw s;return o},enabled:!!n&&!i}),u=ct({resolver:dt(ly),defaultValues:{sender_email:"",smtp_host:"",smtp_port:void 0,smtp_username:"",smtp_password:"",email_api_key:""}});T.useEffect(()=>{c&&u.reset({sender_email:c.sender_email,smtp_host:c.smtp_host||"",smtp_port:c.smtp_port||void 0,smtp_username:c.smtp_username||"",smtp_password:"",email_api_key:""})},[c,u]);const h=Oe({mutationFn:async o=>{if(!n)throw new Error("Company not identified.");if(l==="admin"&&n!==(r==null?void 0:r.company_id))throw new Error("Access Denied: You can only manage SMTP settings for your own company.");const{error:s}=await X.functions.invoke("upsert-company-smtp-settings",{body:{...o,company_id:n}});if(s)throw s},onSuccess:()=>{a.invalidateQueries({queryKey:["companySmtpSettings",n]}),t({title:"Settings Saved",description:"Your company's email settings have been updated."}),u.setValue("smtp_password",""),u.setValue("email_api_key","")},onError:o=>{t({title:"Error Saving Settings",description:o.message,variant:"destructive"})}}),p=o=>{h.mutate(o)},d=l&&(l==="super-admin"||l==="admin"&&n===(r==null?void 0:r.company_id));return i||m?e.jsx("div",{className:"flex justify-center p-8",children:e.jsx(fe,{className:"h-6 w-6 animate-spin"})}):d?e.jsxs(we,{className:"mt-4",children:[e.jsxs(Ae,{children:[e.jsx(Ee,{children:"Company SMTP Settings"}),e.jsx(Re,{children:"Configure your company's own SMTP server or email service API key. If left blank, the system default will be used."})]}),e.jsx(ke,{children:e.jsxs("form",{onSubmit:u.handleSubmit(p),className:"grid gap-6",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"sender_email",children:"Sender Email Address"}),e.jsx(ne,{id:"sender_email",type:"email",...u.register("sender_email"),disabled:h.isPending}),u.formState.errors.sender_email&&e.jsx("p",{className:"text-sm text-destructive",children:u.formState.errors.sender_email.message})]}),e.jsx("h3",{className:"text-lg font-semibold mt-4",children:"SMTP Credentials (Optional)"}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"smtp_host",children:"SMTP Host"}),e.jsx(ne,{id:"smtp_host",...u.register("smtp_host"),disabled:h.isPending})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"smtp_port",children:"SMTP Port"}),e.jsx(ne,{id:"smtp_port",type:"number",...u.register("smtp_port"),disabled:h.isPending}),u.formState.errors.smtp_port&&e.jsx("p",{className:"text-sm text-destructive",children:u.formState.errors.smtp_port.message})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"smtp_username",children:"SMTP Username"}),e.jsx(ne,{id:"smtp_username",...u.register("smtp_username"),disabled:h.isPending})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"smtp_password",children:"SMTP Password (will not be displayed)"}),e.jsx(ne,{id:"smtp_password",type:"password",...u.register("smtp_password"),disabled:h.isPending})]}),e.jsx("h3",{className:"text-lg font-semibold mt-4",children:"Email API Key (Optional)"}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"email_api_key",children:"Email API Key (will not be displayed)"}),e.jsx(ne,{id:"email_api_key",type:"password",...u.register("email_api_key"),disabled:h.isPending})]}),e.jsxs(ee,{type:"submit",disabled:h.isPending,className:"mt-4",children:[h.isPending?e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(pn,{className:"mr-2 h-4 w-4"}),"Save Settings"]})]})})]}):e.jsx("div",{className:"flex flex-1 items-center justify-center text-destructive",children:e.jsx("p",{children:"Access Denied: You do not have permission to manage these SMTP settings."})})};var va={exports:{}};/*!
 * Quill Editor v1.3.7
 * https://quilljs.com/
 * Copyright (c) 2014, Jason Chen
 * Copyright (c) 2013, salesforce.com
 */var dy=va.exports,wo;function uy(){return wo||(wo=1,function(n,a){(function(r,i){n.exports=i()})(typeof self<"u"?self:dy,function(){return function(t){var r={};function i(l){if(r[l])return r[l].exports;var c=r[l]={i:l,l:!1,exports:{}};return t[l].call(c.exports,c,c.exports,i),c.l=!0,c.exports}return i.m=t,i.c=r,i.d=function(l,c,m){i.o(l,c)||Object.defineProperty(l,c,{configurable:!1,enumerable:!0,get:m})},i.n=function(l){var c=l&&l.__esModule?function(){return l.default}:function(){return l};return i.d(c,"a",c),c},i.o=function(l,c){return Object.prototype.hasOwnProperty.call(l,c)},i.p="",i(i.s=109)}([function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0});var l=i(17),c=i(18),m=i(19),u=i(45),h=i(46),p=i(47),d=i(48),o=i(49),s=i(12),g=i(32),v=i(33),x=i(31),y=i(1),f={Scope:y.Scope,create:y.create,find:y.find,query:y.query,register:y.register,Container:l.default,Format:c.default,Leaf:m.default,Embed:d.default,Scroll:u.default,Block:p.default,Inline:h.default,Text:o.default,Attributor:{Attribute:s.default,Class:g.default,Style:v.default,Store:x.default}};r.default=f},function(t,r,i){var l=this&&this.__extends||function(){var x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(y,f){y.__proto__=f}||function(y,f){for(var _ in f)f.hasOwnProperty(_)&&(y[_]=f[_])};return function(y,f){x(y,f);function _(){this.constructor=y}y.prototype=f===null?Object.create(f):(_.prototype=f.prototype,new _)}}();Object.defineProperty(r,"__esModule",{value:!0});var c=function(x){l(y,x);function y(f){var _=this;return f="[Parchment] "+f,_=x.call(this,f)||this,_.message=f,_.name=_.constructor.name,_}return y}(Error);r.ParchmentError=c;var m={},u={},h={},p={};r.DATA_KEY="__blot";var d;(function(x){x[x.TYPE=3]="TYPE",x[x.LEVEL=12]="LEVEL",x[x.ATTRIBUTE=13]="ATTRIBUTE",x[x.BLOT=14]="BLOT",x[x.INLINE=7]="INLINE",x[x.BLOCK=11]="BLOCK",x[x.BLOCK_BLOT=10]="BLOCK_BLOT",x[x.INLINE_BLOT=6]="INLINE_BLOT",x[x.BLOCK_ATTRIBUTE=9]="BLOCK_ATTRIBUTE",x[x.INLINE_ATTRIBUTE=5]="INLINE_ATTRIBUTE",x[x.ANY=15]="ANY"})(d=r.Scope||(r.Scope={}));function o(x,y){var f=g(x);if(f==null)throw new c("Unable to create "+x+" blot");var _=f,b=x instanceof Node||x.nodeType===Node.TEXT_NODE?x:_.create(y);return new _(b,y)}r.create=o;function s(x,y){return y===void 0&&(y=!1),x==null?null:x[r.DATA_KEY]!=null?x[r.DATA_KEY].blot:y?s(x.parentNode,y):null}r.find=s;function g(x,y){y===void 0&&(y=d.ANY);var f;if(typeof x=="string")f=p[x]||m[x];else if(x instanceof Text||x.nodeType===Node.TEXT_NODE)f=p.text;else if(typeof x=="number")x&d.LEVEL&d.BLOCK?f=p.block:x&d.LEVEL&d.INLINE&&(f=p.inline);else if(x instanceof HTMLElement){var _=(x.getAttribute("class")||"").split(/\s+/);for(var b in _)if(f=u[_[b]],f)break;f=f||h[x.tagName]}return f==null?null:y&d.LEVEL&f.scope&&y&d.TYPE&f.scope?f:null}r.query=g;function v(){for(var x=[],y=0;y<arguments.length;y++)x[y]=arguments[y];if(x.length>1)return x.map(function(b){return v(b)});var f=x[0];if(typeof f.blotName!="string"&&typeof f.attrName!="string")throw new c("Invalid definition");if(f.blotName==="abstract")throw new c("Cannot register abstract class");if(p[f.blotName||f.attrName]=f,typeof f.keyName=="string")m[f.keyName]=f;else if(f.className!=null&&(u[f.className]=f),f.tagName!=null){Array.isArray(f.tagName)?f.tagName=f.tagName.map(function(b){return b.toUpperCase()}):f.tagName=f.tagName.toUpperCase();var _=Array.isArray(f.tagName)?f.tagName:[f.tagName];_.forEach(function(b){(h[b]==null||f.className==null)&&(h[b]=f)})}return f}r.register=v},function(t,r,i){var l=i(51),c=i(11),m=i(3),u=i(20),h="\0",p=function(d){Array.isArray(d)?this.ops=d:d!=null&&Array.isArray(d.ops)?this.ops=d.ops:this.ops=[]};p.prototype.insert=function(d,o){var s={};return d.length===0?this:(s.insert=d,o!=null&&typeof o=="object"&&Object.keys(o).length>0&&(s.attributes=o),this.push(s))},p.prototype.delete=function(d){return d<=0?this:this.push({delete:d})},p.prototype.retain=function(d,o){if(d<=0)return this;var s={retain:d};return o!=null&&typeof o=="object"&&Object.keys(o).length>0&&(s.attributes=o),this.push(s)},p.prototype.push=function(d){var o=this.ops.length,s=this.ops[o-1];if(d=m(!0,{},d),typeof s=="object"){if(typeof d.delete=="number"&&typeof s.delete=="number")return this.ops[o-1]={delete:s.delete+d.delete},this;if(typeof s.delete=="number"&&d.insert!=null&&(o-=1,s=this.ops[o-1],typeof s!="object"))return this.ops.unshift(d),this;if(c(d.attributes,s.attributes)){if(typeof d.insert=="string"&&typeof s.insert=="string")return this.ops[o-1]={insert:s.insert+d.insert},typeof d.attributes=="object"&&(this.ops[o-1].attributes=d.attributes),this;if(typeof d.retain=="number"&&typeof s.retain=="number")return this.ops[o-1]={retain:s.retain+d.retain},typeof d.attributes=="object"&&(this.ops[o-1].attributes=d.attributes),this}}return o===this.ops.length?this.ops.push(d):this.ops.splice(o,0,d),this},p.prototype.chop=function(){var d=this.ops[this.ops.length-1];return d&&d.retain&&!d.attributes&&this.ops.pop(),this},p.prototype.filter=function(d){return this.ops.filter(d)},p.prototype.forEach=function(d){this.ops.forEach(d)},p.prototype.map=function(d){return this.ops.map(d)},p.prototype.partition=function(d){var o=[],s=[];return this.forEach(function(g){var v=d(g)?o:s;v.push(g)}),[o,s]},p.prototype.reduce=function(d,o){return this.ops.reduce(d,o)},p.prototype.changeLength=function(){return this.reduce(function(d,o){return o.insert?d+u.length(o):o.delete?d-o.delete:d},0)},p.prototype.length=function(){return this.reduce(function(d,o){return d+u.length(o)},0)},p.prototype.slice=function(d,o){d=d||0,typeof o!="number"&&(o=1/0);for(var s=[],g=u.iterator(this.ops),v=0;v<o&&g.hasNext();){var x;v<d?x=g.next(d-v):(x=g.next(o-v),s.push(x)),v+=u.length(x)}return new p(s)},p.prototype.compose=function(d){var o=u.iterator(this.ops),s=u.iterator(d.ops),g=[],v=s.peek();if(v!=null&&typeof v.retain=="number"&&v.attributes==null){for(var x=v.retain;o.peekType()==="insert"&&o.peekLength()<=x;)x-=o.peekLength(),g.push(o.next());v.retain-x>0&&s.next(v.retain-x)}for(var y=new p(g);o.hasNext()||s.hasNext();)if(s.peekType()==="insert")y.push(s.next());else if(o.peekType()==="delete")y.push(o.next());else{var f=Math.min(o.peekLength(),s.peekLength()),_=o.next(f),b=s.next(f);if(typeof b.retain=="number"){var E={};typeof _.retain=="number"?E.retain=f:E.insert=_.insert;var N=u.attributes.compose(_.attributes,b.attributes,typeof _.retain=="number");if(N&&(E.attributes=N),y.push(E),!s.hasNext()&&c(y.ops[y.ops.length-1],E)){var j=new p(o.rest());return y.concat(j).chop()}}else typeof b.delete=="number"&&typeof _.retain=="number"&&y.push(b)}return y.chop()},p.prototype.concat=function(d){var o=new p(this.ops.slice());return d.ops.length>0&&(o.push(d.ops[0]),o.ops=o.ops.concat(d.ops.slice(1))),o},p.prototype.diff=function(d,o){if(this.ops===d.ops)return new p;var s=[this,d].map(function(f){return f.map(function(_){if(_.insert!=null)return typeof _.insert=="string"?_.insert:h;var b=f===d?"on":"with";throw new Error("diff() called "+b+" non-document")}).join("")}),g=new p,v=l(s[0],s[1],o),x=u.iterator(this.ops),y=u.iterator(d.ops);return v.forEach(function(f){for(var _=f[1].length;_>0;){var b=0;switch(f[0]){case l.INSERT:b=Math.min(y.peekLength(),_),g.push(y.next(b));break;case l.DELETE:b=Math.min(_,x.peekLength()),x.next(b),g.delete(b);break;case l.EQUAL:b=Math.min(x.peekLength(),y.peekLength(),_);var E=x.next(b),N=y.next(b);c(E.insert,N.insert)?g.retain(b,u.attributes.diff(E.attributes,N.attributes)):g.push(N).delete(b);break}_-=b}}),g.chop()},p.prototype.eachLine=function(d,o){o=o||`
`;for(var s=u.iterator(this.ops),g=new p,v=0;s.hasNext();){if(s.peekType()!=="insert")return;var x=s.peek(),y=u.length(x)-s.peekLength(),f=typeof x.insert=="string"?x.insert.indexOf(o,y)-y:-1;if(f<0)g.push(s.next());else if(f>0)g.push(s.next(f));else{if(d(g,s.next(1).attributes||{},v)===!1)return;v+=1,g=new p}}g.length()>0&&d(g,{},v)},p.prototype.transform=function(d,o){if(o=!!o,typeof d=="number")return this.transformPosition(d,o);for(var s=u.iterator(this.ops),g=u.iterator(d.ops),v=new p;s.hasNext()||g.hasNext();)if(s.peekType()==="insert"&&(o||g.peekType()!=="insert"))v.retain(u.length(s.next()));else if(g.peekType()==="insert")v.push(g.next());else{var x=Math.min(s.peekLength(),g.peekLength()),y=s.next(x),f=g.next(x);if(y.delete)continue;f.delete?v.push(f):v.retain(x,u.attributes.transform(y.attributes,f.attributes,o))}return v.chop()},p.prototype.transformPosition=function(d,o){o=!!o;for(var s=u.iterator(this.ops),g=0;s.hasNext()&&g<=d;){var v=s.peekLength(),x=s.peekType();if(s.next(),x==="delete"){d-=Math.min(v,d-g);continue}else x==="insert"&&(g<d||!o)&&(d+=v);g+=v}return d},t.exports=p},function(t,r){var i=Object.prototype.hasOwnProperty,l=Object.prototype.toString,c=Object.defineProperty,m=Object.getOwnPropertyDescriptor,u=function(s){return typeof Array.isArray=="function"?Array.isArray(s):l.call(s)==="[object Array]"},h=function(s){if(!s||l.call(s)!=="[object Object]")return!1;var g=i.call(s,"constructor"),v=s.constructor&&s.constructor.prototype&&i.call(s.constructor.prototype,"isPrototypeOf");if(s.constructor&&!g&&!v)return!1;var x;for(x in s);return typeof x>"u"||i.call(s,x)},p=function(s,g){c&&g.name==="__proto__"?c(s,g.name,{enumerable:!0,configurable:!0,value:g.newValue,writable:!0}):s[g.name]=g.newValue},d=function(s,g){if(g==="__proto__")if(i.call(s,g)){if(m)return m(s,g).value}else return;return s[g]};t.exports=function o(){var s,g,v,x,y,f,_=arguments[0],b=1,E=arguments.length,N=!1;for(typeof _=="boolean"&&(N=_,_=arguments[1]||{},b=2),(_==null||typeof _!="object"&&typeof _!="function")&&(_={});b<E;++b)if(s=arguments[b],s!=null)for(g in s)v=d(_,g),x=d(s,g),_!==x&&(N&&x&&(h(x)||(y=u(x)))?(y?(y=!1,f=v&&u(v)?v:[]):f=v&&h(v)?v:{},p(_,{name:g,newValue:o(N,f,x)})):typeof x<"u"&&p(_,{name:g,newValue:x}));return _}},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0}),r.default=r.BlockEmbed=r.bubbleFormats=void 0;var l=function(){function w(S,P){for(var O=0;O<P.length;O++){var L=P[O];L.enumerable=L.enumerable||!1,L.configurable=!0,"value"in L&&(L.writable=!0),Object.defineProperty(S,L.key,L)}}return function(S,P,O){return P&&w(S.prototype,P),O&&w(S,O),S}}(),c=function w(S,P,O){S===null&&(S=Function.prototype);var L=Object.getOwnPropertyDescriptor(S,P);if(L===void 0){var $=Object.getPrototypeOf(S);return $===null?void 0:w($,P,O)}else{if("value"in L)return L.value;var B=L.get;return B===void 0?void 0:B.call(O)}},m=i(3),u=_(m),h=i(2),p=_(h),d=i(0),o=_(d),s=i(16),g=_(s),v=i(6),x=_(v),y=i(7),f=_(y);function _(w){return w&&w.__esModule?w:{default:w}}function b(w,S){if(!(w instanceof S))throw new TypeError("Cannot call a class as a function")}function E(w,S){if(!w)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return S&&(typeof S=="object"||typeof S=="function")?S:w}function N(w,S){if(typeof S!="function"&&S!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof S);w.prototype=Object.create(S&&S.prototype,{constructor:{value:w,enumerable:!1,writable:!0,configurable:!0}}),S&&(Object.setPrototypeOf?Object.setPrototypeOf(w,S):w.__proto__=S)}var j=1,C=function(w){N(S,w);function S(){return b(this,S),E(this,(S.__proto__||Object.getPrototypeOf(S)).apply(this,arguments))}return l(S,[{key:"attach",value:function(){c(S.prototype.__proto__||Object.getPrototypeOf(S.prototype),"attach",this).call(this),this.attributes=new o.default.Attributor.Store(this.domNode)}},{key:"delta",value:function(){return new p.default().insert(this.value(),(0,u.default)(this.formats(),this.attributes.values()))}},{key:"format",value:function(O,L){var $=o.default.query(O,o.default.Scope.BLOCK_ATTRIBUTE);$!=null&&this.attributes.attribute($,L)}},{key:"formatAt",value:function(O,L,$,B){this.format($,B)}},{key:"insertAt",value:function(O,L,$){if(typeof L=="string"&&L.endsWith(`
`)){var B=o.default.create(D.blotName);this.parent.insertBefore(B,O===0?this:this.next),B.insertAt(0,L.slice(0,-1))}else c(S.prototype.__proto__||Object.getPrototypeOf(S.prototype),"insertAt",this).call(this,O,L,$)}}]),S}(o.default.Embed);C.scope=o.default.Scope.BLOCK_BLOT;var D=function(w){N(S,w);function S(P){b(this,S);var O=E(this,(S.__proto__||Object.getPrototypeOf(S)).call(this,P));return O.cache={},O}return l(S,[{key:"delta",value:function(){return this.cache.delta==null&&(this.cache.delta=this.descendants(o.default.Leaf).reduce(function(O,L){return L.length()===0?O:O.insert(L.value(),k(L))},new p.default).insert(`
`,k(this))),this.cache.delta}},{key:"deleteAt",value:function(O,L){c(S.prototype.__proto__||Object.getPrototypeOf(S.prototype),"deleteAt",this).call(this,O,L),this.cache={}}},{key:"formatAt",value:function(O,L,$,B){L<=0||(o.default.query($,o.default.Scope.BLOCK)?O+L===this.length()&&this.format($,B):c(S.prototype.__proto__||Object.getPrototypeOf(S.prototype),"formatAt",this).call(this,O,Math.min(L,this.length()-O-1),$,B),this.cache={})}},{key:"insertAt",value:function(O,L,$){if($!=null)return c(S.prototype.__proto__||Object.getPrototypeOf(S.prototype),"insertAt",this).call(this,O,L,$);if(L.length!==0){var B=L.split(`
`),Y=B.shift();Y.length>0&&(O<this.length()-1||this.children.tail==null?c(S.prototype.__proto__||Object.getPrototypeOf(S.prototype),"insertAt",this).call(this,Math.min(O,this.length()-1),Y):this.children.tail.insertAt(this.children.tail.length(),Y),this.cache={});var U=this;B.reduce(function(q,R){return U=U.split(q,!0),U.insertAt(0,R),R.length},O+Y.length)}}},{key:"insertBefore",value:function(O,L){var $=this.children.head;c(S.prototype.__proto__||Object.getPrototypeOf(S.prototype),"insertBefore",this).call(this,O,L),$ instanceof g.default&&$.remove(),this.cache={}}},{key:"length",value:function(){return this.cache.length==null&&(this.cache.length=c(S.prototype.__proto__||Object.getPrototypeOf(S.prototype),"length",this).call(this)+j),this.cache.length}},{key:"moveChildren",value:function(O,L){c(S.prototype.__proto__||Object.getPrototypeOf(S.prototype),"moveChildren",this).call(this,O,L),this.cache={}}},{key:"optimize",value:function(O){c(S.prototype.__proto__||Object.getPrototypeOf(S.prototype),"optimize",this).call(this,O),this.cache={}}},{key:"path",value:function(O){return c(S.prototype.__proto__||Object.getPrototypeOf(S.prototype),"path",this).call(this,O,!0)}},{key:"removeChild",value:function(O){c(S.prototype.__proto__||Object.getPrototypeOf(S.prototype),"removeChild",this).call(this,O),this.cache={}}},{key:"split",value:function(O){var L=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(L&&(O===0||O>=this.length()-j)){var $=this.clone();return O===0?(this.parent.insertBefore($,this),this):(this.parent.insertBefore($,this.next),$)}else{var B=c(S.prototype.__proto__||Object.getPrototypeOf(S.prototype),"split",this).call(this,O,L);return this.cache={},B}}}]),S}(o.default.Block);D.blotName="block",D.tagName="P",D.defaultChild="break",D.allowedChildren=[x.default,o.default.Embed,f.default];function k(w){var S=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return w==null||(typeof w.formats=="function"&&(S=(0,u.default)(S,w.formats())),w.parent==null||w.parent.blotName=="scroll"||w.parent.statics.scope!==w.statics.scope)?S:k(w.parent,S)}r.bubbleFormats=k,r.BlockEmbed=C,r.default=D},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0}),r.default=r.overload=r.expandConfig=void 0;var l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(U){return typeof U}:function(U){return U&&typeof Symbol=="function"&&U.constructor===Symbol&&U!==Symbol.prototype?"symbol":typeof U},c=function(){function U(q,R){var F=[],M=!0,z=!1,H=void 0;try{for(var I=q[Symbol.iterator](),A;!(M=(A=I.next()).done)&&(F.push(A.value),!(R&&F.length===R));M=!0);}catch(V){z=!0,H=V}finally{try{!M&&I.return&&I.return()}finally{if(z)throw H}}return F}return function(q,R){if(Array.isArray(q))return q;if(Symbol.iterator in Object(q))return U(q,R);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),m=function(){function U(q,R){for(var F=0;F<R.length;F++){var M=R[F];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(q,M.key,M)}}return function(q,R,F){return R&&U(q.prototype,R),F&&U(q,F),q}}();i(50);var u=i(2),h=k(u),p=i(14),d=k(p),o=i(8),s=k(o),g=i(9),v=k(g),x=i(0),y=k(x),f=i(15),_=k(f),b=i(3),E=k(b),N=i(10),j=k(N),C=i(34),D=k(C);function k(U){return U&&U.__esModule?U:{default:U}}function w(U,q,R){return q in U?Object.defineProperty(U,q,{value:R,enumerable:!0,configurable:!0,writable:!0}):U[q]=R,U}function S(U,q){if(!(U instanceof q))throw new TypeError("Cannot call a class as a function")}var P=(0,j.default)("quill"),O=function(){m(U,null,[{key:"debug",value:function(R){R===!0&&(R="log"),j.default.level(R)}},{key:"find",value:function(R){return R.__quill||y.default.find(R)}},{key:"import",value:function(R){return this.imports[R]==null&&P.error("Cannot import "+R+". Are you sure it was registered?"),this.imports[R]}},{key:"register",value:function(R,F){var M=this,z=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(typeof R!="string"){var H=R.attrName||R.blotName;typeof H=="string"?this.register("formats/"+H,R,F):Object.keys(R).forEach(function(I){M.register(I,R[I],F)})}else this.imports[R]!=null&&!z&&P.warn("Overwriting "+R+" with",F),this.imports[R]=F,(R.startsWith("blots/")||R.startsWith("formats/"))&&F.blotName!=="abstract"?y.default.register(F):R.startsWith("modules")&&typeof F.register=="function"&&F.register()}}]);function U(q){var R=this,F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(S(this,U),this.options=L(q,F),this.container=this.options.container,this.container==null)return P.error("Invalid Quill container",q);this.options.debug&&U.debug(this.options.debug);var M=this.container.innerHTML.trim();this.container.classList.add("ql-container"),this.container.innerHTML="",this.container.__quill=this,this.root=this.addContainer("ql-editor"),this.root.classList.add("ql-blank"),this.root.setAttribute("data-gramm",!1),this.scrollingContainer=this.options.scrollingContainer||this.root,this.emitter=new s.default,this.scroll=y.default.create(this.root,{emitter:this.emitter,whitelist:this.options.formats}),this.editor=new d.default(this.scroll),this.selection=new _.default(this.scroll,this.emitter),this.theme=new this.options.theme(this,this.options),this.keyboard=this.theme.addModule("keyboard"),this.clipboard=this.theme.addModule("clipboard"),this.history=this.theme.addModule("history"),this.theme.init(),this.emitter.on(s.default.events.EDITOR_CHANGE,function(H){H===s.default.events.TEXT_CHANGE&&R.root.classList.toggle("ql-blank",R.editor.isBlank())}),this.emitter.on(s.default.events.SCROLL_UPDATE,function(H,I){var A=R.selection.lastRange,V=A&&A.length===0?A.index:void 0;$.call(R,function(){return R.editor.update(null,I,V)},H)});var z=this.clipboard.convert(`<div class='ql-editor' style="white-space: normal;">`+M+"<p><br></p></div>");this.setContents(z),this.history.clear(),this.options.placeholder&&this.root.setAttribute("data-placeholder",this.options.placeholder),this.options.readOnly&&this.disable()}return m(U,[{key:"addContainer",value:function(R){var F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(typeof R=="string"){var M=R;R=document.createElement("div"),R.classList.add(M)}return this.container.insertBefore(R,F),R}},{key:"blur",value:function(){this.selection.setRange(null)}},{key:"deleteText",value:function(R,F,M){var z=this,H=B(R,F,M),I=c(H,4);return R=I[0],F=I[1],M=I[3],$.call(this,function(){return z.editor.deleteText(R,F)},M,R,-1*F)}},{key:"disable",value:function(){this.enable(!1)}},{key:"enable",value:function(){var R=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.scroll.enable(R),this.container.classList.toggle("ql-disabled",!R)}},{key:"focus",value:function(){var R=this.scrollingContainer.scrollTop;this.selection.focus(),this.scrollingContainer.scrollTop=R,this.scrollIntoView()}},{key:"format",value:function(R,F){var M=this,z=arguments.length>2&&arguments[2]!==void 0?arguments[2]:s.default.sources.API;return $.call(this,function(){var H=M.getSelection(!0),I=new h.default;if(H==null)return I;if(y.default.query(R,y.default.Scope.BLOCK))I=M.editor.formatLine(H.index,H.length,w({},R,F));else{if(H.length===0)return M.selection.format(R,F),I;I=M.editor.formatText(H.index,H.length,w({},R,F))}return M.setSelection(H,s.default.sources.SILENT),I},z)}},{key:"formatLine",value:function(R,F,M,z,H){var I=this,A=void 0,V=B(R,F,M,z,H),K=c(V,4);return R=K[0],F=K[1],A=K[2],H=K[3],$.call(this,function(){return I.editor.formatLine(R,F,A)},H,R,0)}},{key:"formatText",value:function(R,F,M,z,H){var I=this,A=void 0,V=B(R,F,M,z,H),K=c(V,4);return R=K[0],F=K[1],A=K[2],H=K[3],$.call(this,function(){return I.editor.formatText(R,F,A)},H,R,0)}},{key:"getBounds",value:function(R){var F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,M=void 0;typeof R=="number"?M=this.selection.getBounds(R,F):M=this.selection.getBounds(R.index,R.length);var z=this.container.getBoundingClientRect();return{bottom:M.bottom-z.top,height:M.height,left:M.left-z.left,right:M.right-z.left,top:M.top-z.top,width:M.width}}},{key:"getContents",value:function(){var R=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.getLength()-R,M=B(R,F),z=c(M,2);return R=z[0],F=z[1],this.editor.getContents(R,F)}},{key:"getFormat",value:function(){var R=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.getSelection(!0),F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return typeof R=="number"?this.editor.getFormat(R,F):this.editor.getFormat(R.index,R.length)}},{key:"getIndex",value:function(R){return R.offset(this.scroll)}},{key:"getLength",value:function(){return this.scroll.length()}},{key:"getLeaf",value:function(R){return this.scroll.leaf(R)}},{key:"getLine",value:function(R){return this.scroll.line(R)}},{key:"getLines",value:function(){var R=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.MAX_VALUE;return typeof R!="number"?this.scroll.lines(R.index,R.length):this.scroll.lines(R,F)}},{key:"getModule",value:function(R){return this.theme.modules[R]}},{key:"getSelection",value:function(){var R=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return R&&this.focus(),this.update(),this.selection.getRange()[0]}},{key:"getText",value:function(){var R=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.getLength()-R,M=B(R,F),z=c(M,2);return R=z[0],F=z[1],this.editor.getText(R,F)}},{key:"hasFocus",value:function(){return this.selection.hasFocus()}},{key:"insertEmbed",value:function(R,F,M){var z=this,H=arguments.length>3&&arguments[3]!==void 0?arguments[3]:U.sources.API;return $.call(this,function(){return z.editor.insertEmbed(R,F,M)},H,R)}},{key:"insertText",value:function(R,F,M,z,H){var I=this,A=void 0,V=B(R,0,M,z,H),K=c(V,4);return R=K[0],A=K[2],H=K[3],$.call(this,function(){return I.editor.insertText(R,F,A)},H,R,F.length)}},{key:"isEnabled",value:function(){return!this.container.classList.contains("ql-disabled")}},{key:"off",value:function(){return this.emitter.off.apply(this.emitter,arguments)}},{key:"on",value:function(){return this.emitter.on.apply(this.emitter,arguments)}},{key:"once",value:function(){return this.emitter.once.apply(this.emitter,arguments)}},{key:"pasteHTML",value:function(R,F,M){this.clipboard.dangerouslyPasteHTML(R,F,M)}},{key:"removeFormat",value:function(R,F,M){var z=this,H=B(R,F,M),I=c(H,4);return R=I[0],F=I[1],M=I[3],$.call(this,function(){return z.editor.removeFormat(R,F)},M,R)}},{key:"scrollIntoView",value:function(){this.selection.scrollIntoView(this.scrollingContainer)}},{key:"setContents",value:function(R){var F=this,M=arguments.length>1&&arguments[1]!==void 0?arguments[1]:s.default.sources.API;return $.call(this,function(){R=new h.default(R);var z=F.getLength(),H=F.editor.deleteText(0,z),I=F.editor.applyDelta(R),A=I.ops[I.ops.length-1];A!=null&&typeof A.insert=="string"&&A.insert[A.insert.length-1]===`
`&&(F.editor.deleteText(F.getLength()-1,1),I.delete(1));var V=H.compose(I);return V},M)}},{key:"setSelection",value:function(R,F,M){if(R==null)this.selection.setRange(null,F||U.sources.API);else{var z=B(R,F,M),H=c(z,4);R=H[0],F=H[1],M=H[3],this.selection.setRange(new f.Range(R,F),M),M!==s.default.sources.SILENT&&this.selection.scrollIntoView(this.scrollingContainer)}}},{key:"setText",value:function(R){var F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:s.default.sources.API,M=new h.default().insert(R);return this.setContents(M,F)}},{key:"update",value:function(){var R=arguments.length>0&&arguments[0]!==void 0?arguments[0]:s.default.sources.USER,F=this.scroll.update(R);return this.selection.update(R),F}},{key:"updateContents",value:function(R){var F=this,M=arguments.length>1&&arguments[1]!==void 0?arguments[1]:s.default.sources.API;return $.call(this,function(){return R=new h.default(R),F.editor.applyDelta(R,M)},M,!0)}}]),U}();O.DEFAULTS={bounds:null,formats:null,modules:{},placeholder:"",readOnly:!1,scrollingContainer:null,strict:!0,theme:"default"},O.events=s.default.events,O.sources=s.default.sources,O.version="1.3.7",O.imports={delta:h.default,parchment:y.default,"core/module":v.default,"core/theme":D.default};function L(U,q){if(q=(0,E.default)(!0,{container:U,modules:{clipboard:!0,keyboard:!0,history:!0}},q),!q.theme||q.theme===O.DEFAULTS.theme)q.theme=D.default;else if(q.theme=O.import("themes/"+q.theme),q.theme==null)throw new Error("Invalid theme "+q.theme+". Did you register it?");var R=(0,E.default)(!0,{},q.theme.DEFAULTS);[R,q].forEach(function(z){z.modules=z.modules||{},Object.keys(z.modules).forEach(function(H){z.modules[H]===!0&&(z.modules[H]={})})});var F=Object.keys(R.modules).concat(Object.keys(q.modules)),M=F.reduce(function(z,H){var I=O.import("modules/"+H);return I==null?P.error("Cannot load "+H+" module. Are you sure you registered it?"):z[H]=I.DEFAULTS||{},z},{});return q.modules!=null&&q.modules.toolbar&&q.modules.toolbar.constructor!==Object&&(q.modules.toolbar={container:q.modules.toolbar}),q=(0,E.default)(!0,{},O.DEFAULTS,{modules:M},R,q),["bounds","container","scrollingContainer"].forEach(function(z){typeof q[z]=="string"&&(q[z]=document.querySelector(q[z]))}),q.modules=Object.keys(q.modules).reduce(function(z,H){return q.modules[H]&&(z[H]=q.modules[H]),z},{}),q}function $(U,q,R,F){if(this.options.strict&&!this.isEnabled()&&q===s.default.sources.USER)return new h.default;var M=R==null?null:this.getSelection(),z=this.editor.delta,H=U();if(M!=null&&(R===!0&&(R=M.index),F==null?M=Y(M,H,q):F!==0&&(M=Y(M,R,F,q)),this.setSelection(M,s.default.sources.SILENT)),H.length()>0){var I,A=[s.default.events.TEXT_CHANGE,H,z,q];if((I=this.emitter).emit.apply(I,[s.default.events.EDITOR_CHANGE].concat(A)),q!==s.default.sources.SILENT){var V;(V=this.emitter).emit.apply(V,A)}}return H}function B(U,q,R,F,M){var z={};return typeof U.index=="number"&&typeof U.length=="number"?typeof q!="number"?(M=F,F=R,R=q,q=U.length,U=U.index):(q=U.length,U=U.index):typeof q!="number"&&(M=F,F=R,R=q,q=0),(typeof R>"u"?"undefined":l(R))==="object"?(z=R,M=F):typeof R=="string"&&(F!=null?z[R]=F:M=R),M=M||s.default.sources.API,[U,q,z,M]}function Y(U,q,R,F){if(U==null)return null;var M=void 0,z=void 0;if(q instanceof h.default){var H=[U.index,U.index+U.length].map(function(K){return q.transformPosition(K,F!==s.default.sources.USER)}),I=c(H,2);M=I[0],z=I[1]}else{var A=[U.index,U.index+U.length].map(function(K){return K<q||K===q&&F===s.default.sources.USER?K:R>=0?K+R:Math.max(q,K+R)}),V=c(A,2);M=V[0],z=V[1]}return new f.Range(M,z-M)}r.expandConfig=L,r.overload=B,r.default=O},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0});var l=function(){function x(y,f){for(var _=0;_<f.length;_++){var b=f[_];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(y,b.key,b)}}return function(y,f,_){return f&&x(y.prototype,f),_&&x(y,_),y}}(),c=function x(y,f,_){y===null&&(y=Function.prototype);var b=Object.getOwnPropertyDescriptor(y,f);if(b===void 0){var E=Object.getPrototypeOf(y);return E===null?void 0:x(E,f,_)}else{if("value"in b)return b.value;var N=b.get;return N===void 0?void 0:N.call(_)}},m=i(7),u=d(m),h=i(0),p=d(h);function d(x){return x&&x.__esModule?x:{default:x}}function o(x,y){if(!(x instanceof y))throw new TypeError("Cannot call a class as a function")}function s(x,y){if(!x)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return y&&(typeof y=="object"||typeof y=="function")?y:x}function g(x,y){if(typeof y!="function"&&y!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof y);x.prototype=Object.create(y&&y.prototype,{constructor:{value:x,enumerable:!1,writable:!0,configurable:!0}}),y&&(Object.setPrototypeOf?Object.setPrototypeOf(x,y):x.__proto__=y)}var v=function(x){g(y,x);function y(){return o(this,y),s(this,(y.__proto__||Object.getPrototypeOf(y)).apply(this,arguments))}return l(y,[{key:"formatAt",value:function(_,b,E,N){if(y.compare(this.statics.blotName,E)<0&&p.default.query(E,p.default.Scope.BLOT)){var j=this.isolate(_,b);N&&j.wrap(E,N)}else c(y.prototype.__proto__||Object.getPrototypeOf(y.prototype),"formatAt",this).call(this,_,b,E,N)}},{key:"optimize",value:function(_){if(c(y.prototype.__proto__||Object.getPrototypeOf(y.prototype),"optimize",this).call(this,_),this.parent instanceof y&&y.compare(this.statics.blotName,this.parent.statics.blotName)>0){var b=this.parent.isolate(this.offset(),this.length());this.moveChildren(b),b.wrap(this)}}}],[{key:"compare",value:function(_,b){var E=y.order.indexOf(_),N=y.order.indexOf(b);return E>=0||N>=0?E-N:_===b?0:_<b?-1:1}}]),y}(p.default.Inline);v.allowedChildren=[v,p.default.Embed,u.default],v.order=["cursor","inline","underline","strike","italic","bold","script","link","code"],r.default=v},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0});var l=i(0),c=m(l);function m(o){return o&&o.__esModule?o:{default:o}}function u(o,s){if(!(o instanceof s))throw new TypeError("Cannot call a class as a function")}function h(o,s){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s&&(typeof s=="object"||typeof s=="function")?s:o}function p(o,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof s);o.prototype=Object.create(s&&s.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),s&&(Object.setPrototypeOf?Object.setPrototypeOf(o,s):o.__proto__=s)}var d=function(o){p(s,o);function s(){return u(this,s),h(this,(s.__proto__||Object.getPrototypeOf(s)).apply(this,arguments))}return s}(c.default.Text);r.default=d},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0});var l=function(){function f(_,b){for(var E=0;E<b.length;E++){var N=b[E];N.enumerable=N.enumerable||!1,N.configurable=!0,"value"in N&&(N.writable=!0),Object.defineProperty(_,N.key,N)}}return function(_,b,E){return b&&f(_.prototype,b),E&&f(_,E),_}}(),c=function f(_,b,E){_===null&&(_=Function.prototype);var N=Object.getOwnPropertyDescriptor(_,b);if(N===void 0){var j=Object.getPrototypeOf(_);return j===null?void 0:f(j,b,E)}else{if("value"in N)return N.value;var C=N.get;return C===void 0?void 0:C.call(E)}},m=i(54),u=d(m),h=i(10),p=d(h);function d(f){return f&&f.__esModule?f:{default:f}}function o(f,_){if(!(f instanceof _))throw new TypeError("Cannot call a class as a function")}function s(f,_){if(!f)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return _&&(typeof _=="object"||typeof _=="function")?_:f}function g(f,_){if(typeof _!="function"&&_!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof _);f.prototype=Object.create(_&&_.prototype,{constructor:{value:f,enumerable:!1,writable:!0,configurable:!0}}),_&&(Object.setPrototypeOf?Object.setPrototypeOf(f,_):f.__proto__=_)}var v=(0,p.default)("quill:events"),x=["selectionchange","mousedown","mouseup","click"];x.forEach(function(f){document.addEventListener(f,function(){for(var _=arguments.length,b=Array(_),E=0;E<_;E++)b[E]=arguments[E];[].slice.call(document.querySelectorAll(".ql-container")).forEach(function(N){if(N.__quill&&N.__quill.emitter){var j;(j=N.__quill.emitter).handleDOM.apply(j,b)}})})});var y=function(f){g(_,f);function _(){o(this,_);var b=s(this,(_.__proto__||Object.getPrototypeOf(_)).call(this));return b.listeners={},b.on("error",v.error),b}return l(_,[{key:"emit",value:function(){v.log.apply(v,arguments),c(_.prototype.__proto__||Object.getPrototypeOf(_.prototype),"emit",this).apply(this,arguments)}},{key:"handleDOM",value:function(E){for(var N=arguments.length,j=Array(N>1?N-1:0),C=1;C<N;C++)j[C-1]=arguments[C];(this.listeners[E.type]||[]).forEach(function(D){var k=D.node,w=D.handler;(E.target===k||k.contains(E.target))&&w.apply(void 0,[E].concat(j))})}},{key:"listenDOM",value:function(E,N,j){this.listeners[E]||(this.listeners[E]=[]),this.listeners[E].push({node:N,handler:j})}}]),_}(u.default);y.events={EDITOR_CHANGE:"editor-change",SCROLL_BEFORE_UPDATE:"scroll-before-update",SCROLL_OPTIMIZE:"scroll-optimize",SCROLL_UPDATE:"scroll-update",SELECTION_CHANGE:"selection-change",TEXT_CHANGE:"text-change"},y.sources={API:"api",SILENT:"silent",USER:"user"},r.default=y},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0});function l(m,u){if(!(m instanceof u))throw new TypeError("Cannot call a class as a function")}var c=function m(u){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};l(this,m),this.quill=u,this.options=h};c.DEFAULTS={},r.default=c},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0});var l=["error","warn","log","info"],c="warn";function m(h){if(l.indexOf(h)<=l.indexOf(c)){for(var p,d=arguments.length,o=Array(d>1?d-1:0),s=1;s<d;s++)o[s-1]=arguments[s];(p=console)[h].apply(p,o)}}function u(h){return l.reduce(function(p,d){return p[d]=m.bind(console,d,h),p},{})}m.level=u.level=function(h){c=h},r.default=u},function(t,r,i){var l=Array.prototype.slice,c=i(52),m=i(53),u=t.exports=function(o,s,g){return g||(g={}),o===s?!0:o instanceof Date&&s instanceof Date?o.getTime()===s.getTime():!o||!s||typeof o!="object"&&typeof s!="object"?g.strict?o===s:o==s:d(o,s,g)};function h(o){return o==null}function p(o){return!(!o||typeof o!="object"||typeof o.length!="number"||typeof o.copy!="function"||typeof o.slice!="function"||o.length>0&&typeof o[0]!="number")}function d(o,s,g){var v,x;if(h(o)||h(s)||o.prototype!==s.prototype)return!1;if(m(o))return m(s)?(o=l.call(o),s=l.call(s),u(o,s,g)):!1;if(p(o)){if(!p(s)||o.length!==s.length)return!1;for(v=0;v<o.length;v++)if(o[v]!==s[v])return!1;return!0}try{var y=c(o),f=c(s)}catch{return!1}if(y.length!=f.length)return!1;for(y.sort(),f.sort(),v=y.length-1;v>=0;v--)if(y[v]!=f[v])return!1;for(v=y.length-1;v>=0;v--)if(x=y[v],!u(o[x],s[x],g))return!1;return typeof o==typeof s}},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0});var l=i(1),c=function(){function m(u,h,p){p===void 0&&(p={}),this.attrName=u,this.keyName=h;var d=l.Scope.TYPE&l.Scope.ATTRIBUTE;p.scope!=null?this.scope=p.scope&l.Scope.LEVEL|d:this.scope=l.Scope.ATTRIBUTE,p.whitelist!=null&&(this.whitelist=p.whitelist)}return m.keys=function(u){return[].map.call(u.attributes,function(h){return h.name})},m.prototype.add=function(u,h){return this.canAdd(u,h)?(u.setAttribute(this.keyName,h),!0):!1},m.prototype.canAdd=function(u,h){var p=l.query(u,l.Scope.BLOT&(this.scope|l.Scope.TYPE));return p==null?!1:this.whitelist==null?!0:typeof h=="string"?this.whitelist.indexOf(h.replace(/["']/g,""))>-1:this.whitelist.indexOf(h)>-1},m.prototype.remove=function(u){u.removeAttribute(this.keyName)},m.prototype.value=function(u){var h=u.getAttribute(this.keyName);return this.canAdd(u,h)&&h?h:""},m}();r.default=c},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0}),r.default=r.Code=void 0;var l=function(){function C(D,k){var w=[],S=!0,P=!1,O=void 0;try{for(var L=D[Symbol.iterator](),$;!(S=($=L.next()).done)&&(w.push($.value),!(k&&w.length===k));S=!0);}catch(B){P=!0,O=B}finally{try{!S&&L.return&&L.return()}finally{if(P)throw O}}return w}return function(D,k){if(Array.isArray(D))return D;if(Symbol.iterator in Object(D))return C(D,k);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),c=function(){function C(D,k){for(var w=0;w<k.length;w++){var S=k[w];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(D,S.key,S)}}return function(D,k,w){return k&&C(D.prototype,k),w&&C(D,w),D}}(),m=function C(D,k,w){D===null&&(D=Function.prototype);var S=Object.getOwnPropertyDescriptor(D,k);if(S===void 0){var P=Object.getPrototypeOf(D);return P===null?void 0:C(P,k,w)}else{if("value"in S)return S.value;var O=S.get;return O===void 0?void 0:O.call(w)}},u=i(2),h=f(u),p=i(0),d=f(p),o=i(4),s=f(o),g=i(6),v=f(g),x=i(7),y=f(x);function f(C){return C&&C.__esModule?C:{default:C}}function _(C,D){if(!(C instanceof D))throw new TypeError("Cannot call a class as a function")}function b(C,D){if(!C)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return D&&(typeof D=="object"||typeof D=="function")?D:C}function E(C,D){if(typeof D!="function"&&D!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof D);C.prototype=Object.create(D&&D.prototype,{constructor:{value:C,enumerable:!1,writable:!0,configurable:!0}}),D&&(Object.setPrototypeOf?Object.setPrototypeOf(C,D):C.__proto__=D)}var N=function(C){E(D,C);function D(){return _(this,D),b(this,(D.__proto__||Object.getPrototypeOf(D)).apply(this,arguments))}return D}(v.default);N.blotName="code",N.tagName="CODE";var j=function(C){E(D,C);function D(){return _(this,D),b(this,(D.__proto__||Object.getPrototypeOf(D)).apply(this,arguments))}return c(D,[{key:"delta",value:function(){var w=this,S=this.domNode.textContent;return S.endsWith(`
`)&&(S=S.slice(0,-1)),S.split(`
`).reduce(function(P,O){return P.insert(O).insert(`
`,w.formats())},new h.default)}},{key:"format",value:function(w,S){if(!(w===this.statics.blotName&&S)){var P=this.descendant(y.default,this.length()-1),O=l(P,1),L=O[0];L!=null&&L.deleteAt(L.length()-1,1),m(D.prototype.__proto__||Object.getPrototypeOf(D.prototype),"format",this).call(this,w,S)}}},{key:"formatAt",value:function(w,S,P,O){if(S!==0&&!(d.default.query(P,d.default.Scope.BLOCK)==null||P===this.statics.blotName&&O===this.statics.formats(this.domNode))){var L=this.newlineIndex(w);if(!(L<0||L>=w+S)){var $=this.newlineIndex(w,!0)+1,B=L-$+1,Y=this.isolate($,B),U=Y.next;Y.format(P,O),U instanceof D&&U.formatAt(0,w-$+S-B,P,O)}}}},{key:"insertAt",value:function(w,S,P){if(P==null){var O=this.descendant(y.default,w),L=l(O,2),$=L[0],B=L[1];$.insertAt(B,S)}}},{key:"length",value:function(){var w=this.domNode.textContent.length;return this.domNode.textContent.endsWith(`
`)?w:w+1}},{key:"newlineIndex",value:function(w){var S=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(S)return this.domNode.textContent.slice(0,w).lastIndexOf(`
`);var P=this.domNode.textContent.slice(w).indexOf(`
`);return P>-1?w+P:-1}},{key:"optimize",value:function(w){this.domNode.textContent.endsWith(`
`)||this.appendChild(d.default.create("text",`
`)),m(D.prototype.__proto__||Object.getPrototypeOf(D.prototype),"optimize",this).call(this,w);var S=this.next;S!=null&&S.prev===this&&S.statics.blotName===this.statics.blotName&&this.statics.formats(this.domNode)===S.statics.formats(S.domNode)&&(S.optimize(w),S.moveChildren(this),S.remove())}},{key:"replace",value:function(w){m(D.prototype.__proto__||Object.getPrototypeOf(D.prototype),"replace",this).call(this,w),[].slice.call(this.domNode.querySelectorAll("*")).forEach(function(S){var P=d.default.find(S);P==null?S.parentNode.removeChild(S):P instanceof d.default.Embed?P.remove():P.unwrap()})}}],[{key:"create",value:function(w){var S=m(D.__proto__||Object.getPrototypeOf(D),"create",this).call(this,w);return S.setAttribute("spellcheck",!1),S}},{key:"formats",value:function(){return!0}}]),D}(s.default);j.blotName="code-block",j.tagName="PRE",j.TAB="  ",r.Code=N,r.default=j},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0});var l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(U){return typeof U}:function(U){return U&&typeof Symbol=="function"&&U.constructor===Symbol&&U!==Symbol.prototype?"symbol":typeof U},c=function(){function U(q,R){var F=[],M=!0,z=!1,H=void 0;try{for(var I=q[Symbol.iterator](),A;!(M=(A=I.next()).done)&&(F.push(A.value),!(R&&F.length===R));M=!0);}catch(V){z=!0,H=V}finally{try{!M&&I.return&&I.return()}finally{if(z)throw H}}return F}return function(q,R){if(Array.isArray(q))return q;if(Symbol.iterator in Object(q))return U(q,R);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),m=function(){function U(q,R){for(var F=0;F<R.length;F++){var M=R[F];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(q,M.key,M)}}return function(q,R,F){return R&&U(q.prototype,R),F&&U(q,F),q}}(),u=i(2),h=S(u),p=i(20),d=S(p),o=i(0),s=S(o),g=i(13),v=S(g),x=i(24),y=S(x),f=i(4),_=S(f),b=i(16),E=S(b),N=i(21),j=S(N),C=i(11),D=S(C),k=i(3),w=S(k);function S(U){return U&&U.__esModule?U:{default:U}}function P(U,q,R){return q in U?Object.defineProperty(U,q,{value:R,enumerable:!0,configurable:!0,writable:!0}):U[q]=R,U}function O(U,q){if(!(U instanceof q))throw new TypeError("Cannot call a class as a function")}var L=/^[ -~]*$/,$=function(){function U(q){O(this,U),this.scroll=q,this.delta=this.getDelta()}return m(U,[{key:"applyDelta",value:function(R){var F=this,M=!1;this.scroll.update();var z=this.scroll.length();return this.scroll.batchStart(),R=Y(R),R.reduce(function(H,I){var A=I.retain||I.delete||I.insert.length||1,V=I.attributes||{};if(I.insert!=null){if(typeof I.insert=="string"){var K=I.insert;K.endsWith(`
`)&&M&&(M=!1,K=K.slice(0,-1)),H>=z&&!K.endsWith(`
`)&&(M=!0),F.scroll.insertAt(H,K);var Q=F.scroll.line(H),de=c(Q,2),xe=de[0],Z=de[1],re=(0,w.default)({},(0,f.bubbleFormats)(xe));if(xe instanceof _.default){var ye=xe.descendant(s.default.Leaf,Z),Se=c(ye,1),De=Se[0];re=(0,w.default)(re,(0,f.bubbleFormats)(De))}V=d.default.attributes.diff(re,V)||{}}else if(l(I.insert)==="object"){var te=Object.keys(I.insert)[0];if(te==null)return H;F.scroll.insertAt(H,te,I.insert[te])}z+=A}return Object.keys(V).forEach(function(se){F.scroll.formatAt(H,A,se,V[se])}),H+A},0),R.reduce(function(H,I){return typeof I.delete=="number"?(F.scroll.deleteAt(H,I.delete),H):H+(I.retain||I.insert.length||1)},0),this.scroll.batchEnd(),this.update(R)}},{key:"deleteText",value:function(R,F){return this.scroll.deleteAt(R,F),this.update(new h.default().retain(R).delete(F))}},{key:"formatLine",value:function(R,F){var M=this,z=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.scroll.update(),Object.keys(z).forEach(function(H){if(!(M.scroll.whitelist!=null&&!M.scroll.whitelist[H])){var I=M.scroll.lines(R,Math.max(F,1)),A=F;I.forEach(function(V){var K=V.length();if(!(V instanceof v.default))V.format(H,z[H]);else{var Q=R-V.offset(M.scroll),de=V.newlineIndex(Q+A)-Q+1;V.formatAt(Q,de,H,z[H])}A-=K})}}),this.scroll.optimize(),this.update(new h.default().retain(R).retain(F,(0,j.default)(z)))}},{key:"formatText",value:function(R,F){var M=this,z=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Object.keys(z).forEach(function(H){M.scroll.formatAt(R,F,H,z[H])}),this.update(new h.default().retain(R).retain(F,(0,j.default)(z)))}},{key:"getContents",value:function(R,F){return this.delta.slice(R,R+F)}},{key:"getDelta",value:function(){return this.scroll.lines().reduce(function(R,F){return R.concat(F.delta())},new h.default)}},{key:"getFormat",value:function(R){var F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,M=[],z=[];F===0?this.scroll.path(R).forEach(function(I){var A=c(I,1),V=A[0];V instanceof _.default?M.push(V):V instanceof s.default.Leaf&&z.push(V)}):(M=this.scroll.lines(R,F),z=this.scroll.descendants(s.default.Leaf,R,F));var H=[M,z].map(function(I){if(I.length===0)return{};for(var A=(0,f.bubbleFormats)(I.shift());Object.keys(A).length>0;){var V=I.shift();if(V==null)return A;A=B((0,f.bubbleFormats)(V),A)}return A});return w.default.apply(w.default,H)}},{key:"getText",value:function(R,F){return this.getContents(R,F).filter(function(M){return typeof M.insert=="string"}).map(function(M){return M.insert}).join("")}},{key:"insertEmbed",value:function(R,F,M){return this.scroll.insertAt(R,F,M),this.update(new h.default().retain(R).insert(P({},F,M)))}},{key:"insertText",value:function(R,F){var M=this,z=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return F=F.replace(/\r\n/g,`
`).replace(/\r/g,`
`),this.scroll.insertAt(R,F),Object.keys(z).forEach(function(H){M.scroll.formatAt(R,F.length,H,z[H])}),this.update(new h.default().retain(R).insert(F,(0,j.default)(z)))}},{key:"isBlank",value:function(){if(this.scroll.children.length==0)return!0;if(this.scroll.children.length>1)return!1;var R=this.scroll.children.head;return R.statics.blotName!==_.default.blotName||R.children.length>1?!1:R.children.head instanceof E.default}},{key:"removeFormat",value:function(R,F){var M=this.getText(R,F),z=this.scroll.line(R+F),H=c(z,2),I=H[0],A=H[1],V=0,K=new h.default;I!=null&&(I instanceof v.default?V=I.newlineIndex(A)-A+1:V=I.length()-A,K=I.delta().slice(A,A+V-1).insert(`
`));var Q=this.getContents(R,F+V),de=Q.diff(new h.default().insert(M).concat(K)),xe=new h.default().retain(R).concat(de);return this.applyDelta(xe)}},{key:"update",value:function(R){var F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],M=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,z=this.delta;if(F.length===1&&F[0].type==="characterData"&&F[0].target.data.match(L)&&s.default.find(F[0].target)){var H=s.default.find(F[0].target),I=(0,f.bubbleFormats)(H),A=H.offset(this.scroll),V=F[0].oldValue.replace(y.default.CONTENTS,""),K=new h.default().insert(V),Q=new h.default().insert(H.value()),de=new h.default().retain(A).concat(K.diff(Q,M));R=de.reduce(function(xe,Z){return Z.insert?xe.insert(Z.insert,I):xe.push(Z)},new h.default),this.delta=z.compose(R)}else this.delta=this.getDelta(),(!R||!(0,D.default)(z.compose(R),this.delta))&&(R=z.diff(this.delta,M));return R}}]),U}();function B(U,q){return Object.keys(q).reduce(function(R,F){return U[F]==null||(q[F]===U[F]?R[F]=q[F]:Array.isArray(q[F])?q[F].indexOf(U[F])<0&&(R[F]=q[F].concat([U[F]])):R[F]=[q[F],U[F]]),R},{})}function Y(U){return U.reduce(function(q,R){if(R.insert===1){var F=(0,j.default)(R.attributes);return delete F.image,q.insert({image:R.attributes.image},F)}if(R.attributes!=null&&(R.attributes.list===!0||R.attributes.bullet===!0)&&(R=(0,j.default)(R),R.attributes.list?R.attributes.list="ordered":(R.attributes.list="bullet",delete R.attributes.bullet)),typeof R.insert=="string"){var M=R.insert.replace(/\r\n/g,`
`).replace(/\r/g,`
`);return q.insert(M,R.attributes)}return q.push(R)},new h.default)}r.default=$},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0}),r.default=r.Range=void 0;var l=function(){function C(D,k){var w=[],S=!0,P=!1,O=void 0;try{for(var L=D[Symbol.iterator](),$;!(S=($=L.next()).done)&&(w.push($.value),!(k&&w.length===k));S=!0);}catch(B){P=!0,O=B}finally{try{!S&&L.return&&L.return()}finally{if(P)throw O}}return w}return function(D,k){if(Array.isArray(D))return D;if(Symbol.iterator in Object(D))return C(D,k);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),c=function(){function C(D,k){for(var w=0;w<k.length;w++){var S=k[w];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(D,S.key,S)}}return function(D,k,w){return k&&C(D.prototype,k),w&&C(D,w),D}}(),m=i(0),u=y(m),h=i(21),p=y(h),d=i(11),o=y(d),s=i(8),g=y(s),v=i(10),x=y(v);function y(C){return C&&C.__esModule?C:{default:C}}function f(C){if(Array.isArray(C)){for(var D=0,k=Array(C.length);D<C.length;D++)k[D]=C[D];return k}else return Array.from(C)}function _(C,D){if(!(C instanceof D))throw new TypeError("Cannot call a class as a function")}var b=(0,x.default)("quill:selection"),E=function C(D){var k=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;_(this,C),this.index=D,this.length=k},N=function(){function C(D,k){var w=this;_(this,C),this.emitter=k,this.scroll=D,this.composing=!1,this.mouseDown=!1,this.root=this.scroll.domNode,this.cursor=u.default.create("cursor",this),this.lastRange=this.savedRange=new E(0,0),this.handleComposition(),this.handleDragging(),this.emitter.listenDOM("selectionchange",document,function(){w.mouseDown||setTimeout(w.update.bind(w,g.default.sources.USER),1)}),this.emitter.on(g.default.events.EDITOR_CHANGE,function(S,P){S===g.default.events.TEXT_CHANGE&&P.length()>0&&w.update(g.default.sources.SILENT)}),this.emitter.on(g.default.events.SCROLL_BEFORE_UPDATE,function(){if(w.hasFocus()){var S=w.getNativeRange();S!=null&&S.start.node!==w.cursor.textNode&&w.emitter.once(g.default.events.SCROLL_UPDATE,function(){try{w.setNativeRange(S.start.node,S.start.offset,S.end.node,S.end.offset)}catch{}})}}),this.emitter.on(g.default.events.SCROLL_OPTIMIZE,function(S,P){if(P.range){var O=P.range,L=O.startNode,$=O.startOffset,B=O.endNode,Y=O.endOffset;w.setNativeRange(L,$,B,Y)}}),this.update(g.default.sources.SILENT)}return c(C,[{key:"handleComposition",value:function(){var k=this;this.root.addEventListener("compositionstart",function(){k.composing=!0}),this.root.addEventListener("compositionend",function(){if(k.composing=!1,k.cursor.parent){var w=k.cursor.restore();if(!w)return;setTimeout(function(){k.setNativeRange(w.startNode,w.startOffset,w.endNode,w.endOffset)},1)}})}},{key:"handleDragging",value:function(){var k=this;this.emitter.listenDOM("mousedown",document.body,function(){k.mouseDown=!0}),this.emitter.listenDOM("mouseup",document.body,function(){k.mouseDown=!1,k.update(g.default.sources.USER)})}},{key:"focus",value:function(){this.hasFocus()||(this.root.focus(),this.setRange(this.savedRange))}},{key:"format",value:function(k,w){if(!(this.scroll.whitelist!=null&&!this.scroll.whitelist[k])){this.scroll.update();var S=this.getNativeRange();if(!(S==null||!S.native.collapsed||u.default.query(k,u.default.Scope.BLOCK))){if(S.start.node!==this.cursor.textNode){var P=u.default.find(S.start.node,!1);if(P==null)return;if(P instanceof u.default.Leaf){var O=P.split(S.start.offset);P.parent.insertBefore(this.cursor,O)}else P.insertBefore(this.cursor,S.start.node);this.cursor.attach()}this.cursor.format(k,w),this.scroll.optimize(),this.setNativeRange(this.cursor.textNode,this.cursor.textNode.data.length),this.update()}}}},{key:"getBounds",value:function(k){var w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,S=this.scroll.length();k=Math.min(k,S-1),w=Math.min(k+w,S-1)-k;var P=void 0,O=this.scroll.leaf(k),L=l(O,2),$=L[0],B=L[1];if($==null)return null;var Y=$.position(B,!0),U=l(Y,2);P=U[0],B=U[1];var q=document.createRange();if(w>0){q.setStart(P,B);var R=this.scroll.leaf(k+w),F=l(R,2);if($=F[0],B=F[1],$==null)return null;var M=$.position(B,!0),z=l(M,2);return P=z[0],B=z[1],q.setEnd(P,B),q.getBoundingClientRect()}else{var H="left",I=void 0;return P instanceof Text?(B<P.data.length?(q.setStart(P,B),q.setEnd(P,B+1)):(q.setStart(P,B-1),q.setEnd(P,B),H="right"),I=q.getBoundingClientRect()):(I=$.domNode.getBoundingClientRect(),B>0&&(H="right")),{bottom:I.top+I.height,height:I.height,left:I[H],right:I[H],top:I.top,width:0}}}},{key:"getNativeRange",value:function(){var k=document.getSelection();if(k==null||k.rangeCount<=0)return null;var w=k.getRangeAt(0);if(w==null)return null;var S=this.normalizeNative(w);return b.info("getNativeRange",S),S}},{key:"getRange",value:function(){var k=this.getNativeRange();if(k==null)return[null,null];var w=this.normalizedToRange(k);return[w,k]}},{key:"hasFocus",value:function(){return document.activeElement===this.root}},{key:"normalizedToRange",value:function(k){var w=this,S=[[k.start.node,k.start.offset]];k.native.collapsed||S.push([k.end.node,k.end.offset]);var P=S.map(function($){var B=l($,2),Y=B[0],U=B[1],q=u.default.find(Y,!0),R=q.offset(w.scroll);return U===0?R:q instanceof u.default.Container?R+q.length():R+q.index(Y,U)}),O=Math.min(Math.max.apply(Math,f(P)),this.scroll.length()-1),L=Math.min.apply(Math,[O].concat(f(P)));return new E(L,O-L)}},{key:"normalizeNative",value:function(k){if(!j(this.root,k.startContainer)||!k.collapsed&&!j(this.root,k.endContainer))return null;var w={start:{node:k.startContainer,offset:k.startOffset},end:{node:k.endContainer,offset:k.endOffset},native:k};return[w.start,w.end].forEach(function(S){for(var P=S.node,O=S.offset;!(P instanceof Text)&&P.childNodes.length>0;)if(P.childNodes.length>O)P=P.childNodes[O],O=0;else if(P.childNodes.length===O)P=P.lastChild,O=P instanceof Text?P.data.length:P.childNodes.length+1;else break;S.node=P,S.offset=O}),w}},{key:"rangeToNative",value:function(k){var w=this,S=k.collapsed?[k.index]:[k.index,k.index+k.length],P=[],O=this.scroll.length();return S.forEach(function(L,$){L=Math.min(O-1,L);var B=void 0,Y=w.scroll.leaf(L),U=l(Y,2),q=U[0],R=U[1],F=q.position(R,$!==0),M=l(F,2);B=M[0],R=M[1],P.push(B,R)}),P.length<2&&(P=P.concat(P)),P}},{key:"scrollIntoView",value:function(k){var w=this.lastRange;if(w!=null){var S=this.getBounds(w.index,w.length);if(S!=null){var P=this.scroll.length()-1,O=this.scroll.line(Math.min(w.index,P)),L=l(O,1),$=L[0],B=$;if(w.length>0){var Y=this.scroll.line(Math.min(w.index+w.length,P)),U=l(Y,1);B=U[0]}if(!($==null||B==null)){var q=k.getBoundingClientRect();S.top<q.top?k.scrollTop-=q.top-S.top:S.bottom>q.bottom&&(k.scrollTop+=S.bottom-q.bottom)}}}}},{key:"setNativeRange",value:function(k,w){var S=arguments.length>2&&arguments[2]!==void 0?arguments[2]:k,P=arguments.length>3&&arguments[3]!==void 0?arguments[3]:w,O=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;if(b.info("setNativeRange",k,w,S,P),!(k!=null&&(this.root.parentNode==null||k.parentNode==null||S.parentNode==null))){var L=document.getSelection();if(L!=null)if(k!=null){this.hasFocus()||this.root.focus();var $=(this.getNativeRange()||{}).native;if($==null||O||k!==$.startContainer||w!==$.startOffset||S!==$.endContainer||P!==$.endOffset){k.tagName=="BR"&&(w=[].indexOf.call(k.parentNode.childNodes,k),k=k.parentNode),S.tagName=="BR"&&(P=[].indexOf.call(S.parentNode.childNodes,S),S=S.parentNode);var B=document.createRange();B.setStart(k,w),B.setEnd(S,P),L.removeAllRanges(),L.addRange(B)}}else L.removeAllRanges(),this.root.blur(),document.body.focus()}}},{key:"setRange",value:function(k){var w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,S=arguments.length>2&&arguments[2]!==void 0?arguments[2]:g.default.sources.API;if(typeof w=="string"&&(S=w,w=!1),b.info("setRange",k),k!=null){var P=this.rangeToNative(k);this.setNativeRange.apply(this,f(P).concat([w]))}else this.setNativeRange(null);this.update(S)}},{key:"update",value:function(){var k=arguments.length>0&&arguments[0]!==void 0?arguments[0]:g.default.sources.USER,w=this.lastRange,S=this.getRange(),P=l(S,2),O=P[0],L=P[1];if(this.lastRange=O,this.lastRange!=null&&(this.savedRange=this.lastRange),!(0,o.default)(w,this.lastRange)){var $;!this.composing&&L!=null&&L.native.collapsed&&L.start.node!==this.cursor.textNode&&this.cursor.restore();var B=[g.default.events.SELECTION_CHANGE,(0,p.default)(this.lastRange),(0,p.default)(w),k];if(($=this.emitter).emit.apply($,[g.default.events.EDITOR_CHANGE].concat(B)),k!==g.default.sources.SILENT){var Y;(Y=this.emitter).emit.apply(Y,B)}}}}]),C}();function j(C,D){try{D.parentNode}catch{return!1}return D instanceof Text&&(D=D.parentNode),C.contains(D)}r.Range=E,r.default=N},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0});var l=function(){function g(v,x){for(var y=0;y<x.length;y++){var f=x[y];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(v,f.key,f)}}return function(v,x,y){return x&&g(v.prototype,x),y&&g(v,y),v}}(),c=function g(v,x,y){v===null&&(v=Function.prototype);var f=Object.getOwnPropertyDescriptor(v,x);if(f===void 0){var _=Object.getPrototypeOf(v);return _===null?void 0:g(_,x,y)}else{if("value"in f)return f.value;var b=f.get;return b===void 0?void 0:b.call(y)}},m=i(0),u=h(m);function h(g){return g&&g.__esModule?g:{default:g}}function p(g,v){if(!(g instanceof v))throw new TypeError("Cannot call a class as a function")}function d(g,v){if(!g)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return v&&(typeof v=="object"||typeof v=="function")?v:g}function o(g,v){if(typeof v!="function"&&v!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof v);g.prototype=Object.create(v&&v.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}}),v&&(Object.setPrototypeOf?Object.setPrototypeOf(g,v):g.__proto__=v)}var s=function(g){o(v,g);function v(){return p(this,v),d(this,(v.__proto__||Object.getPrototypeOf(v)).apply(this,arguments))}return l(v,[{key:"insertInto",value:function(y,f){y.children.length===0?c(v.prototype.__proto__||Object.getPrototypeOf(v.prototype),"insertInto",this).call(this,y,f):this.remove()}},{key:"length",value:function(){return 0}},{key:"value",value:function(){return""}}],[{key:"value",value:function(){}}]),v}(u.default.Embed);s.blotName="break",s.tagName="BR",r.default=s},function(t,r,i){var l=this&&this.__extends||function(){var d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,s){o.__proto__=s}||function(o,s){for(var g in s)s.hasOwnProperty(g)&&(o[g]=s[g])};return function(o,s){d(o,s);function g(){this.constructor=o}o.prototype=s===null?Object.create(s):(g.prototype=s.prototype,new g)}}();Object.defineProperty(r,"__esModule",{value:!0});var c=i(44),m=i(30),u=i(1),h=function(d){l(o,d);function o(s){var g=d.call(this,s)||this;return g.build(),g}return o.prototype.appendChild=function(s){this.insertBefore(s)},o.prototype.attach=function(){d.prototype.attach.call(this),this.children.forEach(function(s){s.attach()})},o.prototype.build=function(){var s=this;this.children=new c.default,[].slice.call(this.domNode.childNodes).reverse().forEach(function(g){try{var v=p(g);s.insertBefore(v,s.children.head||void 0)}catch(x){if(x instanceof u.ParchmentError)return;throw x}})},o.prototype.deleteAt=function(s,g){if(s===0&&g===this.length())return this.remove();this.children.forEachAt(s,g,function(v,x,y){v.deleteAt(x,y)})},o.prototype.descendant=function(s,g){var v=this.children.find(g),x=v[0],y=v[1];return s.blotName==null&&s(x)||s.blotName!=null&&x instanceof s?[x,y]:x instanceof o?x.descendant(s,y):[null,-1]},o.prototype.descendants=function(s,g,v){g===void 0&&(g=0),v===void 0&&(v=Number.MAX_VALUE);var x=[],y=v;return this.children.forEachAt(g,v,function(f,_,b){(s.blotName==null&&s(f)||s.blotName!=null&&f instanceof s)&&x.push(f),f instanceof o&&(x=x.concat(f.descendants(s,_,y))),y-=b}),x},o.prototype.detach=function(){this.children.forEach(function(s){s.detach()}),d.prototype.detach.call(this)},o.prototype.formatAt=function(s,g,v,x){this.children.forEachAt(s,g,function(y,f,_){y.formatAt(f,_,v,x)})},o.prototype.insertAt=function(s,g,v){var x=this.children.find(s),y=x[0],f=x[1];if(y)y.insertAt(f,g,v);else{var _=v==null?u.create("text",g):u.create(g,v);this.appendChild(_)}},o.prototype.insertBefore=function(s,g){if(this.statics.allowedChildren!=null&&!this.statics.allowedChildren.some(function(v){return s instanceof v}))throw new u.ParchmentError("Cannot insert "+s.statics.blotName+" into "+this.statics.blotName);s.insertInto(this,g)},o.prototype.length=function(){return this.children.reduce(function(s,g){return s+g.length()},0)},o.prototype.moveChildren=function(s,g){this.children.forEach(function(v){s.insertBefore(v,g)})},o.prototype.optimize=function(s){if(d.prototype.optimize.call(this,s),this.children.length===0)if(this.statics.defaultChild!=null){var g=u.create(this.statics.defaultChild);this.appendChild(g),g.optimize(s)}else this.remove()},o.prototype.path=function(s,g){g===void 0&&(g=!1);var v=this.children.find(s,g),x=v[0],y=v[1],f=[[this,s]];return x instanceof o?f.concat(x.path(y,g)):(x!=null&&f.push([x,y]),f)},o.prototype.removeChild=function(s){this.children.remove(s)},o.prototype.replace=function(s){s instanceof o&&s.moveChildren(this),d.prototype.replace.call(this,s)},o.prototype.split=function(s,g){if(g===void 0&&(g=!1),!g){if(s===0)return this;if(s===this.length())return this.next}var v=this.clone();return this.parent.insertBefore(v,this.next),this.children.forEachAt(s,this.length(),function(x,y,f){x=x.split(y,g),v.appendChild(x)}),v},o.prototype.unwrap=function(){this.moveChildren(this.parent,this.next),this.remove()},o.prototype.update=function(s,g){var v=this,x=[],y=[];s.forEach(function(f){f.target===v.domNode&&f.type==="childList"&&(x.push.apply(x,f.addedNodes),y.push.apply(y,f.removedNodes))}),y.forEach(function(f){if(!(f.parentNode!=null&&f.tagName!=="IFRAME"&&document.body.compareDocumentPosition(f)&Node.DOCUMENT_POSITION_CONTAINED_BY)){var _=u.find(f);_!=null&&(_.domNode.parentNode==null||_.domNode.parentNode===v.domNode)&&_.detach()}}),x.filter(function(f){return f.parentNode==v.domNode}).sort(function(f,_){return f===_?0:f.compareDocumentPosition(_)&Node.DOCUMENT_POSITION_FOLLOWING?1:-1}).forEach(function(f){var _=null;f.nextSibling!=null&&(_=u.find(f.nextSibling));var b=p(f);(b.next!=_||b.next==null)&&(b.parent!=null&&b.parent.removeChild(v),v.insertBefore(b,_||void 0))})},o}(m.default);function p(d){var o=u.find(d);if(o==null)try{o=u.create(d)}catch{o=u.create(u.Scope.INLINE),[].slice.call(d.childNodes).forEach(function(g){o.domNode.appendChild(g)}),d.parentNode&&d.parentNode.replaceChild(o.domNode,d),o.attach()}return o}r.default=h},function(t,r,i){var l=this&&this.__extends||function(){var d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,s){o.__proto__=s}||function(o,s){for(var g in s)s.hasOwnProperty(g)&&(o[g]=s[g])};return function(o,s){d(o,s);function g(){this.constructor=o}o.prototype=s===null?Object.create(s):(g.prototype=s.prototype,new g)}}();Object.defineProperty(r,"__esModule",{value:!0});var c=i(12),m=i(31),u=i(17),h=i(1),p=function(d){l(o,d);function o(s){var g=d.call(this,s)||this;return g.attributes=new m.default(g.domNode),g}return o.formats=function(s){if(typeof this.tagName=="string")return!0;if(Array.isArray(this.tagName))return s.tagName.toLowerCase()},o.prototype.format=function(s,g){var v=h.query(s);v instanceof c.default?this.attributes.attribute(v,g):g&&v!=null&&(s!==this.statics.blotName||this.formats()[s]!==g)&&this.replaceWith(s,g)},o.prototype.formats=function(){var s=this.attributes.values(),g=this.statics.formats(this.domNode);return g!=null&&(s[this.statics.blotName]=g),s},o.prototype.replaceWith=function(s,g){var v=d.prototype.replaceWith.call(this,s,g);return this.attributes.copy(v),v},o.prototype.update=function(s,g){var v=this;d.prototype.update.call(this,s,g),s.some(function(x){return x.target===v.domNode&&x.type==="attributes"})&&this.attributes.build()},o.prototype.wrap=function(s,g){var v=d.prototype.wrap.call(this,s,g);return v instanceof o&&v.statics.scope===this.statics.scope&&this.attributes.move(v),v},o}(u.default);r.default=p},function(t,r,i){var l=this&&this.__extends||function(){var h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,d){p.__proto__=d}||function(p,d){for(var o in d)d.hasOwnProperty(o)&&(p[o]=d[o])};return function(p,d){h(p,d);function o(){this.constructor=p}p.prototype=d===null?Object.create(d):(o.prototype=d.prototype,new o)}}();Object.defineProperty(r,"__esModule",{value:!0});var c=i(30),m=i(1),u=function(h){l(p,h);function p(){return h!==null&&h.apply(this,arguments)||this}return p.value=function(d){return!0},p.prototype.index=function(d,o){return this.domNode===d||this.domNode.compareDocumentPosition(d)&Node.DOCUMENT_POSITION_CONTAINED_BY?Math.min(o,1):-1},p.prototype.position=function(d,o){var s=[].indexOf.call(this.parent.domNode.childNodes,this.domNode);return d>0&&(s+=1),[this.parent.domNode,s]},p.prototype.value=function(){var d;return d={},d[this.statics.blotName]=this.statics.value(this.domNode)||!0,d},p.scope=m.Scope.INLINE_BLOT,p}(c.default);r.default=u},function(t,r,i){var l=i(11),c=i(3),m={attributes:{compose:function(h,p,d){typeof h!="object"&&(h={}),typeof p!="object"&&(p={});var o=c(!0,{},p);d||(o=Object.keys(o).reduce(function(g,v){return o[v]!=null&&(g[v]=o[v]),g},{}));for(var s in h)h[s]!==void 0&&p[s]===void 0&&(o[s]=h[s]);return Object.keys(o).length>0?o:void 0},diff:function(h,p){typeof h!="object"&&(h={}),typeof p!="object"&&(p={});var d=Object.keys(h).concat(Object.keys(p)).reduce(function(o,s){return l(h[s],p[s])||(o[s]=p[s]===void 0?null:p[s]),o},{});return Object.keys(d).length>0?d:void 0},transform:function(h,p,d){if(typeof h!="object")return p;if(typeof p=="object"){if(!d)return p;var o=Object.keys(p).reduce(function(s,g){return h[g]===void 0&&(s[g]=p[g]),s},{});return Object.keys(o).length>0?o:void 0}}},iterator:function(h){return new u(h)},length:function(h){return typeof h.delete=="number"?h.delete:typeof h.retain=="number"?h.retain:typeof h.insert=="string"?h.insert.length:1}};function u(h){this.ops=h,this.index=0,this.offset=0}u.prototype.hasNext=function(){return this.peekLength()<1/0},u.prototype.next=function(h){h||(h=1/0);var p=this.ops[this.index];if(p){var d=this.offset,o=m.length(p);if(h>=o-d?(h=o-d,this.index+=1,this.offset=0):this.offset+=h,typeof p.delete=="number")return{delete:h};var s={};return p.attributes&&(s.attributes=p.attributes),typeof p.retain=="number"?s.retain=h:typeof p.insert=="string"?s.insert=p.insert.substr(d,h):s.insert=p.insert,s}else return{retain:1/0}},u.prototype.peek=function(){return this.ops[this.index]},u.prototype.peekLength=function(){return this.ops[this.index]?m.length(this.ops[this.index])-this.offset:1/0},u.prototype.peekType=function(){return this.ops[this.index]?typeof this.ops[this.index].delete=="number"?"delete":typeof this.ops[this.index].retain=="number"?"retain":"insert":"retain"},u.prototype.rest=function(){if(this.hasNext()){if(this.offset===0)return this.ops.slice(this.index);var h=this.offset,p=this.index,d=this.next(),o=this.ops.slice(this.index);return this.offset=h,this.index=p,[d].concat(o)}else return[]},t.exports=m},function(t,r){var i=function(){function l(v,x){return x!=null&&v instanceof x}var c;try{c=Map}catch{c=function(){}}var m;try{m=Set}catch{m=function(){}}var u;try{u=Promise}catch{u=function(){}}function h(v,x,y,f,_){typeof x=="object"&&(y=x.depth,f=x.prototype,_=x.includeNonEnumerable,x=x.circular);var b=[],E=[],N=typeof Buffer<"u";typeof x>"u"&&(x=!0),typeof y>"u"&&(y=1/0);function j(C,D){if(C===null)return null;if(D===0)return C;var k,w;if(typeof C!="object")return C;if(l(C,c))k=new c;else if(l(C,m))k=new m;else if(l(C,u))k=new u(function(q,R){C.then(function(F){q(j(F,D-1))},function(F){R(j(F,D-1))})});else if(h.__isArray(C))k=[];else if(h.__isRegExp(C))k=new RegExp(C.source,g(C)),C.lastIndex&&(k.lastIndex=C.lastIndex);else if(h.__isDate(C))k=new Date(C.getTime());else{if(N&&Buffer.isBuffer(C))return Buffer.allocUnsafe?k=Buffer.allocUnsafe(C.length):k=new Buffer(C.length),C.copy(k),k;l(C,Error)?k=Object.create(C):typeof f>"u"?(w=Object.getPrototypeOf(C),k=Object.create(w)):(k=Object.create(f),w=f)}if(x){var S=b.indexOf(C);if(S!=-1)return E[S];b.push(C),E.push(k)}l(C,c)&&C.forEach(function(q,R){var F=j(R,D-1),M=j(q,D-1);k.set(F,M)}),l(C,m)&&C.forEach(function(q){var R=j(q,D-1);k.add(R)});for(var P in C){var O;w&&(O=Object.getOwnPropertyDescriptor(w,P)),!(O&&O.set==null)&&(k[P]=j(C[P],D-1))}if(Object.getOwnPropertySymbols)for(var L=Object.getOwnPropertySymbols(C),P=0;P<L.length;P++){var $=L[P],B=Object.getOwnPropertyDescriptor(C,$);B&&!B.enumerable&&!_||(k[$]=j(C[$],D-1),B.enumerable||Object.defineProperty(k,$,{enumerable:!1}))}if(_)for(var Y=Object.getOwnPropertyNames(C),P=0;P<Y.length;P++){var U=Y[P],B=Object.getOwnPropertyDescriptor(C,U);B&&B.enumerable||(k[U]=j(C[U],D-1),Object.defineProperty(k,U,{enumerable:!1}))}return k}return j(v,y)}h.clonePrototype=function(x){if(x===null)return null;var y=function(){};return y.prototype=x,new y};function p(v){return Object.prototype.toString.call(v)}h.__objToStr=p;function d(v){return typeof v=="object"&&p(v)==="[object Date]"}h.__isDate=d;function o(v){return typeof v=="object"&&p(v)==="[object Array]"}h.__isArray=o;function s(v){return typeof v=="object"&&p(v)==="[object RegExp]"}h.__isRegExp=s;function g(v){var x="";return v.global&&(x+="g"),v.ignoreCase&&(x+="i"),v.multiline&&(x+="m"),x}return h.__getRegExpFlags=g,h}();typeof t=="object"&&t.exports&&(t.exports=i)},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0});var l=function(){function k(w,S){var P=[],O=!0,L=!1,$=void 0;try{for(var B=w[Symbol.iterator](),Y;!(O=(Y=B.next()).done)&&(P.push(Y.value),!(S&&P.length===S));O=!0);}catch(U){L=!0,$=U}finally{try{!O&&B.return&&B.return()}finally{if(L)throw $}}return P}return function(w,S){if(Array.isArray(w))return w;if(Symbol.iterator in Object(w))return k(w,S);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),c=function(){function k(w,S){for(var P=0;P<S.length;P++){var O=S[P];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(w,O.key,O)}}return function(w,S,P){return S&&k(w.prototype,S),P&&k(w,P),w}}(),m=function k(w,S,P){w===null&&(w=Function.prototype);var O=Object.getOwnPropertyDescriptor(w,S);if(O===void 0){var L=Object.getPrototypeOf(w);return L===null?void 0:k(L,S,P)}else{if("value"in O)return O.value;var $=O.get;return $===void 0?void 0:$.call(P)}},u=i(0),h=b(u),p=i(8),d=b(p),o=i(4),s=b(o),g=i(16),v=b(g),x=i(13),y=b(x),f=i(25),_=b(f);function b(k){return k&&k.__esModule?k:{default:k}}function E(k,w){if(!(k instanceof w))throw new TypeError("Cannot call a class as a function")}function N(k,w){if(!k)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return w&&(typeof w=="object"||typeof w=="function")?w:k}function j(k,w){if(typeof w!="function"&&w!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof w);k.prototype=Object.create(w&&w.prototype,{constructor:{value:k,enumerable:!1,writable:!0,configurable:!0}}),w&&(Object.setPrototypeOf?Object.setPrototypeOf(k,w):k.__proto__=w)}function C(k){return k instanceof s.default||k instanceof o.BlockEmbed}var D=function(k){j(w,k);function w(S,P){E(this,w);var O=N(this,(w.__proto__||Object.getPrototypeOf(w)).call(this,S));return O.emitter=P.emitter,Array.isArray(P.whitelist)&&(O.whitelist=P.whitelist.reduce(function(L,$){return L[$]=!0,L},{})),O.domNode.addEventListener("DOMNodeInserted",function(){}),O.optimize(),O.enable(),O}return c(w,[{key:"batchStart",value:function(){this.batch=!0}},{key:"batchEnd",value:function(){this.batch=!1,this.optimize()}},{key:"deleteAt",value:function(P,O){var L=this.line(P),$=l(L,2),B=$[0],Y=$[1],U=this.line(P+O),q=l(U,1),R=q[0];if(m(w.prototype.__proto__||Object.getPrototypeOf(w.prototype),"deleteAt",this).call(this,P,O),R!=null&&B!==R&&Y>0){if(B instanceof o.BlockEmbed||R instanceof o.BlockEmbed){this.optimize();return}if(B instanceof y.default){var F=B.newlineIndex(B.length(),!0);if(F>-1&&(B=B.split(F+1),B===R)){this.optimize();return}}else if(R instanceof y.default){var M=R.newlineIndex(0);M>-1&&R.split(M+1)}var z=R.children.head instanceof v.default?null:R.children.head;B.moveChildren(R,z),B.remove()}this.optimize()}},{key:"enable",value:function(){var P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.domNode.setAttribute("contenteditable",P)}},{key:"formatAt",value:function(P,O,L,$){this.whitelist!=null&&!this.whitelist[L]||(m(w.prototype.__proto__||Object.getPrototypeOf(w.prototype),"formatAt",this).call(this,P,O,L,$),this.optimize())}},{key:"insertAt",value:function(P,O,L){if(!(L!=null&&this.whitelist!=null&&!this.whitelist[O])){if(P>=this.length())if(L==null||h.default.query(O,h.default.Scope.BLOCK)==null){var $=h.default.create(this.statics.defaultChild);this.appendChild($),L==null&&O.endsWith(`
`)&&(O=O.slice(0,-1)),$.insertAt(0,O,L)}else{var B=h.default.create(O,L);this.appendChild(B)}else m(w.prototype.__proto__||Object.getPrototypeOf(w.prototype),"insertAt",this).call(this,P,O,L);this.optimize()}}},{key:"insertBefore",value:function(P,O){if(P.statics.scope===h.default.Scope.INLINE_BLOT){var L=h.default.create(this.statics.defaultChild);L.appendChild(P),P=L}m(w.prototype.__proto__||Object.getPrototypeOf(w.prototype),"insertBefore",this).call(this,P,O)}},{key:"leaf",value:function(P){return this.path(P).pop()||[null,-1]}},{key:"line",value:function(P){return P===this.length()?this.line(P-1):this.descendant(C,P)}},{key:"lines",value:function(){var P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,O=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.MAX_VALUE,L=function $(B,Y,U){var q=[],R=U;return B.children.forEachAt(Y,U,function(F,M,z){C(F)?q.push(F):F instanceof h.default.Container&&(q=q.concat($(F,M,R))),R-=z}),q};return L(this,P,O)}},{key:"optimize",value:function(){var P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],O=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.batch!==!0&&(m(w.prototype.__proto__||Object.getPrototypeOf(w.prototype),"optimize",this).call(this,P,O),P.length>0&&this.emitter.emit(d.default.events.SCROLL_OPTIMIZE,P,O))}},{key:"path",value:function(P){return m(w.prototype.__proto__||Object.getPrototypeOf(w.prototype),"path",this).call(this,P).slice(1)}},{key:"update",value:function(P){if(this.batch!==!0){var O=d.default.sources.USER;typeof P=="string"&&(O=P),Array.isArray(P)||(P=this.observer.takeRecords()),P.length>0&&this.emitter.emit(d.default.events.SCROLL_BEFORE_UPDATE,O,P),m(w.prototype.__proto__||Object.getPrototypeOf(w.prototype),"update",this).call(this,P.concat([])),P.length>0&&this.emitter.emit(d.default.events.SCROLL_UPDATE,O,P)}}}]),w}(h.default.Scroll);D.blotName="scroll",D.className="ql-editor",D.tagName="DIV",D.defaultChild="block",D.allowedChildren=[s.default,o.BlockEmbed,_.default],r.default=D},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0}),r.SHORTKEY=r.default=void 0;var l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(I){return typeof I}:function(I){return I&&typeof Symbol=="function"&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},c=function(){function I(A,V){var K=[],Q=!0,de=!1,xe=void 0;try{for(var Z=A[Symbol.iterator](),re;!(Q=(re=Z.next()).done)&&(K.push(re.value),!(V&&K.length===V));Q=!0);}catch(ye){de=!0,xe=ye}finally{try{!Q&&Z.return&&Z.return()}finally{if(de)throw xe}}return K}return function(A,V){if(Array.isArray(A))return A;if(Symbol.iterator in Object(A))return I(A,V);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),m=function(){function I(A,V){for(var K=0;K<V.length;K++){var Q=V[K];Q.enumerable=Q.enumerable||!1,Q.configurable=!0,"value"in Q&&(Q.writable=!0),Object.defineProperty(A,Q.key,Q)}}return function(A,V,K){return V&&I(A.prototype,V),K&&I(A,K),A}}(),u=i(21),h=k(u),p=i(11),d=k(p),o=i(3),s=k(o),g=i(2),v=k(g),x=i(20),y=k(x),f=i(0),_=k(f),b=i(5),E=k(b),N=i(10),j=k(N),C=i(9),D=k(C);function k(I){return I&&I.__esModule?I:{default:I}}function w(I,A,V){return A in I?Object.defineProperty(I,A,{value:V,enumerable:!0,configurable:!0,writable:!0}):I[A]=V,I}function S(I,A){if(!(I instanceof A))throw new TypeError("Cannot call a class as a function")}function P(I,A){if(!I)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return A&&(typeof A=="object"||typeof A=="function")?A:I}function O(I,A){if(typeof A!="function"&&A!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof A);I.prototype=Object.create(A&&A.prototype,{constructor:{value:I,enumerable:!1,writable:!0,configurable:!0}}),A&&(Object.setPrototypeOf?Object.setPrototypeOf(I,A):I.__proto__=A)}var L=(0,j.default)("quill:keyboard"),$=/Mac/i.test(navigator.platform)?"metaKey":"ctrlKey",B=function(I){O(A,I),m(A,null,[{key:"match",value:function(K,Q){return Q=H(Q),["altKey","ctrlKey","metaKey","shiftKey"].some(function(de){return!!Q[de]!==K[de]&&Q[de]!==null})?!1:Q.key===(K.which||K.keyCode)}}]);function A(V,K){S(this,A);var Q=P(this,(A.__proto__||Object.getPrototypeOf(A)).call(this,V,K));return Q.bindings={},Object.keys(Q.options.bindings).forEach(function(de){de==="list autofill"&&V.scroll.whitelist!=null&&!V.scroll.whitelist.list||Q.options.bindings[de]&&Q.addBinding(Q.options.bindings[de])}),Q.addBinding({key:A.keys.ENTER,shiftKey:null},F),Q.addBinding({key:A.keys.ENTER,metaKey:null,ctrlKey:null,altKey:null},function(){}),/Firefox/i.test(navigator.userAgent)?(Q.addBinding({key:A.keys.BACKSPACE},{collapsed:!0},U),Q.addBinding({key:A.keys.DELETE},{collapsed:!0},q)):(Q.addBinding({key:A.keys.BACKSPACE},{collapsed:!0,prefix:/^.?$/},U),Q.addBinding({key:A.keys.DELETE},{collapsed:!0,suffix:/^.?$/},q)),Q.addBinding({key:A.keys.BACKSPACE},{collapsed:!1},R),Q.addBinding({key:A.keys.DELETE},{collapsed:!1},R),Q.addBinding({key:A.keys.BACKSPACE,altKey:null,ctrlKey:null,metaKey:null,shiftKey:null},{collapsed:!0,offset:0},U),Q.listen(),Q}return m(A,[{key:"addBinding",value:function(K){var Q=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},de=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},xe=H(K);if(xe==null||xe.key==null)return L.warn("Attempted to add invalid keyboard binding",xe);typeof Q=="function"&&(Q={handler:Q}),typeof de=="function"&&(de={handler:de}),xe=(0,s.default)(xe,Q,de),this.bindings[xe.key]=this.bindings[xe.key]||[],this.bindings[xe.key].push(xe)}},{key:"listen",value:function(){var K=this;this.quill.root.addEventListener("keydown",function(Q){if(!Q.defaultPrevented){var de=Q.which||Q.keyCode,xe=(K.bindings[de]||[]).filter(function(Fe){return A.match(Q,Fe)});if(xe.length!==0){var Z=K.quill.getSelection();if(!(Z==null||!K.quill.hasFocus())){var re=K.quill.getLine(Z.index),ye=c(re,2),Se=ye[0],De=ye[1],te=K.quill.getLeaf(Z.index),se=c(te,2),ge=se[0],ce=se[1],le=Z.length===0?[ge,ce]:K.quill.getLeaf(Z.index+Z.length),Ne=c(le,2),ae=Ne[0],ue=Ne[1],_e=ge instanceof _.default.Text?ge.value().slice(0,ce):"",ie=ae instanceof _.default.Text?ae.value().slice(ue):"",he={collapsed:Z.length===0,empty:Z.length===0&&Se.length()<=1,format:K.quill.getFormat(Z),offset:De,prefix:_e,suffix:ie},We=xe.some(function(Fe){if(Fe.collapsed!=null&&Fe.collapsed!==he.collapsed||Fe.empty!=null&&Fe.empty!==he.empty||Fe.offset!=null&&Fe.offset!==he.offset)return!1;if(Array.isArray(Fe.format)){if(Fe.format.every(function($e){return he.format[$e]==null}))return!1}else if(l(Fe.format)==="object"&&!Object.keys(Fe.format).every(function($e){return Fe.format[$e]===!0?he.format[$e]!=null:Fe.format[$e]===!1?he.format[$e]==null:(0,d.default)(Fe.format[$e],he.format[$e])}))return!1;return Fe.prefix!=null&&!Fe.prefix.test(he.prefix)||Fe.suffix!=null&&!Fe.suffix.test(he.suffix)?!1:Fe.handler.call(K,Z,he)!==!0});We&&Q.preventDefault()}}}})}}]),A}(D.default);B.keys={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46},B.DEFAULTS={bindings:{bold:z("bold"),italic:z("italic"),underline:z("underline"),indent:{key:B.keys.TAB,format:["blockquote","indent","list"],handler:function(A,V){if(V.collapsed&&V.offset!==0)return!0;this.quill.format("indent","+1",E.default.sources.USER)}},outdent:{key:B.keys.TAB,shiftKey:!0,format:["blockquote","indent","list"],handler:function(A,V){if(V.collapsed&&V.offset!==0)return!0;this.quill.format("indent","-1",E.default.sources.USER)}},"outdent backspace":{key:B.keys.BACKSPACE,collapsed:!0,shiftKey:null,metaKey:null,ctrlKey:null,altKey:null,format:["indent","list"],offset:0,handler:function(A,V){V.format.indent!=null?this.quill.format("indent","-1",E.default.sources.USER):V.format.list!=null&&this.quill.format("list",!1,E.default.sources.USER)}},"indent code-block":M(!0),"outdent code-block":M(!1),"remove tab":{key:B.keys.TAB,shiftKey:!0,collapsed:!0,prefix:/\t$/,handler:function(A){this.quill.deleteText(A.index-1,1,E.default.sources.USER)}},tab:{key:B.keys.TAB,handler:function(A){this.quill.history.cutoff();var V=new v.default().retain(A.index).delete(A.length).insert("	");this.quill.updateContents(V,E.default.sources.USER),this.quill.history.cutoff(),this.quill.setSelection(A.index+1,E.default.sources.SILENT)}},"list empty enter":{key:B.keys.ENTER,collapsed:!0,format:["list"],empty:!0,handler:function(A,V){this.quill.format("list",!1,E.default.sources.USER),V.format.indent&&this.quill.format("indent",!1,E.default.sources.USER)}},"checklist enter":{key:B.keys.ENTER,collapsed:!0,format:{list:"checked"},handler:function(A){var V=this.quill.getLine(A.index),K=c(V,2),Q=K[0],de=K[1],xe=(0,s.default)({},Q.formats(),{list:"checked"}),Z=new v.default().retain(A.index).insert(`
`,xe).retain(Q.length()-de-1).retain(1,{list:"unchecked"});this.quill.updateContents(Z,E.default.sources.USER),this.quill.setSelection(A.index+1,E.default.sources.SILENT),this.quill.scrollIntoView()}},"header enter":{key:B.keys.ENTER,collapsed:!0,format:["header"],suffix:/^$/,handler:function(A,V){var K=this.quill.getLine(A.index),Q=c(K,2),de=Q[0],xe=Q[1],Z=new v.default().retain(A.index).insert(`
`,V.format).retain(de.length()-xe-1).retain(1,{header:null});this.quill.updateContents(Z,E.default.sources.USER),this.quill.setSelection(A.index+1,E.default.sources.SILENT),this.quill.scrollIntoView()}},"list autofill":{key:" ",collapsed:!0,format:{list:!1},prefix:/^\s*?(\d+\.|-|\*|\[ ?\]|\[x\])$/,handler:function(A,V){var K=V.prefix.length,Q=this.quill.getLine(A.index),de=c(Q,2),xe=de[0],Z=de[1];if(Z>K)return!0;var re=void 0;switch(V.prefix.trim()){case"[]":case"[ ]":re="unchecked";break;case"[x]":re="checked";break;case"-":case"*":re="bullet";break;default:re="ordered"}this.quill.insertText(A.index," ",E.default.sources.USER),this.quill.history.cutoff();var ye=new v.default().retain(A.index-Z).delete(K+1).retain(xe.length()-2-Z).retain(1,{list:re});this.quill.updateContents(ye,E.default.sources.USER),this.quill.history.cutoff(),this.quill.setSelection(A.index-K,E.default.sources.SILENT)}},"code exit":{key:B.keys.ENTER,collapsed:!0,format:["code-block"],prefix:/\n\n$/,suffix:/^\s+$/,handler:function(A){var V=this.quill.getLine(A.index),K=c(V,2),Q=K[0],de=K[1],xe=new v.default().retain(A.index+Q.length()-de-2).retain(1,{"code-block":null}).delete(1);this.quill.updateContents(xe,E.default.sources.USER)}},"embed left":Y(B.keys.LEFT,!1),"embed left shift":Y(B.keys.LEFT,!0),"embed right":Y(B.keys.RIGHT,!1),"embed right shift":Y(B.keys.RIGHT,!0)}};function Y(I,A){var V,K=I===B.keys.LEFT?"prefix":"suffix";return V={key:I,shiftKey:A,altKey:null},w(V,K,/^$/),w(V,"handler",function(de){var xe=de.index;I===B.keys.RIGHT&&(xe+=de.length+1);var Z=this.quill.getLeaf(xe),re=c(Z,1),ye=re[0];return ye instanceof _.default.Embed?(I===B.keys.LEFT?A?this.quill.setSelection(de.index-1,de.length+1,E.default.sources.USER):this.quill.setSelection(de.index-1,E.default.sources.USER):A?this.quill.setSelection(de.index,de.length+1,E.default.sources.USER):this.quill.setSelection(de.index+de.length+1,E.default.sources.USER),!1):!0}),V}function U(I,A){if(!(I.index===0||this.quill.getLength()<=1)){var V=this.quill.getLine(I.index),K=c(V,1),Q=K[0],de={};if(A.offset===0){var xe=this.quill.getLine(I.index-1),Z=c(xe,1),re=Z[0];if(re!=null&&re.length()>1){var ye=Q.formats(),Se=this.quill.getFormat(I.index-1,1);de=y.default.attributes.diff(ye,Se)||{}}}var De=/[\uD800-\uDBFF][\uDC00-\uDFFF]$/.test(A.prefix)?2:1;this.quill.deleteText(I.index-De,De,E.default.sources.USER),Object.keys(de).length>0&&this.quill.formatLine(I.index-De,De,de,E.default.sources.USER),this.quill.focus()}}function q(I,A){var V=/^[\uD800-\uDBFF][\uDC00-\uDFFF]/.test(A.suffix)?2:1;if(!(I.index>=this.quill.getLength()-V)){var K={},Q=0,de=this.quill.getLine(I.index),xe=c(de,1),Z=xe[0];if(A.offset>=Z.length()-1){var re=this.quill.getLine(I.index+1),ye=c(re,1),Se=ye[0];if(Se){var De=Z.formats(),te=this.quill.getFormat(I.index,1);K=y.default.attributes.diff(De,te)||{},Q=Se.length()}}this.quill.deleteText(I.index,V,E.default.sources.USER),Object.keys(K).length>0&&this.quill.formatLine(I.index+Q-1,V,K,E.default.sources.USER)}}function R(I){var A=this.quill.getLines(I),V={};if(A.length>1){var K=A[0].formats(),Q=A[A.length-1].formats();V=y.default.attributes.diff(Q,K)||{}}this.quill.deleteText(I,E.default.sources.USER),Object.keys(V).length>0&&this.quill.formatLine(I.index,1,V,E.default.sources.USER),this.quill.setSelection(I.index,E.default.sources.SILENT),this.quill.focus()}function F(I,A){var V=this;I.length>0&&this.quill.scroll.deleteAt(I.index,I.length);var K=Object.keys(A.format).reduce(function(Q,de){return _.default.query(de,_.default.Scope.BLOCK)&&!Array.isArray(A.format[de])&&(Q[de]=A.format[de]),Q},{});this.quill.insertText(I.index,`
`,K,E.default.sources.USER),this.quill.setSelection(I.index+1,E.default.sources.SILENT),this.quill.focus(),Object.keys(A.format).forEach(function(Q){K[Q]==null&&(Array.isArray(A.format[Q])||Q!=="link"&&V.quill.format(Q,A.format[Q],E.default.sources.USER))})}function M(I){return{key:B.keys.TAB,shiftKey:!I,format:{"code-block":!0},handler:function(V){var K=_.default.query("code-block"),Q=V.index,de=V.length,xe=this.quill.scroll.descendant(K,Q),Z=c(xe,2),re=Z[0],ye=Z[1];if(re!=null){var Se=this.quill.getIndex(re),De=re.newlineIndex(ye,!0)+1,te=re.newlineIndex(Se+ye+de),se=re.domNode.textContent.slice(De,te).split(`
`);ye=0,se.forEach(function(ge,ce){I?(re.insertAt(De+ye,K.TAB),ye+=K.TAB.length,ce===0?Q+=K.TAB.length:de+=K.TAB.length):ge.startsWith(K.TAB)&&(re.deleteAt(De+ye,K.TAB.length),ye-=K.TAB.length,ce===0?Q-=K.TAB.length:de-=K.TAB.length),ye+=ge.length+1}),this.quill.update(E.default.sources.USER),this.quill.setSelection(Q,de,E.default.sources.SILENT)}}}}function z(I){return{key:I[0].toUpperCase(),shortKey:!0,handler:function(V,K){this.quill.format(I,!K.format[I],E.default.sources.USER)}}}function H(I){if(typeof I=="string"||typeof I=="number")return H({key:I});if((typeof I>"u"?"undefined":l(I))==="object"&&(I=(0,h.default)(I,!1)),typeof I.key=="string")if(B.keys[I.key.toUpperCase()]!=null)I.key=B.keys[I.key.toUpperCase()];else if(I.key.length===1)I.key=I.key.toUpperCase().charCodeAt(0);else return null;return I.shortKey&&(I[$]=I.shortKey,delete I.shortKey),I}r.default=B,r.SHORTKEY=$},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0});var l=function(){function y(f,_){var b=[],E=!0,N=!1,j=void 0;try{for(var C=f[Symbol.iterator](),D;!(E=(D=C.next()).done)&&(b.push(D.value),!(_&&b.length===_));E=!0);}catch(k){N=!0,j=k}finally{try{!E&&C.return&&C.return()}finally{if(N)throw j}}return b}return function(f,_){if(Array.isArray(f))return f;if(Symbol.iterator in Object(f))return y(f,_);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),c=function y(f,_,b){f===null&&(f=Function.prototype);var E=Object.getOwnPropertyDescriptor(f,_);if(E===void 0){var N=Object.getPrototypeOf(f);return N===null?void 0:y(N,_,b)}else{if("value"in E)return E.value;var j=E.get;return j===void 0?void 0:j.call(b)}},m=function(){function y(f,_){for(var b=0;b<_.length;b++){var E=_[b];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(f,E.key,E)}}return function(f,_,b){return _&&y(f.prototype,_),b&&y(f,b),f}}(),u=i(0),h=o(u),p=i(7),d=o(p);function o(y){return y&&y.__esModule?y:{default:y}}function s(y,f){if(!(y instanceof f))throw new TypeError("Cannot call a class as a function")}function g(y,f){if(!y)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return f&&(typeof f=="object"||typeof f=="function")?f:y}function v(y,f){if(typeof f!="function"&&f!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof f);y.prototype=Object.create(f&&f.prototype,{constructor:{value:y,enumerable:!1,writable:!0,configurable:!0}}),f&&(Object.setPrototypeOf?Object.setPrototypeOf(y,f):y.__proto__=f)}var x=function(y){v(f,y),m(f,null,[{key:"value",value:function(){}}]);function f(_,b){s(this,f);var E=g(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,_));return E.selection=b,E.textNode=document.createTextNode(f.CONTENTS),E.domNode.appendChild(E.textNode),E._length=0,E}return m(f,[{key:"detach",value:function(){this.parent!=null&&this.parent.removeChild(this)}},{key:"format",value:function(b,E){if(this._length!==0)return c(f.prototype.__proto__||Object.getPrototypeOf(f.prototype),"format",this).call(this,b,E);for(var N=this,j=0;N!=null&&N.statics.scope!==h.default.Scope.BLOCK_BLOT;)j+=N.offset(N.parent),N=N.parent;N!=null&&(this._length=f.CONTENTS.length,N.optimize(),N.formatAt(j,f.CONTENTS.length,b,E),this._length=0)}},{key:"index",value:function(b,E){return b===this.textNode?0:c(f.prototype.__proto__||Object.getPrototypeOf(f.prototype),"index",this).call(this,b,E)}},{key:"length",value:function(){return this._length}},{key:"position",value:function(){return[this.textNode,this.textNode.data.length]}},{key:"remove",value:function(){c(f.prototype.__proto__||Object.getPrototypeOf(f.prototype),"remove",this).call(this),this.parent=null}},{key:"restore",value:function(){if(!(this.selection.composing||this.parent==null)){var b=this.textNode,E=this.selection.getNativeRange(),N=void 0,j=void 0,C=void 0;if(E!=null&&E.start.node===b&&E.end.node===b){var D=[b,E.start.offset,E.end.offset];N=D[0],j=D[1],C=D[2]}for(;this.domNode.lastChild!=null&&this.domNode.lastChild!==this.textNode;)this.domNode.parentNode.insertBefore(this.domNode.lastChild,this.domNode);if(this.textNode.data!==f.CONTENTS){var k=this.textNode.data.split(f.CONTENTS).join("");this.next instanceof d.default?(N=this.next.domNode,this.next.insertAt(0,k),this.textNode.data=f.CONTENTS):(this.textNode.data=k,this.parent.insertBefore(h.default.create(this.textNode),this),this.textNode=document.createTextNode(f.CONTENTS),this.domNode.appendChild(this.textNode))}if(this.remove(),j!=null){var w=[j,C].map(function(P){return Math.max(0,Math.min(N.data.length,P-1))}),S=l(w,2);return j=S[0],C=S[1],{startNode:N,startOffset:j,endNode:N,endOffset:C}}}}},{key:"update",value:function(b,E){var N=this;if(b.some(function(C){return C.type==="characterData"&&C.target===N.textNode})){var j=this.restore();j&&(E.range=j)}}},{key:"value",value:function(){return""}}]),f}(h.default.Embed);x.blotName="cursor",x.className="ql-cursor",x.tagName="span",x.CONTENTS="\uFEFF",r.default=x},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0});var l=i(0),c=h(l),m=i(4),u=h(m);function h(g){return g&&g.__esModule?g:{default:g}}function p(g,v){if(!(g instanceof v))throw new TypeError("Cannot call a class as a function")}function d(g,v){if(!g)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return v&&(typeof v=="object"||typeof v=="function")?v:g}function o(g,v){if(typeof v!="function"&&v!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof v);g.prototype=Object.create(v&&v.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}}),v&&(Object.setPrototypeOf?Object.setPrototypeOf(g,v):g.__proto__=v)}var s=function(g){o(v,g);function v(){return p(this,v),d(this,(v.__proto__||Object.getPrototypeOf(v)).apply(this,arguments))}return v}(c.default.Container);s.allowedChildren=[u.default,m.BlockEmbed,s],r.default=s},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0}),r.ColorStyle=r.ColorClass=r.ColorAttributor=void 0;var l=function(){function x(y,f){for(var _=0;_<f.length;_++){var b=f[_];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(y,b.key,b)}}return function(y,f,_){return f&&x(y.prototype,f),_&&x(y,_),y}}(),c=function x(y,f,_){y===null&&(y=Function.prototype);var b=Object.getOwnPropertyDescriptor(y,f);if(b===void 0){var E=Object.getPrototypeOf(y);return E===null?void 0:x(E,f,_)}else{if("value"in b)return b.value;var N=b.get;return N===void 0?void 0:N.call(_)}},m=i(0),u=h(m);function h(x){return x&&x.__esModule?x:{default:x}}function p(x,y){if(!(x instanceof y))throw new TypeError("Cannot call a class as a function")}function d(x,y){if(!x)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return y&&(typeof y=="object"||typeof y=="function")?y:x}function o(x,y){if(typeof y!="function"&&y!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof y);x.prototype=Object.create(y&&y.prototype,{constructor:{value:x,enumerable:!1,writable:!0,configurable:!0}}),y&&(Object.setPrototypeOf?Object.setPrototypeOf(x,y):x.__proto__=y)}var s=function(x){o(y,x);function y(){return p(this,y),d(this,(y.__proto__||Object.getPrototypeOf(y)).apply(this,arguments))}return l(y,[{key:"value",value:function(_){var b=c(y.prototype.__proto__||Object.getPrototypeOf(y.prototype),"value",this).call(this,_);return b.startsWith("rgb(")?(b=b.replace(/^[^\d]+/,"").replace(/[^\d]+$/,""),"#"+b.split(",").map(function(E){return("00"+parseInt(E).toString(16)).slice(-2)}).join("")):b}}]),y}(u.default.Attributor.Style),g=new u.default.Attributor.Class("color","ql-color",{scope:u.default.Scope.INLINE}),v=new s("color","color",{scope:u.default.Scope.INLINE});r.ColorAttributor=s,r.ColorClass=g,r.ColorStyle=v},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0}),r.sanitize=r.default=void 0;var l=function(){function v(x,y){for(var f=0;f<y.length;f++){var _=y[f];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(x,_.key,_)}}return function(x,y,f){return y&&v(x.prototype,y),f&&v(x,f),x}}(),c=function v(x,y,f){x===null&&(x=Function.prototype);var _=Object.getOwnPropertyDescriptor(x,y);if(_===void 0){var b=Object.getPrototypeOf(x);return b===null?void 0:v(b,y,f)}else{if("value"in _)return _.value;var E=_.get;return E===void 0?void 0:E.call(f)}},m=i(6),u=h(m);function h(v){return v&&v.__esModule?v:{default:v}}function p(v,x){if(!(v instanceof x))throw new TypeError("Cannot call a class as a function")}function d(v,x){if(!v)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return x&&(typeof x=="object"||typeof x=="function")?x:v}function o(v,x){if(typeof x!="function"&&x!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof x);v.prototype=Object.create(x&&x.prototype,{constructor:{value:v,enumerable:!1,writable:!0,configurable:!0}}),x&&(Object.setPrototypeOf?Object.setPrototypeOf(v,x):v.__proto__=x)}var s=function(v){o(x,v);function x(){return p(this,x),d(this,(x.__proto__||Object.getPrototypeOf(x)).apply(this,arguments))}return l(x,[{key:"format",value:function(f,_){if(f!==this.statics.blotName||!_)return c(x.prototype.__proto__||Object.getPrototypeOf(x.prototype),"format",this).call(this,f,_);_=this.constructor.sanitize(_),this.domNode.setAttribute("href",_)}}],[{key:"create",value:function(f){var _=c(x.__proto__||Object.getPrototypeOf(x),"create",this).call(this,f);return f=this.sanitize(f),_.setAttribute("href",f),_.setAttribute("rel","noopener noreferrer"),_.setAttribute("target","_blank"),_}},{key:"formats",value:function(f){return f.getAttribute("href")}},{key:"sanitize",value:function(f){return g(f,this.PROTOCOL_WHITELIST)?f:this.SANITIZED_URL}}]),x}(u.default);s.blotName="link",s.tagName="A",s.SANITIZED_URL="about:blank",s.PROTOCOL_WHITELIST=["http","https","mailto","tel"];function g(v,x){var y=document.createElement("a");y.href=v;var f=y.href.slice(0,y.href.indexOf(":"));return x.indexOf(f)>-1}r.default=s,r.sanitize=g},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0});var l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(x){return typeof x}:function(x){return x&&typeof Symbol=="function"&&x.constructor===Symbol&&x!==Symbol.prototype?"symbol":typeof x},c=function(){function x(y,f){for(var _=0;_<f.length;_++){var b=f[_];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(y,b.key,b)}}return function(y,f,_){return f&&x(y.prototype,f),_&&x(y,_),y}}(),m=i(23),u=d(m),h=i(107),p=d(h);function d(x){return x&&x.__esModule?x:{default:x}}function o(x,y){if(!(x instanceof y))throw new TypeError("Cannot call a class as a function")}var s=0;function g(x,y){x.setAttribute(y,x.getAttribute(y)!=="true")}var v=function(){function x(y){var f=this;o(this,x),this.select=y,this.container=document.createElement("span"),this.buildPicker(),this.select.style.display="none",this.select.parentNode.insertBefore(this.container,this.select),this.label.addEventListener("mousedown",function(){f.togglePicker()}),this.label.addEventListener("keydown",function(_){switch(_.keyCode){case u.default.keys.ENTER:f.togglePicker();break;case u.default.keys.ESCAPE:f.escape(),_.preventDefault();break}}),this.select.addEventListener("change",this.update.bind(this))}return c(x,[{key:"togglePicker",value:function(){this.container.classList.toggle("ql-expanded"),g(this.label,"aria-expanded"),g(this.options,"aria-hidden")}},{key:"buildItem",value:function(f){var _=this,b=document.createElement("span");return b.tabIndex="0",b.setAttribute("role","button"),b.classList.add("ql-picker-item"),f.hasAttribute("value")&&b.setAttribute("data-value",f.getAttribute("value")),f.textContent&&b.setAttribute("data-label",f.textContent),b.addEventListener("click",function(){_.selectItem(b,!0)}),b.addEventListener("keydown",function(E){switch(E.keyCode){case u.default.keys.ENTER:_.selectItem(b,!0),E.preventDefault();break;case u.default.keys.ESCAPE:_.escape(),E.preventDefault();break}}),b}},{key:"buildLabel",value:function(){var f=document.createElement("span");return f.classList.add("ql-picker-label"),f.innerHTML=p.default,f.tabIndex="0",f.setAttribute("role","button"),f.setAttribute("aria-expanded","false"),this.container.appendChild(f),f}},{key:"buildOptions",value:function(){var f=this,_=document.createElement("span");_.classList.add("ql-picker-options"),_.setAttribute("aria-hidden","true"),_.tabIndex="-1",_.id="ql-picker-options-"+s,s+=1,this.label.setAttribute("aria-controls",_.id),this.options=_,[].slice.call(this.select.options).forEach(function(b){var E=f.buildItem(b);_.appendChild(E),b.selected===!0&&f.selectItem(E)}),this.container.appendChild(_)}},{key:"buildPicker",value:function(){var f=this;[].slice.call(this.select.attributes).forEach(function(_){f.container.setAttribute(_.name,_.value)}),this.container.classList.add("ql-picker"),this.label=this.buildLabel(),this.buildOptions()}},{key:"escape",value:function(){var f=this;this.close(),setTimeout(function(){return f.label.focus()},1)}},{key:"close",value:function(){this.container.classList.remove("ql-expanded"),this.label.setAttribute("aria-expanded","false"),this.options.setAttribute("aria-hidden","true")}},{key:"selectItem",value:function(f){var _=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,b=this.container.querySelector(".ql-selected");if(f!==b&&(b!=null&&b.classList.remove("ql-selected"),f!=null&&(f.classList.add("ql-selected"),this.select.selectedIndex=[].indexOf.call(f.parentNode.children,f),f.hasAttribute("data-value")?this.label.setAttribute("data-value",f.getAttribute("data-value")):this.label.removeAttribute("data-value"),f.hasAttribute("data-label")?this.label.setAttribute("data-label",f.getAttribute("data-label")):this.label.removeAttribute("data-label"),_))){if(typeof Event=="function")this.select.dispatchEvent(new Event("change"));else if((typeof Event>"u"?"undefined":l(Event))==="object"){var E=document.createEvent("Event");E.initEvent("change",!0,!0),this.select.dispatchEvent(E)}this.close()}}},{key:"update",value:function(){var f=void 0;if(this.select.selectedIndex>-1){var _=this.container.querySelector(".ql-picker-options").children[this.select.selectedIndex];f=this.select.options[this.select.selectedIndex],this.selectItem(_)}else this.selectItem(null);var b=f!=null&&f!==this.select.querySelector("option[selected]");this.label.classList.toggle("ql-active",b)}}]),x}();r.default=v},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0});var l=i(0),c=L(l),m=i(5),u=L(m),h=i(4),p=L(h),d=i(16),o=L(d),s=i(25),g=L(s),v=i(24),x=L(v),y=i(35),f=L(y),_=i(6),b=L(_),E=i(22),N=L(E),j=i(7),C=L(j),D=i(55),k=L(D),w=i(42),S=L(w),P=i(23),O=L(P);function L($){return $&&$.__esModule?$:{default:$}}u.default.register({"blots/block":p.default,"blots/block/embed":h.BlockEmbed,"blots/break":o.default,"blots/container":g.default,"blots/cursor":x.default,"blots/embed":f.default,"blots/inline":b.default,"blots/scroll":N.default,"blots/text":C.default,"modules/clipboard":k.default,"modules/history":S.default,"modules/keyboard":O.default}),c.default.register(p.default,o.default,x.default,b.default,N.default,C.default),r.default=u.default},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0});var l=i(1),c=function(){function m(u){this.domNode=u,this.domNode[l.DATA_KEY]={blot:this}}return Object.defineProperty(m.prototype,"statics",{get:function(){return this.constructor},enumerable:!0,configurable:!0}),m.create=function(u){if(this.tagName==null)throw new l.ParchmentError("Blot definition missing tagName");var h;return Array.isArray(this.tagName)?(typeof u=="string"&&(u=u.toUpperCase(),parseInt(u).toString()===u&&(u=parseInt(u))),typeof u=="number"?h=document.createElement(this.tagName[u-1]):this.tagName.indexOf(u)>-1?h=document.createElement(u):h=document.createElement(this.tagName[0])):h=document.createElement(this.tagName),this.className&&h.classList.add(this.className),h},m.prototype.attach=function(){this.parent!=null&&(this.scroll=this.parent.scroll)},m.prototype.clone=function(){var u=this.domNode.cloneNode(!1);return l.create(u)},m.prototype.detach=function(){this.parent!=null&&this.parent.removeChild(this),delete this.domNode[l.DATA_KEY]},m.prototype.deleteAt=function(u,h){var p=this.isolate(u,h);p.remove()},m.prototype.formatAt=function(u,h,p,d){var o=this.isolate(u,h);if(l.query(p,l.Scope.BLOT)!=null&&d)o.wrap(p,d);else if(l.query(p,l.Scope.ATTRIBUTE)!=null){var s=l.create(this.statics.scope);o.wrap(s),s.format(p,d)}},m.prototype.insertAt=function(u,h,p){var d=p==null?l.create("text",h):l.create(h,p),o=this.split(u);this.parent.insertBefore(d,o)},m.prototype.insertInto=function(u,h){h===void 0&&(h=null),this.parent!=null&&this.parent.children.remove(this);var p=null;u.children.insertBefore(this,h),h!=null&&(p=h.domNode),(this.domNode.parentNode!=u.domNode||this.domNode.nextSibling!=p)&&u.domNode.insertBefore(this.domNode,p),this.parent=u,this.attach()},m.prototype.isolate=function(u,h){var p=this.split(u);return p.split(h),p},m.prototype.length=function(){return 1},m.prototype.offset=function(u){return u===void 0&&(u=this.parent),this.parent==null||this==u?0:this.parent.children.offset(this)+this.parent.offset(u)},m.prototype.optimize=function(u){this.domNode[l.DATA_KEY]!=null&&delete this.domNode[l.DATA_KEY].mutations},m.prototype.remove=function(){this.domNode.parentNode!=null&&this.domNode.parentNode.removeChild(this.domNode),this.detach()},m.prototype.replace=function(u){u.parent!=null&&(u.parent.insertBefore(this,u.next),u.remove())},m.prototype.replaceWith=function(u,h){var p=typeof u=="string"?l.create(u,h):u;return p.replace(this),p},m.prototype.split=function(u,h){return u===0?this:this.next},m.prototype.update=function(u,h){},m.prototype.wrap=function(u,h){var p=typeof u=="string"?l.create(u,h):u;return this.parent!=null&&this.parent.insertBefore(p,this.next),p.appendChild(this),p},m.blotName="abstract",m}();r.default=c},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0});var l=i(12),c=i(32),m=i(33),u=i(1),h=function(){function p(d){this.attributes={},this.domNode=d,this.build()}return p.prototype.attribute=function(d,o){o?d.add(this.domNode,o)&&(d.value(this.domNode)!=null?this.attributes[d.attrName]=d:delete this.attributes[d.attrName]):(d.remove(this.domNode),delete this.attributes[d.attrName])},p.prototype.build=function(){var d=this;this.attributes={};var o=l.default.keys(this.domNode),s=c.default.keys(this.domNode),g=m.default.keys(this.domNode);o.concat(s).concat(g).forEach(function(v){var x=u.query(v,u.Scope.ATTRIBUTE);x instanceof l.default&&(d.attributes[x.attrName]=x)})},p.prototype.copy=function(d){var o=this;Object.keys(this.attributes).forEach(function(s){var g=o.attributes[s].value(o.domNode);d.format(s,g)})},p.prototype.move=function(d){var o=this;this.copy(d),Object.keys(this.attributes).forEach(function(s){o.attributes[s].remove(o.domNode)}),this.attributes={}},p.prototype.values=function(){var d=this;return Object.keys(this.attributes).reduce(function(o,s){return o[s]=d.attributes[s].value(d.domNode),o},{})},p}();r.default=h},function(t,r,i){var l=this&&this.__extends||function(){var h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,d){p.__proto__=d}||function(p,d){for(var o in d)d.hasOwnProperty(o)&&(p[o]=d[o])};return function(p,d){h(p,d);function o(){this.constructor=p}p.prototype=d===null?Object.create(d):(o.prototype=d.prototype,new o)}}();Object.defineProperty(r,"__esModule",{value:!0});var c=i(12);function m(h,p){var d=h.getAttribute("class")||"";return d.split(/\s+/).filter(function(o){return o.indexOf(p+"-")===0})}var u=function(h){l(p,h);function p(){return h!==null&&h.apply(this,arguments)||this}return p.keys=function(d){return(d.getAttribute("class")||"").split(/\s+/).map(function(o){return o.split("-").slice(0,-1).join("-")})},p.prototype.add=function(d,o){return this.canAdd(d,o)?(this.remove(d),d.classList.add(this.keyName+"-"+o),!0):!1},p.prototype.remove=function(d){var o=m(d,this.keyName);o.forEach(function(s){d.classList.remove(s)}),d.classList.length===0&&d.removeAttribute("class")},p.prototype.value=function(d){var o=m(d,this.keyName)[0]||"",s=o.slice(this.keyName.length+1);return this.canAdd(d,s)?s:""},p}(c.default);r.default=u},function(t,r,i){var l=this&&this.__extends||function(){var h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,d){p.__proto__=d}||function(p,d){for(var o in d)d.hasOwnProperty(o)&&(p[o]=d[o])};return function(p,d){h(p,d);function o(){this.constructor=p}p.prototype=d===null?Object.create(d):(o.prototype=d.prototype,new o)}}();Object.defineProperty(r,"__esModule",{value:!0});var c=i(12);function m(h){var p=h.split("-"),d=p.slice(1).map(function(o){return o[0].toUpperCase()+o.slice(1)}).join("");return p[0]+d}var u=function(h){l(p,h);function p(){return h!==null&&h.apply(this,arguments)||this}return p.keys=function(d){return(d.getAttribute("style")||"").split(";").map(function(o){var s=o.split(":");return s[0].trim()})},p.prototype.add=function(d,o){return this.canAdd(d,o)?(d.style[m(this.keyName)]=o,!0):!1},p.prototype.remove=function(d){d.style[m(this.keyName)]="",d.getAttribute("style")||d.removeAttribute("style")},p.prototype.value=function(d){var o=d.style[m(this.keyName)];return this.canAdd(d,o)?o:""},p}(c.default);r.default=u},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0});var l=function(){function u(h,p){for(var d=0;d<p.length;d++){var o=p[d];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(h,o.key,o)}}return function(h,p,d){return p&&u(h.prototype,p),d&&u(h,d),h}}();function c(u,h){if(!(u instanceof h))throw new TypeError("Cannot call a class as a function")}var m=function(){function u(h,p){c(this,u),this.quill=h,this.options=p,this.modules={}}return l(u,[{key:"init",value:function(){var p=this;Object.keys(this.options.modules).forEach(function(d){p.modules[d]==null&&p.addModule(d)})}},{key:"addModule",value:function(p){var d=this.quill.constructor.import("modules/"+p);return this.modules[p]=new d(this.quill,this.options.modules[p]||{}),this.modules[p]}}]),u}();m.DEFAULTS={modules:{}},m.themes={default:m},r.default=m},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0});var l=function(){function y(f,_){for(var b=0;b<_.length;b++){var E=_[b];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(f,E.key,E)}}return function(f,_,b){return _&&y(f.prototype,_),b&&y(f,b),f}}(),c=function y(f,_,b){f===null&&(f=Function.prototype);var E=Object.getOwnPropertyDescriptor(f,_);if(E===void 0){var N=Object.getPrototypeOf(f);return N===null?void 0:y(N,_,b)}else{if("value"in E)return E.value;var j=E.get;return j===void 0?void 0:j.call(b)}},m=i(0),u=d(m),h=i(7),p=d(h);function d(y){return y&&y.__esModule?y:{default:y}}function o(y,f){if(!(y instanceof f))throw new TypeError("Cannot call a class as a function")}function s(y,f){if(!y)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return f&&(typeof f=="object"||typeof f=="function")?f:y}function g(y,f){if(typeof f!="function"&&f!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof f);y.prototype=Object.create(f&&f.prototype,{constructor:{value:y,enumerable:!1,writable:!0,configurable:!0}}),f&&(Object.setPrototypeOf?Object.setPrototypeOf(y,f):y.__proto__=f)}var v="\uFEFF",x=function(y){g(f,y);function f(_){o(this,f);var b=s(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,_));return b.contentNode=document.createElement("span"),b.contentNode.setAttribute("contenteditable",!1),[].slice.call(b.domNode.childNodes).forEach(function(E){b.contentNode.appendChild(E)}),b.leftGuard=document.createTextNode(v),b.rightGuard=document.createTextNode(v),b.domNode.appendChild(b.leftGuard),b.domNode.appendChild(b.contentNode),b.domNode.appendChild(b.rightGuard),b}return l(f,[{key:"index",value:function(b,E){return b===this.leftGuard?0:b===this.rightGuard?1:c(f.prototype.__proto__||Object.getPrototypeOf(f.prototype),"index",this).call(this,b,E)}},{key:"restore",value:function(b){var E=void 0,N=void 0,j=b.data.split(v).join("");if(b===this.leftGuard)if(this.prev instanceof p.default){var C=this.prev.length();this.prev.insertAt(C,j),E={startNode:this.prev.domNode,startOffset:C+j.length}}else N=document.createTextNode(j),this.parent.insertBefore(u.default.create(N),this),E={startNode:N,startOffset:j.length};else b===this.rightGuard&&(this.next instanceof p.default?(this.next.insertAt(0,j),E={startNode:this.next.domNode,startOffset:j.length}):(N=document.createTextNode(j),this.parent.insertBefore(u.default.create(N),this.next),E={startNode:N,startOffset:j.length}));return b.data=v,E}},{key:"update",value:function(b,E){var N=this;b.forEach(function(j){if(j.type==="characterData"&&(j.target===N.leftGuard||j.target===N.rightGuard)){var C=N.restore(j.target);C&&(E.range=C)}})}}]),f}(u.default.Embed);r.default=x},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0}),r.AlignStyle=r.AlignClass=r.AlignAttribute=void 0;var l=i(0),c=m(l);function m(o){return o&&o.__esModule?o:{default:o}}var u={scope:c.default.Scope.BLOCK,whitelist:["right","center","justify"]},h=new c.default.Attributor.Attribute("align","align",u),p=new c.default.Attributor.Class("align","ql-align",u),d=new c.default.Attributor.Style("align","text-align",u);r.AlignAttribute=h,r.AlignClass=p,r.AlignStyle=d},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0}),r.BackgroundStyle=r.BackgroundClass=void 0;var l=i(0),c=u(l),m=i(26);function u(d){return d&&d.__esModule?d:{default:d}}var h=new c.default.Attributor.Class("background","ql-bg",{scope:c.default.Scope.INLINE}),p=new m.ColorAttributor("background","background-color",{scope:c.default.Scope.INLINE});r.BackgroundClass=h,r.BackgroundStyle=p},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0}),r.DirectionStyle=r.DirectionClass=r.DirectionAttribute=void 0;var l=i(0),c=m(l);function m(o){return o&&o.__esModule?o:{default:o}}var u={scope:c.default.Scope.BLOCK,whitelist:["rtl"]},h=new c.default.Attributor.Attribute("direction","dir",u),p=new c.default.Attributor.Class("direction","ql-direction",u),d=new c.default.Attributor.Style("direction","direction",u);r.DirectionAttribute=h,r.DirectionClass=p,r.DirectionStyle=d},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0}),r.FontClass=r.FontStyle=void 0;var l=function(){function y(f,_){for(var b=0;b<_.length;b++){var E=_[b];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(f,E.key,E)}}return function(f,_,b){return _&&y(f.prototype,_),b&&y(f,b),f}}(),c=function y(f,_,b){f===null&&(f=Function.prototype);var E=Object.getOwnPropertyDescriptor(f,_);if(E===void 0){var N=Object.getPrototypeOf(f);return N===null?void 0:y(N,_,b)}else{if("value"in E)return E.value;var j=E.get;return j===void 0?void 0:j.call(b)}},m=i(0),u=h(m);function h(y){return y&&y.__esModule?y:{default:y}}function p(y,f){if(!(y instanceof f))throw new TypeError("Cannot call a class as a function")}function d(y,f){if(!y)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return f&&(typeof f=="object"||typeof f=="function")?f:y}function o(y,f){if(typeof f!="function"&&f!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof f);y.prototype=Object.create(f&&f.prototype,{constructor:{value:y,enumerable:!1,writable:!0,configurable:!0}}),f&&(Object.setPrototypeOf?Object.setPrototypeOf(y,f):y.__proto__=f)}var s={scope:u.default.Scope.INLINE,whitelist:["serif","monospace"]},g=new u.default.Attributor.Class("font","ql-font",s),v=function(y){o(f,y);function f(){return p(this,f),d(this,(f.__proto__||Object.getPrototypeOf(f)).apply(this,arguments))}return l(f,[{key:"value",value:function(b){return c(f.prototype.__proto__||Object.getPrototypeOf(f.prototype),"value",this).call(this,b).replace(/["']/g,"")}}]),f}(u.default.Attributor.Style),x=new v("font","font-family",s);r.FontStyle=x,r.FontClass=g},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0}),r.SizeStyle=r.SizeClass=void 0;var l=i(0),c=m(l);function m(p){return p&&p.__esModule?p:{default:p}}var u=new c.default.Attributor.Class("size","ql-size",{scope:c.default.Scope.INLINE,whitelist:["small","large","huge"]}),h=new c.default.Attributor.Style("size","font-size",{scope:c.default.Scope.INLINE,whitelist:["10px","18px","32px"]});r.SizeClass=u,r.SizeStyle=h},function(t,r,i){t.exports={align:{"":i(76),center:i(77),right:i(78),justify:i(79)},background:i(80),blockquote:i(81),bold:i(82),clean:i(83),code:i(58),"code-block":i(58),color:i(84),direction:{"":i(85),rtl:i(86)},float:{center:i(87),full:i(88),left:i(89),right:i(90)},formula:i(91),header:{1:i(92),2:i(93)},italic:i(94),image:i(95),indent:{"+1":i(96),"-1":i(97)},link:i(98),list:{ordered:i(99),bullet:i(100),check:i(101)},script:{sub:i(102),super:i(103)},strike:i(104),underline:i(105),video:i(106)}},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0}),r.getLastChangeIndex=r.default=void 0;var l=function(){function _(b,E){for(var N=0;N<E.length;N++){var j=E[N];j.enumerable=j.enumerable||!1,j.configurable=!0,"value"in j&&(j.writable=!0),Object.defineProperty(b,j.key,j)}}return function(b,E,N){return E&&_(b.prototype,E),N&&_(b,N),b}}(),c=i(0),m=o(c),u=i(5),h=o(u),p=i(9),d=o(p);function o(_){return _&&_.__esModule?_:{default:_}}function s(_,b){if(!(_ instanceof b))throw new TypeError("Cannot call a class as a function")}function g(_,b){if(!_)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&(typeof b=="object"||typeof b=="function")?b:_}function v(_,b){if(typeof b!="function"&&b!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof b);_.prototype=Object.create(b&&b.prototype,{constructor:{value:_,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(_,b):_.__proto__=b)}var x=function(_){v(b,_);function b(E,N){s(this,b);var j=g(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,E,N));return j.lastRecorded=0,j.ignoreChange=!1,j.clear(),j.quill.on(h.default.events.EDITOR_CHANGE,function(C,D,k,w){C!==h.default.events.TEXT_CHANGE||j.ignoreChange||(!j.options.userOnly||w===h.default.sources.USER?j.record(D,k):j.transform(D))}),j.quill.keyboard.addBinding({key:"Z",shortKey:!0},j.undo.bind(j)),j.quill.keyboard.addBinding({key:"Z",shortKey:!0,shiftKey:!0},j.redo.bind(j)),/Win/i.test(navigator.platform)&&j.quill.keyboard.addBinding({key:"Y",shortKey:!0},j.redo.bind(j)),j}return l(b,[{key:"change",value:function(N,j){if(this.stack[N].length!==0){var C=this.stack[N].pop();this.stack[j].push(C),this.lastRecorded=0,this.ignoreChange=!0,this.quill.updateContents(C[N],h.default.sources.USER),this.ignoreChange=!1;var D=f(C[N]);this.quill.setSelection(D)}}},{key:"clear",value:function(){this.stack={undo:[],redo:[]}}},{key:"cutoff",value:function(){this.lastRecorded=0}},{key:"record",value:function(N,j){if(N.ops.length!==0){this.stack.redo=[];var C=this.quill.getContents().diff(j),D=Date.now();if(this.lastRecorded+this.options.delay>D&&this.stack.undo.length>0){var k=this.stack.undo.pop();C=C.compose(k.undo),N=k.redo.compose(N)}else this.lastRecorded=D;this.stack.undo.push({redo:N,undo:C}),this.stack.undo.length>this.options.maxStack&&this.stack.undo.shift()}}},{key:"redo",value:function(){this.change("redo","undo")}},{key:"transform",value:function(N){this.stack.undo.forEach(function(j){j.undo=N.transform(j.undo,!0),j.redo=N.transform(j.redo,!0)}),this.stack.redo.forEach(function(j){j.undo=N.transform(j.undo,!0),j.redo=N.transform(j.redo,!0)})}},{key:"undo",value:function(){this.change("undo","redo")}}]),b}(d.default);x.DEFAULTS={delay:1e3,maxStack:100,userOnly:!1};function y(_){var b=_.ops[_.ops.length-1];return b==null?!1:b.insert!=null?typeof b.insert=="string"&&b.insert.endsWith(`
`):b.attributes!=null?Object.keys(b.attributes).some(function(E){return m.default.query(E,m.default.Scope.BLOCK)!=null}):!1}function f(_){var b=_.reduce(function(N,j){return N+=j.delete||0,N},0),E=_.length()-b;return y(_)&&(E-=1),E}r.default=x,r.getLastChangeIndex=f},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0}),r.default=r.BaseTooltip=void 0;var l=function(){function F(M,z){for(var H=0;H<z.length;H++){var I=z[H];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(M,I.key,I)}}return function(M,z,H){return z&&F(M.prototype,z),H&&F(M,H),M}}(),c=function F(M,z,H){M===null&&(M=Function.prototype);var I=Object.getOwnPropertyDescriptor(M,z);if(I===void 0){var A=Object.getPrototypeOf(M);return A===null?void 0:F(A,z,H)}else{if("value"in I)return I.value;var V=I.get;return V===void 0?void 0:V.call(H)}},m=i(3),u=D(m),h=i(2),p=D(h),d=i(8),o=D(d),s=i(23),g=D(s),v=i(34),x=D(v),y=i(59),f=D(y),_=i(60),b=D(_),E=i(28),N=D(E),j=i(61),C=D(j);function D(F){return F&&F.__esModule?F:{default:F}}function k(F,M){if(!(F instanceof M))throw new TypeError("Cannot call a class as a function")}function w(F,M){if(!F)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return M&&(typeof M=="object"||typeof M=="function")?M:F}function S(F,M){if(typeof M!="function"&&M!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof M);F.prototype=Object.create(M&&M.prototype,{constructor:{value:F,enumerable:!1,writable:!0,configurable:!0}}),M&&(Object.setPrototypeOf?Object.setPrototypeOf(F,M):F.__proto__=M)}var P=[!1,"center","right","justify"],O=["#000000","#e60000","#ff9900","#ffff00","#008a00","#0066cc","#9933ff","#ffffff","#facccc","#ffebcc","#ffffcc","#cce8cc","#cce0f5","#ebd6ff","#bbbbbb","#f06666","#ffc266","#ffff66","#66b966","#66a3e0","#c285ff","#888888","#a10000","#b26b00","#b2b200","#006100","#0047b2","#6b24b2","#444444","#5c0000","#663d00","#666600","#003700","#002966","#3d1466"],L=[!1,"serif","monospace"],$=["1","2","3",!1],B=["small",!1,"large","huge"],Y=function(F){S(M,F);function M(z,H){k(this,M);var I=w(this,(M.__proto__||Object.getPrototypeOf(M)).call(this,z,H)),A=function V(K){if(!document.body.contains(z.root))return document.body.removeEventListener("click",V);I.tooltip!=null&&!I.tooltip.root.contains(K.target)&&document.activeElement!==I.tooltip.textbox&&!I.quill.hasFocus()&&I.tooltip.hide(),I.pickers!=null&&I.pickers.forEach(function(Q){Q.container.contains(K.target)||Q.close()})};return z.emitter.listenDOM("click",document.body,A),I}return l(M,[{key:"addModule",value:function(H){var I=c(M.prototype.__proto__||Object.getPrototypeOf(M.prototype),"addModule",this).call(this,H);return H==="toolbar"&&this.extendToolbar(I),I}},{key:"buildButtons",value:function(H,I){H.forEach(function(A){var V=A.getAttribute("class")||"";V.split(/\s+/).forEach(function(K){if(K.startsWith("ql-")&&(K=K.slice(3),I[K]!=null))if(K==="direction")A.innerHTML=I[K][""]+I[K].rtl;else if(typeof I[K]=="string")A.innerHTML=I[K];else{var Q=A.value||"";Q!=null&&I[K][Q]&&(A.innerHTML=I[K][Q])}})})}},{key:"buildPickers",value:function(H,I){var A=this;this.pickers=H.map(function(K){if(K.classList.contains("ql-align"))return K.querySelector("option")==null&&R(K,P),new b.default(K,I.align);if(K.classList.contains("ql-background")||K.classList.contains("ql-color")){var Q=K.classList.contains("ql-background")?"background":"color";return K.querySelector("option")==null&&R(K,O,Q==="background"?"#ffffff":"#000000"),new f.default(K,I[Q])}else return K.querySelector("option")==null&&(K.classList.contains("ql-font")?R(K,L):K.classList.contains("ql-header")?R(K,$):K.classList.contains("ql-size")&&R(K,B)),new N.default(K)});var V=function(){A.pickers.forEach(function(Q){Q.update()})};this.quill.on(o.default.events.EDITOR_CHANGE,V)}}]),M}(x.default);Y.DEFAULTS=(0,u.default)(!0,{},x.default.DEFAULTS,{modules:{toolbar:{handlers:{formula:function(){this.quill.theme.tooltip.edit("formula")},image:function(){var M=this,z=this.container.querySelector("input.ql-image[type=file]");z==null&&(z=document.createElement("input"),z.setAttribute("type","file"),z.setAttribute("accept","image/png, image/gif, image/jpeg, image/bmp, image/x-icon"),z.classList.add("ql-image"),z.addEventListener("change",function(){if(z.files!=null&&z.files[0]!=null){var H=new FileReader;H.onload=function(I){var A=M.quill.getSelection(!0);M.quill.updateContents(new p.default().retain(A.index).delete(A.length).insert({image:I.target.result}),o.default.sources.USER),M.quill.setSelection(A.index+1,o.default.sources.SILENT),z.value=""},H.readAsDataURL(z.files[0])}}),this.container.appendChild(z)),z.click()},video:function(){this.quill.theme.tooltip.edit("video")}}}}});var U=function(F){S(M,F);function M(z,H){k(this,M);var I=w(this,(M.__proto__||Object.getPrototypeOf(M)).call(this,z,H));return I.textbox=I.root.querySelector('input[type="text"]'),I.listen(),I}return l(M,[{key:"listen",value:function(){var H=this;this.textbox.addEventListener("keydown",function(I){g.default.match(I,"enter")?(H.save(),I.preventDefault()):g.default.match(I,"escape")&&(H.cancel(),I.preventDefault())})}},{key:"cancel",value:function(){this.hide()}},{key:"edit",value:function(){var H=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"link",I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;this.root.classList.remove("ql-hidden"),this.root.classList.add("ql-editing"),I!=null?this.textbox.value=I:H!==this.root.getAttribute("data-mode")&&(this.textbox.value=""),this.position(this.quill.getBounds(this.quill.selection.savedRange)),this.textbox.select(),this.textbox.setAttribute("placeholder",this.textbox.getAttribute("data-"+H)||""),this.root.setAttribute("data-mode",H)}},{key:"restoreFocus",value:function(){var H=this.quill.scrollingContainer.scrollTop;this.quill.focus(),this.quill.scrollingContainer.scrollTop=H}},{key:"save",value:function(){var H=this.textbox.value;switch(this.root.getAttribute("data-mode")){case"link":{var I=this.quill.root.scrollTop;this.linkRange?(this.quill.formatText(this.linkRange,"link",H,o.default.sources.USER),delete this.linkRange):(this.restoreFocus(),this.quill.format("link",H,o.default.sources.USER)),this.quill.root.scrollTop=I;break}case"video":H=q(H);case"formula":{if(!H)break;var A=this.quill.getSelection(!0);if(A!=null){var V=A.index+A.length;this.quill.insertEmbed(V,this.root.getAttribute("data-mode"),H,o.default.sources.USER),this.root.getAttribute("data-mode")==="formula"&&this.quill.insertText(V+1," ",o.default.sources.USER),this.quill.setSelection(V+2,o.default.sources.USER)}break}}this.textbox.value="",this.hide()}}]),M}(C.default);function q(F){var M=F.match(/^(?:(https?):\/\/)?(?:(?:www|m)\.)?youtube\.com\/watch.*v=([a-zA-Z0-9_-]+)/)||F.match(/^(?:(https?):\/\/)?(?:(?:www|m)\.)?youtu\.be\/([a-zA-Z0-9_-]+)/);return M?(M[1]||"https")+"://www.youtube.com/embed/"+M[2]+"?showinfo=0":(M=F.match(/^(?:(https?):\/\/)?(?:www\.)?vimeo\.com\/(\d+)/))?(M[1]||"https")+"://player.vimeo.com/video/"+M[2]+"/":F}function R(F,M){var z=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;M.forEach(function(H){var I=document.createElement("option");H===z?I.setAttribute("selected","selected"):I.setAttribute("value",H),F.appendChild(I)})}r.BaseTooltip=U,r.default=Y},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0});var l=function(){function c(){this.head=this.tail=null,this.length=0}return c.prototype.append=function(){for(var m=[],u=0;u<arguments.length;u++)m[u]=arguments[u];this.insertBefore(m[0],null),m.length>1&&this.append.apply(this,m.slice(1))},c.prototype.contains=function(m){for(var u,h=this.iterator();u=h();)if(u===m)return!0;return!1},c.prototype.insertBefore=function(m,u){m&&(m.next=u,u!=null?(m.prev=u.prev,u.prev!=null&&(u.prev.next=m),u.prev=m,u===this.head&&(this.head=m)):this.tail!=null?(this.tail.next=m,m.prev=this.tail,this.tail=m):(m.prev=null,this.head=this.tail=m),this.length+=1)},c.prototype.offset=function(m){for(var u=0,h=this.head;h!=null;){if(h===m)return u;u+=h.length(),h=h.next}return-1},c.prototype.remove=function(m){this.contains(m)&&(m.prev!=null&&(m.prev.next=m.next),m.next!=null&&(m.next.prev=m.prev),m===this.head&&(this.head=m.next),m===this.tail&&(this.tail=m.prev),this.length-=1)},c.prototype.iterator=function(m){return m===void 0&&(m=this.head),function(){var u=m;return m!=null&&(m=m.next),u}},c.prototype.find=function(m,u){u===void 0&&(u=!1);for(var h,p=this.iterator();h=p();){var d=h.length();if(m<d||u&&m===d&&(h.next==null||h.next.length()!==0))return[h,m];m-=d}return[null,0]},c.prototype.forEach=function(m){for(var u,h=this.iterator();u=h();)m(u)},c.prototype.forEachAt=function(m,u,h){if(!(u<=0))for(var p=this.find(m),d=p[0],o=p[1],s,g=m-o,v=this.iterator(d);(s=v())&&g<m+u;){var x=s.length();m>g?h(s,m-g,Math.min(u,g+x-m)):h(s,0,Math.min(x,m+u-g)),g+=x}},c.prototype.map=function(m){return this.reduce(function(u,h){return u.push(m(h)),u},[])},c.prototype.reduce=function(m,u){for(var h,p=this.iterator();h=p();)u=m(u,h);return u},c}();r.default=l},function(t,r,i){var l=this&&this.__extends||function(){var d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,s){o.__proto__=s}||function(o,s){for(var g in s)s.hasOwnProperty(g)&&(o[g]=s[g])};return function(o,s){d(o,s);function g(){this.constructor=o}o.prototype=s===null?Object.create(s):(g.prototype=s.prototype,new g)}}();Object.defineProperty(r,"__esModule",{value:!0});var c=i(17),m=i(1),u={attributes:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0},h=100,p=function(d){l(o,d);function o(s){var g=d.call(this,s)||this;return g.scroll=g,g.observer=new MutationObserver(function(v){g.update(v)}),g.observer.observe(g.domNode,u),g.attach(),g}return o.prototype.detach=function(){d.prototype.detach.call(this),this.observer.disconnect()},o.prototype.deleteAt=function(s,g){this.update(),s===0&&g===this.length()?this.children.forEach(function(v){v.remove()}):d.prototype.deleteAt.call(this,s,g)},o.prototype.formatAt=function(s,g,v,x){this.update(),d.prototype.formatAt.call(this,s,g,v,x)},o.prototype.insertAt=function(s,g,v){this.update(),d.prototype.insertAt.call(this,s,g,v)},o.prototype.optimize=function(s,g){var v=this;s===void 0&&(s=[]),g===void 0&&(g={}),d.prototype.optimize.call(this,g);for(var x=[].slice.call(this.observer.takeRecords());x.length>0;)s.push(x.pop());for(var y=function(E,N){N===void 0&&(N=!0),!(E==null||E===v)&&E.domNode.parentNode!=null&&(E.domNode[m.DATA_KEY].mutations==null&&(E.domNode[m.DATA_KEY].mutations=[]),N&&y(E.parent))},f=function(E){E.domNode[m.DATA_KEY]==null||E.domNode[m.DATA_KEY].mutations==null||(E instanceof c.default&&E.children.forEach(f),E.optimize(g))},_=s,b=0;_.length>0;b+=1){if(b>=h)throw new Error("[Parchment] Maximum optimize iterations reached");for(_.forEach(function(E){var N=m.find(E.target,!0);N!=null&&(N.domNode===E.target&&(E.type==="childList"?(y(m.find(E.previousSibling,!1)),[].forEach.call(E.addedNodes,function(j){var C=m.find(j,!1);y(C,!1),C instanceof c.default&&C.children.forEach(function(D){y(D,!1)})})):E.type==="attributes"&&y(N.prev)),y(N))}),this.children.forEach(f),_=[].slice.call(this.observer.takeRecords()),x=_.slice();x.length>0;)s.push(x.pop())}},o.prototype.update=function(s,g){var v=this;g===void 0&&(g={}),s=s||this.observer.takeRecords(),s.map(function(x){var y=m.find(x.target,!0);return y==null?null:y.domNode[m.DATA_KEY].mutations==null?(y.domNode[m.DATA_KEY].mutations=[x],y):(y.domNode[m.DATA_KEY].mutations.push(x),null)}).forEach(function(x){x==null||x===v||x.domNode[m.DATA_KEY]==null||x.update(x.domNode[m.DATA_KEY].mutations||[],g)}),this.domNode[m.DATA_KEY].mutations!=null&&d.prototype.update.call(this,this.domNode[m.DATA_KEY].mutations,g),this.optimize(s,g)},o.blotName="scroll",o.defaultChild="block",o.scope=m.Scope.BLOCK_BLOT,o.tagName="DIV",o}(c.default);r.default=p},function(t,r,i){var l=this&&this.__extends||function(){var p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,o){d.__proto__=o}||function(d,o){for(var s in o)o.hasOwnProperty(s)&&(d[s]=o[s])};return function(d,o){p(d,o);function s(){this.constructor=d}d.prototype=o===null?Object.create(o):(s.prototype=o.prototype,new s)}}();Object.defineProperty(r,"__esModule",{value:!0});var c=i(18),m=i(1);function u(p,d){if(Object.keys(p).length!==Object.keys(d).length)return!1;for(var o in p)if(p[o]!==d[o])return!1;return!0}var h=function(p){l(d,p);function d(){return p!==null&&p.apply(this,arguments)||this}return d.formats=function(o){if(o.tagName!==d.tagName)return p.formats.call(this,o)},d.prototype.format=function(o,s){var g=this;o===this.statics.blotName&&!s?(this.children.forEach(function(v){v instanceof c.default||(v=v.wrap(d.blotName,!0)),g.attributes.copy(v)}),this.unwrap()):p.prototype.format.call(this,o,s)},d.prototype.formatAt=function(o,s,g,v){if(this.formats()[g]!=null||m.query(g,m.Scope.ATTRIBUTE)){var x=this.isolate(o,s);x.format(g,v)}else p.prototype.formatAt.call(this,o,s,g,v)},d.prototype.optimize=function(o){p.prototype.optimize.call(this,o);var s=this.formats();if(Object.keys(s).length===0)return this.unwrap();var g=this.next;g instanceof d&&g.prev===this&&u(s,g.formats())&&(g.moveChildren(this),g.remove())},d.blotName="inline",d.scope=m.Scope.INLINE_BLOT,d.tagName="SPAN",d}(c.default);r.default=h},function(t,r,i){var l=this&&this.__extends||function(){var h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,d){p.__proto__=d}||function(p,d){for(var o in d)d.hasOwnProperty(o)&&(p[o]=d[o])};return function(p,d){h(p,d);function o(){this.constructor=p}p.prototype=d===null?Object.create(d):(o.prototype=d.prototype,new o)}}();Object.defineProperty(r,"__esModule",{value:!0});var c=i(18),m=i(1),u=function(h){l(p,h);function p(){return h!==null&&h.apply(this,arguments)||this}return p.formats=function(d){var o=m.query(p.blotName).tagName;if(d.tagName!==o)return h.formats.call(this,d)},p.prototype.format=function(d,o){m.query(d,m.Scope.BLOCK)!=null&&(d===this.statics.blotName&&!o?this.replaceWith(p.blotName):h.prototype.format.call(this,d,o))},p.prototype.formatAt=function(d,o,s,g){m.query(s,m.Scope.BLOCK)!=null?this.format(s,g):h.prototype.formatAt.call(this,d,o,s,g)},p.prototype.insertAt=function(d,o,s){if(s==null||m.query(o,m.Scope.INLINE)!=null)h.prototype.insertAt.call(this,d,o,s);else{var g=this.split(d),v=m.create(o,s);g.parent.insertBefore(v,g)}},p.prototype.update=function(d,o){navigator.userAgent.match(/Trident/)?this.build():h.prototype.update.call(this,d,o)},p.blotName="block",p.scope=m.Scope.BLOCK_BLOT,p.tagName="P",p}(c.default);r.default=u},function(t,r,i){var l=this&&this.__extends||function(){var u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,p){h.__proto__=p}||function(h,p){for(var d in p)p.hasOwnProperty(d)&&(h[d]=p[d])};return function(h,p){u(h,p);function d(){this.constructor=h}h.prototype=p===null?Object.create(p):(d.prototype=p.prototype,new d)}}();Object.defineProperty(r,"__esModule",{value:!0});var c=i(19),m=function(u){l(h,u);function h(){return u!==null&&u.apply(this,arguments)||this}return h.formats=function(p){},h.prototype.format=function(p,d){u.prototype.formatAt.call(this,0,this.length(),p,d)},h.prototype.formatAt=function(p,d,o,s){p===0&&d===this.length()?this.format(o,s):u.prototype.formatAt.call(this,p,d,o,s)},h.prototype.formats=function(){return this.statics.formats(this.domNode)},h}(c.default);r.default=m},function(t,r,i){var l=this&&this.__extends||function(){var h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,d){p.__proto__=d}||function(p,d){for(var o in d)d.hasOwnProperty(o)&&(p[o]=d[o])};return function(p,d){h(p,d);function o(){this.constructor=p}p.prototype=d===null?Object.create(d):(o.prototype=d.prototype,new o)}}();Object.defineProperty(r,"__esModule",{value:!0});var c=i(19),m=i(1),u=function(h){l(p,h);function p(d){var o=h.call(this,d)||this;return o.text=o.statics.value(o.domNode),o}return p.create=function(d){return document.createTextNode(d)},p.value=function(d){var o=d.data;return o.normalize&&(o=o.normalize()),o},p.prototype.deleteAt=function(d,o){this.domNode.data=this.text=this.text.slice(0,d)+this.text.slice(d+o)},p.prototype.index=function(d,o){return this.domNode===d?o:-1},p.prototype.insertAt=function(d,o,s){s==null?(this.text=this.text.slice(0,d)+o+this.text.slice(d),this.domNode.data=this.text):h.prototype.insertAt.call(this,d,o,s)},p.prototype.length=function(){return this.text.length},p.prototype.optimize=function(d){h.prototype.optimize.call(this,d),this.text=this.statics.value(this.domNode),this.text.length===0?this.remove():this.next instanceof p&&this.next.prev===this&&(this.insertAt(this.length(),this.next.value()),this.next.remove())},p.prototype.position=function(d,o){return[this.domNode,d]},p.prototype.split=function(d,o){if(o===void 0&&(o=!1),!o){if(d===0)return this;if(d===this.length())return this.next}var s=m.create(this.domNode.splitText(d));return this.parent.insertBefore(s,this.next),this.text=this.statics.value(this.domNode),s},p.prototype.update=function(d,o){var s=this;d.some(function(g){return g.type==="characterData"&&g.target===s.domNode})&&(this.text=this.statics.value(this.domNode))},p.prototype.value=function(){return this.text},p.blotName="text",p.scope=m.Scope.INLINE_BLOT,p}(c.default);r.default=u},function(t,r,i){var l=document.createElement("div");if(l.classList.toggle("test-class",!1),l.classList.contains("test-class")){var c=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(m,u){return arguments.length>1&&!this.contains(m)==!u?u:c.call(this,m)}}String.prototype.startsWith||(String.prototype.startsWith=function(m,u){return u=u||0,this.substr(u,m.length)===m}),String.prototype.endsWith||(String.prototype.endsWith=function(m,u){var h=this.toString();(typeof u!="number"||!isFinite(u)||Math.floor(u)!==u||u>h.length)&&(u=h.length),u-=m.length;var p=h.indexOf(m,u);return p!==-1&&p===u}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(u){if(this===null)throw new TypeError("Array.prototype.find called on null or undefined");if(typeof u!="function")throw new TypeError("predicate must be a function");for(var h=Object(this),p=h.length>>>0,d=arguments[1],o,s=0;s<p;s++)if(o=h[s],u.call(d,o,s,h))return o}}),document.addEventListener("DOMContentLoaded",function(){document.execCommand("enableObjectResizing",!1,!1),document.execCommand("autoUrlDetect",!1,!1)})},function(t,r){var i=-1,l=1,c=0;function m(b,E,N){if(b==E)return b?[[c,b]]:[];(N<0||b.length<N)&&(N=null);var j=d(b,E),C=b.substring(0,j);b=b.substring(j),E=E.substring(j),j=o(b,E);var D=b.substring(b.length-j);b=b.substring(0,b.length-j),E=E.substring(0,E.length-j);var k=u(b,E);return C&&k.unshift([c,C]),D&&k.push([c,D]),g(k),N!=null&&(k=y(k,N)),k=f(k),k}function u(b,E){var N;if(!b)return[[l,E]];if(!E)return[[i,b]];var j=b.length>E.length?b:E,C=b.length>E.length?E:b,D=j.indexOf(C);if(D!=-1)return N=[[l,j.substring(0,D)],[c,C],[l,j.substring(D+C.length)]],b.length>E.length&&(N[0][0]=N[2][0]=i),N;if(C.length==1)return[[i,b],[l,E]];var k=s(b,E);if(k){var w=k[0],S=k[1],P=k[2],O=k[3],L=k[4],$=m(w,P),B=m(S,O);return $.concat([[c,L]],B)}return h(b,E)}function h(b,E){for(var N=b.length,j=E.length,C=Math.ceil((N+j)/2),D=C,k=2*C,w=new Array(k),S=new Array(k),P=0;P<k;P++)w[P]=-1,S[P]=-1;w[D+1]=0,S[D+1]=0;for(var O=N-j,L=O%2!=0,$=0,B=0,Y=0,U=0,q=0;q<C;q++){for(var R=-q+$;R<=q-B;R+=2){var F=D+R,M;R==-q||R!=q&&w[F-1]<w[F+1]?M=w[F+1]:M=w[F-1]+1;for(var z=M-R;M<N&&z<j&&b.charAt(M)==E.charAt(z);)M++,z++;if(w[F]=M,M>N)B+=2;else if(z>j)$+=2;else if(L){var H=D+O-R;if(H>=0&&H<k&&S[H]!=-1){var I=N-S[H];if(M>=I)return p(b,E,M,z)}}}for(var A=-q+Y;A<=q-U;A+=2){var H=D+A,I;A==-q||A!=q&&S[H-1]<S[H+1]?I=S[H+1]:I=S[H-1]+1;for(var V=I-A;I<N&&V<j&&b.charAt(N-I-1)==E.charAt(j-V-1);)I++,V++;if(S[H]=I,I>N)U+=2;else if(V>j)Y+=2;else if(!L){var F=D+O-A;if(F>=0&&F<k&&w[F]!=-1){var M=w[F],z=D+M-F;if(I=N-I,M>=I)return p(b,E,M,z)}}}}return[[i,b],[l,E]]}function p(b,E,N,j){var C=b.substring(0,N),D=E.substring(0,j),k=b.substring(N),w=E.substring(j),S=m(C,D),P=m(k,w);return S.concat(P)}function d(b,E){if(!b||!E||b.charAt(0)!=E.charAt(0))return 0;for(var N=0,j=Math.min(b.length,E.length),C=j,D=0;N<C;)b.substring(D,C)==E.substring(D,C)?(N=C,D=N):j=C,C=Math.floor((j-N)/2+N);return C}function o(b,E){if(!b||!E||b.charAt(b.length-1)!=E.charAt(E.length-1))return 0;for(var N=0,j=Math.min(b.length,E.length),C=j,D=0;N<C;)b.substring(b.length-C,b.length-D)==E.substring(E.length-C,E.length-D)?(N=C,D=N):j=C,C=Math.floor((j-N)/2+N);return C}function s(b,E){var N=b.length>E.length?b:E,j=b.length>E.length?E:b;if(N.length<4||j.length*2<N.length)return null;function C(B,Y,U){for(var q=B.substring(U,U+Math.floor(B.length/4)),R=-1,F="",M,z,H,I;(R=Y.indexOf(q,R+1))!=-1;){var A=d(B.substring(U),Y.substring(R)),V=o(B.substring(0,U),Y.substring(0,R));F.length<V+A&&(F=Y.substring(R-V,R)+Y.substring(R,R+A),M=B.substring(0,U-V),z=B.substring(U+A),H=Y.substring(0,R-V),I=Y.substring(R+A))}return F.length*2>=B.length?[M,z,H,I,F]:null}var D=C(N,j,Math.ceil(N.length/4)),k=C(N,j,Math.ceil(N.length/2)),w;if(!D&&!k)return null;k?D?w=D[4].length>k[4].length?D:k:w=k:w=D;var S,P,O,L;b.length>E.length?(S=w[0],P=w[1],O=w[2],L=w[3]):(O=w[0],L=w[1],S=w[2],P=w[3]);var $=w[4];return[S,P,O,L,$]}function g(b){b.push([c,""]);for(var E=0,N=0,j=0,C="",D="",k;E<b.length;)switch(b[E][0]){case l:j++,D+=b[E][1],E++;break;case i:N++,C+=b[E][1],E++;break;case c:N+j>1?(N!==0&&j!==0&&(k=d(D,C),k!==0&&(E-N-j>0&&b[E-N-j-1][0]==c?b[E-N-j-1][1]+=D.substring(0,k):(b.splice(0,0,[c,D.substring(0,k)]),E++),D=D.substring(k),C=C.substring(k)),k=o(D,C),k!==0&&(b[E][1]=D.substring(D.length-k)+b[E][1],D=D.substring(0,D.length-k),C=C.substring(0,C.length-k))),N===0?b.splice(E-j,N+j,[l,D]):j===0?b.splice(E-N,N+j,[i,C]):b.splice(E-N-j,N+j,[i,C],[l,D]),E=E-N-j+(N?1:0)+(j?1:0)+1):E!==0&&b[E-1][0]==c?(b[E-1][1]+=b[E][1],b.splice(E,1)):E++,j=0,N=0,C="",D="";break}b[b.length-1][1]===""&&b.pop();var w=!1;for(E=1;E<b.length-1;)b[E-1][0]==c&&b[E+1][0]==c&&(b[E][1].substring(b[E][1].length-b[E-1][1].length)==b[E-1][1]?(b[E][1]=b[E-1][1]+b[E][1].substring(0,b[E][1].length-b[E-1][1].length),b[E+1][1]=b[E-1][1]+b[E+1][1],b.splice(E-1,1),w=!0):b[E][1].substring(0,b[E+1][1].length)==b[E+1][1]&&(b[E-1][1]+=b[E+1][1],b[E][1]=b[E][1].substring(b[E+1][1].length)+b[E+1][1],b.splice(E+1,1),w=!0)),E++;w&&g(b)}var v=m;v.INSERT=l,v.DELETE=i,v.EQUAL=c,t.exports=v;function x(b,E){if(E===0)return[c,b];for(var N=0,j=0;j<b.length;j++){var C=b[j];if(C[0]===i||C[0]===c){var D=N+C[1].length;if(E===D)return[j+1,b];if(E<D){b=b.slice();var k=E-N,w=[C[0],C[1].slice(0,k)],S=[C[0],C[1].slice(k)];return b.splice(j,1,w,S),[j+1,b]}else N=D}}throw new Error("cursor_pos is out of bounds!")}function y(b,E){var N=x(b,E),j=N[1],C=N[0],D=j[C],k=j[C+1];if(D==null)return b;if(D[0]!==c)return b;if(k!=null&&D[1]+k[1]===k[1]+D[1])return j.splice(C,2,k,D),_(j,C,2);if(k!=null&&k[1].indexOf(D[1])===0){j.splice(C,2,[k[0],D[1]],[0,D[1]]);var w=k[1].slice(D[1].length);return w.length>0&&j.splice(C+2,0,[k[0],w]),_(j,C,3)}else return b}function f(b){for(var E=!1,N=function(k){return k.charCodeAt(0)>=56320&&k.charCodeAt(0)<=57343},j=function(k){return k.charCodeAt(k.length-1)>=55296&&k.charCodeAt(k.length-1)<=56319},C=2;C<b.length;C+=1)b[C-2][0]===c&&j(b[C-2][1])&&b[C-1][0]===i&&N(b[C-1][1])&&b[C][0]===l&&N(b[C][1])&&(E=!0,b[C-1][1]=b[C-2][1].slice(-1)+b[C-1][1],b[C][1]=b[C-2][1].slice(-1)+b[C][1],b[C-2][1]=b[C-2][1].slice(0,-1));if(!E)return b;for(var D=[],C=0;C<b.length;C+=1)b[C][1].length>0&&D.push(b[C]);return D}function _(b,E,N){for(var j=E+N-1;j>=0&&j>=E-1;j--)if(j+1<b.length){var C=b[j],D=b[j+1];C[0]===D[1]&&b.splice(j,2,[C[0],C[1]+D[1]])}return b}},function(t,r){r=t.exports=typeof Object.keys=="function"?Object.keys:i,r.shim=i;function i(l){var c=[];for(var m in l)c.push(m);return c}},function(t,r){var i=function(){return Object.prototype.toString.call(arguments)}()=="[object Arguments]";r=t.exports=i?l:c,r.supported=l;function l(m){return Object.prototype.toString.call(m)=="[object Arguments]"}r.unsupported=c;function c(m){return m&&typeof m=="object"&&typeof m.length=="number"&&Object.prototype.hasOwnProperty.call(m,"callee")&&!Object.prototype.propertyIsEnumerable.call(m,"callee")||!1}},function(t,r){var i=Object.prototype.hasOwnProperty,l="~";function c(){}Object.create&&(c.prototype=Object.create(null),new c().__proto__||(l=!1));function m(h,p,d){this.fn=h,this.context=p,this.once=d||!1}function u(){this._events=new c,this._eventsCount=0}u.prototype.eventNames=function(){var p=[],d,o;if(this._eventsCount===0)return p;for(o in d=this._events)i.call(d,o)&&p.push(l?o.slice(1):o);return Object.getOwnPropertySymbols?p.concat(Object.getOwnPropertySymbols(d)):p},u.prototype.listeners=function(p,d){var o=l?l+p:p,s=this._events[o];if(d)return!!s;if(!s)return[];if(s.fn)return[s.fn];for(var g=0,v=s.length,x=new Array(v);g<v;g++)x[g]=s[g].fn;return x},u.prototype.emit=function(p,d,o,s,g,v){var x=l?l+p:p;if(!this._events[x])return!1;var y=this._events[x],f=arguments.length,_,b;if(y.fn){switch(y.once&&this.removeListener(p,y.fn,void 0,!0),f){case 1:return y.fn.call(y.context),!0;case 2:return y.fn.call(y.context,d),!0;case 3:return y.fn.call(y.context,d,o),!0;case 4:return y.fn.call(y.context,d,o,s),!0;case 5:return y.fn.call(y.context,d,o,s,g),!0;case 6:return y.fn.call(y.context,d,o,s,g,v),!0}for(b=1,_=new Array(f-1);b<f;b++)_[b-1]=arguments[b];y.fn.apply(y.context,_)}else{var E=y.length,N;for(b=0;b<E;b++)switch(y[b].once&&this.removeListener(p,y[b].fn,void 0,!0),f){case 1:y[b].fn.call(y[b].context);break;case 2:y[b].fn.call(y[b].context,d);break;case 3:y[b].fn.call(y[b].context,d,o);break;case 4:y[b].fn.call(y[b].context,d,o,s);break;default:if(!_)for(N=1,_=new Array(f-1);N<f;N++)_[N-1]=arguments[N];y[b].fn.apply(y[b].context,_)}}return!0},u.prototype.on=function(p,d,o){var s=new m(d,o||this),g=l?l+p:p;return this._events[g]?this._events[g].fn?this._events[g]=[this._events[g],s]:this._events[g].push(s):(this._events[g]=s,this._eventsCount++),this},u.prototype.once=function(p,d,o){var s=new m(d,o||this,!0),g=l?l+p:p;return this._events[g]?this._events[g].fn?this._events[g]=[this._events[g],s]:this._events[g].push(s):(this._events[g]=s,this._eventsCount++),this},u.prototype.removeListener=function(p,d,o,s){var g=l?l+p:p;if(!this._events[g])return this;if(!d)return--this._eventsCount===0?this._events=new c:delete this._events[g],this;var v=this._events[g];if(v.fn)v.fn===d&&(!s||v.once)&&(!o||v.context===o)&&(--this._eventsCount===0?this._events=new c:delete this._events[g]);else{for(var x=0,y=[],f=v.length;x<f;x++)(v[x].fn!==d||s&&!v[x].once||o&&v[x].context!==o)&&y.push(v[x]);y.length?this._events[g]=y.length===1?y[0]:y:--this._eventsCount===0?this._events=new c:delete this._events[g]}return this},u.prototype.removeAllListeners=function(p){var d;return p?(d=l?l+p:p,this._events[d]&&(--this._eventsCount===0?this._events=new c:delete this._events[d])):(this._events=new c,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prototype.setMaxListeners=function(){return this},u.prefixed=l,u.EventEmitter=u,typeof t<"u"&&(t.exports=u)},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0}),r.matchText=r.matchSpacing=r.matchNewline=r.matchBlot=r.matchAttributor=r.default=void 0;var l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(te){return typeof te}:function(te){return te&&typeof Symbol=="function"&&te.constructor===Symbol&&te!==Symbol.prototype?"symbol":typeof te},c=function(){function te(se,ge){var ce=[],le=!0,Ne=!1,ae=void 0;try{for(var ue=se[Symbol.iterator](),_e;!(le=(_e=ue.next()).done)&&(ce.push(_e.value),!(ge&&ce.length===ge));le=!0);}catch(ie){Ne=!0,ae=ie}finally{try{!le&&ue.return&&ue.return()}finally{if(Ne)throw ae}}return ce}return function(se,ge){if(Array.isArray(se))return se;if(Symbol.iterator in Object(se))return te(se,ge);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),m=function(){function te(se,ge){for(var ce=0;ce<ge.length;ce++){var le=ge[ce];le.enumerable=le.enumerable||!1,le.configurable=!0,"value"in le&&(le.writable=!0),Object.defineProperty(se,le.key,le)}}return function(se,ge,ce){return ge&&te(se.prototype,ge),ce&&te(se,ce),se}}(),u=i(3),h=S(u),p=i(2),d=S(p),o=i(0),s=S(o),g=i(5),v=S(g),x=i(10),y=S(x),f=i(9),_=S(f),b=i(36),E=i(37),N=i(13),j=S(N),C=i(26),D=i(38),k=i(39),w=i(40);function S(te){return te&&te.__esModule?te:{default:te}}function P(te,se,ge){return se in te?Object.defineProperty(te,se,{value:ge,enumerable:!0,configurable:!0,writable:!0}):te[se]=ge,te}function O(te,se){if(!(te instanceof se))throw new TypeError("Cannot call a class as a function")}function L(te,se){if(!te)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return se&&(typeof se=="object"||typeof se=="function")?se:te}function $(te,se){if(typeof se!="function"&&se!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof se);te.prototype=Object.create(se&&se.prototype,{constructor:{value:te,enumerable:!1,writable:!0,configurable:!0}}),se&&(Object.setPrototypeOf?Object.setPrototypeOf(te,se):te.__proto__=se)}var B=(0,y.default)("quill:clipboard"),Y="__ql-matcher",U=[[Node.TEXT_NODE,De],[Node.TEXT_NODE,re],["br",de],[Node.ELEMENT_NODE,re],[Node.ELEMENT_NODE,Q],[Node.ELEMENT_NODE,ye],[Node.ELEMENT_NODE,K],[Node.ELEMENT_NODE,Se],["li",Z],["b",V.bind(V,"bold")],["i",V.bind(V,"italic")],["style",xe]],q=[b.AlignAttribute,D.DirectionAttribute].reduce(function(te,se){return te[se.keyName]=se,te},{}),R=[b.AlignStyle,E.BackgroundStyle,C.ColorStyle,D.DirectionStyle,k.FontStyle,w.SizeStyle].reduce(function(te,se){return te[se.keyName]=se,te},{}),F=function(te){$(se,te);function se(ge,ce){O(this,se);var le=L(this,(se.__proto__||Object.getPrototypeOf(se)).call(this,ge,ce));return le.quill.root.addEventListener("paste",le.onPaste.bind(le)),le.container=le.quill.addContainer("ql-clipboard"),le.container.setAttribute("contenteditable",!0),le.container.setAttribute("tabindex",-1),le.matchers=[],U.concat(le.options.matchers).forEach(function(Ne){var ae=c(Ne,2),ue=ae[0],_e=ae[1];!ce.matchVisual&&_e===ye||le.addMatcher(ue,_e)}),le}return m(se,[{key:"addMatcher",value:function(ce,le){this.matchers.push([ce,le])}},{key:"convert",value:function(ce){if(typeof ce=="string")return this.container.innerHTML=ce.replace(/\>\r?\n +\</g,"><"),this.convert();var le=this.quill.getFormat(this.quill.selection.savedRange.index);if(le[j.default.blotName]){var Ne=this.container.innerText;return this.container.innerHTML="",new d.default().insert(Ne,P({},j.default.blotName,le[j.default.blotName]))}var ae=this.prepareMatching(),ue=c(ae,2),_e=ue[0],ie=ue[1],he=A(this.container,_e,ie);return H(he,`
`)&&he.ops[he.ops.length-1].attributes==null&&(he=he.compose(new d.default().retain(he.length()-1).delete(1))),B.log("convert",this.container.innerHTML,he),this.container.innerHTML="",he}},{key:"dangerouslyPasteHTML",value:function(ce,le){var Ne=arguments.length>2&&arguments[2]!==void 0?arguments[2]:v.default.sources.API;if(typeof ce=="string")this.quill.setContents(this.convert(ce),le),this.quill.setSelection(0,v.default.sources.SILENT);else{var ae=this.convert(le);this.quill.updateContents(new d.default().retain(ce).concat(ae),Ne),this.quill.setSelection(ce+ae.length(),v.default.sources.SILENT)}}},{key:"onPaste",value:function(ce){var le=this;if(!(ce.defaultPrevented||!this.quill.isEnabled())){var Ne=this.quill.getSelection(),ae=new d.default().retain(Ne.index),ue=this.quill.scrollingContainer.scrollTop;this.container.focus(),this.quill.selection.update(v.default.sources.SILENT),setTimeout(function(){ae=ae.concat(le.convert()).delete(Ne.length),le.quill.updateContents(ae,v.default.sources.USER),le.quill.setSelection(ae.length()-Ne.length,v.default.sources.SILENT),le.quill.scrollingContainer.scrollTop=ue,le.quill.focus()},1)}}},{key:"prepareMatching",value:function(){var ce=this,le=[],Ne=[];return this.matchers.forEach(function(ae){var ue=c(ae,2),_e=ue[0],ie=ue[1];switch(_e){case Node.TEXT_NODE:Ne.push(ie);break;case Node.ELEMENT_NODE:le.push(ie);break;default:[].forEach.call(ce.container.querySelectorAll(_e),function(he){he[Y]=he[Y]||[],he[Y].push(ie)});break}}),[le,Ne]}}]),se}(_.default);F.DEFAULTS={matchers:[],matchVisual:!0};function M(te,se,ge){return(typeof se>"u"?"undefined":l(se))==="object"?Object.keys(se).reduce(function(ce,le){return M(ce,le,se[le])},te):te.reduce(function(ce,le){return le.attributes&&le.attributes[se]?ce.push(le):ce.insert(le.insert,(0,h.default)({},P({},se,ge),le.attributes))},new d.default)}function z(te){if(te.nodeType!==Node.ELEMENT_NODE)return{};var se="__ql-computed-style";return te[se]||(te[se]=window.getComputedStyle(te))}function H(te,se){for(var ge="",ce=te.ops.length-1;ce>=0&&ge.length<se.length;--ce){var le=te.ops[ce];if(typeof le.insert!="string")break;ge=le.insert+ge}return ge.slice(-1*se.length)===se}function I(te){if(te.childNodes.length===0)return!1;var se=z(te);return["block","list-item"].indexOf(se.display)>-1}function A(te,se,ge){return te.nodeType===te.TEXT_NODE?ge.reduce(function(ce,le){return le(te,ce)},new d.default):te.nodeType===te.ELEMENT_NODE?[].reduce.call(te.childNodes||[],function(ce,le){var Ne=A(le,se,ge);return le.nodeType===te.ELEMENT_NODE&&(Ne=se.reduce(function(ae,ue){return ue(le,ae)},Ne),Ne=(le[Y]||[]).reduce(function(ae,ue){return ue(le,ae)},Ne)),ce.concat(Ne)},new d.default):new d.default}function V(te,se,ge){return M(ge,te,!0)}function K(te,se){var ge=s.default.Attributor.Attribute.keys(te),ce=s.default.Attributor.Class.keys(te),le=s.default.Attributor.Style.keys(te),Ne={};return ge.concat(ce).concat(le).forEach(function(ae){var ue=s.default.query(ae,s.default.Scope.ATTRIBUTE);ue!=null&&(Ne[ue.attrName]=ue.value(te),Ne[ue.attrName])||(ue=q[ae],ue!=null&&(ue.attrName===ae||ue.keyName===ae)&&(Ne[ue.attrName]=ue.value(te)||void 0),ue=R[ae],ue!=null&&(ue.attrName===ae||ue.keyName===ae)&&(ue=R[ae],Ne[ue.attrName]=ue.value(te)||void 0))}),Object.keys(Ne).length>0&&(se=M(se,Ne)),se}function Q(te,se){var ge=s.default.query(te);if(ge==null)return se;if(ge.prototype instanceof s.default.Embed){var ce={},le=ge.value(te);le!=null&&(ce[ge.blotName]=le,se=new d.default().insert(ce,ge.formats(te)))}else typeof ge.formats=="function"&&(se=M(se,ge.blotName,ge.formats(te)));return se}function de(te,se){return H(se,`
`)||se.insert(`
`),se}function xe(){return new d.default}function Z(te,se){var ge=s.default.query(te);if(ge==null||ge.blotName!=="list-item"||!H(se,`
`))return se;for(var ce=-1,le=te.parentNode;!le.classList.contains("ql-clipboard");)(s.default.query(le)||{}).blotName==="list"&&(ce+=1),le=le.parentNode;return ce<=0?se:se.compose(new d.default().retain(se.length()-1).retain(1,{indent:ce}))}function re(te,se){return H(se,`
`)||(I(te)||se.length()>0&&te.nextSibling&&I(te.nextSibling))&&se.insert(`
`),se}function ye(te,se){if(I(te)&&te.nextElementSibling!=null&&!H(se,`

`)){var ge=te.offsetHeight+parseFloat(z(te).marginTop)+parseFloat(z(te).marginBottom);te.nextElementSibling.offsetTop>te.offsetTop+ge*1.5&&se.insert(`
`)}return se}function Se(te,se){var ge={},ce=te.style||{};return ce.fontStyle&&z(te).fontStyle==="italic"&&(ge.italic=!0),ce.fontWeight&&(z(te).fontWeight.startsWith("bold")||parseInt(z(te).fontWeight)>=700)&&(ge.bold=!0),Object.keys(ge).length>0&&(se=M(se,ge)),parseFloat(ce.textIndent||0)>0&&(se=new d.default().insert("	").concat(se)),se}function De(te,se){var ge=te.data;if(te.parentNode.tagName==="O:P")return se.insert(ge.trim());if(ge.trim().length===0&&te.parentNode.classList.contains("ql-clipboard"))return se;if(!z(te.parentNode).whiteSpace.startsWith("pre")){var ce=function(Ne,ae){return ae=ae.replace(/[^\u00a0]/g,""),ae.length<1&&Ne?" ":ae};ge=ge.replace(/\r\n/g," ").replace(/\n/g," "),ge=ge.replace(/\s\s+/g,ce.bind(ce,!0)),(te.previousSibling==null&&I(te.parentNode)||te.previousSibling!=null&&I(te.previousSibling))&&(ge=ge.replace(/^\s+/,ce.bind(ce,!1))),(te.nextSibling==null&&I(te.parentNode)||te.nextSibling!=null&&I(te.nextSibling))&&(ge=ge.replace(/\s+$/,ce.bind(ce,!1)))}return se.insert(ge)}r.default=F,r.matchAttributor=K,r.matchBlot=Q,r.matchNewline=re,r.matchSpacing=ye,r.matchText=De},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0});var l=function(){function g(v,x){for(var y=0;y<x.length;y++){var f=x[y];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(v,f.key,f)}}return function(v,x,y){return x&&g(v.prototype,x),y&&g(v,y),v}}(),c=function g(v,x,y){v===null&&(v=Function.prototype);var f=Object.getOwnPropertyDescriptor(v,x);if(f===void 0){var _=Object.getPrototypeOf(v);return _===null?void 0:g(_,x,y)}else{if("value"in f)return f.value;var b=f.get;return b===void 0?void 0:b.call(y)}},m=i(6),u=h(m);function h(g){return g&&g.__esModule?g:{default:g}}function p(g,v){if(!(g instanceof v))throw new TypeError("Cannot call a class as a function")}function d(g,v){if(!g)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return v&&(typeof v=="object"||typeof v=="function")?v:g}function o(g,v){if(typeof v!="function"&&v!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof v);g.prototype=Object.create(v&&v.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}}),v&&(Object.setPrototypeOf?Object.setPrototypeOf(g,v):g.__proto__=v)}var s=function(g){o(v,g);function v(){return p(this,v),d(this,(v.__proto__||Object.getPrototypeOf(v)).apply(this,arguments))}return l(v,[{key:"optimize",value:function(y){c(v.prototype.__proto__||Object.getPrototypeOf(v.prototype),"optimize",this).call(this,y),this.domNode.tagName!==this.statics.tagName[0]&&this.replaceWith(this.statics.blotName)}}],[{key:"create",value:function(){return c(v.__proto__||Object.getPrototypeOf(v),"create",this).call(this)}},{key:"formats",value:function(){return!0}}]),v}(u.default);s.blotName="bold",s.tagName=["STRONG","B"],r.default=s},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0}),r.addControls=r.default=void 0;var l=function(){function w(S,P){var O=[],L=!0,$=!1,B=void 0;try{for(var Y=S[Symbol.iterator](),U;!(L=(U=Y.next()).done)&&(O.push(U.value),!(P&&O.length===P));L=!0);}catch(q){$=!0,B=q}finally{try{!L&&Y.return&&Y.return()}finally{if($)throw B}}return O}return function(S,P){if(Array.isArray(S))return S;if(Symbol.iterator in Object(S))return w(S,P);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),c=function(){function w(S,P){for(var O=0;O<P.length;O++){var L=P[O];L.enumerable=L.enumerable||!1,L.configurable=!0,"value"in L&&(L.writable=!0),Object.defineProperty(S,L.key,L)}}return function(S,P,O){return P&&w(S.prototype,P),O&&w(S,O),S}}(),m=i(2),u=y(m),h=i(0),p=y(h),d=i(5),o=y(d),s=i(10),g=y(s),v=i(9),x=y(v);function y(w){return w&&w.__esModule?w:{default:w}}function f(w,S,P){return S in w?Object.defineProperty(w,S,{value:P,enumerable:!0,configurable:!0,writable:!0}):w[S]=P,w}function _(w,S){if(!(w instanceof S))throw new TypeError("Cannot call a class as a function")}function b(w,S){if(!w)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return S&&(typeof S=="object"||typeof S=="function")?S:w}function E(w,S){if(typeof S!="function"&&S!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof S);w.prototype=Object.create(S&&S.prototype,{constructor:{value:w,enumerable:!1,writable:!0,configurable:!0}}),S&&(Object.setPrototypeOf?Object.setPrototypeOf(w,S):w.__proto__=S)}var N=(0,g.default)("quill:toolbar"),j=function(w){E(S,w);function S(P,O){_(this,S);var L=b(this,(S.__proto__||Object.getPrototypeOf(S)).call(this,P,O));if(Array.isArray(L.options.container)){var $=document.createElement("div");D($,L.options.container),P.container.parentNode.insertBefore($,P.container),L.container=$}else typeof L.options.container=="string"?L.container=document.querySelector(L.options.container):L.container=L.options.container;if(!(L.container instanceof HTMLElement)){var B;return B=N.error("Container required for toolbar",L.options),b(L,B)}return L.container.classList.add("ql-toolbar"),L.controls=[],L.handlers={},Object.keys(L.options.handlers).forEach(function(Y){L.addHandler(Y,L.options.handlers[Y])}),[].forEach.call(L.container.querySelectorAll("button, select"),function(Y){L.attach(Y)}),L.quill.on(o.default.events.EDITOR_CHANGE,function(Y,U){Y===o.default.events.SELECTION_CHANGE&&L.update(U)}),L.quill.on(o.default.events.SCROLL_OPTIMIZE,function(){var Y=L.quill.selection.getRange(),U=l(Y,1),q=U[0];L.update(q)}),L}return c(S,[{key:"addHandler",value:function(O,L){this.handlers[O]=L}},{key:"attach",value:function(O){var L=this,$=[].find.call(O.classList,function(Y){return Y.indexOf("ql-")===0});if($){if($=$.slice(3),O.tagName==="BUTTON"&&O.setAttribute("type","button"),this.handlers[$]==null){if(this.quill.scroll.whitelist!=null&&this.quill.scroll.whitelist[$]==null){N.warn("ignoring attaching to disabled format",$,O);return}if(p.default.query($)==null){N.warn("ignoring attaching to nonexistent format",$,O);return}}var B=O.tagName==="SELECT"?"change":"click";O.addEventListener(B,function(Y){var U=void 0;if(O.tagName==="SELECT"){if(O.selectedIndex<0)return;var q=O.options[O.selectedIndex];q.hasAttribute("selected")?U=!1:U=q.value||!1}else O.classList.contains("ql-active")?U=!1:U=O.value||!O.hasAttribute("value"),Y.preventDefault();L.quill.focus();var R=L.quill.selection.getRange(),F=l(R,1),M=F[0];if(L.handlers[$]!=null)L.handlers[$].call(L,U);else if(p.default.query($).prototype instanceof p.default.Embed){if(U=prompt("Enter "+$),!U)return;L.quill.updateContents(new u.default().retain(M.index).delete(M.length).insert(f({},$,U)),o.default.sources.USER)}else L.quill.format($,U,o.default.sources.USER);L.update(M)}),this.controls.push([$,O])}}},{key:"update",value:function(O){var L=O==null?{}:this.quill.getFormat(O);this.controls.forEach(function($){var B=l($,2),Y=B[0],U=B[1];if(U.tagName==="SELECT"){var q=void 0;if(O==null)q=null;else if(L[Y]==null)q=U.querySelector("option[selected]");else if(!Array.isArray(L[Y])){var R=L[Y];typeof R=="string"&&(R=R.replace(/\"/g,'\\"')),q=U.querySelector('option[value="'+R+'"]')}q==null?(U.value="",U.selectedIndex=-1):q.selected=!0}else if(O==null)U.classList.remove("ql-active");else if(U.hasAttribute("value")){var F=L[Y]===U.getAttribute("value")||L[Y]!=null&&L[Y].toString()===U.getAttribute("value")||L[Y]==null&&!U.getAttribute("value");U.classList.toggle("ql-active",F)}else U.classList.toggle("ql-active",L[Y]!=null)})}}]),S}(x.default);j.DEFAULTS={};function C(w,S,P){var O=document.createElement("button");O.setAttribute("type","button"),O.classList.add("ql-"+S),P!=null&&(O.value=P),w.appendChild(O)}function D(w,S){Array.isArray(S[0])||(S=[S]),S.forEach(function(P){var O=document.createElement("span");O.classList.add("ql-formats"),P.forEach(function(L){if(typeof L=="string")C(O,L);else{var $=Object.keys(L)[0],B=L[$];Array.isArray(B)?k(O,$,B):C(O,$,B)}}),w.appendChild(O)})}function k(w,S,P){var O=document.createElement("select");O.classList.add("ql-"+S),P.forEach(function(L){var $=document.createElement("option");L!==!1?$.setAttribute("value",L):$.setAttribute("selected","selected"),O.appendChild($)}),w.appendChild(O)}j.DEFAULTS={container:null,handlers:{clean:function(){var S=this,P=this.quill.getSelection();if(P!=null)if(P.length==0){var O=this.quill.getFormat();Object.keys(O).forEach(function(L){p.default.query(L,p.default.Scope.INLINE)!=null&&S.quill.format(L,!1)})}else this.quill.removeFormat(P,o.default.sources.USER)},direction:function(S){var P=this.quill.getFormat().align;S==="rtl"&&P==null?this.quill.format("align","right",o.default.sources.USER):!S&&P==="right"&&this.quill.format("align",!1,o.default.sources.USER),this.quill.format("direction",S,o.default.sources.USER)},indent:function(S){var P=this.quill.getSelection(),O=this.quill.getFormat(P),L=parseInt(O.indent||0);if(S==="+1"||S==="-1"){var $=S==="+1"?1:-1;O.direction==="rtl"&&($*=-1),this.quill.format("indent",L+$,o.default.sources.USER)}},link:function(S){S===!0&&(S=prompt("Enter link URL:")),this.quill.format("link",S,o.default.sources.USER)},list:function(S){var P=this.quill.getSelection(),O=this.quill.getFormat(P);S==="check"?O.list==="checked"||O.list==="unchecked"?this.quill.format("list",!1,o.default.sources.USER):this.quill.format("list","unchecked",o.default.sources.USER):this.quill.format("list",S,o.default.sources.USER)}}},r.default=j,r.addControls=D},function(t,r){t.exports='<svg viewbox="0 0 18 18"> <polyline class="ql-even ql-stroke" points="5 7 3 9 5 11"></polyline> <polyline class="ql-even ql-stroke" points="13 7 15 9 13 11"></polyline> <line class=ql-stroke x1=10 x2=8 y1=5 y2=13></line> </svg>'},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0});var l=function(){function g(v,x){for(var y=0;y<x.length;y++){var f=x[y];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(v,f.key,f)}}return function(v,x,y){return x&&g(v.prototype,x),y&&g(v,y),v}}(),c=function g(v,x,y){v===null&&(v=Function.prototype);var f=Object.getOwnPropertyDescriptor(v,x);if(f===void 0){var _=Object.getPrototypeOf(v);return _===null?void 0:g(_,x,y)}else{if("value"in f)return f.value;var b=f.get;return b===void 0?void 0:b.call(y)}},m=i(28),u=h(m);function h(g){return g&&g.__esModule?g:{default:g}}function p(g,v){if(!(g instanceof v))throw new TypeError("Cannot call a class as a function")}function d(g,v){if(!g)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return v&&(typeof v=="object"||typeof v=="function")?v:g}function o(g,v){if(typeof v!="function"&&v!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof v);g.prototype=Object.create(v&&v.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}}),v&&(Object.setPrototypeOf?Object.setPrototypeOf(g,v):g.__proto__=v)}var s=function(g){o(v,g);function v(x,y){p(this,v);var f=d(this,(v.__proto__||Object.getPrototypeOf(v)).call(this,x));return f.label.innerHTML=y,f.container.classList.add("ql-color-picker"),[].slice.call(f.container.querySelectorAll(".ql-picker-item"),0,7).forEach(function(_){_.classList.add("ql-primary")}),f}return l(v,[{key:"buildItem",value:function(y){var f=c(v.prototype.__proto__||Object.getPrototypeOf(v.prototype),"buildItem",this).call(this,y);return f.style.backgroundColor=y.getAttribute("value")||"",f}},{key:"selectItem",value:function(y,f){c(v.prototype.__proto__||Object.getPrototypeOf(v.prototype),"selectItem",this).call(this,y,f);var _=this.label.querySelector(".ql-color-label"),b=y&&y.getAttribute("data-value")||"";_&&(_.tagName==="line"?_.style.stroke=b:_.style.fill=b)}}]),v}(u.default);r.default=s},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0});var l=function(){function g(v,x){for(var y=0;y<x.length;y++){var f=x[y];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(v,f.key,f)}}return function(v,x,y){return x&&g(v.prototype,x),y&&g(v,y),v}}(),c=function g(v,x,y){v===null&&(v=Function.prototype);var f=Object.getOwnPropertyDescriptor(v,x);if(f===void 0){var _=Object.getPrototypeOf(v);return _===null?void 0:g(_,x,y)}else{if("value"in f)return f.value;var b=f.get;return b===void 0?void 0:b.call(y)}},m=i(28),u=h(m);function h(g){return g&&g.__esModule?g:{default:g}}function p(g,v){if(!(g instanceof v))throw new TypeError("Cannot call a class as a function")}function d(g,v){if(!g)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return v&&(typeof v=="object"||typeof v=="function")?v:g}function o(g,v){if(typeof v!="function"&&v!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof v);g.prototype=Object.create(v&&v.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}}),v&&(Object.setPrototypeOf?Object.setPrototypeOf(g,v):g.__proto__=v)}var s=function(g){o(v,g);function v(x,y){p(this,v);var f=d(this,(v.__proto__||Object.getPrototypeOf(v)).call(this,x));return f.container.classList.add("ql-icon-picker"),[].forEach.call(f.container.querySelectorAll(".ql-picker-item"),function(_){_.innerHTML=y[_.getAttribute("data-value")||""]}),f.defaultItem=f.container.querySelector(".ql-selected"),f.selectItem(f.defaultItem),f}return l(v,[{key:"selectItem",value:function(y,f){c(v.prototype.__proto__||Object.getPrototypeOf(v.prototype),"selectItem",this).call(this,y,f),y=y||this.defaultItem,this.label.innerHTML=y.innerHTML}}]),v}(u.default);r.default=s},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0});var l=function(){function u(h,p){for(var d=0;d<p.length;d++){var o=p[d];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(h,o.key,o)}}return function(h,p,d){return p&&u(h.prototype,p),d&&u(h,d),h}}();function c(u,h){if(!(u instanceof h))throw new TypeError("Cannot call a class as a function")}var m=function(){function u(h,p){var d=this;c(this,u),this.quill=h,this.boundsContainer=p||document.body,this.root=h.addContainer("ql-tooltip"),this.root.innerHTML=this.constructor.TEMPLATE,this.quill.root===this.quill.scrollingContainer&&this.quill.root.addEventListener("scroll",function(){d.root.style.marginTop=-1*d.quill.root.scrollTop+"px"}),this.hide()}return l(u,[{key:"hide",value:function(){this.root.classList.add("ql-hidden")}},{key:"position",value:function(p){var d=p.left+p.width/2-this.root.offsetWidth/2,o=p.bottom+this.quill.root.scrollTop;this.root.style.left=d+"px",this.root.style.top=o+"px",this.root.classList.remove("ql-flip");var s=this.boundsContainer.getBoundingClientRect(),g=this.root.getBoundingClientRect(),v=0;if(g.right>s.right&&(v=s.right-g.right,this.root.style.left=d+v+"px"),g.left<s.left&&(v=s.left-g.left,this.root.style.left=d+v+"px"),g.bottom>s.bottom){var x=g.bottom-g.top,y=p.bottom-p.top+x;this.root.style.top=o-y+"px",this.root.classList.add("ql-flip")}return v}},{key:"show",value:function(){this.root.classList.remove("ql-editing"),this.root.classList.remove("ql-hidden")}}]),u}();r.default=m},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0});var l=function(){function k(w,S){var P=[],O=!0,L=!1,$=void 0;try{for(var B=w[Symbol.iterator](),Y;!(O=(Y=B.next()).done)&&(P.push(Y.value),!(S&&P.length===S));O=!0);}catch(U){L=!0,$=U}finally{try{!O&&B.return&&B.return()}finally{if(L)throw $}}return P}return function(w,S){if(Array.isArray(w))return w;if(Symbol.iterator in Object(w))return k(w,S);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),c=function k(w,S,P){w===null&&(w=Function.prototype);var O=Object.getOwnPropertyDescriptor(w,S);if(O===void 0){var L=Object.getPrototypeOf(w);return L===null?void 0:k(L,S,P)}else{if("value"in O)return O.value;var $=O.get;return $===void 0?void 0:$.call(P)}},m=function(){function k(w,S){for(var P=0;P<S.length;P++){var O=S[P];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(w,O.key,O)}}return function(w,S,P){return S&&k(w.prototype,S),P&&k(w,P),w}}(),u=i(3),h=_(u),p=i(8),d=_(p),o=i(43),s=_(o),g=i(27),v=_(g),x=i(15),y=i(41),f=_(y);function _(k){return k&&k.__esModule?k:{default:k}}function b(k,w){if(!(k instanceof w))throw new TypeError("Cannot call a class as a function")}function E(k,w){if(!k)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return w&&(typeof w=="object"||typeof w=="function")?w:k}function N(k,w){if(typeof w!="function"&&w!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof w);k.prototype=Object.create(w&&w.prototype,{constructor:{value:k,enumerable:!1,writable:!0,configurable:!0}}),w&&(Object.setPrototypeOf?Object.setPrototypeOf(k,w):k.__proto__=w)}var j=[[{header:["1","2","3",!1]}],["bold","italic","underline","link"],[{list:"ordered"},{list:"bullet"}],["clean"]],C=function(k){N(w,k);function w(S,P){b(this,w),P.modules.toolbar!=null&&P.modules.toolbar.container==null&&(P.modules.toolbar.container=j);var O=E(this,(w.__proto__||Object.getPrototypeOf(w)).call(this,S,P));return O.quill.container.classList.add("ql-snow"),O}return m(w,[{key:"extendToolbar",value:function(P){P.container.classList.add("ql-snow"),this.buildButtons([].slice.call(P.container.querySelectorAll("button")),f.default),this.buildPickers([].slice.call(P.container.querySelectorAll("select")),f.default),this.tooltip=new D(this.quill,this.options.bounds),P.container.querySelector(".ql-link")&&this.quill.keyboard.addBinding({key:"K",shortKey:!0},function(O,L){P.handlers.link.call(P,!L.format.link)})}}]),w}(s.default);C.DEFAULTS=(0,h.default)(!0,{},s.default.DEFAULTS,{modules:{toolbar:{handlers:{link:function(w){if(w){var S=this.quill.getSelection();if(S==null||S.length==0)return;var P=this.quill.getText(S);/^\S+@\S+\.\S+$/.test(P)&&P.indexOf("mailto:")!==0&&(P="mailto:"+P);var O=this.quill.theme.tooltip;O.edit("link",P)}else this.quill.format("link",!1)}}}}});var D=function(k){N(w,k);function w(S,P){b(this,w);var O=E(this,(w.__proto__||Object.getPrototypeOf(w)).call(this,S,P));return O.preview=O.root.querySelector("a.ql-preview"),O}return m(w,[{key:"listen",value:function(){var P=this;c(w.prototype.__proto__||Object.getPrototypeOf(w.prototype),"listen",this).call(this),this.root.querySelector("a.ql-action").addEventListener("click",function(O){P.root.classList.contains("ql-editing")?P.save():P.edit("link",P.preview.textContent),O.preventDefault()}),this.root.querySelector("a.ql-remove").addEventListener("click",function(O){if(P.linkRange!=null){var L=P.linkRange;P.restoreFocus(),P.quill.formatText(L,"link",!1,d.default.sources.USER),delete P.linkRange}O.preventDefault(),P.hide()}),this.quill.on(d.default.events.SELECTION_CHANGE,function(O,L,$){if(O!=null){if(O.length===0&&$===d.default.sources.USER){var B=P.quill.scroll.descendant(v.default,O.index),Y=l(B,2),U=Y[0],q=Y[1];if(U!=null){P.linkRange=new x.Range(O.index-q,U.length());var R=v.default.formats(U.domNode);P.preview.textContent=R,P.preview.setAttribute("href",R),P.show(),P.position(P.quill.getBounds(P.linkRange));return}}else delete P.linkRange;P.hide()}})}},{key:"show",value:function(){c(w.prototype.__proto__||Object.getPrototypeOf(w.prototype),"show",this).call(this),this.root.removeAttribute("data-mode")}}]),w}(o.BaseTooltip);D.TEMPLATE=['<a class="ql-preview" rel="noopener noreferrer" target="_blank" href="about:blank"></a>','<input type="text" data-formula="e=mc^2" data-link="https://quilljs.com" data-video="Embed URL">','<a class="ql-action"></a>','<a class="ql-remove"></a>'].join(""),r.default=C},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0});var l=i(29),c=le(l),m=i(36),u=i(38),h=i(64),p=i(65),d=le(p),o=i(66),s=le(o),g=i(67),v=le(g),x=i(37),y=i(26),f=i(39),_=i(40),b=i(56),E=le(b),N=i(68),j=le(N),C=i(27),D=le(C),k=i(69),w=le(k),S=i(70),P=le(S),O=i(71),L=le(O),$=i(72),B=le($),Y=i(73),U=le(Y),q=i(13),R=le(q),F=i(74),M=le(F),z=i(75),H=le(z),I=i(57),A=le(I),V=i(41),K=le(V),Q=i(28),de=le(Q),xe=i(59),Z=le(xe),re=i(60),ye=le(re),Se=i(61),De=le(Se),te=i(108),se=le(te),ge=i(62),ce=le(ge);function le(Ne){return Ne&&Ne.__esModule?Ne:{default:Ne}}c.default.register({"attributors/attribute/direction":u.DirectionAttribute,"attributors/class/align":m.AlignClass,"attributors/class/background":x.BackgroundClass,"attributors/class/color":y.ColorClass,"attributors/class/direction":u.DirectionClass,"attributors/class/font":f.FontClass,"attributors/class/size":_.SizeClass,"attributors/style/align":m.AlignStyle,"attributors/style/background":x.BackgroundStyle,"attributors/style/color":y.ColorStyle,"attributors/style/direction":u.DirectionStyle,"attributors/style/font":f.FontStyle,"attributors/style/size":_.SizeStyle},!0),c.default.register({"formats/align":m.AlignClass,"formats/direction":u.DirectionClass,"formats/indent":h.IndentClass,"formats/background":x.BackgroundStyle,"formats/color":y.ColorStyle,"formats/font":f.FontClass,"formats/size":_.SizeClass,"formats/blockquote":d.default,"formats/code-block":R.default,"formats/header":s.default,"formats/list":v.default,"formats/bold":E.default,"formats/code":q.Code,"formats/italic":j.default,"formats/link":D.default,"formats/script":w.default,"formats/strike":P.default,"formats/underline":L.default,"formats/image":B.default,"formats/video":U.default,"formats/list/item":g.ListItem,"modules/formula":M.default,"modules/syntax":H.default,"modules/toolbar":A.default,"themes/bubble":se.default,"themes/snow":ce.default,"ui/icons":K.default,"ui/picker":de.default,"ui/icon-picker":ye.default,"ui/color-picker":Z.default,"ui/tooltip":De.default},!0),r.default=c.default},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0}),r.IndentClass=void 0;var l=function(){function v(x,y){for(var f=0;f<y.length;f++){var _=y[f];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(x,_.key,_)}}return function(x,y,f){return y&&v(x.prototype,y),f&&v(x,f),x}}(),c=function v(x,y,f){x===null&&(x=Function.prototype);var _=Object.getOwnPropertyDescriptor(x,y);if(_===void 0){var b=Object.getPrototypeOf(x);return b===null?void 0:v(b,y,f)}else{if("value"in _)return _.value;var E=_.get;return E===void 0?void 0:E.call(f)}},m=i(0),u=h(m);function h(v){return v&&v.__esModule?v:{default:v}}function p(v,x){if(!(v instanceof x))throw new TypeError("Cannot call a class as a function")}function d(v,x){if(!v)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return x&&(typeof x=="object"||typeof x=="function")?x:v}function o(v,x){if(typeof x!="function"&&x!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof x);v.prototype=Object.create(x&&x.prototype,{constructor:{value:v,enumerable:!1,writable:!0,configurable:!0}}),x&&(Object.setPrototypeOf?Object.setPrototypeOf(v,x):v.__proto__=x)}var s=function(v){o(x,v);function x(){return p(this,x),d(this,(x.__proto__||Object.getPrototypeOf(x)).apply(this,arguments))}return l(x,[{key:"add",value:function(f,_){if(_==="+1"||_==="-1"){var b=this.value(f)||0;_=_==="+1"?b+1:b-1}return _===0?(this.remove(f),!0):c(x.prototype.__proto__||Object.getPrototypeOf(x.prototype),"add",this).call(this,f,_)}},{key:"canAdd",value:function(f,_){return c(x.prototype.__proto__||Object.getPrototypeOf(x.prototype),"canAdd",this).call(this,f,_)||c(x.prototype.__proto__||Object.getPrototypeOf(x.prototype),"canAdd",this).call(this,f,parseInt(_))}},{key:"value",value:function(f){return parseInt(c(x.prototype.__proto__||Object.getPrototypeOf(x.prototype),"value",this).call(this,f))||void 0}}]),x}(u.default.Attributor.Class),g=new s("indent","ql-indent",{scope:u.default.Scope.BLOCK,whitelist:[1,2,3,4,5,6,7,8]});r.IndentClass=g},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0});var l=i(4),c=m(l);function m(o){return o&&o.__esModule?o:{default:o}}function u(o,s){if(!(o instanceof s))throw new TypeError("Cannot call a class as a function")}function h(o,s){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s&&(typeof s=="object"||typeof s=="function")?s:o}function p(o,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof s);o.prototype=Object.create(s&&s.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),s&&(Object.setPrototypeOf?Object.setPrototypeOf(o,s):o.__proto__=s)}var d=function(o){p(s,o);function s(){return u(this,s),h(this,(s.__proto__||Object.getPrototypeOf(s)).apply(this,arguments))}return s}(c.default);d.blotName="blockquote",d.tagName="blockquote",r.default=d},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0});var l=function(){function s(g,v){for(var x=0;x<v.length;x++){var y=v[x];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(g,y.key,y)}}return function(g,v,x){return v&&s(g.prototype,v),x&&s(g,x),g}}(),c=i(4),m=u(c);function u(s){return s&&s.__esModule?s:{default:s}}function h(s,g){if(!(s instanceof g))throw new TypeError("Cannot call a class as a function")}function p(s,g){if(!s)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return g&&(typeof g=="object"||typeof g=="function")?g:s}function d(s,g){if(typeof g!="function"&&g!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof g);s.prototype=Object.create(g&&g.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),g&&(Object.setPrototypeOf?Object.setPrototypeOf(s,g):s.__proto__=g)}var o=function(s){d(g,s);function g(){return h(this,g),p(this,(g.__proto__||Object.getPrototypeOf(g)).apply(this,arguments))}return l(g,null,[{key:"formats",value:function(x){return this.tagName.indexOf(x.tagName)+1}}]),g}(m.default);o.blotName="header",o.tagName=["H1","H2","H3","H4","H5","H6"],r.default=o},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0}),r.default=r.ListItem=void 0;var l=function(){function b(E,N){for(var j=0;j<N.length;j++){var C=N[j];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(E,C.key,C)}}return function(E,N,j){return N&&b(E.prototype,N),j&&b(E,j),E}}(),c=function b(E,N,j){E===null&&(E=Function.prototype);var C=Object.getOwnPropertyDescriptor(E,N);if(C===void 0){var D=Object.getPrototypeOf(E);return D===null?void 0:b(D,N,j)}else{if("value"in C)return C.value;var k=C.get;return k===void 0?void 0:k.call(j)}},m=i(0),u=s(m),h=i(4),p=s(h),d=i(25),o=s(d);function s(b){return b&&b.__esModule?b:{default:b}}function g(b,E,N){return E in b?Object.defineProperty(b,E,{value:N,enumerable:!0,configurable:!0,writable:!0}):b[E]=N,b}function v(b,E){if(!(b instanceof E))throw new TypeError("Cannot call a class as a function")}function x(b,E){if(!b)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return E&&(typeof E=="object"||typeof E=="function")?E:b}function y(b,E){if(typeof E!="function"&&E!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof E);b.prototype=Object.create(E&&E.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}}),E&&(Object.setPrototypeOf?Object.setPrototypeOf(b,E):b.__proto__=E)}var f=function(b){y(E,b);function E(){return v(this,E),x(this,(E.__proto__||Object.getPrototypeOf(E)).apply(this,arguments))}return l(E,[{key:"format",value:function(j,C){j===_.blotName&&!C?this.replaceWith(u.default.create(this.statics.scope)):c(E.prototype.__proto__||Object.getPrototypeOf(E.prototype),"format",this).call(this,j,C)}},{key:"remove",value:function(){this.prev==null&&this.next==null?this.parent.remove():c(E.prototype.__proto__||Object.getPrototypeOf(E.prototype),"remove",this).call(this)}},{key:"replaceWith",value:function(j,C){return this.parent.isolate(this.offset(this.parent),this.length()),j===this.parent.statics.blotName?(this.parent.replaceWith(j,C),this):(this.parent.unwrap(),c(E.prototype.__proto__||Object.getPrototypeOf(E.prototype),"replaceWith",this).call(this,j,C))}}],[{key:"formats",value:function(j){return j.tagName===this.tagName?void 0:c(E.__proto__||Object.getPrototypeOf(E),"formats",this).call(this,j)}}]),E}(p.default);f.blotName="list-item",f.tagName="LI";var _=function(b){y(E,b),l(E,null,[{key:"create",value:function(j){var C=j==="ordered"?"OL":"UL",D=c(E.__proto__||Object.getPrototypeOf(E),"create",this).call(this,C);return(j==="checked"||j==="unchecked")&&D.setAttribute("data-checked",j==="checked"),D}},{key:"formats",value:function(j){if(j.tagName==="OL")return"ordered";if(j.tagName==="UL")return j.hasAttribute("data-checked")?j.getAttribute("data-checked")==="true"?"checked":"unchecked":"bullet"}}]);function E(N){v(this,E);var j=x(this,(E.__proto__||Object.getPrototypeOf(E)).call(this,N)),C=function(k){if(k.target.parentNode===N){var w=j.statics.formats(N),S=u.default.find(k.target);w==="checked"?S.format("list","unchecked"):w==="unchecked"&&S.format("list","checked")}};return N.addEventListener("touchstart",C),N.addEventListener("mousedown",C),j}return l(E,[{key:"format",value:function(j,C){this.children.length>0&&this.children.tail.format(j,C)}},{key:"formats",value:function(){return g({},this.statics.blotName,this.statics.formats(this.domNode))}},{key:"insertBefore",value:function(j,C){if(j instanceof f)c(E.prototype.__proto__||Object.getPrototypeOf(E.prototype),"insertBefore",this).call(this,j,C);else{var D=C==null?this.length():C.offset(this),k=this.split(D);k.parent.insertBefore(j,k)}}},{key:"optimize",value:function(j){c(E.prototype.__proto__||Object.getPrototypeOf(E.prototype),"optimize",this).call(this,j);var C=this.next;C!=null&&C.prev===this&&C.statics.blotName===this.statics.blotName&&C.domNode.tagName===this.domNode.tagName&&C.domNode.getAttribute("data-checked")===this.domNode.getAttribute("data-checked")&&(C.moveChildren(this),C.remove())}},{key:"replace",value:function(j){if(j.statics.blotName!==this.statics.blotName){var C=u.default.create(this.statics.defaultChild);j.moveChildren(C),this.appendChild(C)}c(E.prototype.__proto__||Object.getPrototypeOf(E.prototype),"replace",this).call(this,j)}}]),E}(o.default);_.blotName="list",_.scope=u.default.Scope.BLOCK_BLOT,_.tagName=["OL","UL"],_.defaultChild="list-item",_.allowedChildren=[f],r.ListItem=f,r.default=_},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0});var l=i(56),c=m(l);function m(o){return o&&o.__esModule?o:{default:o}}function u(o,s){if(!(o instanceof s))throw new TypeError("Cannot call a class as a function")}function h(o,s){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s&&(typeof s=="object"||typeof s=="function")?s:o}function p(o,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof s);o.prototype=Object.create(s&&s.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),s&&(Object.setPrototypeOf?Object.setPrototypeOf(o,s):o.__proto__=s)}var d=function(o){p(s,o);function s(){return u(this,s),h(this,(s.__proto__||Object.getPrototypeOf(s)).apply(this,arguments))}return s}(c.default);d.blotName="italic",d.tagName=["EM","I"],r.default=d},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0});var l=function(){function g(v,x){for(var y=0;y<x.length;y++){var f=x[y];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(v,f.key,f)}}return function(v,x,y){return x&&g(v.prototype,x),y&&g(v,y),v}}(),c=function g(v,x,y){v===null&&(v=Function.prototype);var f=Object.getOwnPropertyDescriptor(v,x);if(f===void 0){var _=Object.getPrototypeOf(v);return _===null?void 0:g(_,x,y)}else{if("value"in f)return f.value;var b=f.get;return b===void 0?void 0:b.call(y)}},m=i(6),u=h(m);function h(g){return g&&g.__esModule?g:{default:g}}function p(g,v){if(!(g instanceof v))throw new TypeError("Cannot call a class as a function")}function d(g,v){if(!g)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return v&&(typeof v=="object"||typeof v=="function")?v:g}function o(g,v){if(typeof v!="function"&&v!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof v);g.prototype=Object.create(v&&v.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}}),v&&(Object.setPrototypeOf?Object.setPrototypeOf(g,v):g.__proto__=v)}var s=function(g){o(v,g);function v(){return p(this,v),d(this,(v.__proto__||Object.getPrototypeOf(v)).apply(this,arguments))}return l(v,null,[{key:"create",value:function(y){return y==="super"?document.createElement("sup"):y==="sub"?document.createElement("sub"):c(v.__proto__||Object.getPrototypeOf(v),"create",this).call(this,y)}},{key:"formats",value:function(y){if(y.tagName==="SUB")return"sub";if(y.tagName==="SUP")return"super"}}]),v}(u.default);s.blotName="script",s.tagName=["SUB","SUP"],r.default=s},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0});var l=i(6),c=m(l);function m(o){return o&&o.__esModule?o:{default:o}}function u(o,s){if(!(o instanceof s))throw new TypeError("Cannot call a class as a function")}function h(o,s){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s&&(typeof s=="object"||typeof s=="function")?s:o}function p(o,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof s);o.prototype=Object.create(s&&s.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),s&&(Object.setPrototypeOf?Object.setPrototypeOf(o,s):o.__proto__=s)}var d=function(o){p(s,o);function s(){return u(this,s),h(this,(s.__proto__||Object.getPrototypeOf(s)).apply(this,arguments))}return s}(c.default);d.blotName="strike",d.tagName="S",r.default=d},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0});var l=i(6),c=m(l);function m(o){return o&&o.__esModule?o:{default:o}}function u(o,s){if(!(o instanceof s))throw new TypeError("Cannot call a class as a function")}function h(o,s){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s&&(typeof s=="object"||typeof s=="function")?s:o}function p(o,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof s);o.prototype=Object.create(s&&s.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),s&&(Object.setPrototypeOf?Object.setPrototypeOf(o,s):o.__proto__=s)}var d=function(o){p(s,o);function s(){return u(this,s),h(this,(s.__proto__||Object.getPrototypeOf(s)).apply(this,arguments))}return s}(c.default);d.blotName="underline",d.tagName="U",r.default=d},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0});var l=function(){function x(y,f){for(var _=0;_<f.length;_++){var b=f[_];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(y,b.key,b)}}return function(y,f,_){return f&&x(y.prototype,f),_&&x(y,_),y}}(),c=function x(y,f,_){y===null&&(y=Function.prototype);var b=Object.getOwnPropertyDescriptor(y,f);if(b===void 0){var E=Object.getPrototypeOf(y);return E===null?void 0:x(E,f,_)}else{if("value"in b)return b.value;var N=b.get;return N===void 0?void 0:N.call(_)}},m=i(0),u=p(m),h=i(27);function p(x){return x&&x.__esModule?x:{default:x}}function d(x,y){if(!(x instanceof y))throw new TypeError("Cannot call a class as a function")}function o(x,y){if(!x)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return y&&(typeof y=="object"||typeof y=="function")?y:x}function s(x,y){if(typeof y!="function"&&y!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof y);x.prototype=Object.create(y&&y.prototype,{constructor:{value:x,enumerable:!1,writable:!0,configurable:!0}}),y&&(Object.setPrototypeOf?Object.setPrototypeOf(x,y):x.__proto__=y)}var g=["alt","height","width"],v=function(x){s(y,x);function y(){return d(this,y),o(this,(y.__proto__||Object.getPrototypeOf(y)).apply(this,arguments))}return l(y,[{key:"format",value:function(_,b){g.indexOf(_)>-1?b?this.domNode.setAttribute(_,b):this.domNode.removeAttribute(_):c(y.prototype.__proto__||Object.getPrototypeOf(y.prototype),"format",this).call(this,_,b)}}],[{key:"create",value:function(_){var b=c(y.__proto__||Object.getPrototypeOf(y),"create",this).call(this,_);return typeof _=="string"&&b.setAttribute("src",this.sanitize(_)),b}},{key:"formats",value:function(_){return g.reduce(function(b,E){return _.hasAttribute(E)&&(b[E]=_.getAttribute(E)),b},{})}},{key:"match",value:function(_){return/\.(jpe?g|gif|png)$/.test(_)||/^data:image\/.+;base64/.test(_)}},{key:"sanitize",value:function(_){return(0,h.sanitize)(_,["http","https","data"])?_:"//:0"}},{key:"value",value:function(_){return _.getAttribute("src")}}]),y}(u.default.Embed);v.blotName="image",v.tagName="IMG",r.default=v},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0});var l=function(){function x(y,f){for(var _=0;_<f.length;_++){var b=f[_];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(y,b.key,b)}}return function(y,f,_){return f&&x(y.prototype,f),_&&x(y,_),y}}(),c=function x(y,f,_){y===null&&(y=Function.prototype);var b=Object.getOwnPropertyDescriptor(y,f);if(b===void 0){var E=Object.getPrototypeOf(y);return E===null?void 0:x(E,f,_)}else{if("value"in b)return b.value;var N=b.get;return N===void 0?void 0:N.call(_)}},m=i(4),u=i(27),h=p(u);function p(x){return x&&x.__esModule?x:{default:x}}function d(x,y){if(!(x instanceof y))throw new TypeError("Cannot call a class as a function")}function o(x,y){if(!x)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return y&&(typeof y=="object"||typeof y=="function")?y:x}function s(x,y){if(typeof y!="function"&&y!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof y);x.prototype=Object.create(y&&y.prototype,{constructor:{value:x,enumerable:!1,writable:!0,configurable:!0}}),y&&(Object.setPrototypeOf?Object.setPrototypeOf(x,y):x.__proto__=y)}var g=["height","width"],v=function(x){s(y,x);function y(){return d(this,y),o(this,(y.__proto__||Object.getPrototypeOf(y)).apply(this,arguments))}return l(y,[{key:"format",value:function(_,b){g.indexOf(_)>-1?b?this.domNode.setAttribute(_,b):this.domNode.removeAttribute(_):c(y.prototype.__proto__||Object.getPrototypeOf(y.prototype),"format",this).call(this,_,b)}}],[{key:"create",value:function(_){var b=c(y.__proto__||Object.getPrototypeOf(y),"create",this).call(this,_);return b.setAttribute("frameborder","0"),b.setAttribute("allowfullscreen",!0),b.setAttribute("src",this.sanitize(_)),b}},{key:"formats",value:function(_){return g.reduce(function(b,E){return _.hasAttribute(E)&&(b[E]=_.getAttribute(E)),b},{})}},{key:"sanitize",value:function(_){return h.default.sanitize(_)}},{key:"value",value:function(_){return _.getAttribute("src")}}]),y}(m.BlockEmbed);v.blotName="video",v.className="ql-video",v.tagName="IFRAME",r.default=v},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0}),r.default=r.FormulaBlot=void 0;var l=function(){function _(b,E){for(var N=0;N<E.length;N++){var j=E[N];j.enumerable=j.enumerable||!1,j.configurable=!0,"value"in j&&(j.writable=!0),Object.defineProperty(b,j.key,j)}}return function(b,E,N){return E&&_(b.prototype,E),N&&_(b,N),b}}(),c=function _(b,E,N){b===null&&(b=Function.prototype);var j=Object.getOwnPropertyDescriptor(b,E);if(j===void 0){var C=Object.getPrototypeOf(b);return C===null?void 0:_(C,E,N)}else{if("value"in j)return j.value;var D=j.get;return D===void 0?void 0:D.call(N)}},m=i(35),u=s(m),h=i(5),p=s(h),d=i(9),o=s(d);function s(_){return _&&_.__esModule?_:{default:_}}function g(_,b){if(!(_ instanceof b))throw new TypeError("Cannot call a class as a function")}function v(_,b){if(!_)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&(typeof b=="object"||typeof b=="function")?b:_}function x(_,b){if(typeof b!="function"&&b!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof b);_.prototype=Object.create(b&&b.prototype,{constructor:{value:_,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(_,b):_.__proto__=b)}var y=function(_){x(b,_);function b(){return g(this,b),v(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return l(b,null,[{key:"create",value:function(N){var j=c(b.__proto__||Object.getPrototypeOf(b),"create",this).call(this,N);return typeof N=="string"&&(window.katex.render(N,j,{throwOnError:!1,errorColor:"#f00"}),j.setAttribute("data-value",N)),j}},{key:"value",value:function(N){return N.getAttribute("data-value")}}]),b}(u.default);y.blotName="formula",y.className="ql-formula",y.tagName="SPAN";var f=function(_){x(b,_),l(b,null,[{key:"register",value:function(){p.default.register(y,!0)}}]);function b(){g(this,b);var E=v(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));if(window.katex==null)throw new Error("Formula module requires KaTeX.");return E}return b}(o.default);r.FormulaBlot=y,r.default=f},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0}),r.default=r.CodeToken=r.CodeBlock=void 0;var l=function(){function N(j,C){for(var D=0;D<C.length;D++){var k=C[D];k.enumerable=k.enumerable||!1,k.configurable=!0,"value"in k&&(k.writable=!0),Object.defineProperty(j,k.key,k)}}return function(j,C,D){return C&&N(j.prototype,C),D&&N(j,D),j}}(),c=function N(j,C,D){j===null&&(j=Function.prototype);var k=Object.getOwnPropertyDescriptor(j,C);if(k===void 0){var w=Object.getPrototypeOf(j);return w===null?void 0:N(w,C,D)}else{if("value"in k)return k.value;var S=k.get;return S===void 0?void 0:S.call(D)}},m=i(0),u=v(m),h=i(5),p=v(h),d=i(9),o=v(d),s=i(13),g=v(s);function v(N){return N&&N.__esModule?N:{default:N}}function x(N,j){if(!(N instanceof j))throw new TypeError("Cannot call a class as a function")}function y(N,j){if(!N)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return j&&(typeof j=="object"||typeof j=="function")?j:N}function f(N,j){if(typeof j!="function"&&j!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof j);N.prototype=Object.create(j&&j.prototype,{constructor:{value:N,enumerable:!1,writable:!0,configurable:!0}}),j&&(Object.setPrototypeOf?Object.setPrototypeOf(N,j):N.__proto__=j)}var _=function(N){f(j,N);function j(){return x(this,j),y(this,(j.__proto__||Object.getPrototypeOf(j)).apply(this,arguments))}return l(j,[{key:"replaceWith",value:function(D){this.domNode.textContent=this.domNode.textContent,this.attach(),c(j.prototype.__proto__||Object.getPrototypeOf(j.prototype),"replaceWith",this).call(this,D)}},{key:"highlight",value:function(D){var k=this.domNode.textContent;this.cachedText!==k&&((k.trim().length>0||this.cachedText==null)&&(this.domNode.innerHTML=D(k),this.domNode.normalize(),this.attach()),this.cachedText=k)}}]),j}(g.default);_.className="ql-syntax";var b=new u.default.Attributor.Class("token","hljs",{scope:u.default.Scope.INLINE}),E=function(N){f(j,N),l(j,null,[{key:"register",value:function(){p.default.register(b,!0),p.default.register(_,!0)}}]);function j(C,D){x(this,j);var k=y(this,(j.__proto__||Object.getPrototypeOf(j)).call(this,C,D));if(typeof k.options.highlight!="function")throw new Error("Syntax module requires highlight.js. Please include the library on the page before Quill.");var w=null;return k.quill.on(p.default.events.SCROLL_OPTIMIZE,function(){clearTimeout(w),w=setTimeout(function(){k.highlight(),w=null},k.options.interval)}),k.highlight(),k}return l(j,[{key:"highlight",value:function(){var D=this;if(!this.quill.selection.composing){this.quill.update(p.default.sources.USER);var k=this.quill.getSelection();this.quill.scroll.descendants(_).forEach(function(w){w.highlight(D.options.highlight)}),this.quill.update(p.default.sources.SILENT),k!=null&&this.quill.setSelection(k,p.default.sources.SILENT)}}}]),j}(o.default);E.DEFAULTS={highlight:function(){return window.hljs==null?null:function(N){var j=window.hljs.highlightAuto(N);return j.value}}(),interval:1e3},r.CodeBlock=_,r.CodeToken=b,r.default=E},function(t,r){t.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=3 x2=15 y1=9 y2=9></line> <line class=ql-stroke x1=3 x2=13 y1=14 y2=14></line> <line class=ql-stroke x1=3 x2=9 y1=4 y2=4></line> </svg>'},function(t,r){t.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=15 x2=3 y1=9 y2=9></line> <line class=ql-stroke x1=14 x2=4 y1=14 y2=14></line> <line class=ql-stroke x1=12 x2=6 y1=4 y2=4></line> </svg>'},function(t,r){t.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=15 x2=3 y1=9 y2=9></line> <line class=ql-stroke x1=15 x2=5 y1=14 y2=14></line> <line class=ql-stroke x1=15 x2=9 y1=4 y2=4></line> </svg>'},function(t,r){t.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=15 x2=3 y1=9 y2=9></line> <line class=ql-stroke x1=15 x2=3 y1=14 y2=14></line> <line class=ql-stroke x1=15 x2=3 y1=4 y2=4></line> </svg>'},function(t,r){t.exports='<svg viewbox="0 0 18 18"> <g class="ql-fill ql-color-label"> <polygon points="6 6.868 6 6 5 6 5 7 5.942 7 6 6.868"></polygon> <rect height=1 width=1 x=4 y=4></rect> <polygon points="6.817 5 6 5 6 6 6.38 6 6.817 5"></polygon> <rect height=1 width=1 x=2 y=6></rect> <rect height=1 width=1 x=3 y=5></rect> <rect height=1 width=1 x=4 y=7></rect> <polygon points="4 11.439 4 11 3 11 3 12 3.755 12 4 11.439"></polygon> <rect height=1 width=1 x=2 y=12></rect> <rect height=1 width=1 x=2 y=9></rect> <rect height=1 width=1 x=2 y=15></rect> <polygon points="4.63 10 4 10 4 11 4.192 11 4.63 10"></polygon> <rect height=1 width=1 x=3 y=8></rect> <path d=M10.832,4.2L11,4.582V4H10.708A1.948,1.948,0,0,1,10.832,4.2Z></path> <path d=M7,4.582L7.168,4.2A1.929,1.929,0,0,1,7.292,4H7V4.582Z></path> <path d=M8,13H7.683l-0.351.8a1.933,1.933,0,0,1-.124.2H8V13Z></path> <rect height=1 width=1 x=12 y=2></rect> <rect height=1 width=1 x=11 y=3></rect> <path d=M9,3H8V3.282A1.985,1.985,0,0,1,9,3Z></path> <rect height=1 width=1 x=2 y=3></rect> <rect height=1 width=1 x=6 y=2></rect> <rect height=1 width=1 x=3 y=2></rect> <rect height=1 width=1 x=5 y=3></rect> <rect height=1 width=1 x=9 y=2></rect> <rect height=1 width=1 x=15 y=14></rect> <polygon points="13.447 10.174 13.469 10.225 13.472 10.232 13.808 11 14 11 14 10 13.37 10 13.447 10.174"></polygon> <rect height=1 width=1 x=13 y=7></rect> <rect height=1 width=1 x=15 y=5></rect> <rect height=1 width=1 x=14 y=6></rect> <rect height=1 width=1 x=15 y=8></rect> <rect height=1 width=1 x=14 y=9></rect> <path d=M3.775,14H3v1H4V14.314A1.97,1.97,0,0,1,3.775,14Z></path> <rect height=1 width=1 x=14 y=3></rect> <polygon points="12 6.868 12 6 11.62 6 12 6.868"></polygon> <rect height=1 width=1 x=15 y=2></rect> <rect height=1 width=1 x=12 y=5></rect> <rect height=1 width=1 x=13 y=4></rect> <polygon points="12.933 9 13 9 13 8 12.495 8 12.933 9"></polygon> <rect height=1 width=1 x=9 y=14></rect> <rect height=1 width=1 x=8 y=15></rect> <path d=M6,14.926V15H7V14.316A1.993,1.993,0,0,1,6,14.926Z></path> <rect height=1 width=1 x=5 y=15></rect> <path d=M10.668,13.8L10.317,13H10v1h0.792A1.947,1.947,0,0,1,10.668,13.8Z></path> <rect height=1 width=1 x=11 y=15></rect> <path d=M14.332,12.2a1.99,1.99,0,0,1,.166.8H15V12H14.245Z></path> <rect height=1 width=1 x=14 y=15></rect> <rect height=1 width=1 x=15 y=11></rect> </g> <polyline class=ql-stroke points="5.5 13 9 5 12.5 13"></polyline> <line class=ql-stroke x1=11.63 x2=6.38 y1=11 y2=11></line> </svg>'},function(t,r){t.exports='<svg viewbox="0 0 18 18"> <rect class="ql-fill ql-stroke" height=3 width=3 x=4 y=5></rect> <rect class="ql-fill ql-stroke" height=3 width=3 x=11 y=5></rect> <path class="ql-even ql-fill ql-stroke" d=M7,8c0,4.031-3,5-3,5></path> <path class="ql-even ql-fill ql-stroke" d=M14,8c0,4.031-3,5-3,5></path> </svg>'},function(t,r){t.exports='<svg viewbox="0 0 18 18"> <path class=ql-stroke d=M5,4H9.5A2.5,2.5,0,0,1,12,6.5v0A2.5,2.5,0,0,1,9.5,9H5A0,0,0,0,1,5,9V4A0,0,0,0,1,5,4Z></path> <path class=ql-stroke d=M5,9h5.5A2.5,2.5,0,0,1,13,11.5v0A2.5,2.5,0,0,1,10.5,14H5a0,0,0,0,1,0,0V9A0,0,0,0,1,5,9Z></path> </svg>'},function(t,r){t.exports='<svg class="" viewbox="0 0 18 18"> <line class=ql-stroke x1=5 x2=13 y1=3 y2=3></line> <line class=ql-stroke x1=6 x2=9.35 y1=12 y2=3></line> <line class=ql-stroke x1=11 x2=15 y1=11 y2=15></line> <line class=ql-stroke x1=15 x2=11 y1=11 y2=15></line> <rect class=ql-fill height=1 rx=0.5 ry=0.5 width=7 x=2 y=14></rect> </svg>'},function(t,r){t.exports='<svg viewbox="0 0 18 18"> <line class="ql-color-label ql-stroke ql-transparent" x1=3 x2=15 y1=15 y2=15></line> <polyline class=ql-stroke points="5.5 11 9 3 12.5 11"></polyline> <line class=ql-stroke x1=11.63 x2=6.38 y1=9 y2=9></line> </svg>'},function(t,r){t.exports='<svg viewbox="0 0 18 18"> <polygon class="ql-stroke ql-fill" points="3 11 5 9 3 7 3 11"></polygon> <line class="ql-stroke ql-fill" x1=15 x2=11 y1=4 y2=4></line> <path class=ql-fill d=M11,3a3,3,0,0,0,0,6h1V3H11Z></path> <rect class=ql-fill height=11 width=1 x=11 y=4></rect> <rect class=ql-fill height=11 width=1 x=13 y=4></rect> </svg>'},function(t,r){t.exports='<svg viewbox="0 0 18 18"> <polygon class="ql-stroke ql-fill" points="15 12 13 10 15 8 15 12"></polygon> <line class="ql-stroke ql-fill" x1=9 x2=5 y1=4 y2=4></line> <path class=ql-fill d=M5,3A3,3,0,0,0,5,9H6V3H5Z></path> <rect class=ql-fill height=11 width=1 x=5 y=4></rect> <rect class=ql-fill height=11 width=1 x=7 y=4></rect> </svg>'},function(t,r){t.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M14,16H4a1,1,0,0,1,0-2H14A1,1,0,0,1,14,16Z /> <path class=ql-fill d=M14,4H4A1,1,0,0,1,4,2H14A1,1,0,0,1,14,4Z /> <rect class=ql-fill x=3 y=6 width=12 height=6 rx=1 ry=1 /> </svg>'},function(t,r){t.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M13,16H5a1,1,0,0,1,0-2h8A1,1,0,0,1,13,16Z /> <path class=ql-fill d=M13,4H5A1,1,0,0,1,5,2h8A1,1,0,0,1,13,4Z /> <rect class=ql-fill x=2 y=6 width=14 height=6 rx=1 ry=1 /> </svg>'},function(t,r){t.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M15,8H13a1,1,0,0,1,0-2h2A1,1,0,0,1,15,8Z /> <path class=ql-fill d=M15,12H13a1,1,0,0,1,0-2h2A1,1,0,0,1,15,12Z /> <path class=ql-fill d=M15,16H5a1,1,0,0,1,0-2H15A1,1,0,0,1,15,16Z /> <path class=ql-fill d=M15,4H5A1,1,0,0,1,5,2H15A1,1,0,0,1,15,4Z /> <rect class=ql-fill x=2 y=6 width=8 height=6 rx=1 ry=1 /> </svg>'},function(t,r){t.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M5,8H3A1,1,0,0,1,3,6H5A1,1,0,0,1,5,8Z /> <path class=ql-fill d=M5,12H3a1,1,0,0,1,0-2H5A1,1,0,0,1,5,12Z /> <path class=ql-fill d=M13,16H3a1,1,0,0,1,0-2H13A1,1,0,0,1,13,16Z /> <path class=ql-fill d=M13,4H3A1,1,0,0,1,3,2H13A1,1,0,0,1,13,4Z /> <rect class=ql-fill x=8 y=6 width=8 height=6 rx=1 ry=1 transform="translate(24 18) rotate(-180)"/> </svg>'},function(t,r){t.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M11.759,2.482a2.561,2.561,0,0,0-3.53.607A7.656,7.656,0,0,0,6.8,6.2C6.109,9.188,5.275,14.677,4.15,14.927a1.545,1.545,0,0,0-1.3-.933A0.922,0.922,0,0,0,2,15.036S1.954,16,4.119,16s3.091-2.691,3.7-5.553c0.177-.826.36-1.726,0.554-2.6L8.775,6.2c0.381-1.421.807-2.521,1.306-2.676a1.014,1.014,0,0,0,1.02.56A0.966,0.966,0,0,0,11.759,2.482Z></path> <rect class=ql-fill height=1.6 rx=0.8 ry=0.8 width=5 x=5.15 y=6.2></rect> <path class=ql-fill d=M13.663,12.027a1.662,1.662,0,0,1,.266-0.276q0.193,0.069.456,0.138a2.1,2.1,0,0,0,.535.069,1.075,1.075,0,0,0,.767-0.3,1.044,1.044,0,0,0,.314-0.8,0.84,0.84,0,0,0-.238-0.619,0.8,0.8,0,0,0-.594-0.239,1.154,1.154,0,0,0-.781.3,4.607,4.607,0,0,0-.781,1q-0.091.15-.218,0.346l-0.246.38c-0.068-.288-0.137-0.582-0.212-0.885-0.459-1.847-2.494-.984-2.941-0.8-0.482.2-.353,0.647-0.094,0.529a0.869,0.869,0,0,1,1.281.585c0.217,0.751.377,1.436,0.527,2.038a5.688,5.688,0,0,1-.362.467,2.69,2.69,0,0,1-.264.271q-0.221-.08-0.471-0.147a2.029,2.029,0,0,0-.522-0.066,1.079,1.079,0,0,0-.768.3A1.058,1.058,0,0,0,9,15.131a0.82,0.82,0,0,0,.832.852,1.134,1.134,0,0,0,.787-0.3,5.11,5.11,0,0,0,.776-0.993q0.141-.219.215-0.34c0.046-.076.122-0.194,0.223-0.346a2.786,2.786,0,0,0,.918,1.726,2.582,2.582,0,0,0,2.376-.185c0.317-.181.212-0.565,0-0.494A0.807,0.807,0,0,1,14.176,15a5.159,5.159,0,0,1-.913-2.446l0,0Q13.487,12.24,13.663,12.027Z></path> </svg>'},function(t,r){t.exports='<svg viewBox="0 0 18 18"> <path class=ql-fill d=M10,4V14a1,1,0,0,1-2,0V10H3v4a1,1,0,0,1-2,0V4A1,1,0,0,1,3,4V8H8V4a1,1,0,0,1,2,0Zm6.06787,9.209H14.98975V7.59863a.54085.54085,0,0,0-.605-.60547h-.62744a1.01119,1.01119,0,0,0-.748.29688L11.645,8.56641a.5435.5435,0,0,0-.022.8584l.28613.30762a.53861.53861,0,0,0,.84717.0332l.09912-.08789a1.2137,1.2137,0,0,0,.2417-.35254h.02246s-.01123.30859-.01123.60547V13.209H12.041a.54085.54085,0,0,0-.605.60547v.43945a.54085.54085,0,0,0,.605.60547h4.02686a.54085.54085,0,0,0,.605-.60547v-.43945A.54085.54085,0,0,0,16.06787,13.209Z /> </svg>'},function(t,r){t.exports='<svg viewBox="0 0 18 18"> <path class=ql-fill d=M16.73975,13.81445v.43945a.54085.54085,0,0,1-.605.60547H11.855a.58392.58392,0,0,1-.64893-.60547V14.0127c0-2.90527,3.39941-3.42187,3.39941-4.55469a.77675.77675,0,0,0-.84717-.78125,1.17684,1.17684,0,0,0-.83594.38477c-.2749.26367-.561.374-.85791.13184l-.4292-.34082c-.30811-.24219-.38525-.51758-.1543-.81445a2.97155,2.97155,0,0,1,2.45361-1.17676,2.45393,2.45393,0,0,1,2.68408,2.40918c0,2.45312-3.1792,2.92676-3.27832,3.93848h2.79443A.54085.54085,0,0,1,16.73975,13.81445ZM9,3A.99974.99974,0,0,0,8,4V8H3V4A1,1,0,0,0,1,4V14a1,1,0,0,0,2,0V10H8v4a1,1,0,0,0,2,0V4A.99974.99974,0,0,0,9,3Z /> </svg>'},function(t,r){t.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=7 x2=13 y1=4 y2=4></line> <line class=ql-stroke x1=5 x2=11 y1=14 y2=14></line> <line class=ql-stroke x1=8 x2=10 y1=14 y2=4></line> </svg>'},function(t,r){t.exports='<svg viewbox="0 0 18 18"> <rect class=ql-stroke height=10 width=12 x=3 y=4></rect> <circle class=ql-fill cx=6 cy=7 r=1></circle> <polyline class="ql-even ql-fill" points="5 12 5 11 7 9 8 10 11 7 13 9 13 12 5 12"></polyline> </svg>'},function(t,r){t.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=3 x2=15 y1=14 y2=14></line> <line class=ql-stroke x1=3 x2=15 y1=4 y2=4></line> <line class=ql-stroke x1=9 x2=15 y1=9 y2=9></line> <polyline class="ql-fill ql-stroke" points="3 7 3 11 5 9 3 7"></polyline> </svg>'},function(t,r){t.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=3 x2=15 y1=14 y2=14></line> <line class=ql-stroke x1=3 x2=15 y1=4 y2=4></line> <line class=ql-stroke x1=9 x2=15 y1=9 y2=9></line> <polyline class=ql-stroke points="5 7 5 11 3 9 5 7"></polyline> </svg>'},function(t,r){t.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=7 x2=11 y1=7 y2=11></line> <path class="ql-even ql-stroke" d=M8.9,4.577a3.476,3.476,0,0,1,.36,4.679A3.476,3.476,0,0,1,4.577,8.9C3.185,7.5,2.035,6.4,4.217,4.217S7.5,3.185,8.9,4.577Z></path> <path class="ql-even ql-stroke" d=M13.423,9.1a3.476,3.476,0,0,0-4.679-.36,3.476,3.476,0,0,0,.36,4.679c1.392,1.392,2.5,2.542,4.679.36S14.815,10.5,13.423,9.1Z></path> </svg>'},function(t,r){t.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=7 x2=15 y1=4 y2=4></line> <line class=ql-stroke x1=7 x2=15 y1=9 y2=9></line> <line class=ql-stroke x1=7 x2=15 y1=14 y2=14></line> <line class="ql-stroke ql-thin" x1=2.5 x2=4.5 y1=5.5 y2=5.5></line> <path class=ql-fill d=M3.5,6A0.5,0.5,0,0,1,3,5.5V3.085l-0.276.138A0.5,0.5,0,0,1,2.053,3c-0.124-.247-0.023-0.324.224-0.447l1-.5A0.5,0.5,0,0,1,4,2.5v3A0.5,0.5,0,0,1,3.5,6Z></path> <path class="ql-stroke ql-thin" d=M4.5,10.5h-2c0-.234,1.85-1.076,1.85-2.234A0.959,0.959,0,0,0,2.5,8.156></path> <path class="ql-stroke ql-thin" d=M2.5,14.846a0.959,0.959,0,0,0,1.85-.109A0.7,0.7,0,0,0,3.75,14a0.688,0.688,0,0,0,.6-0.736,0.959,0.959,0,0,0-1.85-.109></path> </svg>'},function(t,r){t.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=6 x2=15 y1=4 y2=4></line> <line class=ql-stroke x1=6 x2=15 y1=9 y2=9></line> <line class=ql-stroke x1=6 x2=15 y1=14 y2=14></line> <line class=ql-stroke x1=3 x2=3 y1=4 y2=4></line> <line class=ql-stroke x1=3 x2=3 y1=9 y2=9></line> <line class=ql-stroke x1=3 x2=3 y1=14 y2=14></line> </svg>'},function(t,r){t.exports='<svg class="" viewbox="0 0 18 18"> <line class=ql-stroke x1=9 x2=15 y1=4 y2=4></line> <polyline class=ql-stroke points="3 4 4 5 6 3"></polyline> <line class=ql-stroke x1=9 x2=15 y1=14 y2=14></line> <polyline class=ql-stroke points="3 14 4 15 6 13"></polyline> <line class=ql-stroke x1=9 x2=15 y1=9 y2=9></line> <polyline class=ql-stroke points="3 9 4 10 6 8"></polyline> </svg>'},function(t,r){t.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M15.5,15H13.861a3.858,3.858,0,0,0,1.914-2.975,1.8,1.8,0,0,0-1.6-1.751A1.921,1.921,0,0,0,12.021,11.7a0.50013,0.50013,0,1,0,.957.291h0a0.914,0.914,0,0,1,1.053-.725,0.81,0.81,0,0,1,.744.762c0,1.076-1.16971,1.86982-1.93971,2.43082A1.45639,1.45639,0,0,0,12,15.5a0.5,0.5,0,0,0,.5.5h3A0.5,0.5,0,0,0,15.5,15Z /> <path class=ql-fill d=M9.65,5.241a1,1,0,0,0-1.409.108L6,7.964,3.759,5.349A1,1,0,0,0,2.192,6.59178Q2.21541,6.6213,2.241,6.649L4.684,9.5,2.241,12.35A1,1,0,0,0,3.71,13.70722q0.02557-.02768.049-0.05722L6,11.036,8.241,13.65a1,1,0,1,0,1.567-1.24277Q9.78459,12.3777,9.759,12.35L7.316,9.5,9.759,6.651A1,1,0,0,0,9.65,5.241Z /> </svg>'},function(t,r){t.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M15.5,7H13.861a4.015,4.015,0,0,0,1.914-2.975,1.8,1.8,0,0,0-1.6-1.751A1.922,1.922,0,0,0,12.021,3.7a0.5,0.5,0,1,0,.957.291,0.917,0.917,0,0,1,1.053-.725,0.81,0.81,0,0,1,.744.762c0,1.077-1.164,1.925-1.934,2.486A1.423,1.423,0,0,0,12,7.5a0.5,0.5,0,0,0,.5.5h3A0.5,0.5,0,0,0,15.5,7Z /> <path class=ql-fill d=M9.651,5.241a1,1,0,0,0-1.41.108L6,7.964,3.759,5.349a1,1,0,1,0-1.519,1.3L4.683,9.5,2.241,12.35a1,1,0,1,0,1.519,1.3L6,11.036,8.241,13.65a1,1,0,0,0,1.519-1.3L7.317,9.5,9.759,6.651A1,1,0,0,0,9.651,5.241Z /> </svg>'},function(t,r){t.exports='<svg viewbox="0 0 18 18"> <line class="ql-stroke ql-thin" x1=15.5 x2=2.5 y1=8.5 y2=9.5></line> <path class=ql-fill d=M9.007,8C6.542,7.791,6,7.519,6,6.5,6,5.792,7.283,5,9,5c1.571,0,2.765.679,2.969,1.309a1,1,0,0,0,1.9-.617C13.356,4.106,11.354,3,9,3,6.2,3,4,4.538,4,6.5a3.2,3.2,0,0,0,.5,1.843Z></path> <path class=ql-fill d=M8.984,10C11.457,10.208,12,10.479,12,11.5c0,0.708-1.283,1.5-3,1.5-1.571,0-2.765-.679-2.969-1.309a1,1,0,1,0-1.9.617C4.644,13.894,6.646,15,9,15c2.8,0,5-1.538,5-3.5a3.2,3.2,0,0,0-.5-1.843Z></path> </svg>'},function(t,r){t.exports='<svg viewbox="0 0 18 18"> <path class=ql-stroke d=M5,3V9a4.012,4.012,0,0,0,4,4H9a4.012,4.012,0,0,0,4-4V3></path> <rect class=ql-fill height=1 rx=0.5 ry=0.5 width=12 x=3 y=15></rect> </svg>'},function(t,r){t.exports='<svg viewbox="0 0 18 18"> <rect class=ql-stroke height=12 width=12 x=3 y=3></rect> <rect class=ql-fill height=12 width=1 x=5 y=3></rect> <rect class=ql-fill height=12 width=1 x=12 y=3></rect> <rect class=ql-fill height=2 width=8 x=5 y=8></rect> <rect class=ql-fill height=1 width=3 x=3 y=5></rect> <rect class=ql-fill height=1 width=3 x=3 y=7></rect> <rect class=ql-fill height=1 width=3 x=3 y=10></rect> <rect class=ql-fill height=1 width=3 x=3 y=12></rect> <rect class=ql-fill height=1 width=3 x=12 y=5></rect> <rect class=ql-fill height=1 width=3 x=12 y=7></rect> <rect class=ql-fill height=1 width=3 x=12 y=10></rect> <rect class=ql-fill height=1 width=3 x=12 y=12></rect> </svg>'},function(t,r){t.exports='<svg viewbox="0 0 18 18"> <polygon class=ql-stroke points="7 11 9 13 11 11 7 11"></polygon> <polygon class=ql-stroke points="7 7 9 5 11 7 7 7"></polygon> </svg>'},function(t,r,i){Object.defineProperty(r,"__esModule",{value:!0}),r.default=r.BubbleTooltip=void 0;var l=function j(C,D,k){C===null&&(C=Function.prototype);var w=Object.getOwnPropertyDescriptor(C,D);if(w===void 0){var S=Object.getPrototypeOf(C);return S===null?void 0:j(S,D,k)}else{if("value"in w)return w.value;var P=w.get;return P===void 0?void 0:P.call(k)}},c=function(){function j(C,D){for(var k=0;k<D.length;k++){var w=D[k];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),Object.defineProperty(C,w.key,w)}}return function(C,D,k){return D&&j(C.prototype,D),k&&j(C,k),C}}(),m=i(3),u=x(m),h=i(8),p=x(h),d=i(43),o=x(d),s=i(15),g=i(41),v=x(g);function x(j){return j&&j.__esModule?j:{default:j}}function y(j,C){if(!(j instanceof C))throw new TypeError("Cannot call a class as a function")}function f(j,C){if(!j)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return C&&(typeof C=="object"||typeof C=="function")?C:j}function _(j,C){if(typeof C!="function"&&C!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof C);j.prototype=Object.create(C&&C.prototype,{constructor:{value:j,enumerable:!1,writable:!0,configurable:!0}}),C&&(Object.setPrototypeOf?Object.setPrototypeOf(j,C):j.__proto__=C)}var b=[["bold","italic","link"],[{header:1},{header:2},"blockquote"]],E=function(j){_(C,j);function C(D,k){y(this,C),k.modules.toolbar!=null&&k.modules.toolbar.container==null&&(k.modules.toolbar.container=b);var w=f(this,(C.__proto__||Object.getPrototypeOf(C)).call(this,D,k));return w.quill.container.classList.add("ql-bubble"),w}return c(C,[{key:"extendToolbar",value:function(k){this.tooltip=new N(this.quill,this.options.bounds),this.tooltip.root.appendChild(k.container),this.buildButtons([].slice.call(k.container.querySelectorAll("button")),v.default),this.buildPickers([].slice.call(k.container.querySelectorAll("select")),v.default)}}]),C}(o.default);E.DEFAULTS=(0,u.default)(!0,{},o.default.DEFAULTS,{modules:{toolbar:{handlers:{link:function(C){C?this.quill.theme.tooltip.edit():this.quill.format("link",!1)}}}}});var N=function(j){_(C,j);function C(D,k){y(this,C);var w=f(this,(C.__proto__||Object.getPrototypeOf(C)).call(this,D,k));return w.quill.on(p.default.events.EDITOR_CHANGE,function(S,P,O,L){if(S===p.default.events.SELECTION_CHANGE)if(P!=null&&P.length>0&&L===p.default.sources.USER){w.show(),w.root.style.left="0px",w.root.style.width="",w.root.style.width=w.root.offsetWidth+"px";var $=w.quill.getLines(P.index,P.length);if($.length===1)w.position(w.quill.getBounds(P));else{var B=$[$.length-1],Y=w.quill.getIndex(B),U=Math.min(B.length()-1,P.index+P.length-Y),q=w.quill.getBounds(new s.Range(Y,U));w.position(q)}}else document.activeElement!==w.textbox&&w.quill.hasFocus()&&w.hide()}),w}return c(C,[{key:"listen",value:function(){var k=this;l(C.prototype.__proto__||Object.getPrototypeOf(C.prototype),"listen",this).call(this),this.root.querySelector(".ql-close").addEventListener("click",function(){k.root.classList.remove("ql-editing")}),this.quill.on(p.default.events.SCROLL_OPTIMIZE,function(){setTimeout(function(){if(!k.root.classList.contains("ql-hidden")){var w=k.quill.getSelection();w!=null&&k.position(k.quill.getBounds(w))}},1)})}},{key:"cancel",value:function(){this.show()}},{key:"position",value:function(k){var w=l(C.prototype.__proto__||Object.getPrototypeOf(C.prototype),"position",this).call(this,k),S=this.root.querySelector(".ql-tooltip-arrow");if(S.style.marginLeft="",w===0)return w;S.style.marginLeft=-1*w-S.offsetWidth/2+"px"}}]),C}(d.BaseTooltip);N.TEMPLATE=['<span class="ql-tooltip-arrow"></span>','<div class="ql-tooltip-editor">','<input type="text" data-formula="e=mc^2" data-link="https://quilljs.com" data-video="Embed URL">','<a class="ql-close"></a>',"</div>"].join(""),r.BubbleTooltip=N,r.default=E},function(t,r,i){t.exports=i(63)}]).default})}(va)),va.exports}var vn,No;function my(){if(No)return vn;No=1;var n=vn&&vn.__extends||function(){var p=function(d,o){return p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,g){s.__proto__=g}||function(s,g){for(var v in g)g.hasOwnProperty(v)&&(s[v]=g[v])},p(d,o)};return function(d,o){p(d,o);function s(){this.constructor=d}d.prototype=o===null?Object.create(o):(s.prototype=o.prototype,new s)}}(),a=vn&&vn.__assign||function(){return a=Object.assign||function(p){for(var d,o=1,s=arguments.length;o<s;o++){d=arguments[o];for(var g in d)Object.prototype.hasOwnProperty.call(d,g)&&(p[g]=d[g])}return p},a.apply(this,arguments)},t=vn&&vn.__spreadArrays||function(){for(var p=0,d=0,o=arguments.length;d<o;d++)p+=arguments[d].length;for(var s=Array(p),g=0,d=0;d<o;d++)for(var v=arguments[d],x=0,y=v.length;x<y;x++,g++)s[g]=v[x];return s},r=vn&&vn.__importDefault||function(p){return p&&p.__esModule?p:{default:p}},i=r(wu()),l=r(Rl()),c=r(mm()),m=r(uy()),u=function(p){n(d,p);function d(o){var s=p.call(this,o)||this;s.dirtyProps=["modules","formats","bounds","theme","children"],s.cleanProps=["id","className","style","placeholder","tabIndex","onChange","onChangeSelection","onFocus","onBlur","onKeyPress","onKeyDown","onKeyUp"],s.state={generation:0},s.selection=null,s.onEditorChange=function(v,x,y,f){var _,b,E,N;v==="text-change"?(b=(_=s).onEditorChangeText)===null||b===void 0||b.call(_,s.editor.root.innerHTML,x,f,s.unprivilegedEditor):v==="selection-change"&&((N=(E=s).onEditorChangeSelection)===null||N===void 0||N.call(E,x,f,s.unprivilegedEditor))};var g=s.isControlled()?o.value:o.defaultValue;return s.value=g??"",s}return d.prototype.validateProps=function(o){var s;if(i.default.Children.count(o.children)>1)throw new Error("The Quill editing area can only be composed of a single React element.");if(i.default.Children.count(o.children)){var g=i.default.Children.only(o.children);if(((s=g)===null||s===void 0?void 0:s.type)==="textarea")throw new Error("Quill does not support editing on a <textarea>. Use a <div> instead.")}if(this.lastDeltaChangeSet&&o.value===this.lastDeltaChangeSet)throw new Error("You are passing the `delta` object from the `onChange` event back as `value`. You most probably want `editor.getContents()` instead. See: https://github.com/zenoamaro/react-quill#using-deltas")},d.prototype.shouldComponentUpdate=function(o,s){var g=this,v;if(this.validateProps(o),!this.editor||this.state.generation!==s.generation)return!0;if("value"in o){var x=this.getEditorContents(),y=(v=o.value,v??"");this.isEqualValue(y,x)||this.setEditorContents(this.editor,y)}return o.readOnly!==this.props.readOnly&&this.setEditorReadOnly(this.editor,o.readOnly),t(this.cleanProps,this.dirtyProps).some(function(f){return!c.default(o[f],g.props[f])})},d.prototype.shouldComponentRegenerate=function(o){var s=this;return this.dirtyProps.some(function(g){return!c.default(o[g],s.props[g])})},d.prototype.componentDidMount=function(){this.instantiateEditor(),this.setEditorContents(this.editor,this.getEditorContents())},d.prototype.componentWillUnmount=function(){this.destroyEditor()},d.prototype.componentDidUpdate=function(o,s){var g=this;if(this.editor&&this.shouldComponentRegenerate(o)){var v=this.editor.getContents(),x=this.editor.getSelection();this.regenerationSnapshot={delta:v,selection:x},this.setState({generation:this.state.generation+1}),this.destroyEditor()}if(this.state.generation!==s.generation){var y=this.regenerationSnapshot,v=y.delta,f=y.selection;delete this.regenerationSnapshot,this.instantiateEditor();var _=this.editor;_.setContents(v),h(function(){return g.setEditorSelection(_,f)})}},d.prototype.instantiateEditor=function(){this.editor?this.hookEditor(this.editor):this.editor=this.createEditor(this.getEditingArea(),this.getEditorConfig())},d.prototype.destroyEditor=function(){this.editor&&this.unhookEditor(this.editor)},d.prototype.isControlled=function(){return"value"in this.props},d.prototype.getEditorConfig=function(){return{bounds:this.props.bounds,formats:this.props.formats,modules:this.props.modules,placeholder:this.props.placeholder,readOnly:this.props.readOnly,scrollingContainer:this.props.scrollingContainer,tabIndex:this.props.tabIndex,theme:this.props.theme}},d.prototype.getEditor=function(){if(!this.editor)throw new Error("Accessing non-instantiated editor");return this.editor},d.prototype.createEditor=function(o,s){var g=new m.default(o,s);return s.tabIndex!=null&&this.setEditorTabIndex(g,s.tabIndex),this.hookEditor(g),g},d.prototype.hookEditor=function(o){this.unprivilegedEditor=this.makeUnprivilegedEditor(o),o.on("editor-change",this.onEditorChange)},d.prototype.unhookEditor=function(o){o.off("editor-change",this.onEditorChange)},d.prototype.getEditorContents=function(){return this.value},d.prototype.getEditorSelection=function(){return this.selection},d.prototype.isDelta=function(o){return o&&o.ops},d.prototype.isEqualValue=function(o,s){return this.isDelta(o)&&this.isDelta(s)?c.default(o.ops,s.ops):c.default(o,s)},d.prototype.setEditorContents=function(o,s){var g=this;this.value=s;var v=this.getEditorSelection();typeof s=="string"?o.setContents(o.clipboard.convert(s)):o.setContents(s),h(function(){return g.setEditorSelection(o,v)})},d.prototype.setEditorSelection=function(o,s){if(this.selection=s,s){var g=o.getLength();s.index=Math.max(0,Math.min(s.index,g-1)),s.length=Math.max(0,Math.min(s.length,g-1-s.index)),o.setSelection(s)}},d.prototype.setEditorTabIndex=function(o,s){var g,v;!((v=(g=o)===null||g===void 0?void 0:g.scroll)===null||v===void 0)&&v.domNode&&(o.scroll.domNode.tabIndex=s)},d.prototype.setEditorReadOnly=function(o,s){s?o.disable():o.enable()},d.prototype.makeUnprivilegedEditor=function(o){var s=o;return{getHTML:function(){return s.root.innerHTML},getLength:s.getLength.bind(s),getText:s.getText.bind(s),getContents:s.getContents.bind(s),getSelection:s.getSelection.bind(s),getBounds:s.getBounds.bind(s)}},d.prototype.getEditingArea=function(){if(!this.editingArea)throw new Error("Instantiating on missing editing area");var o=l.default.findDOMNode(this.editingArea);if(!o)throw new Error("Cannot find element for editing area");if(o.nodeType===3)throw new Error("Editing area cannot be a text node");return o},d.prototype.renderEditingArea=function(){var o=this,s=this.props,g=s.children,v=s.preserveWhitespace,x=this.state.generation,y={key:x,ref:function(f){o.editingArea=f}};return i.default.Children.count(g)?i.default.cloneElement(i.default.Children.only(g),y):v?i.default.createElement("pre",a({},y)):i.default.createElement("div",a({},y))},d.prototype.render=function(){var o;return i.default.createElement("div",{id:this.props.id,style:this.props.style,key:this.state.generation,className:"quill "+(o=this.props.className,o??""),onKeyPress:this.props.onKeyPress,onKeyDown:this.props.onKeyDown,onKeyUp:this.props.onKeyUp},this.renderEditingArea())},d.prototype.onEditorChangeText=function(o,s,g,v){var x,y;if(this.editor){var f=this.isDelta(this.value)?v.getContents():v.getHTML();f!==this.getEditorContents()&&(this.lastDeltaChangeSet=s,this.value=f,(y=(x=this.props).onChange)===null||y===void 0||y.call(x,o,s,g,v))}},d.prototype.onEditorChangeSelection=function(o,s,g){var v,x,y,f,_,b;if(this.editor){var E=this.getEditorSelection(),N=!E&&o,j=E&&!o;c.default(o,E)||(this.selection=o,(x=(v=this.props).onChangeSelection)===null||x===void 0||x.call(v,o,s,g),N?(f=(y=this.props).onFocus)===null||f===void 0||f.call(y,o,s,g):j&&((b=(_=this.props).onBlur)===null||b===void 0||b.call(_,E,s,g)))}},d.prototype.focus=function(){this.editor&&this.editor.focus()},d.prototype.blur=function(){this.editor&&(this.selection=null,this.editor.blur())},d.displayName="React Quill",d.Quill=m.default,d.defaultProps={theme:"snow",modules:{},readOnly:!1},d}(i.default.Component);function h(p){Promise.resolve().then(p)}return vn=u,vn}var py=my();const fy=Bi(py),Kn=({value:n,onChange:a,placeholder:t,readOnly:r=!1,disabled:i=!1})=>{const l={toolbar:[[{header:"1"},{header:"2"},{font:[]}],[{size:[]}],["bold","italic","underline","strike","blockquote"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["link","image","video"],["clean"]]},c=["header","font","size","bold","italic","underline","strike","blockquote","list","bullet","indent","link","image","video"];return e.jsx(fy,{theme:"snow",value:n,onChange:a,modules:l,formats:c,placeholder:t,readOnly:r||i,bounds:".app",className:"min-h-[150px]",style:{height:"auto"}})};/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */var hy=Object.prototype.toString,Or=Array.isArray||function(a){return hy.call(a)==="[object Array]"};function bs(n){return typeof n=="function"}function gy(n){return Or(n)?"array":typeof n}function yi(n){return n.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function So(n,a){return n!=null&&typeof n=="object"&&a in n}function vy(n,a){return n!=null&&typeof n!="object"&&n.hasOwnProperty&&n.hasOwnProperty(a)}var xy=RegExp.prototype.test;function yy(n,a){return xy.call(n,a)}var by=/\S/;function _y(n){return!yy(by,n)}var jy={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function wy(n){return String(n).replace(/[&<>"'`=\/]/g,function(t){return jy[t]})}var Ny=/\s*/,Sy=/\s+/,Eo=/\s*=/,Ey=/\s*\}/,ky=/#|\^|\/|>|\{|&|=|!/;function Cy(n,a){if(!n)return[];var t=!1,r=[],i=[],l=[],c=!1,m=!1,u="",h=0;function p(){if(c&&!m)for(;l.length;)delete i[l.pop()];else l=[];c=!1,m=!1}var d,o,s;function g(C){if(typeof C=="string"&&(C=C.split(Sy,2)),!Or(C)||C.length!==2)throw new Error("Invalid tags: "+C);d=new RegExp(yi(C[0])+"\\s*"),o=new RegExp("\\s*"+yi(C[1])),s=new RegExp("\\s*"+yi("}"+C[1]))}g(a||ht.tags);for(var v=new ta(n),x,y,f,_,b,E;!v.eos();){if(x=v.pos,f=v.scanUntil(d),f)for(var N=0,j=f.length;N<j;++N)_=f.charAt(N),_y(_)?(l.push(i.length),u+=_):(m=!0,t=!0,u+=" "),i.push(["text",_,x,x+1]),x+=1,_===`
`&&(p(),u="",h=0,t=!1);if(!v.scan(d))break;if(c=!0,y=v.scan(ky)||"name",v.scan(Ny),y==="="?(f=v.scanUntil(Eo),v.scan(Eo),v.scanUntil(o)):y==="{"?(f=v.scanUntil(s),v.scan(Ey),v.scanUntil(o),y="&"):f=v.scanUntil(o),!v.scan(o))throw new Error("Unclosed tag at "+v.pos);if(y==">"?b=[y,f,x,v.pos,u,h,t]:b=[y,f,x,v.pos],h++,i.push(b),y==="#"||y==="^")r.push(b);else if(y==="/"){if(E=r.pop(),!E)throw new Error('Unopened section "'+f+'" at '+x);if(E[1]!==f)throw new Error('Unclosed section "'+E[1]+'" at '+x)}else y==="name"||y==="{"||y==="&"?m=!0:y==="="&&g(f)}if(p(),E=r.pop(),E)throw new Error('Unclosed section "'+E[1]+'" at '+v.pos);return Py(Ay(i))}function Ay(n){for(var a=[],t,r,i=0,l=n.length;i<l;++i)t=n[i],t&&(t[0]==="text"&&r&&r[0]==="text"?(r[1]+=t[1],r[3]=t[3]):(a.push(t),r=t));return a}function Py(n){for(var a=[],t=a,r=[],i,l,c=0,m=n.length;c<m;++c)switch(i=n[c],i[0]){case"#":case"^":t.push(i),r.push(i),t=i[4]=[];break;case"/":l=r.pop(),l[5]=i[2],t=r.length>0?r[r.length-1][4]:a;break;default:t.push(i)}return a}function ta(n){this.string=n,this.tail=n,this.pos=0}ta.prototype.eos=function(){return this.tail===""};ta.prototype.scan=function(a){var t=this.tail.match(a);if(!t||t.index!==0)return"";var r=t[0];return this.tail=this.tail.substring(r.length),this.pos+=r.length,r};ta.prototype.scanUntil=function(a){var t=this.tail.search(a),r;switch(t){case-1:r=this.tail,this.tail="";break;case 0:r="";break;default:r=this.tail.substring(0,t),this.tail=this.tail.substring(t)}return this.pos+=r.length,r};function Er(n,a){this.view=n,this.cache={".":this.view},this.parent=a}Er.prototype.push=function(a){return new Er(a,this)};Er.prototype.lookup=function(a){var t=this.cache,r;if(t.hasOwnProperty(a))r=t[a];else{for(var i=this,l,c,m,u=!1;i;){if(a.indexOf(".")>0)for(l=i.view,c=a.split("."),m=0;l!=null&&m<c.length;)m===c.length-1&&(u=So(l,c[m])||vy(l,c[m])),l=l[c[m++]];else l=i.view[a],u=So(i.view,a);if(u){r=l;break}i=i.parent}t[a]=r}return bs(r)&&(r=r.call(this.view)),r};function Yt(){this.templateCache={_cache:{},set:function(a,t){this._cache[a]=t},get:function(a){return this._cache[a]},clear:function(){this._cache={}}}}Yt.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};Yt.prototype.parse=function(a,t){var r=this.templateCache,i=a+":"+(t||ht.tags).join(":"),l=typeof r<"u",c=l?r.get(i):void 0;return c==null&&(c=Cy(a,t),l&&r.set(i,c)),c};Yt.prototype.render=function(a,t,r,i){var l=this.getConfigTags(i),c=this.parse(a,l),m=t instanceof Er?t:new Er(t,void 0);return this.renderTokens(c,m,r,a,i)};Yt.prototype.renderTokens=function(a,t,r,i,l){for(var c="",m,u,h,p=0,d=a.length;p<d;++p)h=void 0,m=a[p],u=m[0],u==="#"?h=this.renderSection(m,t,r,i,l):u==="^"?h=this.renderInverted(m,t,r,i,l):u===">"?h=this.renderPartial(m,t,r,l):u==="&"?h=this.unescapedValue(m,t):u==="name"?h=this.escapedValue(m,t,l):u==="text"&&(h=this.rawValue(m)),h!==void 0&&(c+=h);return c};Yt.prototype.renderSection=function(a,t,r,i,l){var c=this,m="",u=t.lookup(a[1]);function h(o){return c.render(o,t,r,l)}if(u){if(Or(u))for(var p=0,d=u.length;p<d;++p)m+=this.renderTokens(a[4],t.push(u[p]),r,i,l);else if(typeof u=="object"||typeof u=="string"||typeof u=="number")m+=this.renderTokens(a[4],t.push(u),r,i,l);else if(bs(u)){if(typeof i!="string")throw new Error("Cannot use higher-order sections without the original template");u=u.call(t.view,i.slice(a[3],a[5]),h),u!=null&&(m+=u)}else m+=this.renderTokens(a[4],t,r,i,l);return m}};Yt.prototype.renderInverted=function(a,t,r,i,l){var c=t.lookup(a[1]);if(!c||Or(c)&&c.length===0)return this.renderTokens(a[4],t,r,i,l)};Yt.prototype.indentPartial=function(a,t,r){for(var i=t.replace(/[^ \t]/g,""),l=a.split(`
`),c=0;c<l.length;c++)l[c].length&&(c>0||!r)&&(l[c]=i+l[c]);return l.join(`
`)};Yt.prototype.renderPartial=function(a,t,r,i){if(r){var l=this.getConfigTags(i),c=bs(r)?r(a[1]):r[a[1]];if(c!=null){var m=a[6],u=a[5],h=a[4],p=c;u==0&&h&&(p=this.indentPartial(c,h,m));var d=this.parse(p,l);return this.renderTokens(d,t,r,p,i)}}};Yt.prototype.unescapedValue=function(a,t){var r=t.lookup(a[1]);if(r!=null)return r};Yt.prototype.escapedValue=function(a,t,r){var i=this.getConfigEscape(r)||ht.escape,l=t.lookup(a[1]);if(l!=null)return typeof l=="number"&&i===ht.escape?String(l):i(l)};Yt.prototype.rawValue=function(a){return a[1]};Yt.prototype.getConfigTags=function(a){return Or(a)?a:a&&typeof a=="object"?a.tags:void 0};Yt.prototype.getConfigEscape=function(a){if(a&&typeof a=="object"&&!Or(a))return a.escape};var ht={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(n){Hr.templateCache=n},get templateCache(){return Hr.templateCache}},Hr=new Yt;ht.clearCache=function(){return Hr.clearCache()};ht.parse=function(a,t){return Hr.parse(a,t)};ht.render=function(a,t,r,i){if(typeof a!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+gy(a)+'" was given as the first argument for mustache#render(template, view, partials)');return Hr.render(a,t,r,i)};ht.escape=wy;ht.Scanner=ta;ht.Context=Er;ht.Writer=Yt;const Oy=({isOpen:n,onOpenChange:a,onSelectSuggestion:t,companyId:r})=>{const{profile:i,isLoading:l}=Ie(),{mutate:c,data:m,isPending:u,error:h}=Oe({mutationFn:async()=>{if(!r)throw new Error("Company ID not found.");if((i==null?void 0:i.role)==="admin"&&r!==(i==null?void 0:i.company_id))throw new Error("Access Denied: You can only get template suggestions for your own company.");const{data:d,error:o}=await X.functions.invoke("suggest-email-templates",{body:{companyId:r}});if(o)throw o;return d}});T.useEffect(()=>{n&&r&&!l&&c()},[n,r,c,l]);const p=m==null?void 0:m.suggestions;return l?e.jsx(vt,{open:n,onOpenChange:a,children:e.jsx(ut,{className:"sm:max-w-3xl",children:e.jsxs("div",{className:"flex justify-center items-center gap-2 py-8",children:[e.jsx(fe,{className:"h-6 w-6 animate-spin"})," ",e.jsx("p",{children:"Loading suggestions..."})]})})}):e.jsx(vt,{open:n,onOpenChange:a,children:e.jsxs(ut,{className:"sm:max-w-3xl",children:[e.jsxs(_t,{children:[e.jsxs(jt,{className:"flex items-center gap-2",children:[e.jsx(Tt,{})," AI-Powered Template Suggestions"]}),e.jsx(Et,{children:`Here are a few email templates drafted by AI based on your company's needs. Click "Create" to use one as a starting point.`})]}),e.jsxs("div",{className:"py-4",children:[u&&e.jsxs("div",{className:"flex justify-center items-center gap-2",children:[e.jsx(fe,{className:"h-6 w-6 animate-spin"})," ",e.jsx("p",{children:"Drafting templates..."})]}),h&&e.jsxs("p",{className:"text-destructive",children:["Error: ",h.message]}),p&&Array.isArray(p)&&e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:p.map((d,o)=>e.jsxs(we,{className:"flex flex-col",children:[e.jsxs(Ae,{children:[e.jsx(Ee,{className:"text-lg",children:d.name}),e.jsxs("p",{className:"text-sm text-muted-foreground pt-1",children:["Subject: ",d.subject]})]}),e.jsx(ke,{className:"flex-grow",children:e.jsx("div",{className:"text-sm border p-2 rounded-md h-32 overflow-y-auto bg-background",dangerouslySetInnerHTML:{__html:d.body}})}),e.jsx(qa,{children:e.jsxs(ee,{onClick:()=>t(d),className:"w-full",children:[e.jsx(Kt,{className:"mr-2 h-4 w-4"})," Create from this suggestion"]})})]},o))}),p&&!Array.isArray(p)&&e.jsx("p",{className:"text-destructive",children:"Error: Invalid suggestions format received from AI."})]})]})})},gd=({isOpen:n,onOpenChange:a,currentTemplate:t,onRedesignComplete:r,isSystemTemplate:i,companyId:l})=>{const[c,m]=T.useState(""),{toast:u}=Ke(),h=Oe({mutationFn:async()=>{const{data:o,error:s}=await X.functions.invoke("redesign-email-template",{body:{templateId:t.id,currentSubject:t.subject,currentBody:t.body,userInstructions:c,isSystemTemplate:i,companyId:l}});if(s)throw s;return o.redesignedTemplate},onSuccess:o=>{r(o.subject,o.body),u({title:"Template Redesigned",description:"AI has generated a new design for your template. Please review."}),a(!1),m("")},onError:o=>{u({title:"Error Redesigning Template",description:o.message||"An unexpected error occurred during AI redesign.",variant:"destructive"})}}),p=()=>{h.mutate()},d=h.isPending;return e.jsx(vt,{open:n,onOpenChange:a,children:e.jsxs(ut,{className:"sm:max-w-[900px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(_t,{children:[e.jsxs(jt,{className:"flex items-center gap-2",children:[e.jsx(Tt,{className:"h-5 w-5"})," AI Redesign: ",t.name]}),e.jsx(Et,{children:"Let AI help you redesign this email template. Provide instructions below."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"current-subject",children:"Current Subject"}),e.jsx(ne,{id:"current-subject",value:t.subject,readOnly:!0,disabled:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"current-body",children:"Current Body (Preview)"}),e.jsx(Kn,{value:t.body,onChange:()=>{},readOnly:!0,disabled:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(G,{htmlFor:"redesign-instructions",className:"flex items-center gap-1",children:[e.jsx(Da,{className:"h-4 w-4 text-yellow-500"}),"Redesign Instructions (Optional)"]}),e.jsx(Ot,{id:"redesign-instructions",placeholder:"e.g., 'Make it more concise and formal', 'Add a strong call to action for expense submission', 'Change the tone to be more friendly.'",value:c,onChange:o=>m(o.target.value),rows:4,disabled:d})]})]}),e.jsxs(sr,{children:[e.jsx(ee,{variant:"outline",onClick:()=>a(!1),disabled:d,children:"Cancel"}),e.jsxs(ee,{onClick:p,disabled:d,children:[d?e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Tt,{className:"mr-2 h-4 w-4"}),"Redesign Template"]})]})]})})},Dy=tt({name:J().min(1,"Template name is required"),subject:J().min(1,"Subject is required"),body:J().min(1,"Email body is required"),description:J().optional().nullable()}),Ty=[{name:"Global: Current Year",variable:"<% year %>",description:"The current year (e.g., 2024)"},{name:"Global: Public Web URL",variable:"<% public_web_url %>",description:"The base URL of the application"},{name:"Global: Default Logo URL",variable:"<% logo_url %>",description:"The system's default logo image URL"},{name:"Global: Default Logo Width",variable:"<% logo_width %>",description:"The system's default logo width in pixels"},{name:"Global: Default Logo Height",variable:"<% logo_height %>",description:"The system's default logo height in pixels"},{name:"Company: Name",variable:"<% company_name %>",description:"The name of the company"},{name:"User: Inviter Name",variable:"<% inviter_name %>",description:"Full name of the user who sent an invitation"},{name:"User: Invited Role",variable:"<% invited_role %>",description:"The role assigned to the invited user"},{name:"User: Invitation Link",variable:"<% invitation_link %>",description:"The unique link to accept an invitation"},{name:"User: New User Name",variable:"<% new_user_name %>",description:"Full name of the newly created user"},{name:"User: New User Email",variable:"<% new_user_email %>",description:"Email of the newly created user"},{name:"User: Admin Name",variable:"<% admin_name %>",description:"Full name of the administrator"},{name:"User: Admin Email",variable:"<% admin_email %>",description:"Email of the administrator"},{name:"User: Target User Name",variable:"<% target_user_name %>",description:"Full name of the user whose status/access was updated"},{name:"User: Target User Email",variable:"<% target_user_email %>",description:"Email of the user whose status/access was updated"},{name:"User: New Status",variable:"<% new_status %>",description:"The new status of a user account (e.g., Active, Inactive)"},{name:"User: Users Link",variable:"<% users_link %>",description:"Link to the user management page"},{name:"Module: Name",variable:"<% module_name %>",description:"Name of the module (e.g., Expense Management)"},{name:"Module: Access Status",variable:"<% access_status %>",description:"Access status of a module (e.g., Enabled, Disabled)"},{name:"Module: Modules Link",variable:"<% modules_link %>",description:"Link to the company modules overview page"},{name:"Expense: Title",variable:"<% expense_title %>",description:"Title of the expense"},{name:"Expense: Amount",variable:"<% expense_amount %>",description:"Formatted amount of the expense"},{name:"Expense: Status",variable:"<% expense_status %>",description:"Status of the expense (e.g., Submitted, Approved)"},{name:"Expense: Link",variable:"<% expense_link %>",description:"Link to the expense detail page"},{name:"Report: Subject",variable:"<% report_subject %>",description:"Subject of the generated report"},{name:"Report: Content",variable:"<% report_content %>",description:"Content of the generated report (HTML or plain text)"}],Ly=({companyId:n})=>{const a=Ye(),{toast:t}=Ke(),{profile:r,isLoading:i}=Ie(),[l,c]=T.useState(!1),[m,u]=T.useState(!1),[h,p]=T.useState(null),[d,o]=T.useState(!1),[s,g]=T.useState(null),[v,x]=T.useState(null),[y,f]=T.useState(!1),_=r==null?void 0:r.role,{data:b,isLoading:E}=je({queryKey:["companyEmailTemplates",n],queryFn:async()=>{if(!n)return[];const{data:A,error:V}=await X.from("company_email_templates").select("*").eq("company_id",n).order("name",{ascending:!0});if(V)throw V;return A},enabled:!!n&&!i}),{data:N,isLoading:j}=je({queryKey:["systemEmailLayoutForCompanyTemplateManager"],queryFn:async()=>{const{data:A,error:V}=await X.functions.invoke("upsert-system-email-layout",{method:"GET"});if(V)throw V;return A.data},enabled:!i}),{data:C,isLoading:D}=je({queryKey:["companyNameForTemplatePreview",n],queryFn:async()=>{if(!n)return null;const{data:A,error:V}=await X.from("companies").select("name").eq("id",n).single();if(V)throw V;return A},enabled:!!n&&!i}),k=ct({resolver:dt(Dy),defaultValues:{name:"",subject:"",body:`
      <p>Hello,</p>
      <p>This is a notification from your company, <% company_name %>.</p>
      <p>You can customize this template using the variables listed on the right.</p>
      <p>Best regards,<br><% company_name %></p>
    `,description:""}});T.useEffect(()=>{l&&k.reset(h?{name:h.name,subject:h.subject,body:h.body,description:h.description||""}:{name:"",subject:"",body:`
        <p>Hello,</p>
        <p>This is a notification from your company, <% company_name %>.</p>
        <p>You can customize this template using the variables listed on the right.</p>
        <p>Best regards,<br><% company_name %></p>
      `,description:""}),x(null)},[l,h,k]);const w=A=>{p(null),k.reset({name:A.name,subject:A.subject,body:A.body,description:`AI-suggested template for: ${A.name}`}),u(!1),c(!0)},S=(A,V)=>{k.setValue("subject",A,{shouldDirty:!0}),k.setValue("body",V,{shouldDirty:!0}),t({title:"AI Redesign Applied",description:"The template has been updated with AI's suggestions. Review and save."})},P=Oe({mutationFn:async A=>{if(!n)throw new Error("Company not identified.");if(_==="admin"&&n!==(r==null?void 0:r.company_id))throw new Error("Access Denied: You can only manage email templates for your own company.");const V={...A,company_id:n};if(h){const{error:K}=await X.from("company_email_templates").update(V).eq("id",h.id);if(K)throw K}else{const{error:K}=await X.from("company_email_templates").insert(V);if(K)throw K}return null},onSuccess:()=>{a.invalidateQueries({queryKey:["companyEmailTemplates",n]}),t({title:"Template Saved",description:"Your email template has been saved."}),c(!1)},onError:A=>{t({title:"Error Saving Template",description:A.message,variant:"destructive"})}}),O=Oe({mutationFn:async A=>{if(!n)throw new Error("Company not identified.");if(_==="admin"&&n!==(r==null?void 0:r.company_id))throw new Error("Access Denied: You can only delete email templates from your own company.");const{error:V}=await X.from("company_email_templates").delete().eq("id",A);if(V)throw V},onSuccess:()=>{a.invalidateQueries({queryKey:["companyEmailTemplates",n]}),t({title:"Template Deleted"}),o(!1)},onError:A=>{t({title:"Error Deleting Template",description:A.message,variant:"destructive"})}}),L=A=>P.mutate(A),$=()=>{p(null),k.reset(),c(!0)},B=A=>{p(A),c(!0)},Y=A=>{g(A),o(!0)},U=()=>{s&&O.mutate(s.id)},q=P.isPending||O.isPending,R=T.useMemo(()=>{const A=new URL(window.location.origin),V=N==null?void 0:N.default_logo_url;let K;try{V?K=new URL(V,A).href:K=new URL("/infotrac-logo.png",A).href}catch(Q){console.error("Error constructing logo_url for preview:",Q),K=""}return{year:new Date().getFullYear(),public_web_url:window.location.origin,logo_url:K,logo_width:(N==null?void 0:N.default_logo_width)||150,logo_height:(N==null?void 0:N.default_logo_height)||"auto",company_name:(C==null?void 0:C.name)||"Your Company",user_name:"John Doe",user_email:"john.doe@example.com",new_user_name:"Alice Smith",new_user_email:"alice.smith@example.com",target_user_name:"Bob Johnson",target_user_email:"bob.johnson@example.com",admin_name:"Jane Admin",admin_email:"jane.admin@example.com",inviter_name:"Charlie Brown",invited_role:"User",new_status:"Active",users_link:`${window.location.origin}/users`,invitation_link:`${window.location.origin}/accept-invite?token=dummytoken123`,module_name:"Expense Management",access_status:"Enabled",modules_link:`${window.location.origin}/company-modules-overview`,expense_title:"Client Lunch",expense_amount:"$125.50",expense_status:"Approved",expense_link:`${window.location.origin}/expenses/123`,report_subject:"Monthly Sales Report",report_content:"<p>Here is your monthly sales summary...</p>"}},[N,C==null?void 0:C.name]),F=k.watch("body"),M=k.watch("subject"),[z,H]=T.useState("");T.useEffect(()=>{try{const A=F?ht.render(F,R,{},["<%","%>"]):"";let V=N!=null&&N.header_html?ht.render(N.header_html,R,{},["<%","%>"]):"",K=N!=null&&N.footer_html?ht.render(N.footer_html,R,{},["<%","%>"]):"";N!=null&&N.header_html||(V=`
          <div style="text-align: center; padding: 20px; background-color: #f8f8f8; border-bottom: 1px solid #eee;">
            <img src="${R.logo_url}" alt="${R.company_name} Logo" style="max-width: ${R.logo_width||150}px; height: ${R.logo_height||"auto"}; display: block; margin: 0 auto;">
          </div>
        `),N!=null&&N.footer_html||(K=`
          <div style="text-align: center; padding: 20px; font-size: 0.8em; color: #777; border-top: 1px solid #eee; margin-top: 20px;">
            &copy; <% year %> ${R.company_name}. All rights reserved. <br>
            <a href="<% public_web_url %>" style="color: #2F424F;">Visit our website</a>
          </div>
        `);const Q=`
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>${M||"Email Preview"}</title>
            <style>
                body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; margin: 0; padding: 0; background-color: #f4f4f4; }
                .email-wrapper { max-width: 600px; margin: 20px auto; background-color: #ffffff; border: 1px solid #ddd; border-radius: 8px; overflow: hidden; }
                .email-header { padding: 20px; text-align: center; }
                .email-body { padding: 20px; }
                .email-footer { padding: 20px; text-align: center; font-size: 0.8em; color: #777; border-top: 1px solid #eee; margin-top: 20px; }
                img { max-width: 100%; height: auto; }
                a { color: #2F424F; text-decoration: none; }
                a:hover { text-decoration: underline; }
            </style>
        </head>
        <body>
            <div class="email-wrapper">
                ${V}
                <div class="email-body">
                    ${A}
                </div>
                ${K}
            </div>
        </body>
        </html>
      `;H(Q),v&&x(null)}catch(A){console.error("Error rendering template preview:",A),x(`Error rendering preview: ${A.message||"Unknown error"}. Please check template syntax.`),H('<p style="color: red;">Error: Could not render preview. Please check template syntax.</p>')}},[F,M,R,v,N]);const I=_&&(_==="super-admin"||_==="admin"&&n===(r==null?void 0:r.company_id));return i||E||j||D?e.jsx("div",{className:"flex justify-center p-8",children:e.jsx(fe,{className:"h-6 w-6 animate-spin"})}):I?e.jsxs(e.Fragment,{children:[e.jsxs(we,{className:"mt-4",children:[e.jsxs(Ae,{className:"flex flex-row items-start justify-between space-y-0 pb-2",children:[e.jsx(Ee,{children:"Email Templates"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ee,{variant:"outline",onClick:()=>u(!0),children:[e.jsx(Tt,{className:"mr-2 h-4 w-4"})," Suggest Templates"]}),e.jsxs(vt,{open:l,onOpenChange:c,children:[e.jsx(ir,{asChild:!0,children:e.jsxs(ee,{onClick:$,children:[e.jsx(Kt,{className:"mr-2 h-4 w-4"})," Create Template"]})}),e.jsxs(ut,{className:"sm:max-w-[1200px] max-h-[90vh] overflow-y-auto",children:[" ",e.jsxs(_t,{children:[e.jsx(jt,{children:h?"Edit Email Template":"Create New Email Template"}),e.jsx(Et,{children:h?"Update the content of this email template.":"Design a new email template for automated notifications."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 py-4",children:[" ",e.jsxs("form",{onSubmit:k.handleSubmit(L),className:"grid gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"name",children:"Name"}),e.jsx(ne,{id:"name",...k.register("name"),disabled:q}),k.formState.errors.name&&e.jsx("p",{className:"text-sm text-destructive",children:k.formState.errors.name.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"subject",children:"Subject"}),e.jsx(ne,{id:"subject",...k.register("subject"),disabled:q}),k.formState.errors.subject&&e.jsx("p",{className:"text-sm text-destructive",children:k.formState.errors.subject.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"description",children:"Description"}),e.jsx(Ot,{id:"description",...k.register("description"),disabled:q})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(G,{htmlFor:"body",className:"flex items-center gap-1",children:["Body ",e.jsx("span",{className:"text-xs text-muted-foreground",children:"(HTML)"})]}),e.jsx(Kn,{value:k.watch("body"),onChange:A=>k.setValue("body",A),placeholder:"Enter email body HTML here. Use placeholders like <% user_name %>.",disabled:q}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Use placeholders like `<% admin_name %>`, `<% company_name %>` for dynamic content."}),k.formState.errors.body&&e.jsx("p",{className:"text-sm text-destructive",children:k.formState.errors.body.message})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[h&&e.jsxs(ee,{type:"button",variant:"outline",onClick:()=>f(!0),disabled:q,children:[e.jsx(Tt,{className:"mr-2 h-4 w-4"})," AI Redesign"]}),e.jsxs(ee,{type:"submit",disabled:q,children:[q&&e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}),h?"Update Template":"Create Template"]})]})]}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs(we,{className:"bg-muted/50",children:[e.jsxs(Ae,{className:"pb-2",children:[e.jsxs(Ee,{className:"text-lg flex items-center gap-2",children:[e.jsx(Gl,{className:"h-5 w-5"})," Available Variables"]}),e.jsx(Re,{children:"Click to insert a variable into the email body."})]}),e.jsxs(ke,{className:"grid gap-2",children:[e.jsxs(Je,{onValueChange:A=>{if(document.querySelector(".ql-editor")){const Q=k.getValues("body")+A;k.setValue("body",Q)}},children:[e.jsx(Qe,{children:e.jsx(et,{placeholder:"Select a variable to insert..."})}),e.jsx(Xe,{className:"max-h-60 overflow-y-auto",children:Ty.map(A=>e.jsxs(Ue,{value:A.variable,children:[A.name," ",e.jsxs("span",{className:"text-muted-foreground text-xs ml-2",children:["(",A.variable,")"]})]},A.variable))})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Variables will be replaced with actual data when the email is sent."})]})]}),e.jsxs(we,{className:"bg-muted/50",children:[e.jsxs(Ae,{className:"pb-2",children:[e.jsx(Ee,{className:"text-lg",children:"Email Body Preview"}),e.jsx(Re,{children:"How your email body will look with dummy data."})]}),e.jsxs(ke,{children:[v&&e.jsx("p",{className:"text-sm text-destructive mb-2",children:v}),e.jsx("div",{className:"prose dark:prose-invert max-w-none border rounded-md p-4 bg-background min-h-[200px]",dangerouslySetInnerHTML:{__html:z}}),k.watch("body")===""&&!v&&e.jsx("p",{className:"text-muted-foreground text-sm text-center mt-4",children:"No content to preview."})]})]})]})]})]})]})]})]}),e.jsx(ke,{className:"pt-6",children:e.jsxs(Ct,{children:[e.jsx(At,{children:e.jsxs(Me,{children:[e.jsx(be,{children:"Name"}),e.jsx(be,{children:"Subject"}),e.jsx(be,{children:"Description"}),e.jsx(be,{className:"text-right",children:"Actions"})]})}),e.jsx(Pt,{children:(b==null?void 0:b.length)===0?e.jsx(Me,{children:e.jsx(ve,{colSpan:4,className:"text-center",children:"No templates created yet."})}):b==null?void 0:b.map(A=>e.jsxs(Me,{children:[e.jsx(ve,{className:"font-medium",children:A.name}),e.jsx(ve,{children:A.subject}),e.jsx(ve,{children:A.description||"N/A"}),e.jsxs(ve,{className:"text-right space-x-2",children:[e.jsx(ee,{variant:"outline",size:"sm",onClick:()=>B(A),children:e.jsx(rn,{className:"h-4 w-4"})}),e.jsx(ee,{variant:"destructive",size:"sm",onClick:()=>Y(A),children:e.jsx(qt,{className:"h-4 w-4"})})]})]},A.id))})]})})]}),e.jsx(an,{open:d,onOpenChange:o,children:e.jsxs(zt,{children:[e.jsxs(Bt,{children:[e.jsx($t,{children:"Are you sure?"}),e.jsxs(Ht,{children:['This will permanently delete the template "',s==null?void 0:s.name,'".']})]}),e.jsxs(Ut,{children:[e.jsx(Wt,{children:"Cancel"}),e.jsx(Vt,{onClick:U,disabled:O.isPending,children:"Delete"})]})]})}),e.jsx(Oy,{isOpen:m,onOpenChange:u,onSelectSuggestion:w,companyId:n}),h&&e.jsx(gd,{isOpen:y,onOpenChange:f,currentTemplate:h,onRedesignComplete:S,isSystemTemplate:!1,companyId:n})]}):e.jsx("div",{className:"flex flex-1 items-center justify-center text-destructive",children:e.jsx("p",{children:"Access Denied: You do not have permission to manage these email templates."})})},Ry=[{value:"send_email",label:"Send an Email"},{value:"generate_report",label:"Generate a Report"}],ko=[{value:"user",label:"The user who triggered the event"},{value:"admin",label:"All company admins"},{value:"submitter",label:"The original submitter of the expense"},{value:"specific_email",label:"A specific email address"}],My=[{value:"expense.submitted",label:"Expense Submitted"},{value:"expense.approved",label:"Expense Approved"},{value:"expense.rejected",label:"Expense Rejected"},{value:"expense.commented",label:"Expense Commented"},{value:"schedule.daily",label:"Daily Schedule"},{value:"schedule.weekly",label:"Weekly Schedule"},{value:"schedule.monthly",label:"Monthly Schedule"}],Fy=(n,a)=>{fa(n,{description:a,style:{backgroundColor:"hsl(48 96% 89%)",color:"hsl(24 9.8% 10%)",borderColor:"hsl(48 96% 89%)"},duration:5e3})},Iy=tt({name:J().min(1,"Automation name is required"),description:J().optional(),trigger_type:J().min(1,"Trigger is required"),action_type:J().min(1,"Action is required"),action_template_id:J().optional(),action_recipient:J().optional(),specific_email_recipient:J().email("Invalid email address").optional().nullable(),report_type:J().optional(),report_format:J().optional(),channels:Zr(J()).nonempty({message:"Please select at least one notification channel."}),is_active:St().default(!0),schedule_time:J().optional().nullable(),schedule_day_of_week:J().optional().nullable(),schedule_day_of_month:gt(n=>n===""?null:Number(n),yt().int().min(1).max(31).optional().nullable())}),qy=({isOpen:n,onOpenChange:a,editingAutomation:t,suggestion:r,aiGeneratedAutomation:i,companyId:l})=>{const c=Ye(),{toast:m}=Ke(),{profile:u,user:h,isLoading:p}=Ie(),d=u==null?void 0:u.role,o=ct({resolver:dt(Iy),defaultValues:{name:"",description:"",trigger_type:"",action_type:"send_email",action_template_id:"",action_recipient:"user",specific_email_recipient:"",report_type:"",report_format:"PDF",channels:["in_app","email"],is_active:!0,schedule_time:"09:00",schedule_day_of_week:"Monday",schedule_day_of_month:1}}),{data:s}=je({queryKey:["companyEmailTemplates",l],queryFn:async()=>{if(!l)return[];const{data:j,error:C}=await X.from("company_email_templates").select("id, name").eq("company_id",l);if(C)throw C;return j},enabled:!!l&&!p}),{data:g,isLoading:v}=je({queryKey:["availableTriggers",l],queryFn:async()=>{if(!l)return[];const{data:j,error:C}=await X.from("company_modules").select("module_id").eq("company_id",l).eq("is_enabled",!0);if(C)throw C;if(!j||j.length===0)return[];const D=j.map(P=>P.module_id),{data:k,error:w}=await X.from("module_triggers").select("trigger_name, label").in("module_id",D);if(w)throw w;return[...My.filter(P=>P.value.startsWith("schedule.")),...k.map(P=>({value:P.trigger_name,label:P.label}))]},enabled:!!l&&!p}),x=Oe({mutationFn:async j=>{if(!l||!(h!=null&&h.id))throw new Error("User or company not found.");if(d==="admin"&&l!==(u==null?void 0:u.company_id))throw new Error("Access Denied: You can only manage automations for your own company.");const C={company_id:l,created_by:h.id,name:j.name,description:j.description,trigger_type:j.trigger_type,trigger_config:{},action_type:j.action_type,action_config:{channels:j.channels,...j.action_type==="send_email"&&{template_id:j.action_template_id,recipient:j.action_recipient,specific_email_recipient:j.action_recipient==="specific_email"?j.specific_email_recipient:null},...j.action_type==="generate_report"&&{report_type:j.report_type,report_format:j.report_format,recipient:j.action_recipient,specific_email_recipient:j.action_recipient==="specific_email"?j.specific_email_recipient:null}},is_active:j.is_active,schedule_config:j.trigger_type.startsWith("schedule.")?{time:j.schedule_time,day_of_week:j.trigger_type==="schedule.weekly"?j.schedule_day_of_week:null,day_of_month:j.trigger_type==="schedule.monthly"?j.schedule_day_of_month:null}:null},{error:D}=await X.from("automations").upsert(t?{...C,id:t.id}:C);if(D)throw D},onSuccess:()=>{c.invalidateQueries({queryKey:["automations",l]}),m({title:"Automation Saved",description:"Your automation has been successfully saved."}),a(!1)},onError:j=>{m({title:"Error Saving Automation",description:j.message,variant:"destructive"})}});T.useEffect(()=>{var j,C,D,k,w,S,P,O,L;n&&(t?o.reset({name:t.name,description:t.description||"",trigger_type:t.trigger_type||"",action_type:"send_email",action_template_id:((j=t.action_config)==null?void 0:j.template_id)||"",action_recipient:((C=t.action_config)==null?void 0:C.recipient)||"user",specific_email_recipient:((D=t.action_config)==null?void 0:D.specific_email_recipient)||"",report_type:((k=t.action_config)==null?void 0:k.report_type)||"",report_format:((w=t.action_config)==null?void 0:w.report_format)||"PDF",channels:((S=t.action_config)==null?void 0:S.channels)||["in_app","email"],is_active:t.is_active??!0,schedule_time:((P=t.schedule_config)==null?void 0:P.time)||"09:00",schedule_day_of_week:((O=t.schedule_config)==null?void 0:O.day_of_week)||"Monday",schedule_day_of_month:((L=t.schedule_config)==null?void 0:L.day_of_month)||1}):r?o.reset({name:r.name,description:r.description,trigger_type:r.trigger_type,action_type:"send_email",action_template_id:"",action_recipient:"user",specific_email_recipient:"",report_type:"",report_format:"PDF",channels:["in_app","email"],is_active:!0,schedule_time:"09:00",schedule_day_of_week:"Monday",schedule_day_of_month:1}):i?(o.reset({name:i.name||"",description:i.description||"",trigger_type:i.trigger_type||"",action_type:i.action_type||"send_email",action_template_id:i.action_template_id||"",action_recipient:i.action_recipient||"user",specific_email_recipient:i.specific_email_recipient||"",report_type:i.report_type||"",report_format:i.report_format||"PDF",channels:i.channels||["in_app","email"],is_active:i.is_active??!0,schedule_time:i.schedule_time||"09:00",schedule_day_of_week:i.schedule_day_of_week||"Monday",schedule_day_of_month:i.schedule_day_of_month||1}),i.warning&&Fy("AI Warning",i.warning)):o.reset({name:"",description:"",trigger_type:"",action_type:"send_email",action_template_id:"",action_recipient:"user",specific_email_recipient:"",report_type:"",report_format:"PDF",channels:["in_app","email"],is_active:!0,schedule_time:"09:00",schedule_day_of_week:"Monday",schedule_day_of_month:1}))},[n,t,r,i,o]);const y=j=>{x.mutate(j)},f=d&&(d==="super-admin"||d==="admin"&&l===(u==null?void 0:u.company_id)),_=o.watch("action_type"),b=o.watch("action_recipient"),E=o.watch("trigger_type"),N=E.startsWith("schedule.");return p?e.jsx("div",{className:"flex justify-center p-8",children:e.jsx(fe,{className:"h-6 w-6 animate-spin"})}):f?e.jsx(vt,{open:n,onOpenChange:a,children:e.jsxs(ut,{children:[e.jsxs(_t,{children:[e.jsxs(jt,{children:[t?"Edit":"Create"," Automation"]}),e.jsx(Et,{children:"Set up a trigger and a corresponding action to automate tasks."})]}),e.jsxs("form",{onSubmit:o.handleSubmit(y),className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"name",children:"Automation Name"}),e.jsx(ne,{id:"name",...o.register("name")}),o.formState.errors.name&&e.jsx("p",{className:"text-sm text-destructive",children:o.formState.errors.name.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"description",children:"Description (Optional)"}),e.jsx(Ot,{id:"description",...o.register("description")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"trigger_type",children:"When this happens... (Trigger)"}),e.jsx(Jt,{name:"trigger_type",control:o.control,render:({field:j})=>e.jsxs(Je,{onValueChange:j.onChange,value:j.value,disabled:v,children:[e.jsx(Qe,{children:e.jsx(et,{placeholder:v?"Loading triggers...":"Select a trigger..."})}),e.jsx(Xe,{children:g==null?void 0:g.map(C=>e.jsx(Ue,{value:C.value,children:C.label},C.value))})]})}),o.formState.errors.trigger_type&&e.jsx("p",{className:"text-sm text-destructive",children:o.formState.errors.trigger_type.message})]}),N&&e.jsxs("div",{className:"space-y-2 border p-4 rounded-md bg-muted/50",children:[e.jsx("h4",{className:"font-semibold",children:"Schedule Configuration"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"schedule_time",children:"Time of Day"}),e.jsx(ne,{id:"schedule_time",type:"time",...o.register("schedule_time")}),o.formState.errors.schedule_time&&e.jsx("p",{className:"text-sm text-destructive",children:o.formState.errors.schedule_time.message})]}),E==="schedule.weekly"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"schedule_day_of_week",children:"Day of Week"}),e.jsxs(Je,{onValueChange:j=>o.setValue("schedule_day_of_week",j),value:o.watch("schedule_day_of_week")||"",children:[e.jsx(Qe,{children:e.jsx(et,{placeholder:"Select day"})}),e.jsx(Xe,{children:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].map(j=>e.jsx(Ue,{value:j,children:j},j))})]}),o.formState.errors.schedule_day_of_week&&e.jsx("p",{className:"text-sm text-destructive",children:o.formState.errors.schedule_day_of_week.message})]}),E==="schedule.monthly"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"schedule_day_of_month",children:"Day of Month"}),e.jsx(ne,{id:"schedule_day_of_month",type:"number",min:"1",max:"31",...o.register("schedule_day_of_month",{valueAsNumber:!0})}),o.formState.errors.schedule_day_of_month&&e.jsx("p",{className:"text-sm text-destructive",children:o.formState.errors.schedule_day_of_month.message})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{children:"Do this... (Action)"}),e.jsx(Jt,{name:"action_type",control:o.control,render:({field:j})=>e.jsxs(Je,{onValueChange:j.onChange,value:j.value,children:[e.jsx(Qe,{children:e.jsx(et,{placeholder:"Select an action..."})}),e.jsx(Xe,{children:Ry.map(C=>e.jsx(Ue,{value:C.value,children:C.label},C.value))})]})}),o.formState.errors.action_type&&e.jsx("p",{className:"text-sm text-destructive",children:o.formState.errors.action_type.message})]}),_==="send_email"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"action_template_id",children:"Using this template..."}),e.jsx(Jt,{name:"action_template_id",control:o.control,render:({field:j})=>e.jsxs(Je,{onValueChange:j.onChange,value:j.value,children:[e.jsx(Qe,{children:e.jsx(et,{placeholder:"Select an email template..."})}),e.jsx(Xe,{children:s==null?void 0:s.map(C=>e.jsx(Ue,{value:C.id,children:C.name},C.id))})]})}),o.formState.errors.action_template_id&&e.jsx("p",{className:"text-sm text-destructive",children:o.formState.errors.action_template_id.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"action_recipient",children:"Send to..."}),e.jsx(Jt,{name:"action_recipient",control:o.control,render:({field:j})=>e.jsxs(Je,{onValueChange:j.onChange,value:j.value,children:[e.jsx(Qe,{children:e.jsx(et,{placeholder:"Select a recipient..."})}),e.jsx(Xe,{children:ko.map(C=>e.jsx(Ue,{value:C.value,children:C.label},C.value))})]})}),o.formState.errors.action_recipient&&e.jsx("p",{className:"text-sm text-destructive",children:o.formState.errors.action_recipient.message})]}),b==="specific_email"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"specific_email_recipient",children:"Specific Email Address"}),e.jsx(ne,{id:"specific_email_recipient",type:"email",...o.register("specific_email_recipient")}),o.formState.errors.specific_email_recipient&&e.jsx("p",{className:"text-sm text-destructive",children:o.formState.errors.specific_email_recipient.message})]})]}),_==="generate_report"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"report_type",children:"Report Type"}),e.jsx(Jt,{name:"report_type",control:o.control,render:({field:j})=>e.jsxs(Je,{onValueChange:j.onChange,value:j.value,children:[e.jsx(Qe,{children:e.jsx(et,{placeholder:"Select report type..."})}),e.jsxs(Xe,{children:[e.jsx(Ue,{value:"order_summary",children:"Order Summary (Placeholder)"}),e.jsx(Ue,{value:"ar_aging",children:"AR Aging (Placeholder)"}),e.jsx(Ue,{value:"ap_aging",children:"AP Aging (Placeholder)"})]})]})}),o.formState.errors.report_type&&e.jsx("p",{className:"text-sm text-destructive",children:o.formState.errors.report_type.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"report_format",children:"Report Format"}),e.jsx(Jt,{name:"report_format",control:o.control,render:({field:j})=>e.jsxs(Je,{onValueChange:j.onChange,value:j.value,children:[e.jsx(Qe,{children:e.jsx(et,{placeholder:"Select report format..."})}),e.jsxs(Xe,{children:[e.jsx(Ue,{value:"PDF",children:"PDF"}),e.jsx(Ue,{value:"CSV",children:"CSV"})]})]})}),o.formState.errors.report_format&&e.jsx("p",{className:"text-sm text-destructive",children:o.formState.errors.report_format.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"action_recipient",children:"Send Report to..."}),e.jsx(Jt,{name:"action_recipient",control:o.control,render:({field:j})=>e.jsxs(Je,{onValueChange:j.onChange,value:j.value,children:[e.jsx(Qe,{children:e.jsx(et,{placeholder:"Select a recipient..."})}),e.jsx(Xe,{children:ko.map(C=>e.jsx(Ue,{value:C.value,children:C.label},C.value))})]})}),o.formState.errors.action_recipient&&e.jsx("p",{className:"text-sm text-destructive",children:o.formState.errors.action_recipient.message})]}),b==="specific_email"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"specific_email_recipient",children:"Specific Email Address"}),e.jsx(ne,{id:"specific_email_recipient",type:"email",...o.register("specific_email_recipient")}),o.formState.errors.specific_email_recipient&&e.jsx("p",{className:"text-sm text-destructive",children:o.formState.errors.specific_email_recipient.message})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{children:"Deliver Via"}),e.jsx(Jt,{name:"channels",control:o.control,render:({field:j})=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(bt,{id:"channel-in-app",checked:j.value.includes("in_app"),onCheckedChange:C=>{const D=C?[...j.value,"in_app"]:j.value.filter(k=>k!=="in_app");j.onChange(D)}}),e.jsx(G,{htmlFor:"channel-in-app",children:"In-App Alert"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(bt,{id:"channel-email",checked:j.value.includes("email"),onCheckedChange:C=>{const D=C?[...j.value,"email"]:j.value.filter(k=>k!=="email");j.onChange(D)}}),e.jsx(G,{htmlFor:"channel-email",children:"Email"})]})]})}),o.formState.errors.channels&&e.jsx("p",{className:"text-sm text-destructive",children:o.formState.errors.channels.message})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Jt,{name:"is_active",control:o.control,render:({field:j})=>e.jsx(za,{id:"is_active",checked:j.value,onCheckedChange:j.onChange})}),e.jsx(G,{htmlFor:"is_active",children:"Enable this automation"})]}),e.jsxs(ee,{type:"submit",disabled:x.isPending,children:[x.isPending&&e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Automation"]})]})]})}):e.jsx(ut,{children:e.jsxs(_t,{children:[e.jsx(jt,{children:"Access Denied"}),e.jsx(Et,{children:"You do not have permission to manage automations for this company."})]})})},zy=({isOpen:n,onOpenChange:a,onSelectSuggestion:t,companyId:r})=>{const{profile:i,isLoading:l}=Ie(),{mutate:c,data:m,isPending:u,error:h}=Oe({mutationFn:async()=>{if(!r)throw new Error("Company ID not found.");if((i==null?void 0:i.role)==="admin"&&r!==(i==null?void 0:i.company_id))throw new Error("Access Denied: You can only get automation suggestions for your own company.");const{data:p,error:d}=await X.functions.invoke("suggest-automations",{body:{companyId:r}});if(d)throw d;return p.suggestions||[]}});return T.useEffect(()=>{n&&r&&!l&&c()},[n,r,c,l]),l?e.jsx(vt,{open:n,onOpenChange:a,children:e.jsx(ut,{className:"sm:max-w-2xl",children:e.jsxs("div",{className:"flex justify-center items-center gap-2 py-8",children:[e.jsx(fe,{className:"h-6 w-6 animate-spin"})," ",e.jsx("p",{children:"Loading suggestions..."})]})})}):e.jsx(vt,{open:n,onOpenChange:a,children:e.jsxs(ut,{className:"sm:max-w-2xl",children:[e.jsxs(_t,{children:[e.jsxs(jt,{className:"flex items-center gap-2",children:[e.jsx(Tt,{})," AI-Powered Automation Suggestions"]}),e.jsx(Et,{children:`Here are a few ideas for automations based on your company's data. Click "Create" to get started with one.`})]}),e.jsxs("div",{className:"py-4",children:[u&&e.jsxs("div",{className:"flex justify-center items-center gap-2",children:[e.jsx(fe,{className:"h-6 w-6 animate-spin"})," ",e.jsx("p",{children:"Generating ideas..."})]}),h&&e.jsxs("p",{className:"text-destructive",children:["Error: ",h.message]}),m&&e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:m.map((p,d)=>e.jsxs(we,{className:"flex flex-col",children:[e.jsx(Ae,{children:e.jsx(Ee,{className:"text-lg",children:p.name})}),e.jsx(ke,{className:"flex-grow",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:p.description})}),e.jsx(qa,{children:e.jsxs(ee,{onClick:()=>t(p),className:"w-full",children:[e.jsx(Kt,{className:"mr-2 h-4 w-4"})," Create"]})})]},d))})]})]})})},By=({isOpen:n,onOpenChange:a,onAutomationGenerated:t,companyId:r})=>{const[i,l]=T.useState(""),{toast:c}=Ke(),{profile:m,isLoading:u}=Ie(),h=m==null?void 0:m.role,p=Oe({mutationFn:async s=>{if(!r)throw new Error("Company ID not found.");if(h==="admin"&&r!==(m==null?void 0:m.company_id))throw new Error("Access Denied: You can only generate automations for your own company.");const{data:g,error:v}=await X.functions.invoke("describe-automation",{body:{companyId:r,userDescription:s}});if(v)throw v;return g},onSuccess:s=>{s.automation?(t(s.automation),c({title:"Automation Drafted",description:s.message||"AI has drafted an automation based on your description. Please review."}),a(!1),l("")):c({title:"Could Not Draft Automation",description:s.message||"AI could not generate a suitable automation. Please try a different description.",variant:"destructive"})},onError:s=>{c({title:"Error generating automation",description:s.message||"An unexpected error occurred.",variant:"destructive"})}}),d=()=>{if(!i.trim()){c({title:"Input Required",description:"Please describe the automation you want to create.",variant:"destructive"});return}p.mutate(i)},o=u||p.isPending;return e.jsx(vt,{open:n,onOpenChange:a,children:e.jsxs(ut,{className:"sm:max-w-[600px]",children:[e.jsxs(_t,{children:[e.jsxs(jt,{className:"flex items-center gap-2",children:[e.jsx(Tt,{className:"h-5 w-5"})," Describe Automation with AI"]}),e.jsx(Et,{children:'Tell AI what kind of automation you want to create in plain language. For example: "Email an order summary to management every day at 7am" or "Notify me when an expense is rejected."'})]}),e.jsx("div",{className:"grid gap-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs(G,{htmlFor:"automation-description",className:"flex items-center gap-1",children:[e.jsx(Da,{className:"h-4 w-4 text-yellow-500"}),"Your Automation Idea"]}),e.jsx(Ot,{id:"automation-description",placeholder:"e.g., 'Generate a monthly AR aging report and send it to finance@example.com on the 5th of each month at 9 AM.'",value:i,onChange:s=>l(s.target.value),rows:5,disabled:o})]})}),e.jsxs(sr,{children:[e.jsx(ee,{variant:"outline",onClick:()=>a(!1),disabled:o,children:"Cancel"}),e.jsxs(ee,{onClick:d,disabled:o||!i.trim(),children:[o?e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Tt,{className:"mr-2 h-4 w-4"}),"Generate Automation"]})]})]})})},vd=({companyId:n})=>{const{profile:a,isLoading:t}=Ie(),r=Ye(),{toast:i}=Ke(),[l,c]=T.useState(!1),[m,u]=T.useState(!1),[h,p]=T.useState(!1),[d,o]=T.useState(null),[s,g]=T.useState(null),[v,x]=T.useState(null),y=a==null?void 0:a.role,{data:f,isLoading:_}=je({queryKey:["automations",n],queryFn:async()=>{if(!n)return[];const{data:S,error:P}=await X.from("automations").select("*, action_config").eq("company_id",n);if(P)throw P;return S},enabled:!!n&&!t}),{data:b}=je({queryKey:["availableTriggers",n],queryFn:async()=>{if(!n)return[];const{data:S,error:P}=await X.from("company_modules").select("module_id").eq("company_id",n).eq("is_enabled",!0);if(P)throw P;if(!S||S.length===0)return[];const O=S.map(B=>B.module_id),{data:L,error:$}=await X.from("module_triggers").select("trigger_name, label").in("module_id",O);if($)throw $;return L.map(B=>({value:B.trigger_name,label:B.label}))},enabled:!!n&&!t}),E=Oe({mutationFn:async({id:S,is_active:P})=>{if(!n)throw new Error("Company not identified.");if(y==="admin"&&n!==(a==null?void 0:a.company_id))throw new Error("Access Denied: You can only update automations for your own company.");const{error:O}=await X.from("automations").update({is_active:P}).eq("id",S);if(O)throw O},onSuccess:()=>{r.invalidateQueries({queryKey:["automations",n]}),i({title:"Automation status updated."})},onError:S=>{i({title:"Error updating status",description:S.message,variant:"destructive"})}}),N=S=>{o(S),g(null),x(null),c(!0)},j=()=>{o(null),g(null),x(null),c(!0)},C=S=>{g(S),o(null),x(null),c(!0),u(!1)},D=S=>{x(S),o(null),g(null),c(!0),p(!1)},k=S=>{var P;return((P=b==null?void 0:b.find(O=>O.value===S))==null?void 0:P.label)||S},w=y&&(y==="super-admin"||y==="admin"&&n===(a==null?void 0:a.company_id));return t||_?e.jsx("div",{className:"flex justify-center p-8",children:e.jsx(fe,{className:"h-6 w-6 animate-spin"})}):w?e.jsxs(e.Fragment,{children:[e.jsxs(we,{className:"mt-4",children:[e.jsxs(Ae,{className:"flex flex-row items-start justify-between space-y-0 pb-2",children:[e.jsx(Ee,{children:"Automated Notifications"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ee,{variant:"outline",onClick:()=>p(!0),children:[" ",e.jsx(Da,{className:"mr-2 h-4 w-4"})," Describe Automation"]}),e.jsxs(ee,{variant:"outline",onClick:()=>u(!0),children:[e.jsx(Tt,{className:"mr-2 h-4 w-4"})," Suggest Automations"]}),e.jsxs(ee,{onClick:j,children:[e.jsx(Kt,{className:"mr-2 h-4 w-4"})," Create Automation"]})]})]}),e.jsx(ke,{className:"pt-6",children:_?e.jsx("div",{className:"flex justify-center",children:e.jsx(fe,{className:"h-6 w-6 animate-spin"})}):e.jsxs(Ct,{children:[e.jsx(At,{children:e.jsxs(Me,{children:[e.jsx(be,{children:"Name"}),e.jsx(be,{children:"Trigger"}),e.jsx(be,{children:"Delivery"}),e.jsx(be,{children:"Status"}),e.jsx(be,{className:"text-right",children:"Actions"})]})}),e.jsx(Pt,{children:(f==null?void 0:f.length)===0?e.jsx(Me,{children:e.jsx(ve,{colSpan:5,className:"text-center",children:"No automations created yet."})}):f==null?void 0:f.map(S=>{var P,O,L,$;return e.jsxs(Me,{children:[e.jsx(ve,{className:"font-medium",children:S.name}),e.jsx(ve,{children:e.jsx(It,{variant:"secondary",children:k(S.trigger_type)})}),e.jsx(ve,{children:e.jsxs("div",{className:"flex gap-2",children:[((O=(P=S.action_config)==null?void 0:P.channels)==null?void 0:O.includes("in_app"))&&e.jsxs(It,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(La,{className:"h-3 w-3"})," In-App"]}),(($=(L=S.action_config)==null?void 0:L.channels)==null?void 0:$.includes("email"))&&e.jsxs(It,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(Ra,{className:"h-3 w-3"})," Email"]})]})}),e.jsx(ve,{children:e.jsx(za,{checked:S.is_active,onCheckedChange:B=>E.mutate({id:S.id,is_active:B})})}),e.jsxs(ve,{className:"text-right",children:[e.jsx(ee,{variant:"ghost",size:"icon",onClick:()=>N(S),children:e.jsx(rn,{className:"h-4 w-4"})}),e.jsx(ee,{variant:"ghost",size:"icon",disabled:!0,children:e.jsx(qt,{className:"h-4 w-4"})})]})]},S.id)})})]})})]}),e.jsx(qy,{isOpen:l,onOpenChange:c,editingAutomation:d,suggestion:s,aiGeneratedAutomation:v,companyId:n}),e.jsx(zy,{isOpen:m,onOpenChange:u,onSelectSuggestion:C,companyId:n}),e.jsx(By,{isOpen:h,onOpenChange:p,onAutomationGenerated:D,companyId:n})]}):e.jsx("div",{className:"flex flex-1 items-center justify-center text-destructive",children:e.jsx("p",{children:"Access Denied: You do not have permission to manage these automations."})})},Uy=tt({recipient_email:J().email("Invalid email address").min(1,"Recipient email is required"),subject:J().min(1,"Subject is required"),body:J().optional(),use_template:St().default(!1),template_name:J().optional(),template_variables:J().optional().nullable()}),$y=({companyId:n})=>{const{toast:a}=Ke(),{profile:t,isLoading:r}=Ie(),i=t==null?void 0:t.role,l=ct({resolver:dt(Uy),defaultValues:{recipient_email:"",subject:"",body:"",use_template:!1,template_name:"",template_variables:`{
  "user_name": "John Doe",
  "expense_title": "Client Lunch",
  "expense_status": "Approved",
  "expense_link": "https://example.com/expenses/123",
  "admin_name": "Jane Smith",
  "company_name": "Your Company",
  "year": 2024
}`}}),{data:c,isLoading:m}=je({queryKey:["companyEmailTemplates",n],queryFn:async()=>{if(!n)return[];const{data:v,error:x}=await X.from("company_email_templates").select("id, name, subject, body").eq("company_id",n);if(x)throw x;return v},enabled:!!n&&!r}),u=Oe({mutationFn:async v=>{if(!n)throw new Error("Company ID not found.");if(i==="admin"&&n!==(t==null?void 0:t.company_id))throw new Error("Access Denied: You can only send test emails for your own company.");let x={};if(v.use_template&&v.template_variables)try{x=JSON.parse(v.template_variables)}catch{throw new Error("Invalid JSON for template variables.")}const y={company_id:n,recipient_email:v.recipient_email,subject:v.subject,body:v.body,...v.use_template&&{template_name:v.template_name,template_variables:x}},{data:f,error:_}=await X.functions.invoke("send-company-email",{body:y});if(_)throw _;return f},onSuccess:v=>{a({title:"Test Email Sent",description:v.message||"Test email simulated successfully."})},onError:v=>{a({title:"Error Sending Test Email",description:v.message,variant:"destructive"})}}),h=v=>{u.mutate(v)},p=r||m,d=u.isPending,o=l.watch("use_template"),s=l.watch("template_name");T.useEffect(()=>{if(o&&s&&c){const v=c.find(x=>x.name===s);v&&(l.setValue("subject",v.subject),l.setValue("body",v.body))}else o||(l.setValue("subject",""),l.setValue("body",""))},[o,s,c,l]);const g=i&&(i==="super-admin"||i==="admin"&&n===(t==null?void 0:t.company_id));return p?e.jsx("div",{className:"flex justify-center p-8",children:e.jsx(fe,{className:"h-6 w-6 animate-spin"})}):g?e.jsxs(we,{className:"mt-4",children:[e.jsxs(Ae,{children:[e.jsx(Ee,{children:"Send Test Email"}),e.jsx(Re,{children:"Send a test email using your company's configured SMTP settings or an email template."})]}),e.jsx(ke,{children:e.jsxs("form",{onSubmit:l.handleSubmit(h),className:"grid gap-6",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"recipient_email",children:"Recipient Email Address"}),e.jsx(ne,{id:"recipient_email",type:"email",...l.register("recipient_email"),disabled:d}),l.formState.errors.recipient_email&&e.jsx("p",{className:"text-sm text-destructive",children:l.formState.errors.recipient_email.message})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Jt,{name:"use_template",control:l.control,render:({field:v})=>e.jsx(bt,{id:"use_template",checked:v.value,onCheckedChange:v.onChange,disabled:d})}),e.jsx(G,{htmlFor:"use_template",children:"Use an Email Template"})]}),o&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"template_name",children:"Select Template"}),e.jsxs(Je,{onValueChange:v=>l.setValue("template_name",v),value:l.watch("template_name")||"",disabled:d||m,children:[e.jsx(Qe,{id:"template_name",children:e.jsx(et,{placeholder:m?"Loading templates...":"Select a template"})}),e.jsx(Xe,{children:c==null?void 0:c.map(v=>e.jsx(Ue,{value:v.name,children:v.name},v.id))})]}),l.formState.errors.template_name&&e.jsx("p",{className:"text-sm text-destructive",children:l.formState.errors.template_name.message})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"template_variables",children:"Template Variables (JSON)"}),e.jsx(Ot,{id:"template_variables",...l.register("template_variables"),rows:8,className:"font-mono text-sm",placeholder:'{"user_name": "John Doe", "expense_title": "Client Lunch"}',disabled:d}),l.formState.errors.template_variables&&e.jsx("p",{className:"text-sm text-destructive",children:l.formState.errors.template_variables.message})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"subject",children:"Subject"}),e.jsx(ne,{id:"subject",...l.register("subject"),disabled:d||o}),l.formState.errors.subject&&e.jsx("p",{className:"text-sm text-destructive",children:l.formState.errors.subject.message})]}),e.jsxs("div",{className:"grid gap-2 mb-6",children:[" ",e.jsx(G,{htmlFor:"body",children:"Body"}),e.jsx(Kn,{value:l.watch("body")||"",onChange:v=>l.setValue("body",v),placeholder:"Enter email body here...",disabled:d||o}),l.formState.errors.body&&e.jsx("p",{className:"text-sm text-destructive",children:l.formState.errors.body.message})]}),e.jsxs(ee,{type:"submit",disabled:d,children:[d?e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(ya,{className:"mr-2 h-4 w-4"}),"Send Test Email"]})]})})]}):e.jsx("div",{className:"flex flex-1 items-center justify-center text-destructive",children:e.jsx("p",{children:"Access Denied: You do not have permission to send test emails for this company."})})},xd=()=>{var o;const[n]=Ui(),a=kn(),t=n.get("companyId"),{profile:r,isLoading:i}=Ie(),l=r==null?void 0:r.role,c=l==="super-admin",{data:m,isLoading:u}=je({queryKey:["allCompaniesForNotificationSettings"],queryFn:async()=>{const{data:s,error:g}=await X.from("companies").select("id, name").order("name",{ascending:!0});if(g)throw g;return s},enabled:c&&!t}),h=t||(r==null?void 0:r.company_id),p=l&&(c||l==="admin"&&h===(r==null?void 0:r.company_id)),d=s=>{a(`/company-notification-settings?companyId=${s}`)};return i||u?e.jsxs("div",{className:"flex flex-1 items-center justify-center",children:[e.jsx(fe,{className:"h-8 w-8 animate-spin"}),e.jsx("p",{className:"ml-2",children:"Loading notification settings..."})]}):p?c&&!h?e.jsxs(we,{className:"max-w-2xl mx-auto mt-8",children:[e.jsxs(Ae,{children:[e.jsxs(Ee,{className:"flex items-center gap-2",children:[e.jsx(Pa,{className:"h-5 w-5"})," Select a Company"]}),e.jsx(Re,{children:"As a Super Admin, please select a company to manage its notification settings."})]}),e.jsx(ke,{children:e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"company-select",children:"Company"}),e.jsxs(Je,{onValueChange:d,children:[e.jsx(Qe,{id:"company-select",children:e.jsx(et,{placeholder:"Select a company"})}),e.jsx(Xe,{children:m==null?void 0:m.map(s=>e.jsx(Ue,{value:s.id,children:s.name},s.id))})]})]})})]}):h?e.jsxs(we,{children:[e.jsxs(Ae,{children:[e.jsxs(Ee,{className:"flex items-center gap-2",children:[e.jsx(Ra,{className:"h-5 w-5"})," Notification Settings",c&&t&&e.jsxs("span",{className:"ml-2 text-sm font-normal text-muted-foreground",children:["(Company: ",((o=m==null?void 0:m.find(s=>s.id===t))==null?void 0:o.name)||"Loading...",")"]})]}),e.jsx(Re,{children:"Manage your company's notification configurations, templates, and automated alerts."})]}),e.jsx(ke,{children:e.jsxs(dn,{defaultValue:"templates",children:[e.jsxs(sn,{className:"grid w-full grid-cols-4",children:[e.jsx(ze,{value:"templates",children:"Templates"}),e.jsx(ze,{value:"automations",children:"Automations"}),e.jsx(ze,{value:"smtp",children:"Email Settings"}),e.jsx(ze,{value:"test-email",children:"Test Email"})]}),e.jsx(Ve,{value:"templates",children:e.jsx(Ly,{companyId:h})}),e.jsx(Ve,{value:"automations",children:e.jsx(vd,{companyId:h})}),e.jsx(Ve,{value:"smtp",children:e.jsx(cy,{companyId:h})}),e.jsx(Ve,{value:"test-email",children:e.jsx($y,{companyId:h})})]})})]}):e.jsx("div",{className:"flex flex-1 items-center justify-center text-destructive",children:e.jsx("p",{children:"Error: Could not determine company for notification settings."})}):e.jsx("div",{className:"flex flex-1 items-center justify-center text-destructive",children:e.jsx("p",{children:"Access Denied: You do not have permission to manage these notification settings."})})},yd=({currentLogoUrl:n,onFileSelected:a,isLoading:t=!1,disabled:r=!1})=>{const[i,l]=T.useState(null),[c,m]=T.useState(null),[u,h]=T.useState(null),[p,d]=T.useState(!1);T.useEffect(()=>{l(n||null)},[n]);const o=T.useCallback((f,_)=>{if(m(null),_.length>0){m("Invalid file type or size. Please upload an image (max 2MB).");return}if(f.length>0){const b=f[0];if(b.size>2*1024*1024){m("File size exceeds 2MB limit.");return}const E=new FileReader;E.addEventListener("load",()=>{h(E.result),d(!0)}),E.readAsDataURL(b)}},[]),{getRootProps:s,getInputProps:g,isDragActive:v}=Va({onDrop:o,accept:{"image/*":[".jpeg",".png",".gif",".webp"]},maxFiles:1,disabled:t||r}),x=f=>{a(f),l(URL.createObjectURL(f)),h(null)},y=f=>{f==null||f.stopPropagation(),a(null),l(n||null),m(null)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs("div",{...s(),className:pe("relative flex items-center justify-center h-24 w-24 rounded-full border-2 border-dashed transition-colors","hover:border-primary hover:bg-muted/50",v&&"border-primary bg-muted/50",(t||r)&&"opacity-70 cursor-not-allowed",c&&"border-destructive","cursor-pointer"),children:[e.jsx("input",{...g()}),e.jsxs(_r,{className:"h-20 w-20",children:[e.jsx(jr,{src:i||void 0,alt:"Company Logo Preview",className:"object-contain"}),e.jsx(wr,{className:"bg-muted-foreground/20",children:t?e.jsx(fe,{className:"h-8 w-8 animate-spin text-primary"}):e.jsx(Pa,{className:"h-8 w-8 text-muted-foreground"})})]}),!t&&i&&i!==n&&e.jsxs(ee,{variant:"ghost",size:"icon",onClick:y,className:"absolute -top-2 -right-2 h-6 w-6 rounded-full bg-background/80 hover:bg-background",children:[e.jsx(Ft,{className:"h-4 w-4 text-destructive"}),e.jsx("span",{className:"sr-only",children:"Clear image"})]})]}),c&&e.jsx("p",{className:"text-sm text-destructive text-center",children:c}),e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Drag & drop or click to upload logo (max 2MB)"})]}),e.jsx(hd,{isOpen:p,onOpenChange:d,imageSrc:u,onSave:x})]})},Hy=tt({name:J().min(1,"Location name is required"),address:J().optional().nullable(),city:J().optional().nullable(),state:J().optional().nullable(),zip_code:J().optional().nullable(),country:J().optional().nullable(),is_main_location:St().default(!1)}),Vy=({isOpen:n,onOpenChange:a,editingLocation:t,companyId:r})=>{const i=Ye(),{toast:l}=Ke(),{profile:c,isLoading:m}=Ie(),u=c==null?void 0:c.role,h=ct({resolver:dt(Hy),defaultValues:{name:"",address:"",city:"",state:"",zip_code:"",country:"",is_main_location:!1}});T.useEffect(()=>{n&&(t?h.reset({name:t.name,address:t.address,city:t.city,state:t.state,zip_code:t.zip_code,country:t.country,is_main_location:t.is_main_location}):h.reset({name:"",address:"",city:"",state:"",zip_code:"",country:"",is_main_location:!1}))},[n,t,h]);const p=Oe({mutationFn:async s=>{if(!r)throw new Error("Company ID not found.");if(u==="admin"&&r!==(c==null?void 0:c.company_id))throw new Error("Access Denied: You can only manage locations for your own company.");const g={...s,company_id:r};if(t){const{error:v}=await X.from("company_locations").update({...g,updated_at:new Date().toISOString()}).eq("id",t.id);if(v)throw v}else{const{error:v}=await X.from("company_locations").insert(g);if(v)throw v}return null},onSuccess:()=>{i.invalidateQueries({queryKey:["companyLocations",r]}),l({title:"Location Saved",description:"Company location has been successfully saved."}),a(!1)},onError:s=>{l({title:"Error Saving Location",description:s.message||"An unexpected error occurred.",variant:"destructive"})}}),d=s=>{p.mutate(s)},o=m||p.isPending;return e.jsxs(ut,{className:"sm:max-w-[425px]",children:[e.jsxs(_t,{children:[e.jsx(jt,{children:t?"Edit Location":"Add New Location"}),e.jsx(Et,{children:t?"Update the details of this company location.":"Add a new physical location for your company."})]}),e.jsxs("form",{onSubmit:h.handleSubmit(d),className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"name",children:"Location Name"}),e.jsx(ne,{id:"name",...h.register("name"),disabled:o}),h.formState.errors.name&&e.jsx("p",{className:"text-sm text-destructive",children:h.formState.errors.name.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"address",children:"Address"}),e.jsx(ne,{id:"address",...h.register("address"),disabled:o})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"city",children:"City"}),e.jsx(ne,{id:"city",...h.register("city"),disabled:o})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"state",children:"State/Province"}),e.jsx(ne,{id:"state",...h.register("state"),disabled:o})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"zip_code",children:"Zip/Postal Code"}),e.jsx(ne,{id:"zip_code",...h.register("zip_code"),disabled:o})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"country",children:"Country"}),e.jsx(ne,{id:"country",...h.register("country"),disabled:o})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(bt,{id:"is_main_location",checked:h.watch("is_main_location"),onCheckedChange:s=>h.setValue("is_main_location",s),disabled:o}),e.jsx(G,{htmlFor:"is_main_location",children:"Set as Main Location"})]}),e.jsxs(ee,{type:"submit",disabled:o,children:[o&&e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Location"]})]})]})},Wy=({companyId:n})=>{const a=Ye(),{toast:t}=Ke(),{profile:r,isLoading:i}=Ie(),[l,c]=T.useState(!1),[m,u]=T.useState(null),[h,p]=T.useState(!1),[d,o]=T.useState(null),s=r==null?void 0:r.role,{data:g,isLoading:v,isError:x}=je({queryKey:["companyLocations",n],queryFn:async()=>{if(!n)return[];const{data:C,error:D}=await X.from("company_locations").select("*").eq("company_id",n).order("is_main_location",{ascending:!1}).order("name",{ascending:!0});if(D)throw D;return C},enabled:!!n&&!i}),y=Oe({mutationFn:async C=>{if(!n)throw new Error("Company ID not found.");if(s==="admin"&&n!==(r==null?void 0:r.company_id))throw new Error("Access Denied: You can only delete locations from your own company.");const{error:D}=await X.from("company_locations").delete().eq("id",C).eq("company_id",n);if(D)throw D;return null},onSuccess:()=>{a.invalidateQueries({queryKey:["companyLocations",n]}),t({title:"Location Deleted",description:"Company location has been successfully deleted."}),p(!1),o(null)},onError:C=>{t({title:"Error deleting location",description:C.message||"An unexpected error occurred.",variant:"destructive"})}}),f=()=>{u(null),c(!0)},_=C=>{u(C),c(!0)},b=C=>{o(C),p(!0)},E=()=>{d&&y.mutate(d.id)},N=y.isPending,j=s&&(s==="super-admin"||s==="admin"&&n===(r==null?void 0:r.company_id));return i||v?e.jsxs("div",{className:"flex flex-1 items-center justify-center",children:[e.jsx(fe,{className:"h-8 w-8 animate-spin"}),e.jsx("p",{className:"ml-2",children:"Loading locations..."})]}):x?e.jsx("div",{className:"flex flex-1 items-center justify-center text-destructive",children:e.jsx("p",{children:"Error loading locations. Please try again."})}):e.jsxs(e.Fragment,{children:[e.jsxs(we,{children:[e.jsxs(Ae,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(Ee,{className:"text-lg",children:"Company Locations"}),j&&e.jsxs(vt,{open:l,onOpenChange:c,children:[e.jsx(ir,{asChild:!0,children:e.jsxs(ee,{size:"sm",onClick:f,children:[e.jsx(Kt,{className:"mr-2 h-4 w-4"})," Add Location"]})}),e.jsx(Vy,{isOpen:l,onOpenChange:c,editingLocation:m,companyId:n})]})]}),e.jsx(ke,{children:e.jsxs(Ct,{children:[e.jsx(At,{children:e.jsxs(Me,{children:[e.jsx(be,{children:"Name"}),e.jsx(be,{children:"Address"}),e.jsx(be,{children:"City"}),e.jsx(be,{children:"State"}),e.jsx(be,{children:"Country"}),e.jsx(be,{children:"Main"}),j&&e.jsx(be,{className:"text-right",children:"Actions"})]})}),e.jsx(Pt,{children:(g==null?void 0:g.length)===0?e.jsx(Me,{children:e.jsx(ve,{colSpan:j?7:6,className:"text-center text-muted-foreground",children:"No locations defined for your company."})}):g==null?void 0:g.map(C=>e.jsxs(Me,{children:[e.jsxs(ve,{className:"font-medium flex items-center gap-2",children:[C.is_main_location&&e.jsx(Yu,{className:"h-4 w-4 text-primary"}),C.name]}),e.jsx(ve,{children:C.address||"N/A"}),e.jsx(ve,{children:C.city||"N/A"}),e.jsx(ve,{children:C.state||"N/A"}),e.jsx(ve,{children:C.country||"N/A"}),e.jsx(ve,{children:C.is_main_location?"Yes":"No"}),j&&e.jsxs(ve,{className:"text-right space-x-2",children:[e.jsx(ee,{variant:"outline",size:"sm",onClick:()=>_(C),children:e.jsx(rn,{className:"h-4 w-4"})}),e.jsx(ee,{variant:"destructive",size:"sm",onClick:()=>b(C),disabled:N,children:N&&(d==null?void 0:d.id)===C.id?e.jsx(fe,{className:"h-4 w-4 animate-spin"}):e.jsx(qt,{className:"h-4 w-4"})})]})]},C.id))})]})})]}),e.jsx(an,{open:h,onOpenChange:p,children:e.jsxs(zt,{children:[e.jsxs(Bt,{children:[e.jsx($t,{children:"Are you absolutely sure?"}),e.jsxs(Ht,{children:['This action cannot be undone. This will permanently delete the location "',d==null?void 0:d.name,'".']})]}),e.jsxs(Ut,{children:[e.jsx(Wt,{disabled:N,children:"Cancel"}),e.jsxs(Vt,{onClick:E,disabled:N,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:[N?e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Delete"]})]})]})})]})},Ky=tt({name:J().min(1,"Company name is required"),domain:J().optional().nullable(),default_currency:J().min(1,"Default currency is required"),logo_file:nr().optional().nullable(),legal_name:J().optional().nullable(),tax_id:J().optional().nullable(),phone_number:J().optional().nullable(),website:J().url("Invalid URL").or(Fa("")).optional().nullable(),industry:J().optional().nullable(),address_line_1:J().optional().nullable(),address_line_2:J().optional().nullable(),city:J().optional().nullable(),state_province:J().optional().nullable(),postal_code:J().optional().nullable(),country:J().optional().nullable(),fiscal_year_end_date:Ji().nullable().optional()}),Yy=()=>{const n=Ye(),{toast:a}=Ke(),{profile:t,isLoading:r}=Ie(),[i,l]=T.useState(null),[c]=Ui(),u=c.get("companyId")||(t==null?void 0:t.company_id),h=t==null?void 0:t.role,p=h==="super-admin",{data:d,isLoading:o,isError:s}=je({queryKey:["companySettings",u],queryFn:async()=>{if(!u)return null;const{data:N,error:j}=await X.from("companies").select("*").eq("id",u).single();if(j)throw j;return N},enabled:!!u&&!r}),{data:g,isLoading:v}=je({queryKey:["currencies"],queryFn:async()=>{const{data:N,error:j}=await X.from("currencies").select("id, code, name, symbol").eq("is_active",!0).order("code");if(j)throw j;return N}}),x=ct({resolver:dt(Ky),defaultValues:{name:"",domain:"",default_currency:"USD",logo_file:null,legal_name:"",tax_id:"",phone_number:"",website:"",industry:"",address_line_1:"",address_line_2:"",city:"",state_province:"",postal_code:"",country:"",fiscal_year_end_date:void 0}});T.useEffect(()=>{d&&(x.reset({name:d.name,domain:d.domain,default_currency:d.default_currency,logo_file:null,legal_name:d.legal_name||"",tax_id:d.tax_id||"",phone_number:d.phone_number||"",website:d.website||"",industry:d.industry||"",address_line_1:d.address_line_1||"",address_line_2:d.address_line_2||"",city:d.city||"",state_province:d.state_province||"",postal_code:d.postal_code||"",country:d.country||"",fiscal_year_end_date:d.fiscal_year_end_date?new Date(d.fiscal_year_end_date):void 0}),l(null))},[d,x]);const y=Oe({mutationFn:async N=>{if(!u)throw new Error("Company ID not found.");if(h==="admin"&&u!==(t==null?void 0:t.company_id))throw new Error("Access Denied: You can only manage your own company's settings.");let j=d==null?void 0:d.logo_url;if(i){const D=i.name.split(".").pop(),k=`${u}/logo.${D}`,{error:w}=await X.storage.from("company-logos").upload(k,i,{upsert:!0});if(w)throw w;const{data:S}=X.storage.from("company-logos").getPublicUrl(k);j=S.publicUrl}else if(i===null&&(d!=null&&d.logo_url)){const D=d.logo_url.split("/public/company-logos/")[1];D&&await X.storage.from("company-logos").remove([D]),j=null}const{error:C}=await X.from("companies").update({name:N.name,domain:N.domain,default_currency:N.default_currency,logo_url:j,legal_name:N.legal_name||null,tax_id:N.tax_id||null,phone_number:N.phone_number||null,website:N.website||null,industry:N.industry||null,address_line_1:N.address_line_1||null,address_line_2:N.address_line_2||null,city:N.city||null,state_province:N.state_province||null,postal_code:N.postal_code||null,country:N.country||null,fiscal_year_end_date:N.fiscal_year_end_date?N.fiscal_year_end_date.toISOString().split("T")[0]:null,updated_at:new Date().toISOString()}).eq("id",u);if(C)throw C;return null},onSuccess:()=>{n.invalidateQueries({queryKey:["companySettings",u]}),n.invalidateQueries({queryKey:["companies"]}),n.invalidateQueries({queryKey:["companyLogo",u]}),n.invalidateQueries({queryKey:["profiles"]}),a({title:"Company Settings Saved",description:"Your company details have been successfully updated."})},onError:N=>{a({title:"Error Saving Settings",description:N.message||"An unexpected error occurred.",variant:"destructive"})}}),f=N=>{y.mutate(N)},_=r||o||v,b=y.isPending,E=h&&(p||h==="admin"&&u===(t==null?void 0:t.company_id));return _?e.jsxs("div",{className:"flex flex-1 items-center justify-center",children:[e.jsx(fe,{className:"h-8 w-8 animate-spin"}),e.jsx("p",{className:"ml-2",children:"Loading company settings..."})]}):E?s||!d?e.jsx("div",{className:"flex flex-1 items-center justify-center text-destructive",children:e.jsx("p",{children:"Error loading company details or company not found."})}):e.jsxs(dn,{defaultValue:"details",className:"w-full",children:[e.jsxs(sn,{className:"grid w-full grid-cols-4",children:[" ",e.jsx(ze,{value:"details",children:"Details"}),e.jsx(ze,{value:"locations",children:"Locations"}),e.jsx(ze,{value:"modules",disabled:!p&&u!==(t==null?void 0:t.company_id),children:"Modules"}),e.jsx(ze,{value:"notifications",children:"Notifications"})," "]}),e.jsx(Ve,{value:"details",children:e.jsxs(we,{className:"mb-6",children:[e.jsxs(Ae,{children:[e.jsxs(Ee,{className:"flex items-center gap-2",children:[e.jsx(Gr,{className:"h-5 w-5"})," Company Details"]}),e.jsx(Re,{children:"Manage your company's general information and branding."})]}),e.jsx(ke,{children:e.jsxs("form",{onSubmit:x.handleSubmit(f),className:"grid gap-6",children:[e.jsx("div",{className:"flex flex-col items-center gap-4",children:e.jsx(yd,{currentLogoUrl:d.logo_url,onFileSelected:l,isLoading:b,disabled:b})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"name",children:"Company Name"}),e.jsx(ne,{id:"name",...x.register("name"),disabled:b}),x.formState.errors.name&&e.jsx("p",{className:"text-sm text-destructive",children:x.formState.errors.name.message})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"legal_name",children:"Legal Name (Optional)"}),e.jsx(ne,{id:"legal_name",...x.register("legal_name"),disabled:b})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"domain",children:"Company Domain (Optional)"}),e.jsx(ne,{id:"domain",...x.register("domain"),disabled:b})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"tax_id",children:"Tax ID / VAT Number (Optional)"}),e.jsx(ne,{id:"tax_id",...x.register("tax_id"),disabled:b})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"phone_number",children:"Phone Number (Optional)"}),e.jsx(ne,{id:"phone_number",...x.register("phone_number"),disabled:b})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"website",children:"Website (Optional)"}),e.jsx(ne,{id:"website",type:"url",...x.register("website"),disabled:b}),x.formState.errors.website&&e.jsx("p",{className:"text-sm text-destructive",children:x.formState.errors.website.message})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"industry",children:"Industry (Optional)"}),e.jsx(ne,{id:"industry",...x.register("industry"),disabled:b})]})]}),e.jsx(lt,{className:"my-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Primary Address (Optional)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"address_line_1",children:"Address Line 1"}),e.jsx(ne,{id:"address_line_1",...x.register("address_line_1"),disabled:b})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"address_line_2",children:"Address Line 2 (Optional)"}),e.jsx(ne,{id:"address_line_2",...x.register("address_line_2"),disabled:b})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"city",children:"City"}),e.jsx(ne,{id:"city",...x.register("city"),disabled:b})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"state_province",children:"State/Province"}),e.jsx(ne,{id:"state_province",...x.register("state_province"),disabled:b})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"postal_code",children:"Zip/Postal Code"}),e.jsx(ne,{id:"postal_code",...x.register("postal_code"),disabled:b})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"country",children:"Country"}),e.jsx(ne,{id:"country",...x.register("country"),disabled:b})]})]}),e.jsx(lt,{className:"my-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Financial Settings"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"default_currency",children:"Default Currency"}),e.jsxs(Je,{onValueChange:N=>x.setValue("default_currency",N),value:x.watch("default_currency"),disabled:b,children:[e.jsx(Qe,{children:e.jsx(et,{placeholder:"Select a currency"})}),e.jsx(Xe,{children:g==null?void 0:g.map(N=>e.jsxs(Ue,{value:N.code,children:[N.code," - ",N.name," (",N.symbol,")"]},N.code))})]}),x.formState.errors.default_currency&&e.jsx("p",{className:"text-sm text-destructive",children:x.formState.errors.default_currency.message})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"fiscal_year_end_date",children:"Fiscal Year End Date"}),e.jsxs(ms,{children:[e.jsx(ps,{asChild:!0,children:e.jsxs(ee,{variant:"outline",className:pe("w-full justify-start text-left font-normal",!x.watch("fiscal_year_end_date")&&"text-muted-foreground"),disabled:b,children:[e.jsx(Zi,{className:"mr-2 h-4 w-4"}),x.watch("fiscal_year_end_date")?at(x.watch("fiscal_year_end_date"),"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(Ha,{className:"w-auto p-0",children:e.jsx($a,{mode:"single",selected:x.watch("fiscal_year_end_date")||void 0,onSelect:N=>x.setValue("fiscal_year_end_date",N||null),initialFocus:!0})})]}),x.formState.errors.fiscal_year_end_date&&e.jsx("p",{className:"text-sm text-destructive",children:x.formState.errors.fiscal_year_end_date.message})]})]}),e.jsxs(ee,{type:"submit",disabled:b,children:[b?e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(pn,{className:"mr-2 h-4 w-4"}),"Save Company Details"]})]})})]})}),e.jsx(Ve,{value:"locations",children:u?e.jsx(Wy,{companyId:u}):e.jsx("div",{className:"flex flex-1 items-center justify-center text-muted-foreground py-8",children:"Select a company to manage its locations."})}),e.jsx(Ve,{value:"modules",children:u?e.jsx(wc,{companyId:u}):e.jsx("div",{className:"flex flex-1 items-center justify-center text-muted-foreground py-8",children:"Select a company to manage its modules."})}),e.jsxs(Ve,{value:"notifications",children:[" ",u?e.jsx(xd,{}):e.jsx("div",{className:"flex flex-1 items-center justify-center text-muted-foreground py-8",children:"Select a company to manage its notification settings."})]})]}):e.jsx("div",{className:"flex flex-1 items-center justify-center text-destructive",children:e.jsx("p",{children:"Access Denied: You do not have permission to manage these company settings."})})},Gy=tt({billing_currency_code:J().min(1,"Billing currency is required")}),Zy=()=>{const n=Ye(),{toast:a}=Ke(),{profile:t,isLoading:r}=Ie(),i=(t==null?void 0:t.role)==="super-admin",{data:l,isLoading:c,isError:m}=je({queryKey:["systemBillingSettings"],queryFn:async()=>{if(!i)return null;const{data:s,error:g}=await X.from("system_billing_settings").select("*").single();if(g&&g.code!=="PGRST116")throw g;return s},enabled:i}),{data:u,isLoading:h}=je({queryKey:["currencies"],queryFn:async()=>{const{data:s,error:g}=await X.from("currencies").select("id, code, name, symbol").eq("is_active",!0).order("code");if(g)throw g;return s}}),p=ct({resolver:dt(Gy),defaultValues:{billing_currency_code:"USD"}});T.useEffect(()=>{l&&p.reset({billing_currency_code:l.billing_currency_code})},[l,p]);const d=Oe({mutationFn:async s=>{if(!i)throw new Error("Only Super Admins can configure system billing settings.");const{data:g,error:v}=await X.functions.invoke("upsert-system-billing-settings",{body:{billing_currency_code:s.billing_currency_code}});if(v)throw v;return g},onSuccess:()=>{n.invalidateQueries({queryKey:["systemBillingSettings"]}),a({title:"Billing Settings Saved",description:"System billing currency has been updated successfully."})},onError:s=>{a({title:"Error Saving Settings",description:s.message||"An unexpected error occurred while saving system billing settings.",variant:"destructive"})}}),o=s=>{d.mutate(s)};return r||c||h?e.jsxs("div",{className:"flex flex-1 items-center justify-center",children:[e.jsx(fe,{className:"h-8 w-8 animate-spin"}),e.jsx("p",{className:"ml-2",children:"Loading system billing settings..."})]}):i?m?e.jsx("div",{className:"flex flex-1 items-center justify-center text-destructive",children:e.jsx("p",{children:"Error loading system billing settings. Please try again."})}):e.jsxs(we,{className:"max-w-2xl mx-auto",children:[e.jsxs(Ae,{children:[e.jsxs(Ee,{className:"flex items-center gap-2",children:[e.jsx(Zl,{className:"h-5 w-5"})," System Billing Settings"]}),e.jsx(Re,{children:"Configure the default currency used for billing companies on the platform."})]}),e.jsx(ke,{children:e.jsxs("form",{onSubmit:p.handleSubmit(o),className:"grid gap-6",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"billing_currency_code",children:"Default Billing Currency"}),e.jsxs(Je,{onValueChange:s=>p.setValue("billing_currency_code",s),value:p.watch("billing_currency_code"),disabled:d.isPending,children:[e.jsx(Qe,{id:"billing_currency_code",children:e.jsx(et,{placeholder:"Select default billing currency"})}),e.jsx(Xe,{children:u==null?void 0:u.map(s=>e.jsxs(Ue,{value:s.code,children:[s.code," - ",s.name," (",s.symbol,")"]},s.code))})]}),p.formState.errors.billing_currency_code&&e.jsx("p",{className:"text-sm text-destructive",children:p.formState.errors.billing_currency_code.message})]}),e.jsxs(ee,{type:"submit",disabled:d.isPending,className:"mt-4",children:[d.isPending?e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(pn,{className:"mr-2 h-4 w-4"}),"Save Settings"]})]})})]}):e.jsx("div",{className:"flex flex-1 items-center justify-center text-destructive",children:e.jsx("p",{children:"Access Denied: Only Super Admins can manage system billing settings."})})},Qy=()=>{const{profile:n,isLoading:a}=Ie(),t=n==null?void 0:n.company_id,r=n==null?void 0:n.role,i=r&&(r==="super-admin"||r==="admin"||r==="controller");return a?e.jsxs("div",{className:"flex flex-1 items-center justify-center",children:[e.jsx(fe,{className:"h-8 w-8 animate-spin"}),e.jsx("p",{className:"ml-2",children:"Loading process automation module..."})]}):i?t?e.jsxs(we,{children:[e.jsxs(Ae,{children:[e.jsxs(Ee,{className:"flex items-center gap-2",children:[e.jsx(Ei,{className:"h-5 w-5"})," Process Automation"]}),e.jsx(Re,{children:"Automate tasks and notifications based on triggers and scheduled events."})]}),e.jsx(ke,{children:e.jsx(vd,{companyId:t})})]}):e.jsx("div",{className:"flex flex-1 items-center justify-center text-destructive",children:e.jsx("p",{children:"Error: Company ID not found for Process Automation. Please ensure your profile is linked to a company."})}):e.jsx("div",{className:"flex flex-1 items-center justify-center text-destructive",children:e.jsx("p",{children:"Access Denied: You do not have permission to access Process Automation."})})},Ge=(n,a)=>Math.random()*(a-n)+n,Co=(n,a)=>Math.floor(Ge(n,a)),Xy=()=>[{name:"Travel",amount:Ge(500,2e3)},{name:"Office Supplies",amount:Ge(200,800)},{name:"Software Subscriptions",amount:Ge(1e3,3e3)},{name:"Marketing",amount:Ge(300,1500)},{name:"Utilities",amount:Ge(100,500)},{name:"Meals & Entertainment",amount:Ge(400,1200)}].sort((n,a)=>a.amount-n.amount),Jy=(n=6)=>{const a=new Date,t=Ql(a,n-1);return Xl({start:t,end:a}).map(i=>({month:at(i,"MMM yy"),expenses:Ge(5e3,15e3)}))},eb=(n=6)=>{const a=new Date,t=Ql(a,n-1);return Xl({start:t,end:a}).map(i=>({month:at(i,"MMM yy"),revenue:Ge(2e4,5e4)}))},tb=()=>[{vendor:"Cloud Services Inc.",spend:Ge(3e3,8e3)},{vendor:"Office Depot",spend:Ge(1e3,2500)},{vendor:"Marketing Agency X",spend:Ge(2e3,6e3)},{vendor:"Travel Solutions",spend:Ge(1500,4e3)},{vendor:"Utility Co.",spend:Ge(500,1500)}].sort((n,a)=>a.spend-n.spend),nb=()=>[{customer:"Acme Corp",sales:Ge(1e4,3e4)},{customer:"Globex Inc.",sales:Ge(8e3,25e3)},{customer:"Soylent Corp",sales:Ge(5e3,15e3)},{customer:"Initech",sales:Ge(3e3,1e4)},{customer:"Umbrella Corp",sales:Ge(2e3,8e3)}].sort((n,a)=>a.sales-n.sales),rb=()=>[{label:"Current",amount:Ge(15e3,4e4)},{label:"1-30 Days Overdue",amount:Ge(5e3,15e3)},{label:"31-60 Days Overdue",amount:Ge(2e3,8e3)},{label:"61-90 Days Overdue",amount:Ge(1e3,5e3)},{label:"90+ Days Overdue",amount:Ge(500,3e3)}],ab=()=>[{label:"Current",amount:Ge(1e4,3e4)},{label:"1-30 Days Overdue",amount:Ge(3e3,1e4)},{label:"31-60 Days Overdue",amount:Ge(1e3,5e3)},{label:"61-90 Days Overdue",amount:Ge(500,2e3)},{label:"90+ Days Overdue",amount:Ge(100,1e3)}],ib=()=>[{label:"Total Revenue (MTD)",value:Ge(15e3,3e4),unit:"$",trend:"up"},{label:"Total Expenses (MTD)",value:Ge(5e3,1e4),unit:"$",trend:"down"},{label:"Profit Margin",value:Ge(20,40),unit:"%",trend:"up"},{label:"Open Invoices",value:Co(10,50),trend:"stable"},{label:"Overdue Bills",value:Co(2,15),trend:"up"}],_s=({title:n,description:a,isLoading:t=!1,children:r,className:i,...l})=>e.jsxs(we,{className:pe("flex flex-col",i),...l,children:[e.jsxs(Ae,{className:"pb-2",children:[e.jsx(Ee,{className:"text-lg",children:n}),a&&e.jsx(Re,{children:a})]}),e.jsx(ke,{className:"flex-1 flex items-center justify-center p-4",children:t?e.jsxs("div",{className:"flex flex-col items-center gap-2 text-muted-foreground",children:[e.jsx(fe,{className:"h-6 w-6 animate-spin"}),e.jsx("p",{children:"Loading data..."})]}):r})]}),Ao=({title:n,description:a,data:t,dataKey:r,categoryKey:i,currencyCode:l="USD",isLoading:c})=>{const[m,u]=T.useState([]);T.useEffect(()=>{(async()=>{const d=await Promise.all(t.map(async o=>({...o,[r]:o[r],[`${r}Formatted`]:await Dn(o[r],l)})));u(d)})()},[t,r,l]);const h=({active:p,payload:d,label:o})=>{if(p&&d&&d.length){const s=d[0].payload[`${r}Formatted`];return e.jsx("div",{className:"rounded-lg border bg-background p-2 text-sm shadow-sm",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"text-muted-foreground",children:[i,":"]}),e.jsx("div",{children:o}),e.jsxs("div",{className:"text-muted-foreground",children:[r,":"]}),e.jsx("div",{children:s})]})})}return null};return e.jsx(_s,{title:n,description:a,isLoading:c,children:m.length>0?e.jsx(ec,{width:"100%",height:250,children:e.jsxs(pm,{data:m,margin:{top:5,right:10,left:10,bottom:5},children:[e.jsx(tc,{strokeDasharray:"3 3",stroke:"hsl(var(--muted))"}),e.jsx(nc,{dataKey:i,stroke:"hsl(var(--foreground))",fontSize:12,tickLine:!1,axisLine:!1}),e.jsx(rc,{stroke:"hsl(var(--foreground))",fontSize:12,tickLine:!1,axisLine:!1,tickFormatter:p=>p.toLocaleString("en-US",{maximumFractionDigits:0})}),e.jsx(ac,{content:e.jsx(h,{})}),e.jsx(fm,{type:"monotone",dataKey:r,stroke:"hsl(var(--brand-accent))",strokeWidth:2,dot:{r:4},activeDot:{r:6}})]})}):e.jsx("p",{className:"text-muted-foreground",children:"No data available."})})},Rr=({title:n,description:a,data:t,dataKey:r,categoryKey:i,currencyCode:l="USD",isLoading:c})=>{const[m,u]=T.useState([]);T.useEffect(()=>{(async()=>{const d=await Promise.all(t.map(async o=>({...o,[r]:o[r],[`${r}Formatted`]:await Dn(o[r],l)})));u(d)})()},[t,r,l]);const h=({active:p,payload:d,label:o})=>{if(p&&d&&d.length){const s=d[0].payload[`${r}Formatted`];return e.jsx("div",{className:"rounded-lg border bg-background p-2 text-sm shadow-sm",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"text-muted-foreground",children:[i,":"]}),e.jsx("div",{children:o}),e.jsxs("div",{className:"text-muted-foreground",children:[r,":"]}),e.jsx("div",{children:s})]})})}return null};return e.jsx(_s,{title:n,description:a,isLoading:c,children:m.length>0?e.jsx(ec,{width:"100%",height:250,children:e.jsxs(hm,{data:m,margin:{top:5,right:10,left:10,bottom:5},children:[e.jsx(tc,{strokeDasharray:"3 3",stroke:"hsl(var(--muted))"}),e.jsx(nc,{dataKey:i,stroke:"hsl(var(--foreground))",fontSize:12,tickLine:!1,axisLine:!1}),e.jsx(rc,{stroke:"hsl(var(--foreground))",fontSize:12,tickLine:!1,axisLine:!1,tickFormatter:p=>p.toLocaleString("en-US",{maximumFractionDigits:0})}),e.jsx(ac,{content:e.jsx(h,{})}),e.jsx(gm,{dataKey:r,fill:"hsl(var(--brand-accent))",radius:[4,4,0,0]})]})}):e.jsx("p",{className:"text-muted-foreground",children:"No data available."})})},sb=()=>{const{profile:n,isLoading:a}=Ie(),t=n==null?void 0:n.role,r="USD",[i]=T.useState(ib()),[l]=T.useState(Xy()),[c]=T.useState(Jy()),[m]=T.useState(eb()),[u]=T.useState(tb()),[h]=T.useState(nb()),[p]=T.useState(rb()),[d]=T.useState(ab());return a?e.jsxs("div",{className:"flex flex-1 items-center justify-center",children:[e.jsx(fe,{className:"h-8 w-8 animate-spin"}),e.jsx("p",{className:"ml-2",children:"Loading dashboard..."})]}):!t||!["admin","controller","super-admin"].includes(t)?e.jsx("div",{className:"flex flex-1 items-center justify-center rounded-lg border border-dashed shadow-sm p-4",children:e.jsxs("div",{className:"flex flex-col items-center gap-1 text-center",children:[e.jsx("h3",{className:"text-2xl font-bold tracking-tight",children:"Welcome to INFOtrac!"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Select a module from the sidebar to get started."})]})}):e.jsxs("div",{className:"grid gap-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-2xl font-bold tracking-tight flex items-center gap-2",children:[e.jsx(Jl,{className:"h-6 w-6"})," Dashboard Overview"]}),e.jsxs(ee,{variant:"outline",children:[e.jsx(Tt,{className:"mr-2 h-4 w-4"})," Smart Add Chart"]})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5",children:i.map((o,s)=>e.jsx(_s,{title:o.label,description:o.unit==="$"?"Month-to-Date":void 0,children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("p",{className:"text-3xl font-bold",children:o.unit==="$"?e.jsx(xn,{amount:o.value,currencyCode:r}):`${o.value.toFixed(0)}${o.unit||""}`}),o.trend&&e.jsxs("div",{className:`flex items-center text-sm mt-1 ${o.trend==="up"?"text-green-500":o.trend==="down"?"text-red-500":"text-muted-foreground"}`,children:[e.jsx(Gu,{className:`h-4 w-4 mr-1 ${o.trend==="down"?"rotate-180":""}`}),o.trend.charAt(0).toUpperCase()+o.trend.slice(1)]})]})},s))}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsx(Ao,{title:"Monthly Expenses",description:"Total expenses over the last 6 months",data:c,dataKey:"expenses",categoryKey:"month",currencyCode:r}),e.jsx(Ao,{title:"Monthly Revenue",description:"Total revenue over the last 6 months",data:m,dataKey:"revenue",categoryKey:"month",currencyCode:r})]}),e.jsx(Rr,{title:"Expenses by Category",description:"Breakdown of expenses across different categories",data:l,dataKey:"amount",categoryKey:"name",currencyCode:r}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsx(Rr,{title:"Top Vendor Spend",description:"Highest spending with vendors",data:u,dataKey:"spend",categoryKey:"vendor",currencyCode:r}),e.jsx(Rr,{title:"Top Customer Sales",description:"Highest sales from customers",data:h,dataKey:"sales",categoryKey:"customer",currencyCode:r})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsx(Rr,{title:"Accounts Receivable Aging",description:"Outstanding customer invoices by age",data:p,dataKey:"amount",categoryKey:"label",currencyCode:r}),e.jsx(Rr,{title:"Accounts Payable Aging",description:"Outstanding vendor bills by age",data:d,dataKey:"amount",categoryKey:"label",currencyCode:r})]})]})},ob=({isOpen:n,onOpenChange:a,onSelectSuggestion:t})=>{const{profile:r,isLoading:i}=Ie(),l=(r==null?void 0:r.role)==="super-admin",{data:c,isLoading:m}=je({queryKey:["systemEmailLayoutForSuggestions"],queryFn:async()=>{if(!l)return null;const{data:s,error:g}=await X.functions.invoke("upsert-system-email-layout",{method:"GET"});if(g)throw g;return s.data},enabled:l}),{mutate:u,data:h,isPending:p,error:d}=Oe({mutationFn:async()=>{if(!l)throw new Error("Access Denied: Only Super Admins can get system template suggestions.");const{data:s,error:g}=await X.functions.invoke("suggest-system-email-templates",{body:{systemLayout:c}});if(g)throw g;return s}});T.useEffect(()=>{n&&!i&&l&&!m&&u()},[n,u,i,l,m,c]);const o=h==null?void 0:h.suggestions;return i||m?e.jsx(vt,{open:n,onOpenChange:a,children:e.jsx(ut,{className:"sm:max-w-3xl",children:e.jsxs("div",{className:"flex justify-center items-center gap-2 py-8",children:[e.jsx(fe,{className:"h-6 w-6 animate-spin"})," ",e.jsx("p",{children:"Loading suggestions..."})]})})}):e.jsx(vt,{open:n,onOpenChange:a,children:e.jsxs(ut,{className:"sm:max-w-3xl",children:[e.jsxs(_t,{children:[e.jsxs(jt,{className:"flex items-center gap-2",children:[e.jsx(Tt,{})," AI-Powered System Template Suggestions"]}),e.jsx(Et,{children:'Here are a few system email templates drafted by AI. Click "Create" to use one as a starting point.'})]}),e.jsxs("div",{className:"py-4",children:[p&&e.jsxs("div",{className:"flex justify-center items-center gap-2",children:[e.jsx(fe,{className:"h-6 w-6 animate-spin"})," ",e.jsx("p",{children:"Drafting templates..."})]}),d&&e.jsxs("p",{className:"text-destructive",children:["Error: ",d.message]}),o&&Array.isArray(o)&&e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:o.map((s,g)=>e.jsxs(we,{className:"flex flex-col",children:[e.jsxs(Ae,{children:[e.jsx(Ee,{className:"text-lg",children:s.name}),e.jsxs("p",{className:"text-sm text-muted-foreground pt-1",children:["Subject: ",s.subject]})]}),e.jsx(ke,{className:"flex-grow",children:e.jsx("div",{className:"text-sm border p-2 rounded-md h-32 overflow-y-auto bg-background",dangerouslySetInnerHTML:{__html:s.body}})}),e.jsx(qa,{children:e.jsxs(ee,{onClick:()=>t(s),className:"w-full",children:[e.jsx(Kt,{className:"mr-2 h-4 w-4"})," Create from this suggestion"]})})]},g))}),o&&!Array.isArray(o)&&e.jsx("p",{className:"text-destructive",children:"Error: Invalid suggestions format received from AI."})]})]})})},lb=tt({sender_email:J().email("Invalid email address").min(1,"Sender email is required"),smtp_host:gt(n=>n===""?null:n,J().nullable().optional()),smtp_port:gt(n=>{if(n===""||n===null||n===void 0)return null;const a=Number(n);return isNaN(a)?null:a},yt().int().positive("Port must be a positive integer").nullable().optional()),smtp_username:gt(n=>n===""?null:n,J().nullable().optional()),smtp_password:J().optional().nullable(),email_api_key:J().optional().nullable()}).superRefine((n,a)=>{n.email_api_key&&n.email_api_key.trim()!==""||n.smtp_host&&n.smtp_host.trim()!==""&&((n.smtp_port===null||n.smtp_port===void 0)&&a.addIssue({code:Xt.custom,message:"SMTP Port is required when SMTP Host is provided.",path:["smtp_port"]}),(n.smtp_username===null||n.smtp_username===void 0||n.smtp_username.trim()==="")&&a.addIssue({code:Xt.custom,message:"SMTP Username is required when SMTP Host is provided.",path:["smtp_username"]}))}),cb=tt({name:J().min(1,"Template name is required"),subject:J().min(1,"Subject is required"),body:J().min(1,"Email body is required"),description:J().optional().nullable()}),db=tt({header_html:J().optional().nullable(),footer_html:J().optional().nullable(),default_logo_url:J().optional().nullable().refine(n=>n?J().url().safeParse(n).success||n.startsWith("/"):!0,{message:"Must be a valid absolute URL (http/https) or a root-relative path (starts with /)"}),default_company_name:J().optional().nullable(),default_logo_width:gt(n=>n===""?null:Number(n),yt().int().positive("Width must be a positive integer").nullable().optional()),default_logo_height:gt(n=>n===""?null:Number(n),yt().int().positive("Height must be a positive integer").nullable().optional())}),ub=tt({recipient_email:J().email("Invalid email address").min(1,"Recipient email is required"),subject:J().min(1,"Subject is required"),body:J().optional(),use_template:St().default(!1),template_name:J().optional(),template_variables:J().optional().nullable()}),mb=[{name:"Global: Current Year",variable:"<% year %>",description:"The current year (e.g., 2024)"},{name:"Global: Public Web URL",variable:"<% public_web_url %>",description:"The base URL of the application"},{name:"Global: Default Logo URL",variable:"<% logo_url %>",description:"The system's default logo image URL"},{name:"Global: Default Logo Width",variable:"<% logo_width %>",description:"The system's default logo width in pixels"},{name:"Global: Default Logo Height",variable:"<% logo_height %>",description:"The system's default logo height in pixels"},{name:"Global: Default Company Name",variable:"<% company_name %>",description:"The system's default company name"},{name:"User: Inviter Name",variable:"<% inviter_name %>",description:"Full name of the user who sent an invitation"},{name:"User: Invited Role",variable:"<% invited_role %>",description:"The role assigned to the invited user"},{name:"User: Invitation Link",variable:"<% invitation_link %>",description:"The unique link to accept an invitation"},{name:"User: New User Name",variable:"<% new_user_name %>",description:"Full name of the newly created user"},{name:"User: New User Email",variable:"<% new_user_email %>",description:"Email of the newly created user"},{name:"User: Admin Name",variable:"<% admin_name %>",description:"Full name of the administrator"},{name:"User: Admin Email",variable:"<% admin_email %>",description:"Email of the administrator"},{name:"User: Target User Name",variable:"<% target_user_name %>",description:"Full name of the user whose status/access was updated"},{name:"User: Target User Email",variable:"<% target_user_email %>",description:"Email of the user whose status/access was updated"},{name:"User: New Status",variable:"<% new_status %>",description:"The new status of a user account (e.g., Active, Inactive)"},{name:"User: Users Link",variable:"<% users_link %>",description:"Link to the user management page"},{name:"Module: Name",variable:"<% module_name %>",description:"Name of the module (e.g., Expense Management)"},{name:"Module: Access Status",variable:"<% access_status %>",description:"Access status of a module (e.g., Enabled, Disabled)"},{name:"Module: Modules Link",variable:"<% modules_link %>",description:"Link to the company modules overview page"},{name:"Expense: Title",variable:"<% expense_title %>",description:"Title of the expense"},{name:"Expense: Amount",variable:"<% expense_amount %>",description:"Formatted amount of the expense"},{name:"Expense: Status",variable:"<% expense_status %>",description:"Status of the expense (e.g., Submitted, Approved)"},{name:"Expense: Link",variable:"<% expense_link %>",description:"Link to the expense detail page"},{name:"Report: Subject",variable:"<% report_subject %>",description:"Subject of the generated report"},{name:"Report: Content",variable:"<% report_content %>",description:"Content of the generated report (HTML or plain text)"}],pb=()=>{const n=Ye(),{toast:a}=Ke(),{profile:t,isLoading:r}=Ie(),i=(t==null?void 0:t.role)==="super-admin",[l,c]=T.useState(!1),[m,u]=T.useState(!1),[h,p]=T.useState(null),[d,o]=T.useState(!1),[s,g]=T.useState(null),[v,x]=T.useState(null),[y,f]=T.useState(!1),{data:_,isLoading:b}=je({queryKey:["smtpSettings"],queryFn:async()=>{if(!i)return null;const{data:oe,error:Le}=await X.from("smtp_settings").select("*").single();if(Le&&Le.code!=="PGRST116")throw Le;return oe},enabled:i}),{data:E,isLoading:N}=je({queryKey:["resendApiKeyStatus"],queryFn:async()=>{if(!i)return{isResendApiKeySet:!1};const{data:oe,error:Le}=await X.functions.invoke("check-resend-api-key");if(Le)throw Le;return oe},enabled:i}),{data:j,isLoading:C}=je({queryKey:["emailTemplates"],queryFn:async()=>{if(!i)return[];const{data:oe,error:Le}=await X.from("email_templates").select("*").order("name",{ascending:!0});if(Le)throw Le;return oe},enabled:i}),{data:D,isLoading:k}=je({queryKey:["systemEmailLayout"],queryFn:async()=>{if(!i)return null;const{data:oe,error:Le}=await X.functions.invoke("upsert-system-email-layout",{method:"GET"});if(Le)throw Le;return oe.data},enabled:i}),w=ct({resolver:dt(lb),defaultValues:{sender_email:"",smtp_host:"",smtp_port:void 0,smtp_username:"",smtp_password:"",email_api_key:""}});T.useEffect(()=>{_&&w.reset({sender_email:_.sender_email,smtp_host:_.smtp_host||"",smtp_port:_.smtp_port||void 0,smtp_username:_.smtp_username||"",smtp_password:"",email_api_key:""})},[_,w]);const S=Oe({mutationFn:async oe=>{if(!i)throw new Error("Access Denied: Only Super Admins can configure SMTP settings.");const Le={sender_email:oe.sender_email,smtp_host:oe.smtp_host||null,smtp_port:oe.smtp_port||null,smtp_username:oe.smtp_username||null,...oe.smtp_password&&{smtp_password:oe.smtp_password},...oe.email_api_key&&{email_api_key:oe.email_api_key}},{data:nt,error:wt}=await X.functions.invoke("upsert-smtp-settings",{body:Le});if(wt)throw wt;return nt},onSuccess:()=>{n.invalidateQueries({queryKey:["smtpSettings"]}),n.invalidateQueries({queryKey:["resendApiKeyStatus"]}),a({title:"Email Settings Saved",description:"System email sending settings have been updated."}),w.setValue("smtp_password",""),w.setValue("email_api_key","")},onError:oe=>{a({title:"Error Saving Settings",description:oe.message,variant:"destructive"})}}),P=oe=>{S.mutate(oe)},O=ct({resolver:dt(cb),defaultValues:{name:"",subject:"",body:`
        <p>Hello,</p>
        <p>This is a system notification from <% company_name %>.</p>
        <p>You can customize this template using the variables listed on the right.</p>
        <p>Best regards,<br><% company_name %></p>
      `,description:""}});T.useEffect(()=>{l&&h?O.reset({name:h.name,subject:h.subject,body:h.body,description:h.description||""}):l||O.reset({name:"",subject:"",body:`
          <p>Hello,</p>
          <p>This is a system notification from <% company_name %>.</p>
          <p>You can customize this template using the variables listed on the right.</p>
          <p>Best regards,<br><% company_name %></p>
        `,description:""}),x(null)},[l,h,O]);const L=Oe({mutationFn:async oe=>{if(!i)throw new Error("Only Super Admins can manage email templates.");if(h){const{error:Le}=await X.from("email_templates").update({...oe,updated_at:new Date().toISOString()}).eq("id",h.id);if(Le)throw Le}else{const{error:Le}=await X.from("email_templates").insert(oe);if(Le)throw Le}return null},onSuccess:()=>{n.invalidateQueries({queryKey:["emailTemplates"]}),a({title:"Template Saved",description:"Email template has been successfully saved."}),c(!1)},onError:oe=>{a({title:"Error Saving Template",description:oe.message,variant:"destructive"})}}),$=Oe({mutationFn:async oe=>{if(!i)throw new Error("Only Super Admins can manage email templates.");const{error:Le}=await X.from("email_templates").delete().eq("id",oe);if(Le)throw Le;return null},onSuccess:()=>{n.invalidateQueries({queryKey:["emailTemplates"]}),a({title:"Template Deleted",description:"Email template has been deleted."}),o(!1),g(null)},onError:oe=>{a({title:"Error Deleting Template",description:oe.message,variant:"destructive"})}}),B=oe=>{L.mutate(oe)},Y=()=>{p(null),O.reset(),c(!0)},U=oe=>{p(oe),c(!0)},q=oe=>{g(oe),o(!0)},R=()=>{s&&$.mutate(s.id)},F=oe=>{p(null),O.reset({name:oe.name,subject:oe.subject,body:oe.body,description:`AI-suggested template for: ${oe.name}`}),u(!1),c(!0)},M=(oe,Le)=>{O.setValue("subject",oe,{shouldDirty:!0}),O.setValue("body",Le,{shouldDirty:!0}),a({title:"AI Redesign Applied",description:"The template has been updated with AI's suggestions. Review and save."})},z=ct({resolver:dt(db),defaultValues:{header_html:"",footer_html:"",default_logo_url:"",default_company_name:"",default_logo_width:void 0,default_logo_height:void 0}});T.useEffect(()=>{D&&z.reset({header_html:D.header_html||"",footer_html:D.footer_html||"",default_logo_url:D.default_logo_url||"",default_company_name:D.default_company_name||"",default_logo_width:D.default_logo_width||void 0,default_logo_height:D.default_logo_height||void 0})},[D,z]);const H=Oe({mutationFn:async oe=>{if(!i)throw new Error("Access Denied: Only Super Admins can manage system email layout.");const Le={header_html:oe.header_html||null,footer_html:oe.footer_html||null,default_logo_url:oe.default_logo_url||null,default_company_name:oe.default_company_name||null,default_logo_width:oe.default_logo_width||null,default_logo_height:oe.default_logo_height||null},{data:nt,error:wt}=await X.functions.invoke("upsert-system-email-layout",{method:"POST",body:Le});if(wt)throw wt;return nt},onSuccess:()=>{n.invalidateQueries({queryKey:["systemEmailLayout"]}),a({title:"Layout Saved",description:"System email layout has been updated successfully."})},onError:oe=>{a({title:"Error Saving Layout",description:oe.message,variant:"destructive"})}}),I=oe=>{H.mutate(oe)},A=ct({resolver:dt(ub),defaultValues:{recipient_email:"",subject:"",body:"",use_template:!1,template_name:"",template_variables:`{
  "user_name": "John Doe",
  "expense_title": "Client Lunch",
  "expense_status": "Approved",
  "expense_link": "https://example.com/expenses/123",
  "admin_name": "Jane Smith",
  "company_name": "Your Company",
  "year": 2024
}`}}),V=Oe({mutationFn:async oe=>{if(!i)throw new Error("Access Denied: Only Super Admins can send system test emails.");let Le={};if(oe.use_template&&oe.template_variables)try{Le=JSON.parse(oe.template_variables)}catch{throw new Error("Invalid JSON for template variables.")}const nt={recipient_email:oe.recipient_email,subject:oe.subject,body:oe.body,...oe.use_template&&{template_name:oe.template_name,template_variables:Le}},{data:wt,error:_n}=await X.functions.invoke("send-email",{body:nt});if(_n)throw _n;return wt},onSuccess:oe=>{a({title:"Test Email Sent",description:oe.message||"Test email simulated successfully."})},onError:oe=>{a({title:"Error Sending Test Email",description:oe.message,variant:"destructive"})}}),K=oe=>{V.mutate(oe)},Q=A.watch("use_template"),de=A.watch("template_name");T.useEffect(()=>{if(Q&&de&&j){const oe=j.find(Le=>Le.name===de);oe&&(A.setValue("subject",oe.subject),A.setValue("body",oe.body))}else Q||(A.setValue("subject",""),A.setValue("body",""))},[Q,de,j,A]);const xe=r||b||N||C||k,Z=S.isPending,re=L.isPending||$.isPending,ye=H.isPending,Se=V.isPending;let De="Simulated (No API Key)",te=e.jsx(Ft,{className:"h-5 w-5 text-destructive"}),se="text-destructive",ge=(_==null?void 0:_.sender_email)||"noreply@example.com";E!=null&&E.isResendApiKeySet?(De="Resend API (System-wide)",te=e.jsx(ua,{className:"h-5 w-5 text-green-500"}),se="text-green-500"):_!=null&&_.smtp_host&&(_!=null&&_.smtp_username)&&(_!=null&&_.smtp_password_encrypted)?(De="Direct SMTP (System-wide)",te=e.jsx(ua,{className:"h-5 w-5 text-green-500"}),se="text-green-500"):_!=null&&_.email_api_key_encrypted&&(De="Email API (System-wide, configured in DB)",te=e.jsx(ua,{className:"h-5 w-5 text-green-500"}),se="text-green-500");const ce=T.useMemo(()=>{const oe=new URL(window.location.origin),Le=D==null?void 0:D.default_logo_url;let nt;try{Le?nt=new URL(Le,oe).href:nt=new URL("/infotrac-logo.png",oe).href}catch(wt){console.error("Error constructing logo_url for preview:",wt),nt=""}return{year:new Date().getFullYear(),public_web_url:window.location.origin,logo_url:nt,logo_width:(D==null?void 0:D.default_logo_width)||150,logo_height:(D==null?void 0:D.default_logo_height)||"auto",company_name:(D==null?void 0:D.default_company_name)||"INFOtrac",user_name:"John Doe",user_email:"john.doe@example.com",new_user_name:"Alice Smith",new_user_email:"alice.smith@example.com",target_user_name:"Bob Johnson",target_user_email:"bob.johnson@example.com",admin_name:"Jane Admin",admin_email:"jane.admin@example.com",inviter_name:"Charlie Brown",invited_role:"User",new_status:"Active",users_link:`${window.location.origin}/users`,invitation_link:`${window.location.origin}/accept-invite?token=dummytoken123`,module_name:"Expense Management",access_status:"Enabled",modules_link:`${window.location.origin}/company-modules-overview`,expense_title:"Client Lunch",expense_amount:"$125.50",expense_status:"Approved",expense_link:`${window.location.origin}/expenses/123`,report_subject:"Monthly Sales Report",report_content:"<p>Here is your monthly sales summary...</p>"}},[D]),le=(oe,Le)=>{const nt=oe?ht.render(oe,ce,{},["<%","%>"]):"";let wt=D!=null&&D.header_html?ht.render(D.header_html,ce,{},["<%","%>"]):ht.render(`
      <table width="100%" border="0" cellspacing="0" cellpadding="0" style="background-color: #f8f8f8; padding: 20px 0; border-bottom: 1px solid #eeeeee;">
        <tr>
          <td align="center" valign="top">
            <table border="0" cellspacing="0" cellpadding="0" width="600" style="max-width: 600px;">
              <tr>
                <td align="center" valign="top" style="padding: 0 20px;">
                  <a href="<% public_web_url %>" target="_blank" style="text-decoration: none;">
                    <img src="<% logo_url %>" alt="<% company_name %> Logo"
                         width="<% logo_width %>"
                         height="<% logo_height %>"
                         style="display: block; max-width: 100%; height: auto; border: 0; outline: none; text-decoration: none; margin: 0 auto; padding-bottom: 10px;"
                         onerror="this.onerror=null;this.src='<% public_web_url %>/infotrac-logo.png';"
                    >
                  </a>
                  <% #company_name %>
                  <p style="font-family: Arial, sans-serif; font-size: 18px; line-height: 24px; color: #2F424F; margin: 0; padding: 0;">
                    <strong><% company_name %></strong>
                  </p>
                  <% /company_name %>
                </td>
              </tr>
            </table>
          </td>
        </tr>
      </table>
    `,ce,{},["<%","%>"]),_n=D!=null&&D.footer_html?ht.render(D.footer_html,ce,{},["<%","%>"]):ht.render(`
      <div style="text-align: center; padding: 20px; font-size: 0.8em; color: #777; border-top: 1px solid #eee; margin-top: 20px;">
        &copy; <% year %> <% company_name %>. All rights reserved. <br>
        <a href="<% public_web_url %>" style="color: #2F424F;">Visit our website</a>
      </div>
    `,ce,{},["<%","%>"]);return`
      <!DOCTYPE html>
      <html lang="en">
      <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <title>${Le||"Email Preview"}</title>
          <style>
              body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; margin: 0; padding: 0; background-color: #f4f4f4; }
              .email-wrapper { max-width: 600px; margin: 20px auto; background-color: #ffffff; border: 1px solid #ddd; border-radius: 8px; overflow: hidden; }
              .email-header { padding: 20px; text-align: center; }
              .email-body { padding: 20px; }
              .email-footer { padding: 20px; text-align: center; font-size: 0.8em; color: #777; border-top: 1px solid #eee; margin-top: 20px; }
              img { max-width: 100%; height: auto; }
              a { color: #2F424F; text-decoration: none; }
              a:hover { text-decoration: underline; }
          </style>
      </head>
      <body>
          <div class="email-wrapper">
              ${wt}
              <div class="email-body">
                  ${nt}
              </div>
              ${_n}
          </div>
      </body>
      </html>
    `},Ne=O.watch("body"),ae=O.watch("subject"),ue=T.useMemo(()=>le(Ne??"",ae??""),[Ne,ae,ce,D]),_e=z.watch("header_html"),ie=z.watch("footer_html"),he=z.watch("default_logo_url"),We=z.watch("default_company_name"),Fe=z.watch("default_logo_width"),$e=z.watch("default_logo_height"),me=T.useMemo(()=>{const oe={...ce,logo_url:he||ce.logo_url,company_name:We||ce.company_name,logo_width:Fe||ce.logo_width,logo_height:$e||ce.logo_height,body_content:"<p>This is a **dummy email body** to preview your header and footer layout. It will be replaced by actual template content when an email is sent.</p><p>Example variable: User Name: <% user_name %></p>"};let Le=_e?ht.render(_e,oe,{},["<%","%>"]):ht.render(`
      <div style="text-align: center; padding: 20px; background-color: #f8f8f8; border-bottom: 1px solid #eee;">
        <img src="<% logo_url %>" alt="<% company_name %> Logo" style="max-width: <% logo_width %>px; height: <% logo_height %>; display: block; margin: 0 auto;">
      </div>
    `,oe,{},["<%","%>"]),nt=ie?ht.render(ie,oe,{},["<%","%>"]):ht.render(`
      <div style="text-align: center; padding: 20px; font-size: 0.8em; color: #777; border-top: 1px solid #eee; margin-top: 20px;">
        &copy; <% year %> <% company_name %>. All rights reserved. <br>
        <a href="<% public_web_url %>" style="color: #2F424F;">Visit our website</a>
      </div>
    `,oe,{},["<%","%>"]);return`
      <!DOCTYPE html>
      <html lang="en">
      <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <title>Layout Preview</title>
          <style>
              body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; margin: 0; padding: 0; background-color: #f4f4f4; }
              .email-wrapper { max-width: 600px; margin: 20px auto; background-color: #ffffff; border: 1px solid #ddd; border-radius: 8px; overflow: hidden; }
              .email-header { padding: 20px; text-align: center; }
              .email-body { padding: 20px; }
              .email-footer { padding: 20px; text-align: center; font-size: 0.8em; color: #777; border-top: 1px solid #eee; margin-top: 20px; }
              img { max-width: 100%; height: auto; }
              a { color: #2F424F; text-decoration: none; }
              a:hover { text-decoration: underline; }
          </style>
      </head>
      <body>
          <div class="email-wrapper">
              ${Le}
              <div class="email-body">
                  ${oe.body_content}
              </div>
              ${nt}
          </div>
      </body>
      </html>
    `},[_e,ie,he,We,Fe,$e,ce,D]),Pe=A.watch("body"),Te=A.watch("subject"),mt=T.useMemo(()=>le(Pe??"",Te??""),[Pe,Te,ce,D]);return xe?e.jsxs("div",{className:"flex flex-1 items-center justify-center",children:[e.jsx(fe,{className:"h-8 w-8 animate-spin"}),e.jsx("p",{className:"ml-2",children:"Loading system notification settings..."})]}):i?e.jsxs(we,{children:[e.jsxs(Ae,{children:[e.jsxs(Ee,{className:"flex items-center gap-2",children:[e.jsx(Ra,{className:"h-5 w-5"})," System Notification Settings"]}),e.jsx(Re,{children:"Manage global email settings, templates, layout, and send test emails for the entire platform."})]}),e.jsx(ke,{children:e.jsxs(dn,{defaultValue:"email-settings",children:[e.jsxs(sn,{className:"grid w-full grid-cols-4",children:[e.jsx(ze,{value:"email-settings",children:"Email Settings"}),e.jsx(ze,{value:"email-templates",children:"Email Templates"}),e.jsx(ze,{value:"email-layout",children:"Email Layout"}),e.jsx(ze,{value:"test-email",children:"Test Email"})]}),e.jsx(Ve,{value:"email-settings",className:"mt-4",children:e.jsxs(we,{children:[e.jsxs(Ae,{children:[e.jsxs(Ee,{className:"flex items-center gap-2",children:[e.jsx(Xi,{className:"h-5 w-5"})," SMTP & Email API Settings"]}),e.jsx(Re,{children:"Configure the email server settings for sending automated notifications. You can use either direct SMTP credentials or an API key from a transactional email service (e.g., Resend)."})]}),e.jsxs(ke,{children:[e.jsxs("div",{className:"mb-6 p-4 border rounded-lg bg-muted/50",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2 mb-2",children:[e.jsx(Zu,{className:"h-5 w-5 text-blue-500"})," Email Service Status"]}),e.jsxs("div",{className:"grid gap-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[te,e.jsxs("p",{className:`font-medium ${se}`,children:["Active Service: ",De]})]}),e.jsxs("p",{children:["Sender Email: ",e.jsx("span",{className:"font-medium",children:ge})]})]})]}),e.jsx(lt,{className:"my-6"}),e.jsxs("form",{onSubmit:w.handleSubmit(P),className:"grid gap-6",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"sender_email",children:"Sender Email Address"}),e.jsx(ne,{id:"sender_email",type:"email",placeholder:"noreply@yourdomain.com",...w.register("sender_email"),disabled:Z}),w.formState.errors.sender_email&&e.jsx("p",{className:"text-sm text-destructive",children:w.formState.errors.sender_email.message})]}),e.jsx("h3",{className:"text-lg font-semibold mt-4",children:"SMTP Credentials (Optional)"}),e.jsx("p",{className:"text-sm text-muted-foreground -mt-2",children:"Fill these if you are using a direct SMTP server. Leave blank if using an Email API Key."}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"smtp_host",children:"SMTP Host"}),e.jsx(ne,{id:"smtp_host",placeholder:"smtp.example.com",...w.register("smtp_host"),disabled:Z})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"smtp_port",children:"SMTP Port"}),e.jsx(ne,{id:"smtp_port",type:"number",placeholder:"587",...w.register("smtp_port",{valueAsNumber:!0}),disabled:Z}),w.formState.errors.smtp_port&&e.jsx("p",{className:"text-sm text-destructive",children:w.formState.errors.smtp_port.message})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"smtp_username",children:"SMTP Username"}),e.jsx(ne,{id:"smtp_username",placeholder:"your-username",...w.register("smtp_username"),disabled:Z})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"smtp_password",children:"SMTP Password (will not be displayed after saving)"}),e.jsx(ne,{id:"smtp_password",type:"password",placeholder:"Enter new password to update",...w.register("smtp_password"),disabled:Z})]}),e.jsx("h3",{className:"text-lg font-semibold mt-4",children:"Email API Key (Optional)"}),e.jsx("p",{className:"text-sm text-muted-foreground -mt-2",children:"Fill this if you are using a transactional email service API (e.g., Resend). Leave blank if using SMTP."}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"email_api_key",children:"Email API Key (will not be displayed after saving)"}),e.jsx(ne,{id:"email_api_key",type:"password",placeholder:"Enter new API key to update",...w.register("email_api_key"),disabled:Z})]}),e.jsxs(ee,{type:"submit",disabled:Z,className:"mt-4",children:[Z?e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(pn,{className:"mr-2 h-4 w-4"}),"Save Settings"]})]})]})]})}),e.jsxs(Ve,{value:"email-templates",className:"mt-4",children:[e.jsxs(we,{children:[e.jsxs(Ae,{className:"flex flex-row items-start justify-between space-y-0 pb-2",children:[e.jsxs("div",{children:[e.jsxs(Ee,{className:"flex items-center gap-2",children:[e.jsx(Ta,{className:"h-5 w-5"})," Email Templates"]}),e.jsx(Re,{children:"Manage the email templates used for automated notifications across the platform."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ee,{variant:"outline",onClick:()=>u(!0),children:[e.jsx(Tt,{className:"mr-2 h-4 w-4"})," Suggest Templates"]}),e.jsxs(vt,{open:l,onOpenChange:c,children:[e.jsx(ir,{asChild:!0,children:e.jsxs(ee,{onClick:Y,children:[e.jsx(Kt,{className:"mr-2 h-4 w-4"})," Create New Template"]})}),e.jsxs(ut,{className:"sm:max-w-[1200px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(_t,{children:[e.jsx(jt,{children:h?"Edit Email Template":"Create New Email Template"}),e.jsx(Et,{children:h?"Update the content of this email template.":"Design a new email template for automated notifications."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 py-4",children:[e.jsxs("form",{onSubmit:O.handleSubmit(B),className:"grid gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"template-name",children:"Name"}),e.jsx(ne,{id:"template-name",...O.register("name"),disabled:re}),O.formState.errors.name&&e.jsx("p",{className:"text-sm text-destructive",children:O.formState.errors.name.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"template-subject",children:"Subject"}),e.jsx(ne,{id:"template-subject",...O.register("subject"),disabled:re}),O.formState.errors.subject&&e.jsx("p",{className:"text-sm text-destructive",children:O.formState.errors.subject.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"template-description",children:"Description"}),e.jsx(Ot,{id:"template-description",...O.register("description"),disabled:re})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(G,{htmlFor:"template-body",className:"flex items-center gap-1",children:["Body ",e.jsx("span",{className:"text-xs text-muted-foreground",children:"(HTML)"})]}),e.jsx(Kn,{value:O.watch("body"),onChange:oe=>O.setValue("body",oe),placeholder:"Enter email body HTML here. Use placeholders like <% user_name %>.",disabled:re}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Use placeholders like `<% admin_name %>`, `<% company_name %>` for dynamic content."}),O.formState.errors.body&&e.jsx("p",{className:"text-sm text-destructive",children:O.formState.errors.body.message})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[h&&e.jsxs(ee,{type:"button",variant:"outline",onClick:()=>f(!0),disabled:re,children:[e.jsx(Tt,{className:"mr-2 h-4 w-4"})," AI Redesign"]}),e.jsxs(ee,{type:"submit",disabled:re,children:[re&&e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}),h?"Update Template":"Create Template"]})]})]}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs(we,{className:"bg-muted/50",children:[e.jsxs(Ae,{className:"pb-2",children:[e.jsxs(Ee,{className:"text-lg flex items-center gap-2",children:[e.jsx(Gl,{className:"h-5 w-5"})," Available Variables"]}),e.jsx(Re,{children:"Click to insert a variable into the email body."})]}),e.jsxs(ke,{className:"grid gap-2",children:[e.jsxs(Je,{onValueChange:oe=>{if(document.querySelector(".ql-editor")){const wt=O.getValues("body")+oe;O.setValue("body",wt)}},children:[e.jsx(Qe,{children:e.jsx(et,{placeholder:"Select a variable to insert..."})}),e.jsx(Xe,{className:"max-h-60 overflow-y-auto",children:mb.map(oe=>e.jsxs(Ue,{value:oe.variable,children:[oe.name," ",e.jsxs("span",{className:"text-muted-foreground text-xs ml-2",children:["(",oe.variable,")"]})]},oe.variable))})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Variables will be replaced with actual data when the email is sent."})]})]}),e.jsxs(we,{className:"bg-muted/50",children:[e.jsxs(Ae,{className:"pb-2",children:[e.jsx(Ee,{className:"text-lg",children:"Email Body Preview"}),e.jsx(Re,{children:"How your email body will look with dummy data."})]}),e.jsxs(ke,{children:[v&&e.jsx("p",{className:"text-sm text-destructive mb-2",children:v}),e.jsx("iframe",{srcDoc:ue,className:"w-full h-[300px] border rounded-md bg-background",title:"Email Template Preview"}),O.watch("body")===""&&!v&&e.jsx("p",{className:"text-muted-foreground text-sm text-center mt-4",children:"No content to preview."})]})]})]})]})," "]})]})]})]}),e.jsx(ke,{children:e.jsxs(Ct,{children:[e.jsx(At,{children:e.jsxs(Me,{children:[e.jsx(be,{children:"Name"}),e.jsx(be,{children:"Subject"}),e.jsx(be,{children:"Description"}),e.jsx(be,{className:"text-right",children:"Actions"})]})}),e.jsx(Pt,{children:(j==null?void 0:j.length)===0?e.jsx(Me,{children:e.jsx(ve,{colSpan:4,className:"text-center",children:"No templates created yet."})}):j==null?void 0:j.map(oe=>e.jsxs(Me,{children:[e.jsx(ve,{className:"font-medium",children:oe.name}),e.jsx(ve,{children:oe.subject}),e.jsx(ve,{children:oe.description||"N/A"}),e.jsxs(ve,{className:"text-right space-x-2",children:[e.jsx(ee,{variant:"outline",size:"sm",onClick:()=>U(oe),children:e.jsx(rn,{className:"h-4 w-4"})}),e.jsx(ee,{variant:"destructive",size:"sm",onClick:()=>q(oe),children:e.jsx(qt,{className:"h-4 w-4"})})]})]},oe.id))})]})})]}),e.jsx(an,{open:d,onOpenChange:o,children:e.jsxs(zt,{children:[e.jsxs(Bt,{children:[e.jsx($t,{children:"Are you sure?"}),e.jsxs(Ht,{children:['This will permanently delete the template "',s==null?void 0:s.name,'".']})]}),e.jsxs(Ut,{children:[e.jsx(Wt,{children:"Cancel"}),e.jsx(Vt,{onClick:R,disabled:$.isPending,children:"Delete"})]})]})}),e.jsx(ob,{isOpen:m,onOpenChange:u,onSelectSuggestion:F}),h&&e.jsx(gd,{isOpen:y,onOpenChange:f,currentTemplate:h,onRedesignComplete:M,isSystemTemplate:!0})]}),e.jsx(Ve,{value:"email-layout",className:"mt-4",children:e.jsxs(we,{children:[e.jsxs(Ae,{children:[e.jsxs(Ee,{className:"flex items-center gap-2",children:[e.jsx(Qu,{className:"h-5 w-5"})," System Email Layout"]}),e.jsx(Re,{children:"Configure the global header, footer, and default branding for all system-generated emails. The email body will be inserted between the header and footer."})]}),e.jsx(ke,{children:e.jsxs("form",{onSubmit:z.handleSubmit(I),className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"grid gap-6",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"default_company_name",children:"Default Company Name"}),e.jsx(ne,{id:"default_company_name",placeholder:"Your Company Name",...z.register("default_company_name"),disabled:ye}),z.formState.errors.default_company_name&&e.jsx("p",{className:"text-sm text-destructive",children:z.formState.errors.default_company_name.message})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"default_logo_url",children:"Default Logo URL"}),e.jsx(ne,{id:"default_logo_url",type:"text",placeholder:"e.g., /infotrac-logo.png or https://example.com/logo.png",...z.register("default_logo_url"),disabled:ye}),z.formState.errors.default_logo_url&&e.jsx("p",{className:"text-sm text-destructive",children:z.formState.errors.default_logo_url.message})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"default_logo_width",children:"Default Logo Width (px, Optional)"}),e.jsx(ne,{id:"default_logo_width",type:"number",placeholder:"e.g., 150",...z.register("default_logo_width",{valueAsNumber:!0}),disabled:ye}),z.formState.errors.default_logo_width&&e.jsx("p",{className:"text-sm text-destructive",children:z.formState.errors.default_logo_width.message})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"default_logo_height",children:"Default Logo Height (px, Optional)"}),e.jsx(ne,{id:"default_logo_height",type:"number",placeholder:"e.g., 40",...z.register("default_logo_height",{valueAsNumber:!0}),disabled:ye}),z.formState.errors.default_logo_height&&e.jsx("p",{className:"text-sm text-destructive",children:z.formState.errors.default_logo_height.message})]})]}),e.jsx(lt,{className:"my-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(G,{htmlFor:"header_html",children:"Email Header (HTML)"}),e.jsxs(ee,{type:"button",variant:"outline",size:"sm",onClick:()=>z.setValue("header_html",""),disabled:ye,children:[e.jsx(Ds,{className:"mr-2 h-4 w-4"})," Reset to Default"]})]}),e.jsx(Kn,{value:z.watch("header_html")||"",onChange:oe=>z.setValue("header_html",oe),placeholder:"Enter global email header HTML here. Leave blank to use system default.",disabled:ye}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Use placeholders like `<% logo_url %>`, `<% company_name %>`, `<% logo_width %>`, `<% logo_height %>` for dynamic content."}),z.formState.errors.header_html&&e.jsx("p",{className:"text-sm text-destructive",children:z.formState.errors.header_html.message})]}),e.jsx(lt,{className:"my-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(G,{htmlFor:"footer_html",children:"Email Footer (HTML)"}),e.jsxs(ee,{type:"button",variant:"outline",size:"sm",onClick:()=>z.setValue("footer_html",""),disabled:ye,children:[e.jsx(Ds,{className:"mr-2 h-4 w-4"})," Reset to Default"]})]}),e.jsx(Kn,{value:z.watch("footer_html")||"",onChange:oe=>z.setValue("footer_html",oe),placeholder:"Enter global email footer HTML here. Leave blank to use system default.",disabled:ye}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Use placeholders like `<% year %>`, `<% company_name %>`, `<% public_web_url %>` for dynamic content."}),z.formState.errors.footer_html&&e.jsx("p",{className:"text-sm text-destructive",children:z.formState.errors.footer_html.message})]}),e.jsxs(ee,{type:"submit",disabled:ye,className:"mt-4",children:[ye?e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(pn,{className:"mr-2 h-4 w-4"}),"Save Layout"]})]}),e.jsx("div",{className:"grid gap-4",children:e.jsxs(we,{className:"bg-muted/50 h-full flex flex-col",children:[e.jsxs(Ae,{className:"pb-2",children:[e.jsx(Ee,{className:"text-lg",children:"Full Email Layout Preview"}),e.jsx(Re,{children:"How a complete email will look with your configured header, footer, and dummy content."})]}),e.jsxs(ke,{className:"flex-1 flex flex-col",children:[v&&e.jsx("p",{className:"text-sm text-destructive mb-2",children:v}),e.jsx("iframe",{srcDoc:me,className:"w-full h-[500px] border rounded-md bg-background",title:"Email Layout Preview"}),!_e&&!ie&&e.jsx("p",{className:"text-muted-foreground text-sm text-center mt-4",children:"No custom layout HTML. Showing default structure."})]})]})})]})})]})}),e.jsx(Ve,{value:"test-email",className:"mt-4",children:e.jsxs(we,{children:[e.jsxs(Ae,{children:[e.jsxs(Ee,{className:"flex items-center gap-2",children:[e.jsx(ya,{className:"h-5 w-5"})," Send System Test Email"]}),e.jsx(Re,{children:"Send a test email using the system-wide SMTP settings."})]}),e.jsxs(ke,{children:[e.jsxs("form",{onSubmit:A.handleSubmit(K),className:"grid gap-6",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"test-recipient_email",children:"Recipient Email Address"}),e.jsx(ne,{id:"test-recipient_email",type:"email",...A.register("recipient_email"),disabled:Se}),A.formState.errors.recipient_email&&e.jsx("p",{className:"text-sm text-destructive",children:A.formState.errors.recipient_email.message})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Jt,{name:"use_template",control:A.control,render:({field:oe})=>e.jsx(bt,{id:"test-use_template",checked:oe.value,onCheckedChange:oe.onChange,disabled:Se})}),e.jsx(G,{htmlFor:"test-use_template",children:"Use an Email Template"})]}),Q&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"test-template_name",children:"Select Template"}),e.jsxs(Je,{onValueChange:oe=>A.setValue("template_name",oe),value:A.watch("template_name")||"",disabled:Se||C,children:[e.jsx(Qe,{id:"test-template_name",children:e.jsx(et,{placeholder:C?"Loading templates...":"Select a template"})}),e.jsx(Xe,{children:j==null?void 0:j.map(oe=>e.jsx(Ue,{value:oe.name,children:oe.name},oe.id))})]}),A.formState.errors.template_name&&e.jsx("p",{className:"text-sm text-destructive",children:A.formState.errors.template_name.message})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"test-template_variables",children:"Template Variables (JSON)"}),e.jsx(Ot,{id:"test-template_variables",...A.register("template_variables"),rows:8,className:"font-mono text-sm",placeholder:'{"user_name": "John Doe", "expense_title": "Client Lunch"}',disabled:Se}),A.formState.errors.template_variables&&e.jsx("p",{className:"text-sm text-destructive",children:A.formState.errors.template_variables.message})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"test-subject",children:"Subject"}),e.jsx(ne,{id:"test-subject",...A.register("subject"),disabled:Se||Q}),A.formState.errors.subject&&e.jsx("p",{className:"text-sm text-destructive",children:A.formState.errors.subject.message})]}),e.jsxs("div",{className:"grid gap-2 mb-8",children:[e.jsx(G,{htmlFor:"test-body",children:"Body"}),e.jsx(Kn,{value:A.watch("body")||"",onChange:oe=>A.setValue("body",oe),placeholder:"Enter email body here...",disabled:Se||Q}),A.formState.errors.body&&e.jsx("p",{className:"text-sm text-destructive",children:A.formState.errors.body.message})]}),e.jsxs(ee,{type:"submit",disabled:Se,children:[Se?e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(ya,{className:"mr-2 h-4 w-4"}),"Send Test Email"]})]}),e.jsx(lt,{className:"my-6"}),e.jsxs(we,{className:"bg-muted/50",children:[e.jsxs(Ae,{className:"pb-2",children:[e.jsx(Ee,{className:"text-lg",children:"Test Email Preview"}),e.jsx(Re,{children:"How your test email will look."})]}),e.jsxs(ke,{children:[v&&e.jsx("p",{className:"text-sm text-destructive mb-2",children:v}),e.jsx("iframe",{srcDoc:mt,className:"w-full h-[500px] border rounded-md bg-background",title:"Test Email Preview"}),A.watch("body")===""&&!v&&e.jsx("p",{className:"text-muted-foreground text-sm text-center mt-4",children:"No content to preview."})]})]})]})]})})]})})]}):e.jsx("div",{className:"flex flex-1 items-center justify-center text-destructive",children:e.jsx("p",{children:"Access Denied: Only Super Admins can manage system notification settings."})})},{createElement:kr,createContext:fb,forwardRef:bd,useCallback:Qt,useContext:_d,useEffect:Zn,useImperativeHandle:jd,useLayoutEffect:hb,useMemo:gb,useRef:tn,useState:xr}=Ml,Po=Ml[`useId${Math.random()}`.slice(0,5)],vb=hb,Ya=fb(null);Ya.displayName="PanelGroupContext";const Qn=vb,xb=typeof Po=="function"?Po:()=>null;let yb=0;function js(n=null){const a=xb(),t=tn(n||a||null);return t.current===null&&(t.current=""+yb++),n??t.current}function wd({children:n,className:a="",collapsedSize:t,collapsible:r,defaultSize:i,forwardedRef:l,id:c,maxSize:m,minSize:u,onCollapse:h,onExpand:p,onResize:d,order:o,style:s,tagName:g="div",...v}){const x=_d(Ya);if(x===null)throw Error("Panel components must be rendered within a PanelGroup container");const{collapsePanel:y,expandPanel:f,getPanelSize:_,getPanelStyle:b,groupId:E,isPanelCollapsed:N,reevaluatePanelConstraints:j,registerPanel:C,resizePanel:D,unregisterPanel:k}=x,w=js(c),S=tn({callbacks:{onCollapse:h,onExpand:p,onResize:d},constraints:{collapsedSize:t,collapsible:r,defaultSize:i,maxSize:m,minSize:u},id:w,idIsFromProps:c!==void 0,order:o});tn({didLogMissingDefaultSizeWarning:!1}),Qn(()=>{const{callbacks:O,constraints:L}=S.current,$={...L};S.current.id=w,S.current.idIsFromProps=c!==void 0,S.current.order=o,O.onCollapse=h,O.onExpand=p,O.onResize=d,L.collapsedSize=t,L.collapsible=r,L.defaultSize=i,L.maxSize=m,L.minSize=u,($.collapsedSize!==L.collapsedSize||$.collapsible!==L.collapsible||$.maxSize!==L.maxSize||$.minSize!==L.minSize)&&j(S.current,$)}),Qn(()=>{const O=S.current;return C(O),()=>{k(O)}},[o,w,C,k]),jd(l,()=>({collapse:()=>{y(S.current)},expand:O=>{f(S.current,O)},getId(){return w},getSize(){return _(S.current)},isCollapsed(){return N(S.current)},isExpanded(){return!N(S.current)},resize:O=>{D(S.current,O)}}),[y,f,_,N,w,D]);const P=b(S.current,i);return kr(g,{...v,children:n,className:a,id:c,style:{...P,...s},"data-panel":"","data-panel-collapsible":r||void 0,"data-panel-group-id":E,"data-panel-id":w,"data-panel-size":parseFloat(""+P.flexGrow).toFixed(1)})}const qi=bd((n,a)=>kr(wd,{...n,forwardedRef:a}));wd.displayName="Panel";qi.displayName="forwardRef(Panel)";let zi=null,Yn=null;function bb(n,a){if(a){const t=(a&Cd)!==0,r=(a&Ad)!==0,i=(a&Pd)!==0,l=(a&Od)!==0;if(t)return i?"se-resize":l?"ne-resize":"e-resize";if(r)return i?"sw-resize":l?"nw-resize":"w-resize";if(i)return"s-resize";if(l)return"n-resize"}switch(n){case"horizontal":return"ew-resize";case"intersection":return"move";case"vertical":return"ns-resize"}}function _b(){Yn!==null&&(document.head.removeChild(Yn),zi=null,Yn=null)}function bi(n,a){const t=bb(n,a);zi!==t&&(zi=t,Yn===null&&(Yn=document.createElement("style"),document.head.appendChild(Yn)),Yn.innerHTML=`*{cursor: ${t}!important;}`)}function Nd(n){return n.type==="keydown"}function Sd(n){return n.type.startsWith("pointer")}function Ed(n){return n.type.startsWith("mouse")}function Ga(n){if(Sd(n)){if(n.isPrimary)return{x:n.clientX,y:n.clientY}}else if(Ed(n))return{x:n.clientX,y:n.clientY};return{x:1/0,y:1/0}}function jb(){if(typeof matchMedia=="function")return matchMedia("(pointer:coarse)").matches?"coarse":"fine"}function wb(n,a,t){return n.x<a.x+a.width&&n.x+n.width>a.x&&n.y<a.y+a.height&&n.y+n.height>a.y}function Nb(n,a){if(n===a)throw new Error("Cannot compare node with itself");const t={a:To(n),b:To(a)};let r;for(;t.a.at(-1)===t.b.at(-1);)n=t.a.pop(),a=t.b.pop(),r=n;He(r,"Stacking order can only be calculated for elements with a common ancestor");const i={a:Do(Oo(t.a)),b:Do(Oo(t.b))};if(i.a===i.b){const l=r.childNodes,c={a:t.a.at(-1),b:t.b.at(-1)};let m=l.length;for(;m--;){const u=l[m];if(u===c.a)return 1;if(u===c.b)return-1}}return Math.sign(i.a-i.b)}const Sb=/\b(?:position|zIndex|opacity|transform|webkitTransform|mixBlendMode|filter|webkitFilter|isolation)\b/;function Eb(n){var a;const t=getComputedStyle((a=kd(n))!==null&&a!==void 0?a:n).display;return t==="flex"||t==="inline-flex"}function kb(n){const a=getComputedStyle(n);return!!(a.position==="fixed"||a.zIndex!=="auto"&&(a.position!=="static"||Eb(n))||+a.opacity<1||"transform"in a&&a.transform!=="none"||"webkitTransform"in a&&a.webkitTransform!=="none"||"mixBlendMode"in a&&a.mixBlendMode!=="normal"||"filter"in a&&a.filter!=="none"||"webkitFilter"in a&&a.webkitFilter!=="none"||"isolation"in a&&a.isolation==="isolate"||Sb.test(a.willChange)||a.webkitOverflowScrolling==="touch")}function Oo(n){let a=n.length;for(;a--;){const t=n[a];if(He(t,"Missing node"),kb(t))return t}return null}function Do(n){return n&&Number(getComputedStyle(n).zIndex)||0}function To(n){const a=[];for(;n;)a.push(n),n=kd(n);return a}function kd(n){const{parentNode:a}=n;return a&&a instanceof ShadowRoot?a.host:a}const Cd=1,Ad=2,Pd=4,Od=8,Cb=jb()==="coarse";let yn=[],yr=!1,Mn=new Map,Za=new Map;const Vr=new Set;function Ab(n,a,t,r,i){var l;const{ownerDocument:c}=a,m={direction:t,element:a,hitAreaMargins:r,setResizeHandlerState:i},u=(l=Mn.get(c))!==null&&l!==void 0?l:0;return Mn.set(c,u+1),Vr.add(m),Na(),function(){var p;Za.delete(n),Vr.delete(m);const d=(p=Mn.get(c))!==null&&p!==void 0?p:1;if(Mn.set(c,d-1),Na(),d===1&&Mn.delete(c),yn.includes(m)){const o=yn.indexOf(m);o>=0&&yn.splice(o,1),Ns(),i("up",!0,null)}}}function Lo(n){const{target:a}=n,{x:t,y:r}=Ga(n);yr=!0,ws({target:a,x:t,y:r}),Na(),yn.length>0&&(Sa("down",n),n.preventDefault(),n.stopPropagation())}function Mr(n){const{x:a,y:t}=Ga(n);if(yr&&n.buttons===0&&(yr=!1,Sa("up",n)),!yr){const{target:r}=n;ws({target:r,x:a,y:t})}Sa("move",n),Ns(),yn.length>0&&n.preventDefault()}function dr(n){const{target:a}=n,{x:t,y:r}=Ga(n);Za.clear(),yr=!1,yn.length>0&&n.preventDefault(),Sa("up",n),ws({target:a,x:t,y:r}),Ns(),Na()}function ws({target:n,x:a,y:t}){yn.splice(0);let r=null;(n instanceof HTMLElement||n instanceof SVGElement)&&(r=n),Vr.forEach(i=>{const{element:l,hitAreaMargins:c}=i,m=l.getBoundingClientRect(),{bottom:u,left:h,right:p,top:d}=m,o=Cb?c.coarse:c.fine;if(a>=h-o&&a<=p+o&&t>=d-o&&t<=u+o){if(r!==null&&document.contains(r)&&l!==r&&!l.contains(r)&&!r.contains(l)&&Nb(r,l)>0){let g=r,v=!1;for(;g&&!g.contains(l);){if(wb(g.getBoundingClientRect(),m)){v=!0;break}g=g.parentElement}if(v)return}yn.push(i)}})}function _i(n,a){Za.set(n,a)}function Ns(){let n=!1,a=!1;yn.forEach(r=>{const{direction:i}=r;i==="horizontal"?n=!0:a=!0});let t=0;Za.forEach(r=>{t|=r}),n&&a?bi("intersection",t):n?bi("horizontal",t):a?bi("vertical",t):_b()}function Na(){Mn.forEach((n,a)=>{const{body:t}=a;t.removeEventListener("contextmenu",dr),t.removeEventListener("pointerdown",Lo),t.removeEventListener("pointerleave",Mr),t.removeEventListener("pointermove",Mr)}),window.removeEventListener("pointerup",dr),window.removeEventListener("pointercancel",dr),Vr.size>0&&(yr?(yn.length>0&&Mn.forEach((n,a)=>{const{body:t}=a;n>0&&(t.addEventListener("contextmenu",dr),t.addEventListener("pointerleave",Mr),t.addEventListener("pointermove",Mr))}),window.addEventListener("pointerup",dr),window.addEventListener("pointercancel",dr)):Mn.forEach((n,a)=>{const{body:t}=a;n>0&&(t.addEventListener("pointerdown",Lo,{capture:!0}),t.addEventListener("pointermove",Mr))}))}function Sa(n,a){Vr.forEach(t=>{const{setResizeHandlerState:r}=t,i=yn.includes(t);r(n,i,a)})}function Pb(){const[n,a]=xr(0);return Qt(()=>a(t=>t+1),[])}function He(n,a){if(!n)throw console.error(a),Error(a)}const Ss=10;function Jn(n,a,t=Ss){return n.toFixed(t)===a.toFixed(t)?0:n>a?1:-1}function Pn(n,a,t=Ss){return Jn(n,a,t)===0}function ln(n,a,t){return Jn(n,a,t)===0}function Ob(n,a,t){if(n.length!==a.length)return!1;for(let r=0;r<n.length;r++){const i=n[r],l=a[r];if(!ln(i,l,t))return!1}return!0}function gr({panelConstraints:n,panelIndex:a,size:t}){const r=n[a];He(r!=null,`Panel constraints not found for index ${a}`);let{collapsedSize:i=0,collapsible:l,maxSize:c=100,minSize:m=0}=r;if(Jn(t,m)<0)if(l){const u=(i+m)/2;Jn(t,u)<0?t=i:t=m}else t=m;return t=Math.min(c,t),t=parseFloat(t.toFixed(Ss)),t}function Ir({delta:n,initialLayout:a,panelConstraints:t,pivotIndices:r,prevLayout:i,trigger:l}){if(ln(n,0))return a;const c=[...a],[m,u]=r;He(m!=null,"Invalid first pivot index"),He(u!=null,"Invalid second pivot index");let h=0;if(l==="keyboard"){{const d=n<0?u:m,o=t[d];He(o,`Panel constraints not found for index ${d}`);const{collapsedSize:s=0,collapsible:g,minSize:v=0}=o;if(g){const x=a[d];if(He(x!=null,`Previous layout not found for panel index ${d}`),ln(x,s)){const y=v-x;Jn(y,Math.abs(n))>0&&(n=n<0?0-y:y)}}}{const d=n<0?m:u,o=t[d];He(o,`No panel constraints found for index ${d}`);const{collapsedSize:s=0,collapsible:g,minSize:v=0}=o;if(g){const x=a[d];if(He(x!=null,`Previous layout not found for panel index ${d}`),ln(x,v)){const y=x-s;Jn(y,Math.abs(n))>0&&(n=n<0?0-y:y)}}}}{const d=n<0?1:-1;let o=n<0?u:m,s=0;for(;;){const v=a[o];He(v!=null,`Previous layout not found for panel index ${o}`);const y=gr({panelConstraints:t,panelIndex:o,size:100})-v;if(s+=y,o+=d,o<0||o>=t.length)break}const g=Math.min(Math.abs(n),Math.abs(s));n=n<0?0-g:g}{let o=n<0?m:u;for(;o>=0&&o<t.length;){const s=Math.abs(n)-Math.abs(h),g=a[o];He(g!=null,`Previous layout not found for panel index ${o}`);const v=g-s,x=gr({panelConstraints:t,panelIndex:o,size:v});if(!ln(g,x)&&(h+=g-x,c[o]=x,h.toPrecision(3).localeCompare(Math.abs(n).toPrecision(3),void 0,{numeric:!0})>=0))break;n<0?o--:o++}}if(Ob(i,c))return i;{const d=n<0?u:m,o=a[d];He(o!=null,`Previous layout not found for panel index ${d}`);const s=o+h,g=gr({panelConstraints:t,panelIndex:d,size:s});if(c[d]=g,!ln(g,s)){let v=s-g,y=n<0?u:m;for(;y>=0&&y<t.length;){const f=c[y];He(f!=null,`Previous layout not found for panel index ${y}`);const _=f+v,b=gr({panelConstraints:t,panelIndex:y,size:_});if(ln(f,b)||(v-=b-f,c[y]=b),ln(v,0))break;n>0?y--:y++}}}const p=c.reduce((d,o)=>o+d,0);return ln(p,100)?c:i}function Db({layout:n,panelsArray:a,pivotIndices:t}){let r=0,i=100,l=0,c=0;const m=t[0];He(m!=null,"No pivot index found"),a.forEach((d,o)=>{const{constraints:s}=d,{maxSize:g=100,minSize:v=0}=s;o===m?(r=v,i=g):(l+=v,c+=g)});const u=Math.min(i,100-l),h=Math.max(r,100-c),p=n[m];return{valueMax:u,valueMin:h,valueNow:p}}function Wr(n,a=document){return Array.from(a.querySelectorAll(`[data-panel-resize-handle-id][data-panel-group-id="${n}"]`))}function Dd(n,a,t=document){const i=Wr(n,t).findIndex(l=>l.getAttribute("data-panel-resize-handle-id")===a);return i??null}function Td(n,a,t){const r=Dd(n,a,t);return r!=null?[r,r+1]:[-1,-1]}function Ld(n,a=document){var t;if(a instanceof HTMLElement&&(a==null||(t=a.dataset)===null||t===void 0?void 0:t.panelGroupId)==n)return a;const r=a.querySelector(`[data-panel-group][data-panel-group-id="${n}"]`);return r||null}function Qa(n,a=document){const t=a.querySelector(`[data-panel-resize-handle-id="${n}"]`);return t||null}function Tb(n,a,t,r=document){var i,l,c,m;const u=Qa(a,r),h=Wr(n,r),p=u?h.indexOf(u):-1,d=(i=(l=t[p])===null||l===void 0?void 0:l.id)!==null&&i!==void 0?i:null,o=(c=(m=t[p+1])===null||m===void 0?void 0:m.id)!==null&&c!==void 0?c:null;return[d,o]}function Lb({committedValuesRef:n,eagerValuesRef:a,groupId:t,layout:r,panelDataArray:i,panelGroupElement:l,setLayout:c}){tn({didWarnAboutMissingResizeHandle:!1}),Qn(()=>{if(!l)return;const m=Wr(t,l);for(let u=0;u<i.length-1;u++){const{valueMax:h,valueMin:p,valueNow:d}=Db({layout:r,panelsArray:i,pivotIndices:[u,u+1]}),o=m[u];if(o!=null){const s=i[u];He(s,`No panel data found for index "${u}"`),o.setAttribute("aria-controls",s.id),o.setAttribute("aria-valuemax",""+Math.round(h)),o.setAttribute("aria-valuemin",""+Math.round(p)),o.setAttribute("aria-valuenow",d!=null?""+Math.round(d):"")}}return()=>{m.forEach((u,h)=>{u.removeAttribute("aria-controls"),u.removeAttribute("aria-valuemax"),u.removeAttribute("aria-valuemin"),u.removeAttribute("aria-valuenow")})}},[t,r,i,l]),Zn(()=>{if(!l)return;const m=a.current;He(m,"Eager values not found");const{panelDataArray:u}=m,h=Ld(t,l);He(h!=null,`No group found for id "${t}"`);const p=Wr(t,l);He(p,`No resize handles found for group id "${t}"`);const d=p.map(o=>{const s=o.getAttribute("data-panel-resize-handle-id");He(s,"Resize handle element has no handle id attribute");const[g,v]=Tb(t,s,u,l);if(g==null||v==null)return()=>{};const x=y=>{if(!y.defaultPrevented)switch(y.key){case"Enter":{y.preventDefault();const f=u.findIndex(_=>_.id===g);if(f>=0){const _=u[f];He(_,`No panel data found for index ${f}`);const b=r[f],{collapsedSize:E=0,collapsible:N,minSize:j=0}=_.constraints;if(b!=null&&N){const C=Ir({delta:ln(b,E)?j-E:E-b,initialLayout:r,panelConstraints:u.map(D=>D.constraints),pivotIndices:Td(t,s,l),prevLayout:r,trigger:"keyboard"});r!==C&&c(C)}}break}}};return o.addEventListener("keydown",x),()=>{o.removeEventListener("keydown",x)}});return()=>{d.forEach(o=>o())}},[l,n,a,t,r,i,c])}function Ro(n,a){if(n.length!==a.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==a[t])return!1;return!0}function Rd(n,a){const t=n==="horizontal",{x:r,y:i}=Ga(a);return t?r:i}function Rb(n,a,t,r,i){const l=t==="horizontal",c=Qa(a,i);He(c,`No resize handle element found for id "${a}"`);const m=c.getAttribute("data-panel-group-id");He(m,"Resize handle element has no group id attribute");let{initialCursorPosition:u}=r;const h=Rd(t,n),p=Ld(m,i);He(p,`No group element found for id "${m}"`);const d=p.getBoundingClientRect(),o=l?d.width:d.height;return(h-u)/o*100}function Mb(n,a,t,r,i,l){if(Nd(n)){const c=t==="horizontal";let m=0;n.shiftKey?m=100:i!=null?m=i:m=10;let u=0;switch(n.key){case"ArrowDown":u=c?0:m;break;case"ArrowLeft":u=c?-m:0;break;case"ArrowRight":u=c?m:0;break;case"ArrowUp":u=c?0:-m;break;case"End":u=100;break;case"Home":u=-100;break}return u}else return r==null?0:Rb(n,a,t,r,l)}function Fb({panelDataArray:n}){const a=Array(n.length),t=n.map(l=>l.constraints);let r=0,i=100;for(let l=0;l<n.length;l++){const c=t[l];He(c,`Panel constraints not found for index ${l}`);const{defaultSize:m}=c;m!=null&&(r++,a[l]=m,i-=m)}for(let l=0;l<n.length;l++){const c=t[l];He(c,`Panel constraints not found for index ${l}`);const{defaultSize:m}=c;if(m!=null)continue;const u=n.length-r,h=i/u;r++,a[l]=h,i-=h}return a}function ur(n,a,t){a.forEach((r,i)=>{const l=n[i];He(l,`Panel data not found for index ${i}`);const{callbacks:c,constraints:m,id:u}=l,{collapsedSize:h=0,collapsible:p}=m,d=t[u];if(d==null||r!==d){t[u]=r;const{onCollapse:o,onExpand:s,onResize:g}=c;g&&g(r,d),p&&(o||s)&&(s&&(d==null||Pn(d,h))&&!Pn(r,h)&&s(),o&&(d==null||!Pn(d,h))&&Pn(r,h)&&o())}})}function la(n,a){if(n.length!==a.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!=a[t])return!1;return!0}function Ib({defaultSize:n,dragState:a,layout:t,panelData:r,panelIndex:i,precision:l=3}){const c=t[i];let m;return c==null?m=n!=null?n.toPrecision(l):"1":r.length===1?m="1":m=c.toPrecision(l),{flexBasis:0,flexGrow:m,flexShrink:1,overflow:"hidden",pointerEvents:a!==null?"none":void 0}}function qb(n,a=10){let t=null;return(...i)=>{t!==null&&clearTimeout(t),t=setTimeout(()=>{n(...i)},a)}}function Mo(n){try{if(typeof localStorage<"u")n.getItem=a=>localStorage.getItem(a),n.setItem=(a,t)=>{localStorage.setItem(a,t)};else throw new Error("localStorage not supported in this environment")}catch(a){console.error(a),n.getItem=()=>null,n.setItem=()=>{}}}function Md(n){return`react-resizable-panels:${n}`}function Fd(n){return n.map(a=>{const{constraints:t,id:r,idIsFromProps:i,order:l}=a;return i?r:l?`${l}:${JSON.stringify(t)}`:JSON.stringify(t)}).sort((a,t)=>a.localeCompare(t)).join(",")}function Id(n,a){try{const t=Md(n),r=a.getItem(t);if(r){const i=JSON.parse(r);if(typeof i=="object"&&i!=null)return i}}catch{}return null}function zb(n,a,t){var r,i;const l=(r=Id(n,t))!==null&&r!==void 0?r:{},c=Fd(a);return(i=l[c])!==null&&i!==void 0?i:null}function Bb(n,a,t,r,i){var l;const c=Md(n),m=Fd(a),u=(l=Id(n,i))!==null&&l!==void 0?l:{};u[m]={expandToSizes:Object.fromEntries(t.entries()),layout:r};try{i.setItem(c,JSON.stringify(u))}catch(h){console.error(h)}}function Fo({layout:n,panelConstraints:a}){const t=[...n],r=t.reduce((l,c)=>l+c,0);if(t.length!==a.length)throw Error(`Invalid ${a.length} panel layout: ${t.map(l=>`${l}%`).join(", ")}`);if(!ln(r,100)&&t.length>0)for(let l=0;l<a.length;l++){const c=t[l];He(c!=null,`No layout data found for index ${l}`);const m=100/r*c;t[l]=m}let i=0;for(let l=0;l<a.length;l++){const c=t[l];He(c!=null,`No layout data found for index ${l}`);const m=gr({panelConstraints:a,panelIndex:l,size:c});c!=m&&(i+=c-m,t[l]=m)}if(!ln(i,0))for(let l=0;l<a.length;l++){const c=t[l];He(c!=null,`No layout data found for index ${l}`);const m=c+i,u=gr({panelConstraints:a,panelIndex:l,size:m});if(c!==u&&(i-=u-c,t[l]=u,ln(i,0)))break}return t}const Ub=100,qr={getItem:n=>(Mo(qr),qr.getItem(n)),setItem:(n,a)=>{Mo(qr),qr.setItem(n,a)}},Io={};function qd({autoSaveId:n=null,children:a,className:t="",direction:r,forwardedRef:i,id:l=null,onLayout:c=null,keyboardResizeBy:m=null,storage:u=qr,style:h,tagName:p="div",...d}){const o=js(l),s=tn(null),[g,v]=xr(null),[x,y]=xr([]),f=Pb(),_=tn({}),b=tn(new Map),E=tn(0),N=tn({autoSaveId:n,direction:r,dragState:g,id:o,keyboardResizeBy:m,onLayout:c,storage:u}),j=tn({layout:x,panelDataArray:[],panelDataArrayChanged:!1});tn({didLogIdAndOrderWarning:!1,didLogPanelConstraintsWarning:!1,prevPanelIds:[]}),jd(i,()=>({getId:()=>N.current.id,getLayout:()=>{const{layout:M}=j.current;return M},setLayout:M=>{const{onLayout:z}=N.current,{layout:H,panelDataArray:I}=j.current,A=Fo({layout:M,panelConstraints:I.map(V=>V.constraints)});Ro(H,A)||(y(A),j.current.layout=A,z&&z(A),ur(I,A,_.current))}}),[]),Qn(()=>{N.current.autoSaveId=n,N.current.direction=r,N.current.dragState=g,N.current.id=o,N.current.onLayout=c,N.current.storage=u}),Lb({committedValuesRef:N,eagerValuesRef:j,groupId:o,layout:x,panelDataArray:j.current.panelDataArray,setLayout:y,panelGroupElement:s.current}),Zn(()=>{const{panelDataArray:M}=j.current;if(n){if(x.length===0||x.length!==M.length)return;let z=Io[n];z==null&&(z=qb(Bb,Ub),Io[n]=z);const H=[...M],I=new Map(b.current);z(n,H,I,x,u)}},[n,x,u]),Zn(()=>{});const C=Qt(M=>{const{onLayout:z}=N.current,{layout:H,panelDataArray:I}=j.current;if(M.constraints.collapsible){const A=I.map(de=>de.constraints),{collapsedSize:V=0,panelSize:K,pivotIndices:Q}=Un(I,M,H);if(He(K!=null,`Panel size not found for panel "${M.id}"`),!Pn(K,V)){b.current.set(M.id,K);const xe=fr(I,M)===I.length-1?K-V:V-K,Z=Ir({delta:xe,initialLayout:H,panelConstraints:A,pivotIndices:Q,prevLayout:H,trigger:"imperative-api"});la(H,Z)||(y(Z),j.current.layout=Z,z&&z(Z),ur(I,Z,_.current))}}},[]),D=Qt((M,z)=>{const{onLayout:H}=N.current,{layout:I,panelDataArray:A}=j.current;if(M.constraints.collapsible){const V=A.map(re=>re.constraints),{collapsedSize:K=0,panelSize:Q=0,minSize:de=0,pivotIndices:xe}=Un(A,M,I),Z=z??de;if(Pn(Q,K)){const re=b.current.get(M.id),ye=re!=null&&re>=Z?re:Z,De=fr(A,M)===A.length-1?Q-ye:ye-Q,te=Ir({delta:De,initialLayout:I,panelConstraints:V,pivotIndices:xe,prevLayout:I,trigger:"imperative-api"});la(I,te)||(y(te),j.current.layout=te,H&&H(te),ur(A,te,_.current))}}},[]),k=Qt(M=>{const{layout:z,panelDataArray:H}=j.current,{panelSize:I}=Un(H,M,z);return He(I!=null,`Panel size not found for panel "${M.id}"`),I},[]),w=Qt((M,z)=>{const{panelDataArray:H}=j.current,I=fr(H,M);return Ib({defaultSize:z,dragState:g,layout:x,panelData:H,panelIndex:I})},[g,x]),S=Qt(M=>{const{layout:z,panelDataArray:H}=j.current,{collapsedSize:I=0,collapsible:A,panelSize:V}=Un(H,M,z);return He(V!=null,`Panel size not found for panel "${M.id}"`),A===!0&&Pn(V,I)},[]),P=Qt(M=>{const{layout:z,panelDataArray:H}=j.current,{collapsedSize:I=0,collapsible:A,panelSize:V}=Un(H,M,z);return He(V!=null,`Panel size not found for panel "${M.id}"`),!A||Jn(V,I)>0},[]),O=Qt(M=>{const{panelDataArray:z}=j.current;z.push(M),z.sort((H,I)=>{const A=H.order,V=I.order;return A==null&&V==null?0:A==null?-1:V==null?1:A-V}),j.current.panelDataArrayChanged=!0,f()},[f]);Qn(()=>{if(j.current.panelDataArrayChanged){j.current.panelDataArrayChanged=!1;const{autoSaveId:M,onLayout:z,storage:H}=N.current,{layout:I,panelDataArray:A}=j.current;let V=null;if(M){const Q=zb(M,A,H);Q&&(b.current=new Map(Object.entries(Q.expandToSizes)),V=Q.layout)}V==null&&(V=Fb({panelDataArray:A}));const K=Fo({layout:V,panelConstraints:A.map(Q=>Q.constraints)});Ro(I,K)||(y(K),j.current.layout=K,z&&z(K),ur(A,K,_.current))}}),Qn(()=>{const M=j.current;return()=>{M.layout=[]}},[]);const L=Qt(M=>{let z=!1;const H=s.current;return H&&window.getComputedStyle(H,null).getPropertyValue("direction")==="rtl"&&(z=!0),function(A){A.preventDefault();const V=s.current;if(!V)return()=>null;const{direction:K,dragState:Q,id:de,keyboardResizeBy:xe,onLayout:Z}=N.current,{layout:re,panelDataArray:ye}=j.current,{initialLayout:Se}=Q??{},De=Td(de,M,V);let te=Mb(A,M,K,Q,xe,V);const se=K==="horizontal";se&&z&&(te=-te);const ge=ye.map(Ne=>Ne.constraints),ce=Ir({delta:te,initialLayout:Se??re,panelConstraints:ge,pivotIndices:De,prevLayout:re,trigger:Nd(A)?"keyboard":"mouse-or-touch"}),le=!la(re,ce);(Sd(A)||Ed(A))&&E.current!=te&&(E.current=te,!le&&te!==0?se?_i(M,te<0?Cd:Ad):_i(M,te<0?Pd:Od):_i(M,0)),le&&(y(ce),j.current.layout=ce,Z&&Z(ce),ur(ye,ce,_.current))}},[]),$=Qt((M,z)=>{const{onLayout:H}=N.current,{layout:I,panelDataArray:A}=j.current,V=A.map(re=>re.constraints),{panelSize:K,pivotIndices:Q}=Un(A,M,I);He(K!=null,`Panel size not found for panel "${M.id}"`);const xe=fr(A,M)===A.length-1?K-z:z-K,Z=Ir({delta:xe,initialLayout:I,panelConstraints:V,pivotIndices:Q,prevLayout:I,trigger:"imperative-api"});la(I,Z)||(y(Z),j.current.layout=Z,H&&H(Z),ur(A,Z,_.current))},[]),B=Qt((M,z)=>{const{layout:H,panelDataArray:I}=j.current,{collapsedSize:A=0,collapsible:V}=z,{collapsedSize:K=0,collapsible:Q,maxSize:de=100,minSize:xe=0}=M.constraints,{panelSize:Z}=Un(I,M,H);Z!=null&&(V&&Q&&Pn(Z,A)?Pn(A,K)||$(M,K):Z<xe?$(M,xe):Z>de&&$(M,de))},[$]),Y=Qt((M,z)=>{const{direction:H}=N.current,{layout:I}=j.current;if(!s.current)return;const A=Qa(M,s.current);He(A,`Drag handle element not found for id "${M}"`);const V=Rd(H,z);v({dragHandleId:M,dragHandleRect:A.getBoundingClientRect(),initialCursorPosition:V,initialLayout:I})},[]),U=Qt(()=>{v(null)},[]),q=Qt(M=>{const{panelDataArray:z}=j.current,H=fr(z,M);H>=0&&(z.splice(H,1),delete _.current[M.id],j.current.panelDataArrayChanged=!0,f())},[f]),R=gb(()=>({collapsePanel:C,direction:r,dragState:g,expandPanel:D,getPanelSize:k,getPanelStyle:w,groupId:o,isPanelCollapsed:S,isPanelExpanded:P,reevaluatePanelConstraints:B,registerPanel:O,registerResizeHandle:L,resizePanel:$,startDragging:Y,stopDragging:U,unregisterPanel:q,panelGroupElement:s.current}),[C,g,r,D,k,w,o,S,P,B,O,L,$,Y,U,q]),F={display:"flex",flexDirection:r==="horizontal"?"row":"column",height:"100%",overflow:"hidden",width:"100%"};return kr(Ya.Provider,{value:R},kr(p,{...d,children:a,className:t,id:l,ref:s,style:{...F,...h},"data-panel-group":"","data-panel-group-direction":r,"data-panel-group-id":o}))}const zd=bd((n,a)=>kr(qd,{...n,forwardedRef:a}));qd.displayName="PanelGroup";zd.displayName="forwardRef(PanelGroup)";function fr(n,a){return n.findIndex(t=>t===a||t.id===a.id)}function Un(n,a,t){const r=fr(n,a),l=r===n.length-1?[r-1,r]:[r,r+1],c=t[r];return{...a.constraints,panelSize:c,pivotIndices:l}}function $b({disabled:n,handleId:a,resizeHandler:t,panelGroupElement:r}){Zn(()=>{if(n||t==null||r==null)return;const i=Qa(a,r);if(i==null)return;const l=c=>{if(!c.defaultPrevented)switch(c.key){case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"End":case"Home":{c.preventDefault(),t(c);break}case"F6":{c.preventDefault();const m=i.getAttribute("data-panel-group-id");He(m,`No group element found for id "${m}"`);const u=Wr(m,r),h=Dd(m,a,r);He(h!==null,`No resize element found for id "${a}"`);const p=c.shiftKey?h>0?h-1:u.length-1:h+1<u.length?h+1:0;u[p].focus();break}}};return i.addEventListener("keydown",l),()=>{i.removeEventListener("keydown",l)}},[r,n,a,t])}function Bd({children:n=null,className:a="",disabled:t=!1,hitAreaMargins:r,id:i,onBlur:l,onDragging:c,onFocus:m,style:u={},tabIndex:h=0,tagName:p="div",...d}){var o,s;const g=tn(null),v=tn({onDragging:c});Zn(()=>{v.current.onDragging=c});const x=_d(Ya);if(x===null)throw Error("PanelResizeHandle components must be rendered within a PanelGroup container");const{direction:y,groupId:f,registerResizeHandle:_,startDragging:b,stopDragging:E,panelGroupElement:N}=x,j=js(i),[C,D]=xr("inactive"),[k,w]=xr(!1),[S,P]=xr(null),O=tn({state:C});Qn(()=>{O.current.state=C}),Zn(()=>{if(t)P(null);else{const Y=_(j);P(()=>Y)}},[t,j,_]);const L=(o=r==null?void 0:r.coarse)!==null&&o!==void 0?o:15,$=(s=r==null?void 0:r.fine)!==null&&s!==void 0?s:5;return Zn(()=>{if(t||S==null)return;const Y=g.current;return He(Y,"Element ref not attached"),Ab(j,Y,y,{coarse:L,fine:$},(q,R,F)=>{if(R)switch(q){case"down":{D("drag"),He(F,'Expected event to be defined for "down" action'),b(j,F);const{onDragging:M}=v.current;M&&M(!0);break}case"move":{const{state:M}=O.current;M!=="drag"&&D("hover"),He(F,'Expected event to be defined for "move" action'),S(F);break}case"up":{D("hover"),E();const{onDragging:M}=v.current;M&&M(!1);break}}else D("inactive")})},[L,y,t,$,_,j,S,b,E]),$b({disabled:t,handleId:j,resizeHandler:S,panelGroupElement:N}),kr(p,{...d,children:n,className:a,id:i,onBlur:()=>{w(!1),l==null||l()},onFocus:()=>{w(!0),m==null||m()},ref:g,role:"separator",style:{...{touchAction:"none",userSelect:"none"},...u},tabIndex:h,"data-panel-group-direction":y,"data-panel-group-id":f,"data-resize-handle":"","data-resize-handle-active":C==="drag"?"pointer":k?"keyboard":void 0,"data-resize-handle-state":C,"data-panel-resize-handle-enabled":!t,"data-panel-resize-handle-id":j})}Bd.displayName="PanelResizeHandle";const Hb=rl,Vb=al,Wb=tl,Ud=T.forwardRef(({className:n,...a},t)=>e.jsx(Ea,{className:pe("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",n),...a,ref:t}));Ud.displayName=Ea.displayName;const Kb=Kr("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),$d=T.forwardRef(({side:n="right",className:a,children:t,...r},i)=>e.jsxs(Wb,{children:[e.jsx(Ud,{}),e.jsxs(ka,{ref:i,className:pe(Kb({side:n}),a),...r,children:[t,e.jsxs(nl,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[e.jsx(Yr,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));$d.displayName=ka.displayName;const Yb=T.forwardRef(({className:n,...a},t)=>e.jsx(Ca,{ref:t,className:pe("text-lg font-semibold text-foreground",n),...a}));Yb.displayName=Ca.displayName;const Gb=T.forwardRef(({className:n,...a},t)=>e.jsx(Aa,{ref:t,className:pe("text-sm text-muted-foreground",n),...a}));Gb.displayName=Aa.displayName;const Zb=({isSidebarCollapsed:n})=>{const{profile:a,impersonatedProfile:t,setImpersonatedProfile:r,isLoading:i}=Ie(),[l,c]=T.useState(void 0),[m,u]=T.useState(void 0),[h,p]=T.useState(!1),d=(a==null?void 0:a.role)==="super-admin",{data:o,isLoading:s}=je({queryKey:["allCompaniesForImpersonation"],queryFn:async()=>{const{data:b,error:E}=await X.from("companies").select("id, name").order("name",{ascending:!0});if(E)throw E;return b},enabled:d}),{data:g,isLoading:v}=je({queryKey:["allProfilesForImpersonation"],queryFn:async()=>{const{data:b,error:E}=await X.from("profiles").select("id, user_id, company_id, email, full_name, first_name, last_name, role, avatar_url, status, created_at, updated_at").order("email",{ascending:!0});if(E)throw E;return b},enabled:d}),x=l?g==null?void 0:g.filter(b=>b.company_id===l):g;T.useEffect(()=>{u(void 0)},[l]),T.useEffect(()=>{t?(c(t.company_id||void 0),u(t.user_id)):(c(void 0),u(void 0))},[t]);const y=()=>{if(m&&g){const b=g.find(E=>E.user_id===m);b&&r(b)}},f=()=>{r(null)};if(!d)return null;const _=i||s||v;return e.jsx(vs,{open:h,onOpenChange:p,className:"mt-auto border-t border-gray-300 rounded-none shadow-none",children:e.jsxs(we,{className:"border-none rounded-none",children:[e.jsxs(Ae,{className:pe("p-2 pb-1 flex flex-row items-center",n?"justify-start":"justify-between"),children:[e.jsxs(Ee,{className:"text-sm flex items-center gap-1",children:[e.jsx(Ts,{className:"h-4 w-4 text-brand-accent"}),!n&&"Impersonate User"," "]}),e.jsx(xs,{asChild:!0,children:e.jsxs(ee,{variant:"ghost",className:"h-7 w-7 p-0",children:[e.jsx(Bn,{className:pe("h-3 w-3 transition-transform duration-200",h?"rotate-0":"rotate-180")}),e.jsx("span",{className:"sr-only",children:"Toggle Impersonation"})]})})]}),e.jsx(ys,{children:e.jsxs(ke,{className:"p-2 pt-1 space-y-2",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx(G,{htmlFor:"impersonate-company",className:"text-xs text-muted-foreground",children:"Company"}),e.jsxs(Je,{value:l||"",onValueChange:c,disabled:_,children:[e.jsx(Qe,{id:"impersonate-company",className:"h-8",children:e.jsx(et,{placeholder:"Select company"})}),e.jsx(Xe,{children:o==null?void 0:o.map(b=>e.jsx(Ue,{value:b.id,children:b.name},b.id))})]})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx(G,{htmlFor:"impersonate-user",className:"text-xs text-muted-foreground",children:"User"}),e.jsxs(Je,{value:m||"",onValueChange:u,disabled:_||!l,children:[e.jsx(Qe,{id:"impersonate-user",className:"h-8",children:e.jsx(et,{placeholder:"Select user"})}),e.jsx(Xe,{children:x==null?void 0:x.map(b=>e.jsxs(Ue,{value:b.user_id,children:[b.full_name||b.email," (",b.role,")"]},b.user_id))})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ee,{onClick:y,disabled:_||!m,className:"flex-1 h-8",children:[_?e.jsx(fe,{className:"h-3 w-3 animate-spin"}):e.jsx(Ts,{className:"h-3 w-3"}),e.jsx("span",{className:"sr-only",children:"Impersonate"})]}),e.jsxs(ee,{variant:"outline",onClick:f,disabled:!t,className:"flex-1 h-8",children:[e.jsx(Ft,{className:"h-3 w-3"}),e.jsx("span",{className:"sr-only",children:"Clear Impersonation"})]})]})]})})]})})},ji=[{id:"dashboard",label:"Dashboard",path:"/dashboard",icon:Jl,isHidden:!1,roles:["admin","controller","super-admin"],companyRequired:!0},{id:"companies",label:"Companies",path:"/companies",icon:Pa,roles:["super-admin"],isHidden:!1},{id:"vendors",label:"Vendors",path:"/vendors",icon:Fl,roles:["admin","controller","super-admin"],companyRequired:!0,isHidden:!1},{id:"customers",label:"Customers",path:"/customers",icon:Il,roles:["admin","controller","super-admin"],companyRequired:!0,isHidden:!1},{id:"expenses",label:"My Expenses",path:"/expenses",icon:Hl,companyRequired:!0,isHidden:!1},{id:"expense-review",label:"Expense Review",path:"/expense-review",icon:Vl,roles:["admin","controller","super-admin"],companyRequired:!0,isHidden:!1},{id:"notifications-page",label:"Notifications",path:"/notifications",icon:La,companyRequired:!0,isHidden:!1},{id:"accounting",label:"Accounting",icon:Si,roles:["admin","controller","super-admin"],companyRequired:!0,isHidden:!1,children:[{id:"expense-categories",label:"Expense Categories",path:"/expense-categories",icon:Wl,roles:["admin","controller","super-admin"],companyRequired:!0,isHidden:!1},{id:"gl-accounts",label:"GL Accounts",path:"/gl-accounts",icon:Si,roles:["admin","controller","super-admin"],companyRequired:!0,isHidden:!1}]},{id:"process-automation",label:"Process Automation",icon:Ei,roles:["admin","controller","super-admin"],companyRequired:!0,isHidden:!1,children:[{id:"automations",label:"Automations",path:"/process-automation",icon:Ei,roles:["admin","controller","super-admin"],companyRequired:!0,isHidden:!1}]},{id:"billing",label:"Billing",path:"/billing",icon:Yl,roles:["super-admin"],isHidden:!1},{id:"analytics",label:"Analytics",path:"/analytics",icon:Xu,isHidden:!1},{id:"system-notification-settings",label:"System Notifications",path:"/system-notification-settings",icon:Ra,roles:["super-admin"],isHidden:!1},{id:"settings",label:"Settings",icon:Xi,isHidden:!1,children:[{id:"profile-settings",label:"Profile",path:"/settings",icon:Qi,isHidden:!1},{id:"company-settings",label:"Company",path:"/company-settings",icon:Gr,roles:["admin","super-admin"],companyRequired:!0,isHidden:!1},{id:"users",label:"Users",path:"/users",icon:Vi,roles:["admin","super-admin"],isHidden:!1,isLocked:!0},{id:"company-modules-overview",label:"Modules",path:"/company-modules-overview",icon:br,roles:["admin","super-admin"],companyRequired:!0,isHidden:!1},{id:"system-modules",label:"System Modules",path:"/system-modules",icon:br,roles:["super-admin"],isHidden:!1},{id:"system-billing-settings",label:"System Billing",path:"/system-billing-settings",icon:Zl,roles:["super-admin"],isHidden:!1}]}];function Qb(){const n=Ye(),{user:a,profile:t,isLoading:r,impersonatedProfile:i}=Ie(),l=(i==null?void 0:i.user_id)||(a==null?void 0:a.id),c=i||t,{data:m,isLoading:u}=je({queryKey:["userMenuPreferences",l],queryFn:async()=>{if(!l)return null;const{data:E,error:N}=await X.from("user_menu_preferences").select("*").eq("user_id",l).single();if(N&&N.code!=="PGRST116")throw console.error("Error fetching user menu preferences:",N),N;if(E){let j=[];return Array.isArray(E.menu_items_order)?E.menu_items_order.length>0&&typeof E.menu_items_order[0]=="string"?j=E.menu_items_order.map(C=>({id:C,isHidden:!1})):j=E.menu_items_order:E.menu_items_order===null||E.menu_items_order===void 0?j=[]:(console.warn("menu_items_order is not an array:",E.menu_items_order),j=[]),{...E,menu_items_order:j}}return null},enabled:!!l&&!r,staleTime:1e3*60*5,refetchOnWindowFocus:!0}),{data:h,isLoading:p}=je({queryKey:["userModulesForMenu",l],queryFn:async()=>{if(!l)return[];const{data:E,error:N}=await X.from("user_modules").select("id, user_id, company_id, module_id, is_enabled").eq("user_id",l);if(N)throw N;return E},enabled:!!l&&!r}),{data:d,isLoading:o}=je({queryKey:["companyModulesForMenu",c==null?void 0:c.company_id],queryFn:async()=>{if(!(c!=null&&c.company_id))return[];const{data:E,error:N}=await X.from("company_modules").select("id, company_id, module_id, is_enabled, is_locked_by_system").eq("company_id",c.company_id);if(N)throw N;return E},enabled:!!(c!=null&&c.company_id)&&!r}),{data:s,isLoading:g}=je({queryKey:["allSystemModulesForMenu"],queryFn:async()=>{const{data:E,error:N}=await X.from("modules").select("id, name, module_type, roles");if(N)throw N;return E},enabled:!r,staleTime:1/0}),v=Oe({mutationFn:async E=>{if(!l)throw new Error("User not authenticated.");const{data:N,error:j}=await X.from("user_menu_preferences").upsert({user_id:l,menu_items_order:E},{onConflict:"user_id"});if(j)throw j;return N},onSuccess:()=>{n.invalidateQueries({queryKey:["userMenuPreferences",l]})}}),x=T.useCallback((E,N)=>{if(!N)return;const j=new Map;switch(N.forEach(C=>j.set(C.name,C.id)),E){case"dashboard":return j.get("Dashboard");case"companies":return j.get("Companies");case"vendors":return j.get("Vendors");case"customers":return j.get("Customers");case"expenses":return j.get("Expense Management");case"expense-review":return j.get("Expense Management");case"notifications-page":return j.get("Notifications");case"expense-categories":return j.get("Expense Categories");case"gl-accounts":return j.get("GL Accounts");case"automations":return j.get("Process Automation");case"billing":return j.get("Billing");case"analytics":return j.get("Analytics");case"system-notification-settings":return j.get("System Notification Settings");case"profile-settings":return j.get("Profile Settings");case"company-settings":return j.get("Company Settings");case"users":return j.get("Users");case"company-modules-overview":return j.get("Company Modules Overview");case"system-modules":return j.get("System Modules");case"system-billing-settings":return j.get("System Billing Settings");case"company-notification-settings":return j.get("Company Notification Settings");default:return}},[]),y=T.useMemo(()=>{const E=P=>P.map(O=>{const L={...O};return O.children&&(L.children=E(O.children)),L}),N=E(ji),j=new Map;((m==null?void 0:m.menu_items_order)||[]).forEach(P=>{j.set(P.id,P)});const C=new Map;s&&s.forEach(P=>{var L;const O=(L=ji.find($=>$.label===P.name))==null?void 0:L.id;O&&C.set(O,{id:P.id,type:P.module_type,roles:P.roles}),ji.forEach($=>{var B;(B=$.children)==null||B.forEach(Y=>{Y.label===P.name&&C.set(Y.id,{id:P.id,type:P.module_type,roles:P.roles})})})});const D=new Map;d&&d.forEach(P=>D.set(P.module_id,P));const k=P=>{for(const O of P){const L=j.get(O.id);L!==void 0&&(O.isHidden=L.isHidden);const $=C.get(O.id);if($){const B=D.get($.id);O.isLocked=$.type==="core"||((B==null?void 0:B.is_locked_by_system)??!1)}O.children&&k(O.children)}};k(N);const w=[],S=new Set;for(const P of(m==null?void 0:m.menu_items_order)||[]){const O=N.find(L=>L.id===P.id);O&&!S.has(O.id)&&(w.push(O),S.add(O.id))}for(const P of N)S.has(P.id)||w.push(P);return w},[m,d,s]),f=T.useCallback((E,N,j,C,D,k,w=!1)=>{const S=new Map;C.forEach(O=>S.set(O.module_id,O.is_enabled));const P=new Map;return D.forEach(O=>P.set(O.module_id,{is_enabled:O.is_enabled,is_locked_by_system:O.is_locked_by_system})),E.map(O=>{const L=k==null?void 0:k.find(Y=>Y.name===O.label),$=L==null?void 0:L.id;if(O.path&&j&&N!=="super-admin"&&$){const Y=P.get($);if(Y===void 0||Y.is_enabled===!1)return null}if($&&S.has($)&&!S.get($)||L&&L.roles&&L.roles.length>0&&(!N||!L.roles.includes(N)))return null;const B=O.isLocked&&N!=="super-admin";if(!w&&O.isHidden&&!B||O.companyRequired&&!j||O.roles&&(!N||!O.roles.includes(N)))return null;if(O.children){const Y=f(O.children,N,j,C,D,k,w);return Y.length>0?{...O,children:Y}:null}return O}).filter(O=>O!==null)},[x]),_=T.useMemo(()=>!c||g?[]:f(y,c.role,c.company_id,h||[],d||[],s,!1),[y,c,h,d,f,g,s]),b=T.useMemo(()=>!c||g?[]:f(y,c.role,c.company_id,h||[],d||[],s,!0),[y,c,h,d,f,g,s]);return{menuItems:_,editableMenuItems:b,saveMenuPreferences:v.mutate,isSavingPreferences:v.isPending,isLoading:u||r||p||o||g}}const Xb=()=>{const{profile:n,isLoading:a}=Ie(),t=n==null?void 0:n.user_id,r=Ye(),{toast:i}=Ke(),{data:l,isLoading:c}=je({queryKey:["unreadNotifications",t],queryFn:async()=>{if(!t)return[];const{data:d,error:o}=await X.from("expense_notifications").select("id, title, message, created_at, is_read, expense_id").eq("user_id",t).eq("is_read",!1).order("created_at",{ascending:!1}).limit(5);if(o)throw o;return d},enabled:!!t}),m=Oe({mutationFn:async d=>{const{error:o}=await X.from("expense_notifications").update({is_read:!0}).eq("id",d).eq("user_id",t);if(o)throw o;return null},onSuccess:()=>{r.invalidateQueries({queryKey:["unreadNotifications",t]}),r.invalidateQueries({queryKey:["notifications",t]})},onError:d=>{i({title:"Error marking notification as read",description:d.message||"An unexpected error occurred.",variant:"destructive"})}}),u=d=>{d.is_read||m.mutate(d.id)},h=(l==null?void 0:l.length)||0,p=a||c;return e.jsxs(rs,{children:[e.jsx(as,{asChild:!0,children:e.jsxs(ee,{variant:"ghost",size:"icon",className:"relative",children:[e.jsx(La,{className:"h-5 w-5"}),h>0&&e.jsx(It,{variant:"destructive",className:"absolute -top-1 -right-1 h-4 w-4 justify-center rounded-full p-0 text-xs",children:h}),e.jsx("span",{className:"sr-only",children:"Notifications"})]})}),e.jsxs(Ba,{align:"end",className:"w-80",children:[e.jsx(Dc,{children:"Notifications"}),e.jsx(Pi,{}),p?e.jsx("div",{className:"flex items-center justify-center p-4",children:e.jsx(fe,{className:"h-5 w-5 animate-spin"})}):l&&l.length>0?l.map(d=>e.jsx(Tn,{asChild:!0,children:e.jsxs(Dt,{to:`/expenses/${d.expense_id}`,className:"flex flex-col items-start gap-1 p-2",onClick:()=>u(d),children:[e.jsx("p",{className:"font-semibold",children:d.title}),e.jsx("p",{className:"text-sm text-muted-foreground whitespace-normal",children:d.message}),e.jsx("p",{className:"text-xs text-muted-foreground",children:Kl(new Date(d.created_at),{addSuffix:!0})})]})},d.id)):e.jsx("p",{className:"p-4 text-sm text-center text-muted-foreground",children:"No new notifications"}),e.jsx(Pi,{}),e.jsx(Tn,{asChild:!0,children:e.jsx(Dt,{to:"/notifications",className:"w-full justify-center",children:"View All Notifications"})})]})]})},Jb=({isSidebarCollapsed:n})=>{const{profile:a,isLoading:t}=Ie(),r=kn(),i=()=>{r("/settings")};if(t)return e.jsxs(ee,{variant:"ghost",size:"icon",className:pe("relative h-9 w-9 rounded-full",n?"mx-auto":""),disabled:!0,children:[e.jsx(fe,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{className:"sr-only",children:"Loading profile"})]});const l=a==null?void 0:a.avatar_url,m=(a!=null&&a.first_name?a.first_name.charAt(0).toUpperCase():"")||(a!=null&&a.email?a.email.charAt(0).toUpperCase():"?");return e.jsxs(ee,{variant:"ghost",size:"icon",className:pe("relative h-9 w-9 rounded-full",n?"mx-auto":"","hover:bg-muted-foreground/10"),onClick:i,"aria-label":"View Profile Settings",children:[e.jsxs(_r,{className:"h-8 w-8",children:[e.jsx(jr,{src:l||void 0,alt:"User Avatar"}),e.jsx(wr,{className:"bg-gray-300 dark:bg-gray-700 text-gray-800 dark:text-gray-200 text-sm font-medium",children:m})]}),e.jsx("span",{className:"sr-only",children:"Profile Settings"})]})},ca="sidebar-width",mr=22,da=5,qo=8,e_=({item:n,isActive:a,isSidebarCollapsed:t,isEditingMenu:r,userRole:i,onToggleVisibility:l,isLocked:c})=>{const{attributes:m,listeners:u,setNodeRef:h,transform:p,transition:d,isDragging:o}=Cm({id:n.id,disabled:!r}),s={transform:Am.Transform.toString(p),transition:d,zIndex:o?100:"auto",opacity:o?.7:1},g=$i(),[v,x]=W.useState(!1);if(W.useEffect(()=>{var f;(f=n.children)!=null&&f.some(_=>_.path&&a(_.path))&&x(!0)},[g.pathname,n.children,a]),n.children&&n.children.length>0)return e.jsx("div",{ref:h,style:s,children:e.jsxs(vs,{open:v,onOpenChange:x,children:[e.jsxs("div",{className:pe("flex items-center rounded-lg transition-all",r&&"border border-dashed border-muted-foreground/50"),children:[r&&e.jsx("div",{...u,...m,className:"cursor-grab p-3 -ml-1 -my-1 rounded-sm hover:bg-muted-foreground/10",children:e.jsx(Ls,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx(xs,{asChild:!0,children:e.jsxs("div",{className:pe("flex flex-1 items-center rounded-lg h-10 cursor-pointer transition-all",a(n.path||"")?"bg-brand-accent text-brand-accent-foreground hover:bg-brand-accent":"text-sidebar-foreground hover:bg-muted",t?"justify-center":"justify-start px-3"),children:[e.jsx(n.icon,{className:"h-4 w-4 flex-shrink-0"}),!t&&e.jsx("span",{className:"ml-3 flex-1 min-w-0 overflow-hidden whitespace-nowrap text-ellipsis",children:n.label}),!t&&e.jsx(Bn,{className:pe("h-4 w-4 flex-shrink-0 transition-transform duration-200",v&&"rotate-180")})]})})]}),e.jsx(ys,{className:pe("pl-7 mt-1 space-y-1",t&&"hidden"),children:n.children.map(f=>e.jsxs(Dt,{to:f.path,className:pe("flex items-center gap-3 rounded-lg px-3 h-10 transition-all",a(f.path)?"bg-brand-accent text-brand-accent-foreground":"text-sidebar-foreground hover:bg-muted"),children:[e.jsx(f.icon,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{className:"flex-1 min-w-0 overflow-hidden whitespace-nowrap text-ellipsis",children:f.label})]},f.id))})]})});const y=n.id==="dashboard"&&i==="super-admin"?"/super-admin-dashboard":n.path;return e.jsx("div",{ref:h,style:s,className:pe(r&&"border border-dashed border-muted-foreground/50"),children:e.jsxs("div",{className:"flex items-center",children:[r&&e.jsx("div",{...u,...m,className:"cursor-grab p-3 -ml-1 -my-1 rounded-sm hover:bg-muted-foreground/10",children:e.jsx(Ls,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs(Dt,{to:y,className:pe("flex flex-1 items-center gap-3 rounded-lg h-10 transition-all",a(y)?"bg-brand-accent text-brand-accent-foreground":"text-sidebar-foreground hover:bg-muted",t?"justify-center":"justify-start px-3"),children:[e.jsx(n.icon,{className:"h-4 w-4 flex-shrink-0"}),!t&&e.jsx("span",{className:"flex-1 min-w-0 whitespace-nowrap overflow-hidden text-ellipsis",children:n.label})]}),r&&e.jsxs(ee,{variant:"ghost",size:"icon",onClick:()=>l(n.id),className:"h-6 w-6 flex-shrink-0",disabled:c&&i!=="super-admin",children:[n.isHidden?e.jsx(nm,{className:"h-3 w-3"}):e.jsx(mn,{className:"h-3 w-3"}),e.jsx("span",{className:"sr-only",children:n.isHidden?"Show":"Hide"})]})]})})},t_=()=>{const n=ns(),{session:a,profile:t,impersonatedProfile:r}=Ie(),i=$i(),l=t==null?void 0:t.role,{toast:c}=Ke(),m=Nu(),{menuItems:u,editableMenuItems:h,saveMenuPreferences:p,isSavingPreferences:d,isLoading:o}=Qb(),[s,g]=T.useState(!1),[v,x]=W.useState([]),[y,f]=T.useState(!0),[_,b]=T.useState(mr),[E,N]=T.useState(!1),j=T.useRef(null);W.useEffect(()=>{s&&x(h)},[s,h]),T.useEffect(()=>{var F;const q=m[m.length-1],R=(F=q==null?void 0:q.handle)==null?void 0:F.pageTitle;R?document.title=R:document.title="INFOtrac"},[m]),W.useEffect(()=>{if(typeof window<"u"){const q=localStorage.getItem(ca),R=q?parseFloat(q):mr;b(R),f(R>qo)}},[]);const C=ym(Rs(km),Rs(Em,{coordinateGetter:Sm}));function D(q){const{active:R,over:F}=q;R.id!==(F==null?void 0:F.id)&&x(M=>{const z=(A,V)=>{for(let K=0;K<A.length;K++){if(A[K].id===V)return[K];if(A[K].children){const Q=z(A[K].children,V);if(Q.length>0)return[K,...Q]}}return[]},H=z(M,R.id),I=z(M,F.id);return H.length===1&&I.length===1?Nm(M,H[0],I[0]):M})}const k=q=>{const R=F=>F.map(M=>M.id===q?{...M,isHidden:!M.isHidden}:M.children?{...M,children:R(M.children)}:M);x(F=>R(F))},w=q=>{localStorage.setItem(ca,q.toString()),b(q),f(q>qo)},S=()=>{j.current&&(y?(j.current.setLayout([da,100-da]),f(!1),localStorage.setItem(ca,da.toString())):(j.current.setLayout([mr,100-mr]),f(!0),localStorage.setItem(ca,mr.toString())))},P=!y,O=()=>{const q=F=>{let M=[];for(const z of F)M.push({id:z.id,isHidden:z.isHidden||!1}),z.children&&(M=M.concat(q(z.children)));return M},R=q(v);p(R,{onSuccess:()=>{c({title:"Menu Preferences Saved",description:"Your sidebar menu order and visibility have been updated."}),g(!1)},onError:F=>{c({title:"Error Saving Preferences",description:F.message||"Failed to save menu preferences.",variant:"destructive"})}})},L=()=>{x(h),g(!1),c({title:"Edit Canceled",description:"Your menu changes have been discarded."})},$=async()=>{console.log("Attempting logout. Current session:",a);try{const{error:q}=await X.auth.signOut();q?q.message.includes("Auth session missing!")||q.message.includes("No current session")?(console.warn("Logout: Supabase reported no active session. Treating as successful logout."),c({title:"Logged out",description:"You have been successfully logged out."})):(console.error("Logout error from Supabase:",q),c({title:"Logout Error",description:q.message,variant:"destructive"})):(console.log("Successfully signed out from Supabase."),c({title:"Logged out",description:"You have been successfully logged out."}))}catch(q){console.error("Unexpected error during logout:",q),c({title:"Unexpected Logout Error",description:q.message||"An unexpected error occurred during logout.",variant:"destructive"})}finally{window.location.reload()}},B=()=>{const q=F=>i.pathname===F,R=s?v:u;return o?e.jsxs("div",{className:"flex items-center justify-center p-4 text-muted-foreground",children:[e.jsx(fe,{className:"h-4 w-4 animate-spin mr-2"})," Loading menu..."]}):e.jsx("nav",{className:"flex flex-col gap-1 p-2",children:e.jsx(bm,{sensors:C,collisionDetection:_m,onDragEnd:D,children:e.jsx(jm,{items:R.map(F=>F.id),strategy:wm,children:R.map(F=>e.jsx(e_,{item:F,isActive:q,isSidebarCollapsed:P,isEditingMenu:s,userRole:l,onToggleVisibility:k,isLocked:F.isLocked},F.id))})})})},Y=()=>e.jsxs("div",{className:"relative flex items-center h-16 border-b bg-sidebar-background flex-shrink-0 group",children:[e.jsxs(Dt,{to:"/",className:pe("flex items-center gap-2 font-semibold",P?"justify-center w-full":"justify-start flex-1 px-4"),onClick:P?S:void 0,children:[e.jsx("img",{src:"/infotrac-logo.png",alt:"INFOtrac Logo",className:pe("w-auto flex-shrink-0 object-contain",P?"h-10 w-10":"h-8")}),!P&&e.jsx("span",{className:"text-lg text-brand-accent",children:"INFOtrac"})]}),!n&&(y&&e.jsxs(ee,{variant:"ghost",size:"icon",onClick:S,className:"h-8 w-8",children:[e.jsx(Xn,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Collapse sidebar"})]})||P&&e.jsxs(ee,{variant:"ghost",size:"icon",onClick:S,className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 h-8 w-8 rounded-full z-10 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(qn,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Expand sidebar"})]}))]}),U=()=>e.jsxs("div",{className:"mt-auto p-2 border-t bg-sidebar-background flex-shrink-0",children:[s?e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsxs(ee,{size:"sm",className:"w-full",onClick:O,disabled:d,children:[d&&e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}),e.jsx(pn,{className:"mr-2 h-4 w-4"})," ",!P&&"Save"]}),e.jsxs(ee,{size:"sm",variant:"outline",className:"w-full",onClick:L,disabled:d,children:[e.jsx(Ft,{className:"mr-2 h-4 w-4"})," ",!P&&"Cancel"]})]}):!P&&e.jsxs(ee,{variant:"outline",className:"w-full justify-start mb-2",onClick:()=>g(!0),size:P?"icon":"default",children:[e.jsx(em,{className:pe("h-4 w-4",!P&&"mr-2")})," ",!P&&"Edit Menu"]}),e.jsx(Zb,{isSidebarCollapsed:P}),e.jsxs("div",{className:pe("flex items-center mt-2",P?"flex-col gap-2":"justify-between"),children:[e.jsx(Xb,{}),e.jsx(Jb,{isSidebarCollapsed:P}),e.jsxs(ee,{variant:"ghost",size:"icon",onClick:$,children:[e.jsx(tm,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Logout"})]})]})]});return n?e.jsxs("div",{className:"flex min-h-screen w-full flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between h-16 px-4 border-b bg-background",children:[e.jsxs(Hb,{children:[e.jsx(Vb,{asChild:!0,children:e.jsxs(ee,{variant:"outline",size:"icon",className:"shrink-0",children:[e.jsx(Ju,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Toggle navigation menu"})]})}),e.jsxs($d,{side:"left",className:"flex flex-col bg-sidebar-background p-0",children:[e.jsx(Y,{}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsx(B,{})}),r&&e.jsxs("div",{className:"p-4 text-sm text-red-500 bg-red-100 dark:bg-red-900 dark:text-red-200 rounded-md mx-4",children:["Impersonating: ",r.full_name||r.email," (",r.role,")"]}),e.jsx(U,{})]})]}),e.jsxs(Dt,{to:"/",className:"flex items-center gap-2 font-semibold",children:[e.jsx("img",{src:"/infotrac-logo.png",alt:"INFOtrac Logo",className:"h-6 w-auto flex-shrink-0 object-contain"}),e.jsx("span",{className:"text-lg text-brand-accent",children:"INFOtrac"})]})]}),e.jsx("main",{className:"flex flex-1 flex-col gap-4 p-4 md:gap-8 md:p-6 overflow-auto",children:e.jsx(Cs,{})})]}):e.jsx("div",{className:"flex h-screen w-full bg-muted/40 overflow-hidden",children:e.jsxs(zd,{ref:j,direction:"horizontal",className:"flex-1",onLayout:q=>w(q[0]),onDragStart:()=>N(!0),onDragEnd:()=>N(!1),children:[e.jsxs(qi,{defaultSize:_,onResize:w,minSize:da,maxSize:mr,className:pe("flex flex-col border-r bg-sidebar-background",E?"no-transition":"transition-all duration-300 ease-in-out"),children:[e.jsx(Y,{}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsx(B,{})}),r&&e.jsxs("div",{className:"p-2 text-xs text-center text-red-500 bg-red-100 dark:bg-red-900 dark:text-red-200 rounded-md mx-2",children:["Impersonating: ",r.full_name||r.email," (",r.role,")"]}),e.jsx(U,{})]}),e.jsx(Bd,{className:"w-2 bg-border hover:bg-primary transition-colors"}),e.jsx(qi,{className:"flex flex-col",children:e.jsx("main",{className:"flex flex-1 flex-col gap-4 p-4 md:gap-8 md:p-6 overflow-auto",children:e.jsx(Cs,{})})})]})})},n_=tt({first_name:J().min(1,"First name is required"),last_name:J().min(1,"Last name is required"),avatar_file:nr().optional().nullable()}),r_=tt({name:J().min(1,"Company name is required"),logo_file:nr().optional().nullable(),legal_name:J().optional().nullable(),tax_id:J().optional().nullable(),phone_number:J().optional().nullable(),website:J().url("Invalid URL").or(Fa("")).optional().nullable(),industry:J().optional().nullable(),address_line_1:J().optional().nullable(),address_line_2:J().optional().nullable(),city:J().optional().nullable(),state_province:J().optional().nullable(),postal_code:J().optional().nullable(),country:J().optional().nullable(),fiscal_year_end_date:Ji().nullable().optional()}),Hd=()=>{const n=Ye(),{toast:a}=Ke(),t=kn(),{user:r,profile:i,isLoading:l}=Ie(),[c,m]=T.useState("profile-setup"),[u,h]=T.useState(null),[p,d]=T.useState(null),o=ct({resolver:dt(n_),defaultValues:{first_name:(i==null?void 0:i.first_name)||"",last_name:(i==null?void 0:i.last_name)||"",avatar_file:null}});T.useEffect(()=>{i&&o.reset({first_name:i.first_name||"",last_name:i.last_name||"",avatar_file:null})},[i,o]);const s=Oe({mutationFn:async C=>{var w;if(!(r!=null&&r.id))throw new Error("User not authenticated.");let D=i==null?void 0:i.avatar_url;if(u){const S=u.name.split(".").pop(),P=`${r.id}/avatar.${S}`,{error:O}=await X.storage.from("avatars").upload(P,u,{upsert:!0});if(O)throw O;const{data:L}=X.storage.from("avatars").getPublicUrl(P);D=`${L.publicUrl}?t=${Date.now()}`}else if(u===null&&(i!=null&&i.avatar_url)){const S=(w=i.avatar_url.split("/public/avatars/")[1])==null?void 0:w.split("?")[0];S&&await X.storage.from("avatars").remove([S]),D=null}const{error:k}=await X.from("profiles").update({first_name:C.first_name,last_name:C.last_name,full_name:(C.first_name||"")+" "+(C.last_name||""),avatar_url:D,updated_at:new Date().toISOString()}).eq("user_id",r.id);if(k)throw k;return null},onSuccess:()=>{n.invalidateQueries({queryKey:["profiles"]}),a({title:"Profile Saved",description:"Your profile details have been updated."}),h(null)},onError:C=>{a({title:"Error Saving Profile",description:C.message,variant:"destructive"})}}),g=ct({resolver:dt(r_),defaultValues:{name:"",logo_file:null,legal_name:"",tax_id:"",phone_number:"",website:"",industry:"",address_line_1:"",address_line_2:"",city:"",state_province:"",postal_code:"",country:"",fiscal_year_end_date:void 0}}),{data:v,isLoading:x}=je({queryKey:["companyDetailsForOnboarding",i==null?void 0:i.company_id],queryFn:async()=>{if(!(i!=null&&i.company_id))return null;const{data:C,error:D}=await X.from("companies").select("*").eq("id",i.company_id).single();if(D&&D.code!=="PGRST116")throw D;return C},enabled:!!(i!=null&&i.company_id)&&!l});T.useEffect(()=>{v&&(g.reset({name:v.name,logo_file:null,legal_name:v.legal_name||"",tax_id:v.tax_id||"",phone_number:v.phone_number||"",website:v.website||"",industry:v.industry||"",address_line_1:v.address_line_1||"",address_line_2:v.address_line_2||"",city:v.city||"",state_province:v.state_province||"",postal_code:v.postal_code||"",country:v.country||"",fiscal_year_end_date:v.fiscal_year_end_date?new Date(v.fiscal_year_end_date):void 0}),d(null))},[v,g]);const y=Oe({mutationFn:async C=>{if(!(i!=null&&i.company_id))throw new Error("Company ID not found.");let D=v==null?void 0:v.logo_url;if(p){const w=p.name.split(".").pop(),S=`${i.company_id}/logo.${w}`,{error:P}=await X.storage.from("company-logos").upload(S,p,{upsert:!0});if(P)throw P;const{data:O}=X.storage.from("company-logos").getPublicUrl(S);D=O.publicUrl}else if(p===null&&(v!=null&&v.logo_url)){const w=v.logo_url.split("/public/company-logos/")[1];w&&await X.storage.from("company-logos").remove([w]),D=null}const{error:k}=await X.from("companies").update({name:C.name,logo_url:D,legal_name:C.legal_name||null,tax_id:C.tax_id||null,phone_number:C.phone_number||null,website:C.website||null,industry:C.industry||null,address_line_1:C.address_line_1||null,address_line_2:C.address_line_2||null,city:C.city||null,state_province:C.state_province||null,postal_code:C.postal_code||null,country:C.country||null,fiscal_year_end_date:C.fiscal_year_end_date?C.fiscal_year_end_date.toISOString().split("T")[0]:null,updated_at:new Date().toISOString()}).eq("id",i.company_id);if(k)throw k;return null},onSuccess:()=>{n.invalidateQueries({queryKey:["companyDetailsForOnboarding",i==null?void 0:i.company_id]}),n.invalidateQueries({queryKey:["companySettings",i==null?void 0:i.company_id]}),n.invalidateQueries({queryKey:["companies"]}),a({title:"Company Saved",description:"Your company details have been updated."}),d(null)},onError:C=>{a({title:"Error Saving Company",description:C.message,variant:"destructive"})}}),{data:f,isLoading:_}=je({queryKey:["companyModulesForOnboarding",i==null?void 0:i.company_id],queryFn:async()=>{if(!(i!=null&&i.company_id))return[];const{data:C,error:D}=await X.from("company_modules").select(`
          id,
          module_id,
          is_enabled,
          is_locked_by_system,
          modules (name, description)
        `).eq("company_id",i.company_id);if(D)throw D;return(C||[]).map(k=>({...k,modules:Array.isArray(k.modules)&&k.modules.length>0?k.modules[0]:k.modules}))},enabled:!!(i!=null&&i.company_id)&&!l}),b=l||x||_,E=s.isPending,N=y.isPending,j=async()=>{const C=o.handleSubmit(k=>s.mutate(k))(),D=g.handleSubmit(k=>y.mutate(k))();try{await Promise.all([C,D]),await n.refetchQueries({queryKey:["profiles",r==null?void 0:r.id],exact:!0}),a({title:"Setup Complete",description:"Your company and profile setup is complete. Redirecting to dashboard."}),t("/dashboard",{replace:!0})}catch(k){console.error("Error during complete setup:",k)}};return b?e.jsxs("div",{className:"flex min-h-screen w-full flex-col items-center justify-center",children:[e.jsx(fe,{className:"h-8 w-8 animate-spin"}),e.jsx("p",{className:"ml-2",children:"Loading onboarding..."})]}):!i||i.role!=="admin"||!i.company_id?(t("/",{replace:!0}),null):e.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gray-100 dark:bg-gray-900 p-4",children:e.jsxs("div",{className:"w-full max-w-4xl bg-white dark:bg-gray-800 p-8 rounded-lg shadow-md",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx("img",{src:"/infotrac-logo.png",alt:"INFOtrac Logo",className:"h-16 w-auto object-contain"})}),e.jsx("h2",{className:"text-2xl font-bold text-center mb-6 text-gray-900 dark:text-white",children:"Welcome! Complete Your Company Setup"}),e.jsxs(dn,{value:c,onValueChange:m,className:"w-full",children:[e.jsxs(sn,{className:"grid w-full grid-cols-3",children:[e.jsx(ze,{value:"profile-setup",children:"Profile Setup"}),e.jsx(ze,{value:"company-details",children:"Company Details"}),e.jsx(ze,{value:"module-access",children:"Module Access"})]}),e.jsxs(Ve,{value:"profile-setup",children:[e.jsxs(we,{children:[e.jsxs(Ae,{children:[e.jsxs(Ee,{className:"flex items-center gap-2",children:[e.jsx(Qi,{className:"h-5 w-5"})," Your Profile"]}),e.jsx(Re,{children:"Update your personal information and add an avatar."})]}),e.jsx(ke,{children:e.jsxs("form",{onSubmit:o.handleSubmit(C=>s.mutate(C)),className:"grid gap-6",children:[e.jsx("div",{className:"flex flex-col items-center gap-4",children:e.jsx(gs,{currentAvatarUrl:i==null?void 0:i.avatar_url,onFileSelected:h,isLoading:E,disabled:E})}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"profile-first_name",children:"First Name"}),e.jsx(ne,{id:"profile-first_name",...o.register("first_name"),disabled:E}),o.formState.errors.first_name&&e.jsx("p",{className:"text-sm text-destructive",children:o.formState.errors.first_name.message})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"profile-last_name",children:"Last Name"}),e.jsx(ne,{id:"profile-last_name",...o.register("last_name"),disabled:E}),o.formState.errors.last_name&&e.jsx("p",{className:"text-sm text-destructive",children:o.formState.errors.last_name.message})]}),e.jsxs(ee,{type:"submit",disabled:E,children:[E&&e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Profile"]})]})})]}),e.jsx("div",{className:"flex justify-end p-6 pt-0",children:e.jsxs(ee,{type:"button",onClick:()=>m("company-details"),disabled:E,children:["Next ",e.jsx(qn,{className:"ml-2 h-4 w-4"})]})})]}),e.jsxs(Ve,{value:"company-details",children:[e.jsxs(we,{children:[e.jsxs(Ae,{children:[e.jsxs(Ee,{className:"flex items-center gap-2",children:[e.jsx(Gr,{className:"h-5 w-5"})," Company Details"]}),e.jsx(Re,{children:"Review and complete your company's information."})]}),e.jsx(ke,{children:e.jsxs("form",{onSubmit:g.handleSubmit(C=>y.mutate(C)),className:"grid gap-6",children:[e.jsx("div",{className:"flex flex-col items-center gap-4",children:e.jsx(yd,{currentLogoUrl:v==null?void 0:v.logo_url,onFileSelected:d,isLoading:N,disabled:N})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"company-name",children:"Company Name"}),e.jsx(ne,{id:"company-name",...g.register("name"),disabled:N}),g.formState.errors.name&&e.jsx("p",{className:"text-sm text-destructive",children:g.formState.errors.name.message})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"legal_name",children:"Legal Name (Optional)"}),e.jsx(ne,{id:"legal_name",...g.register("legal_name"),disabled:N})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"tax_id",children:"Tax ID / VAT Number (Optional)"}),e.jsx(ne,{id:"tax_id",...g.register("tax_id"),disabled:N})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"phone_number",children:"Phone Number (Optional)"}),e.jsx(ne,{id:"phone_number",...g.register("phone_number"),disabled:N})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"website",children:"Website (Optional)"}),e.jsx(ne,{id:"website",type:"url",...g.register("website"),disabled:N}),g.formState.errors.website&&e.jsx("p",{className:"text-sm text-destructive",children:g.formState.errors.website.message})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"industry",children:"Industry (Optional)"}),e.jsx(ne,{id:"industry",...g.register("industry"),disabled:N})]})]}),e.jsx(lt,{className:"my-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Primary Address (Optional)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"address_line_1",children:"Address Line 1"}),e.jsx(ne,{id:"address_line_1",...g.register("address_line_1"),disabled:N})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"address_line_2",children:"Address Line 2 (Optional)"}),e.jsx(ne,{id:"address_line_2",...g.register("address_line_2"),disabled:N})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"city",children:"City"}),e.jsx(ne,{id:"city",...g.register("city"),disabled:N})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"state_province",children:"State/Province"}),e.jsx(ne,{id:"state_province",...g.register("state_province"),disabled:N})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"postal_code",children:"Zip/Postal Code"}),e.jsx(ne,{id:"postal_code",...g.register("postal_code"),disabled:N})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"country",children:"Country"}),e.jsx(ne,{id:"country",...g.register("country"),disabled:N})]})]}),e.jsx(lt,{className:"my-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Financial Settings"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{className:"grid gap-2",children:[e.jsx(G,{htmlFor:"fiscal_year_end_date",children:"Fiscal Year End Date"}),e.jsxs(ms,{children:[e.jsx(ps,{asChild:!0,children:e.jsxs(ee,{variant:"outline",className:pe("w-full justify-start text-left font-normal",!g.watch("fiscal_year_end_date")&&"text-muted-foreground"),disabled:N,children:[e.jsx(Zi,{className:"mr-2 h-4 w-4"}),g.watch("fiscal_year_end_date")?at(g.watch("fiscal_year_end_date"),"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(Ha,{className:"w-auto p-0",children:e.jsx($a,{mode:"single",selected:g.watch("fiscal_year_end_date")||void 0,onSelect:C=>g.setValue("fiscal_year_end_date",C||null),initialFocus:!0})})]}),g.formState.errors.fiscal_year_end_date&&e.jsx("p",{className:"text-sm text-destructive",children:g.formState.errors.fiscal_year_end_date.message})]})}),e.jsxs(ee,{type:"submit",disabled:N,children:[N&&e.jsx(fe,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Company Details"]})]})})]}),e.jsxs("div",{className:"flex justify-between p-6 pt-0",children:[e.jsxs(ee,{type:"button",variant:"outline",onClick:()=>m("profile-setup"),disabled:N,children:[e.jsx(Xn,{className:"mr-2 h-4 w-4"})," Previous"]}),e.jsxs(ee,{type:"button",onClick:()=>m("module-access"),disabled:N,children:["Next ",e.jsx(qn,{className:"ml-2 h-4 w-4"})]})]})]}),e.jsxs(Ve,{value:"module-access",children:[e.jsxs(we,{children:[e.jsxs(Ae,{children:[e.jsxs(Ee,{className:"flex items-center gap-2",children:[e.jsx(br,{className:"h-5 w-5"})," Your Company's Modules"]}),e.jsx(Re,{children:"These are the modules enabled for your company, as provisioned by the Super Admin."})]}),e.jsx(ke,{children:(f||[]).length===0?e.jsx("p",{className:"text-muted-foreground",children:"No modules are currently enabled for your company."}):e.jsxs(Ct,{children:[e.jsx(At,{children:e.jsxs(Me,{children:[e.jsx(be,{children:"Module Name"}),e.jsx(be,{children:"Description"}),e.jsx(be,{children:"Status"})]})}),e.jsx(Pt,{children:(f||[]).map(C=>{var D,k;return e.jsxs(Me,{children:[e.jsx(ve,{className:"font-medium",children:((D=C.modules)==null?void 0:D.name)||"Unknown"}),e.jsx(ve,{children:((k=C.modules)==null?void 0:k.description)||"N/A"}),e.jsxs(ve,{children:[e.jsx(bt,{checked:C.is_enabled,disabled:!0}),C.is_locked_by_system&&e.jsx("span",{className:"ml-2 text-xs text-muted-foreground",children:"(Locked)"})]})]},C.id)})})]})})]}),e.jsxs("div",{className:"flex justify-between p-6 pt-0",children:[e.jsxs(ee,{type:"button",variant:"outline",onClick:()=>m("company-details"),disabled:E||N,children:[e.jsx(Xn,{className:"mr-2 h-4 w-4"})," Previous"]}),e.jsxs(ee,{onClick:j,disabled:E||N,children:[e.jsx(pn,{className:"mr-2 h-4 w-4"})," Complete Setup"]})]})]})]})]})})},a_=new sm,i_=()=>e.jsx("div",{className:"flex min-h-screen w-full flex-col items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-2xl font-bold tracking-tight mb-4",children:"Awaiting Company Assignment"}),e.jsx("p",{className:"text-lg text-muted-foreground mb-6",children:"Your account is active, but you haven't been assigned to a company yet. Please contact your administrator to get started."})]})}),zo=({children:n,allowedRoles:a})=>{const{session:t,profile:r,impersonatedProfile:i,isLoading:l}=Ie(),c=kn(),m=$i(),u=i||r,[h,p]=T.useState(!1),[d,o]=T.useState(!1);return T.useEffect(()=>{(async()=>{if(l)return;let g=null,v=!1,x=!1;if(!t)m.pathname!=="/login"&&m.pathname!=="/accept-invite"&&(g="/login");else if(!u)m.pathname!=="/complete-profile"&&m.pathname!=="/onboarding"&&(g="/complete-profile");else if(!u.first_name||!u.last_name)u.role==="admin"&&u.company_id?m.pathname!=="/onboarding"&&(g="/onboarding",x=!0):m.pathname!=="/complete-profile"&&(g="/complete-profile");else if(u.role==="super-admin"){const{count:y,error:f}=await X.from("companies").select("id",{count:"exact",head:!0});f?(console.error("ProtectedRoute: Error checking companies for super-admin:",f),g="/company-setup"):(y??0)===0?m.pathname!=="/company-setup"&&(g="/company-setup"):(m.pathname==="/"||m.pathname==="/login")&&(g="/super-admin-dashboard")}else!u.company_id&&u.role!=="super-admin"?(m.pathname!=="/"&&(g="/"),v=!0):(m.pathname==="/login"||m.pathname==="/accept-invite"||m.pathname==="/")&&(u.role==="super-admin"?g="/super-admin-dashboard":g="/dashboard");p(v),o(x),g&&m.pathname!==g&&c(g,{replace:!0})})()},[l,t,u,m.pathname,c]),l?e.jsxs("div",{className:"flex min-h-screen w-full flex-col items-center justify-center",children:[e.jsx(fe,{className:"h-8 w-8 animate-spin"}),e.jsx("p",{className:"ml-2",children:"Loading application..."})]}):t&&!u&&!l?(m.pathname!=="/complete-profile"&&m.pathname!=="/onboarding"&&c("/complete-profile",{replace:!0}),e.jsxs("div",{className:"flex min-h-screen w-full flex-col items-center justify-center",children:[e.jsx(fe,{className:"h-8 w-8 animate-spin"}),e.jsx("p",{className:"ml-2",children:"Loading profile data..."})]})):h&&m.pathname==="/"?e.jsx(i_,{}):d&&m.pathname==="/onboarding"?e.jsx(Hd,{}):a&&u&&!a.includes(u.role)?e.jsx("div",{className:"min-h-screen flex items-center justify-center text-destructive",children:e.jsx("p",{children:"Access Denied: You do not have the necessary permissions to view this page."})}):e.jsx(e.Fragment,{children:n})},s_=[{path:"/login",element:e.jsx(Mf,{})},{path:"/accept-invite",element:e.jsx(mx,{})},{path:"/complete-profile",element:e.jsx(oy,{})},{path:"/onboarding",element:e.jsx(zo,{allowedRoles:["admin"],children:e.jsx(Hd,{})})},{element:e.jsx(zo,{children:e.jsx(t_,{})}),children:[{path:"/",element:e.jsx(Sp,{}),handle:{pageTitle:"INFOtrac - Welcome"}},{path:"/dashboard",element:e.jsx(sb,{}),handle:{pageTitle:"INFOtrac - Dashboard"}},{path:"/super-admin-dashboard",element:e.jsx(ry,{}),handle:{pageTitle:"INFOtrac - Super Admin Dashboard"}},{path:"/company-setup",element:e.jsx(iy,{}),handle:{pageTitle:"INFOtrac - Company Setup"}},{path:"/companies",element:e.jsx(zf,{}),handle:{pageTitle:"INFOtrac - Companies"}},{path:"/vendors",element:e.jsx(ph,{}),handle:{pageTitle:"INFOtrac - Vendors"}},{path:"/customers",element:e.jsx(gh,{}),handle:{pageTitle:"INFOtrac - Customers"}},{path:"/expenses",element:e.jsx(rx,{}),handle:{pageTitle:"INFOtrac - My Expenses"}},{path:"/expenses/:id",element:e.jsx(ax,{}),handle:{pageTitle:"INFOtrac - Expense Details"}},{path:"/expense-review",element:e.jsx(sx,{}),handle:{pageTitle:"INFOtrac - Expense Review"}},{path:"/expense-categories",element:e.jsx(lx,{}),handle:{pageTitle:"INFOtrac - Expense Categories"}},{path:"/gl-accounts",element:e.jsx(dx,{}),handle:{pageTitle:"INFOtrac - GL Accounts"}},{path:"/notifications",element:e.jsx(ux,{}),handle:{pageTitle:"INFOtrac - Notifications"}},{path:"/billing",element:e.jsx(px,{}),handle:{pageTitle:"INFOtrac - Billing"}},{path:"/settings",element:e.jsx(ty,{}),handle:{pageTitle:"INFOtrac - Profile Settings"}},{path:"/company-settings",element:e.jsx(Yy,{}),handle:{pageTitle:"INFOtrac - Company Settings"}},{path:"/system-notification-settings",element:e.jsx(pb,{}),handle:{pageTitle:"INFOtrac - System Notification Settings"}},{path:"/company-modules-overview",element:e.jsx(Zf,{}),handle:{pageTitle:"INFOtrac - Modules Overview"}},{path:"/system-modules",element:e.jsx(Kf,{}),handle:{pageTitle:"INFOtrac - System Modules"}},{path:"/company-notification-settings",element:e.jsx(xd,{}),handle:{pageTitle:"INFOtrac - Company Notification Settings"}},{path:"/system-billing-settings",element:e.jsx(Zy,{}),handle:{pageTitle:"INFOtrac - System Billing"}},{path:"/process-automation",element:e.jsx(Qy,{}),handle:{pageTitle:"INFOtrac - Process Automation"}},{path:"/analytics",element:e.jsx("div",{className:"flex flex-1 items-center justify-center rounded-lg border border-dashed shadow-sm p-4",children:e.jsx("p",{className:"text-muted-foreground",children:"Analytics content coming soon!"})}),handle:{pageTitle:"INFOtrac - Analytics"}},{path:"/users",element:e.jsx(oh,{}),handle:{pageTitle:"INFOtrac - Users"}},{path:"*",element:e.jsx(Ep,{}),handle:{pageTitle:"INFOtrac - Page Not Found"}}]}],o_=Su(s_,{future:void 0});class l_{constructor(){lr(this,"isProduction",!0);lr(this,"apiEndpoint","/api/errors")}async reportError(a,t,r){const i={message:a.message,stack:a.stack,componentStack:t==null?void 0:t.componentStack,url:window.location.href,userAgent:navigator.userAgent,timestamp:new Date().toISOString(),userId:r,sessionId:this.getSessionId()};if(!this.isProduction){console.group("🚨 Error Report"),console.error("Error:",a),console.error("Error Info:",t),console.error("Report:",i),console.groupEnd();return}try{await this.sendToErrorService(i)}catch(l){console.error("Failed to report error:",l)}}async sendToErrorService(a){try{await fetch(this.apiEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})}catch{this.storeErrorLocally(a)}}storeErrorLocally(a){try{const t=localStorage.getItem("pendingErrorReports"),r=t?JSON.parse(t):[];r.push(a),r.length>10&&r.splice(0,r.length-10),localStorage.setItem("pendingErrorReports",JSON.stringify(r))}catch(t){console.error("Failed to store error locally:",t)}}getSessionId(){let a=sessionStorage.getItem("error-session-id");return a||(a=crypto.randomUUID(),sessionStorage.setItem("error-session-id",a)),a}async retryPendingErrors(){if(this.isProduction)try{const a=localStorage.getItem("pendingErrorReports");if(!a)return;const t=JSON.parse(a);for(const r of t)await this.sendToErrorService(r);localStorage.removeItem("pendingErrorReports")}catch(a){console.error("Failed to retry pending errors:",a)}}}const Vd=new l_;typeof window<"u"&&Vd.retryPendingErrors();class Bo extends T.Component{constructor(){super(...arguments);lr(this,"state",{hasError:!1});lr(this,"handleRetry",()=>{this.setState({hasError:!1,error:void 0})});lr(this,"handleReload",()=>{window.location.reload()})}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,r){var i,l;console.error("ErrorBoundary caught an error:",t,r),Vd.reportError(t,r),(l=(i=this.props).onError)==null||l.call(i,t,r)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx("div",{className:"flex items-center justify-center min-h-[400px] p-4",children:e.jsxs(we,{className:"w-full max-w-md",children:[e.jsxs(Ae,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 flex h-12 w-12 items-center justify-center rounded-full bg-red-100",children:e.jsx(rm,{className:"h-6 w-6 text-red-600"})}),e.jsx(Ee,{children:"Something went wrong"}),e.jsx(Re,{children:"An unexpected error occurred. Please try refreshing the page or contact support if the problem persists."})]}),e.jsxs(ke,{className:"space-y-4",children:[!1,e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ee,{onClick:this.handleRetry,variant:"outline",className:"flex-1",children:[e.jsx(am,{className:"mr-2 h-4 w-4"}),"Try Again"]}),e.jsx(ee,{onClick:this.handleReload,className:"flex-1",children:"Reload Page"})]})]})]})}):this.props.children}}window.addEventListener("unhandledrejection",n=>{console.error("Unhandled promise rejection:",n.reason)});window.addEventListener("error",n=>{console.error("Uncaught error:",n.error)});Om.createRoot(document.getElementById("root")).render(e.jsx(W.StrictMode,{children:e.jsx(Bo,{onError:(n,a)=>{console.error("Root ErrorBoundary caught error:",n,a)},children:e.jsx(om,{client:a_,children:e.jsxs(bp,{children:[e.jsx(Bm,{}),e.jsx(yp,{}),e.jsx(Np,{children:e.jsx(Bo,{onError:(n,a)=>{console.error("App ErrorBoundary caught error:",n,a)},children:e.jsx(Eu,{router:o_})})})]})})})}));
